import{aZ as b,a_ as M,h as Z,a$ as t,d as h,b0 as u,aV as c,b1 as z}from"./uuid-fb53ae2e.js";import{F as R,B as l}from"./arcgisLayerUrl-fc2d909c.js";import{t as p}from"./json-48e3ea08.js";const o=[0,0];function f(i,n){if(!n)return null;if("x"in n){const s={x:0,y:0};return[s.x,s.y]=i(n.x,n.y,o),n.z!=null&&(s.z=n.z),n.m!=null&&(s.m=n.m),s}if("xmin"in n){const s={xmin:0,ymin:0,xmax:0,ymax:0};return[s.xmin,s.ymin]=i(n.xmin,n.ymin,o),[s.xmax,s.ymax]=i(n.xmax,n.ymax,o),n.hasZ&&(s.zmin=n.zmin,s.zmax=n.zmax,s.hasZ=!0),n.hasM&&(s.mmin=n.mmin,s.mmax=n.mmax,s.hasM=!0),s}return"rings"in n?{rings:m(n.rings,i),hasM:n.hasM,hasZ:n.hasZ}:"paths"in n?{paths:m(n.paths,i),hasM:n.hasM,hasZ:n.hasZ}:"points"in n?{points:x(n.points,i),hasM:n.hasM,hasZ:n.hasZ}:null}function m(i,n){const s=[];for(const r of i)s.push(x(r,n));return s}function x(i,n){const s=[];for(const r of i){const e=n(r[0],r[1],[0,0]);s.push(e),r.length>2&&e.push(r[2]),r.length>3&&e.push(r[3])}return s}async function w(i,n){if(!i||!n)return;const s=Array.isArray(i)?i.map(r=>r.geometry!=null?r.geometry.spatialReference:null).filter(Z):[i];await R(s.map(r=>({source:r,dest:n})))}const y=f.bind(null,b),g=f.bind(null,M);function A(i,n,s,r){if(!i||(s||(s=n,n=i.spatialReference),!t(n)||!t(s)||h(n,s)))return i;if(u(n,s)){const e=c(s)?y(i):g(i);return e.spatialReference=s,e}return l(p,[i],n,s,null,r)[0]}class d{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(n,s,r,e){if(!(n!=null&&n.length)||!s||!r||h(s,r))return n;const a={geometries:n,inSpatialReference:s,outSpatialReference:r,geographicTransformation:e,resolve:z()};return this._jobs.push(a),this._timer??(this._timer=setTimeout(this._process,10)),a.resolve.promise}_process(){this._timer=null;const n=this._jobs.shift();if(!n)return;const{geometries:s,inSpatialReference:r,outSpatialReference:e,resolve:a,geographicTransformation:_}=n;u(r,e)?c(e)?a(s.map(y)):a(s.map(g)):a(l(p,s,r,e,_,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}}const j=new d;function k(i,n,s,r){return j.push(i,n,s,r)}export{k as b,A as j,w as x};
