import{a as i,y as n,c as d,f as m,o as l,dh as y,e as h}from"./uuid-De2V3pkO.js";import{d as f}from"./FeatureSet-B32diVNL.js";import _ from"./FeatureLayerView2D-NvrBWOFY.js";import{e as S}from"./util-Co9CNf_x.js";import{d as v}from"./FeatureEffect-D6mxFSco.js";import"./index-OAJD89tD.js";import"./Field-CpwGNSHU.js";import"./fieldType-CQ9t6Wui.js";import"./Container-DX7KQTHt.js";import"./mat3f32-BPgNI_lm.js";import"./parser-CQvYRaWk.js";import"./mat4f32-BYh1DbDV.js";import"./mat4-DR7ljCfE.js";import"./definitions-DYuD04dF.js";import"./enums-BFYfP9qy.js";import"./Texture-BUpON3bN.js";import"./capabilities-BeSycj8J.js";import"./layerUtils-D8dZn4eh.js";import"./Query-CEg5oX17.js";import"./arcgisLayerUrl-DMpJLG2u.js";import"./FullTextSearch-C1te3nF2.js";import"./QuantizationParameters-DrrRb5JH.js";import"./LayerView-DVe-QqFJ.js";import"./scaleUtils-ApfxRMLk.js";import"./map-BEES39Ai.js";import"./Basemap-DVlQKLRn.js";import"./loadAll-Cim39wYP.js";import"./PortalItem-C8IOgJp9.js";import"./writeUtils-993Cp9iz.js";import"./compilerUtils-BndV9QTL.js";import"./CollectionFlattener-BEJgaFwb.js";import"./infoFor3D-CKoUGm1M.js";import"./basemapUtils-BPWzFCB8.js";import"./TablesMixin-BAh-Tdsn.js";import"./Cyclical-bCBpTSsi.js";import"./workers-Dp_XhR59.js";import"./TileInfo-ybWiFFHA.js";import"./jsxFactory-CrT0-KGb.js";import"./UpdatingHandles-7vim6dHb.js";import"./signal-C4o35hpO.js";import"./GraphicsCollection-DbKTAY2Z.js";import"./ViewingMode-HRfKv6NR.js";import"./unitBezier-C3UyU2rI.js";import"./mat2df32-Y88URbH1.js";import"./vec2-C6Y96AwR.js";import"./TileStore-DTOce_SM.js";import"./quickselect-Dsa-MazW.js";import"./commonjsHelpers-DCkdB7M8.js";import"./TileInfoView-CccucBWX.js";import"./vec2f64-BuJjW9A-.js";import"./normalizeUtils-CHaYFzrc.js";import"./normalizeUtilsCommon-vfKhPTnw.js";import"./mat3-Riwg5JNu.js";import"./vec2f32-DJy8k_UQ.js";import"./GoTo-BYKJE8LR.js";import"./AttributeStoreView-DRtDspVQ.js";import"./TiledDisplayObject-BVLmQerJ.js";import"./diffUtils-B9GaWVUW.js";import"./labelingInfo-C5rI8Tdf.js";import"./LabelClass-5BgkMgGD.js";import"./labelUtils-Dph0uXsk.js";import"./defaultsJSON-CHAaurhX.js";import"./jsonUtils-CqYY9-3B.js";import"./color-cT1-Ge3_.js";import"./enums-lYQiQBYo.js";import"./VertexElementDescriptor-BLyltQyJ.js";import"./WGLContainer-CCreaUuQ.js";import"./FramebufferObject-BKEPrhyG.js";import"./ProgramTemplate-CzjMKiq1.js";import"./GeometryUtils-CzofDDjY.js";import"./heatmapUtils-DncJMPvQ.js";import"./vec4f64-Jk3PXxMO.js";import"./StyleDefinition-C8U8LdH5.js";import"./config-BOD8--da.js";import"./earcut-BVL67bTw.js";import"./featureConversionUtils-BBvLZPS5.js";import"./OptimizedFeature-CuDeWVOV.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./visualVariablesUtils-CsTrhTSw.js";import"./ExpandedCIM-Dnfk4gBv.js";import"./BidiEngine-VcLDr8lR.js";import"./GeometryUtils-D08nBgDv.js";import"./utils-pl3RUk3K.js";import"./Rect-CUzevAry.js";import"./quantizationUtils-D3whBd2n.js";import"./floatRGBA-BJa16tCb.js";import"./clusterUtils-CBl3uOAm.js";import"./MD5-MtSiOt06.js";import"./SizeVariable-CEwBbtT1.js";import"./colorRamps-BC6MwlXc.js";import"./LegendOptions-FRTnoArL.js";import"./lengthUtils-C4EPlNSZ.js";import"./BitmapTileContainer-CJ7KXk9o.js";import"./Bitmap-CWIo4k0z.js";import"./TileContainer-C6bCPGX3.js";import"./CircularArray-DfLrgW_-.js";import"./BufferPool-gYR13KWI.js";import"./FeatureContainer-BV5r4dtJ.js";import"./commonProperties-7y88ic0r.js";import"./ElevationInfo-C7w4yfnq.js";import"./floorFilterUtils-n6UOt7ty.js";import"./popupUtils-mFT2nLUz.js";import"./RefreshableLayerView-D4pqx1y-.js";import"./jsonUtils-Ds9cu0Qh.js";const g=t=>{let e=class extends t{resume(){this._isUserPaused=!1,this.suspended||this._doResume()}pause(){this._isUserPaused=!0,this.suspended||this._doPause()}constructor(...r){super(...r),this._isUserPaused=!1,this.filter=null}get connectionStatus(){return this._isUserPaused?"paused":this._streamConnectionStatus}_onSuspendedChange(r){r?this._doPause():this._isUserPaused||this._doResume()}};return i([n()],e.prototype,"_isUserPaused",void 0),i([n({readOnly:!0})],e.prototype,"connectionStatus",null),i([n({type:v})],e.prototype,"filter",void 0),e=i([d("esri.layers.mixins.StreamLayerView")],e),e};function u(t,e){if(t==null&&e==null)return null;const r={};return e!=null&&(r.geometry=e.toJSON()),t!=null&&(r.where=t),r}let s=class extends g(_){constructor(){super(...arguments),this.pipelineConnectionStatus="disconnected",this.pipelineErrorString=null,this._enabledEventTypes=new Set}initialize(){this.addHandles([m((()=>this.layer.customParameters),(t=>this._proxy.updateCustomParameters(t))),this.layer.on("send-message-to-socket",(t=>this._proxy.sendMessageToSocket(t))),this.layer.on("send-message-to-client",(t=>this._proxy.sendMessageToClient(t))),m((()=>this.layer.purgeOptions),(()=>this._update())),m((()=>this.suspended),this._onSuspendedChange.bind(this))],"constructor")}get connectionError(){return this.pipelineErrorString?new l("stream-controller",this.pipelineErrorString):null}on(t,e){if(Array.isArray(t))return y(t.map((a=>this.on(a,e))));const r=["data-received","message-received"].includes(t);r&&(this._enabledEventTypes.add(t),this._proxy.enableEvent(t,!0));const p=super.on(t,e),o=this;return h((()=>{p.remove(),r&&(o._proxy.closed||o.hasEventListener(t)||o._proxy.enableEvent(t,!1))}))}queryLatestObservations(t,e){if(!(this.layer.timeInfo?.endField||this.layer.timeInfo?.startField||this.layer.timeInfo?.trackIdField))throw new l("streamlayer-no-timeField","queryLatestObservation can only be used with services that define a TrackIdField");return this._proxy.queryLatestObservations(this._cleanUpQuery(t),e).then((r=>{const p=f.fromJSON(r);return p.features.forEach((o=>{o.layer=this.layer,o.sourceLayer=this.layer})),p}))}detach(){super.detach(),this.pipelineConnectionStatus="disconnected"}get _streamConnectionStatus(){return this.pipelineConnectionStatus}_doPause(){this._proxy?.pauseStream()}_doResume(){this._proxy?.resumeStream()}_createClientOptions(){return{...super._createClientOptions(),setProperty:t=>{this.set(t.propertyName,t.value)}}}_createTileRendererHash(t){const e=`${JSON.stringify(this.layer.purgeOptions)}.${JSON.stringify(u(this.layer.definitionExpression,this.layer.geometryDefinition))})`;return super._createTileRendererHash(t)+e}async _createServiceOptions(){const t=this.layer,{objectIdField:e}=t,r=t.fields.map((c=>c.toJSON())),p=S(t.geometryType),o=t.timeInfo?.toJSON()||null,a=t.spatialReference?t.spatialReference.toJSON():null;return{type:"stream",isPaused:this._isUserPaused,fields:r,fieldsIndex:this.layer.fieldsIndex.toJSON(),geometryType:p,objectIdField:e,timeInfo:o,source:this.layer.parsedUrl,serviceFilter:u(this.layer.definitionExpression,this.layer.geometryDefinition),purgeOptions:this.layer.purgeOptions.toJSON(),enabledEventTypes:Array.from(this._enabledEventTypes.values()),spatialReference:a,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,updateInterval:this.layer.updateInterval,customParameters:t.customParameters}}};i([n()],s.prototype,"pipelineConnectionStatus",void 0),i([n()],s.prototype,"pipelineErrorString",void 0),i([n({readOnly:!0})],s.prototype,"connectionError",null),i([n({readOnly:!0})],s.prototype,"_streamConnectionStatus",null),s=i([d("esri.views.2d.layers.StreamLayerView2D")],s);const _e=s;export{_e as default};
