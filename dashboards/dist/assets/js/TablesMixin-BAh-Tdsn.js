import{l as b}from"./CollectionFlattener-BEJgaFwb.js";import{a as l,y as p,V as u,n as f,db as m,s as d,c}from"./uuid-De2V3pkO.js";import{a as g}from"./arcgisLayerUrl-DMpJLG2u.js";function x(n){return new b({getCollections:()=>[n.tables,n.layers],getChildrenFunction:r=>{const a=[];return"tables"in r&&a.push(r.tables),"layers"in r&&a.push(r.layers),a},itemFilterFunction:r=>{const a=r.parent;return!!a&&"tables"in a&&a.tables.includes(r)}})}function A(n){for(const r of n.values())r?.destroy();n.clear()}function y(n,r,a){let e,t;if(n)for(let o=0,i=n.length;o<i;o++){if(e=n.at(o),e?.[r]===a)return e;if(e?.type==="group"&&(t=y(e.layers,r,a),t))return t}}const w=n=>{let r=class extends n{constructor(...e){super(...e),this.layers=new u;const t=s=>{s.parent&&"remove"in s.parent&&s.parent.remove(s)},o=s=>{s.parent=this,this.layerAdded(s),s.type!=="elevation"&&s.type!=="base-elevation"||d.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as an operational layer and will therefore be ignored.`)},i=s=>{s.parent=null,this.layerRemoved(s)};this.addHandles([this.layers.on("before-add",(s=>t(s.item))),this.layers.on("after-add",(s=>o(s.item))),this.layers.on("after-remove",(s=>i(s.item)))])}destroy(){const e=this.layers.toArray();for(const t of e)t.destroy();this.layers.destroy()}set layers(e){this._set("layers",f(e,this._get("layers")))}add(e,t){const o=this.layers;if(t=o.getNextIndex(t),e instanceof g){const i=e;i.parent===this?this.reorder(i,t):o.add(i,t)}else m(e)?e.then((i=>{this.destroyed||this.add(i,t)})):d.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(e,t){const o=this.layers;let i=o.getNextIndex(t);e.slice().forEach((s=>{s.parent!==this?(o.add(s,i),i+=1):this.reorder(s,i)}))}findLayerById(e){return y(this.layers,"id",e)}findLayerByUid(e){return y(this.layers,"uid",e)}remove(e){return this.layers.remove(e)}removeMany(e){return this.layers.removeMany(e)}removeAll(){return this.layers.removeAll()}reorder(e,t){return this.layers.reorder(e,t)}layerAdded(e){}layerRemoved(e){}};return l([p()],r.prototype,"layers",null),r=l([c("esri.support.LayersMixin")],r),r};function h(n,r,a){if(n)for(let e=0,t=n.length;e<t;e++){const o=n.at(e);if(o[r]===a)return o;if(o?.type==="group"){const i=h(o.tables,r,a);if(i)return i}}}const B=n=>{let r=class extends n{constructor(...a){super(...a),this.tables=new u,this.addHandles([this.tables.on("after-add",(e=>{const t=e.item;t.parent&&t.parent!==this&&"tables"in t.parent&&t.parent.tables.remove(t),t.parent=this,t.type!=="feature"&&d.getLogger(this).error(`Layer 'title:${t.title}, id:${t.id}' of type '${t.type}' is not supported as a table and will therefore be ignored.`)})),this.tables.on("after-remove",(e=>{e.item.parent=null}))])}destroy(){const a=this.tables.toArray();for(const e of a)e.destroy();this.tables.destroy()}set tables(a){this._set("tables",f(a,this._get("tables")))}findTableById(a){return h(this.tables,"id",a)}findTableByUid(a){return h(this.tables,"uid",a)}};return l([p()],r.prototype,"tables",null),r=l([c("esri.support.TablesMixin")],r),r};export{w as d,B as l,A as n,x as t};
