const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./symbolLayerUtils-Bys_tSQ1.js","./index-OAJD89tD.js","./uuid-De2V3pkO.js","./LRUCache-DMLtX-OB.js"])))=>i.map(i=>d[i]);
import{_ as d}from"./index-OAJD89tD.js";import{aK as c,cn as m,eF as h,eG as S,eH as M,eI as g}from"./uuid-De2V3pkO.js";import"./parser-CQvYRaWk.js";import"./mat4f32-BYh1DbDV.js";import"./mat4-DR7ljCfE.js";import{f as C,u as I,M as z,y as L,m as j}from"./utils-pl3RUk3K.js";import{e as x}from"./LRUCache-DMLtX-OB.js";function P(o){const t=[];return y(C(o),t),t.length?new c(I(t[0])):null}function y(o,t){if(!o)return;let r;r=o.type==="CIMTextSymbol"?o.symbol:o;const n=o.type==="CIMPolygonSymbol";if(r?.symbolLayers){for(const l of r.symbolLayers)if(!(l.colorLocked||n&&(z(l)||L(l)&&l.markerPlacement&&j(l.markerPlacement))))switch(l.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":l.tintColor&&b(t,l.tintColor);break;case"CIMVectorMarker":l.markerGraphics?.forEach((e=>{y(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":b(t,l.color);break;case"CIMHatchFill":y(l.lineSymbol,t)}}}function b(o,t){for(const r of o)if(r.join(".")===t.join("."))return;o.push(t)}new x(1e3);new c([128,128,128]);const _=new c("white");function Q(o,t){if(!o)return null;let r=null;return m(o)?r=$(o):h(o)&&(r=o.type==="cim"?P(o):o.color?new c(o.color):null),r?f(r,t):null}function $(o){const t=o.symbolLayers;if(!t)return null;let r=null;return t.forEach((n=>{n.type==="object"&&n.resource?.href||(r=n.type==="water"?n.color:n.material?n.material.color:null)})),r?new c(r):null}function f(o,t){if(t==null||o==null)return o;const r=o.toRgba();return r[3]=r[3]*t,new c(r)}function v(o,t,r){const n=o.symbolLayers;if(!n)return;const l=e=>f(t=t??e??(r!=null?_:null),r);n.forEach((e=>{if(e.type!=="object"||!e.resource?.href||t)if(e.type==="water")e.color=l(e.color);else{const a=e.material!=null?e.material.color:null,u=l(a);e.material==null?e.material=new M({color:u}):e.material.color=u,r!=null&&"outline"in e&&e.outline?.color!=null&&(e.outline.color=f(e.outline.color,r))}}))}function E(o,t,r){(t=t??o.color)&&(o.color=f(t,r)),r!=null&&"outline"in o&&o.outline?.color&&(o.outline.color=f(o.outline.color,r))}function W(o,t,r){o&&(t||r!=null)&&(t&&(t=new c(t)),m(o)?v(o,t,r):h(o)&&E(o,t,r))}async function F(o,t){const r=o.symbolLayers;r&&await S(r,(async n=>R(n,t)))}async function R(o,t){switch(o.type){case"extrude":D(o,t);break;case"icon":case"line":case"text":O(o,t);break;case"path":H(o,t);break;case"object":await G(o,t)}}function O(o,t){const r=w(t);r!=null&&(o.size=r)}function w(o){for(const t of o)if(typeof t=="number")return t;return null}function D(o,t){o.size=typeof t[2]=="number"?t[2]:0}async function G(o,t){const{resourceSize:r,symbolSize:n}=await T(o),l=k(t,r,n);o.width=s(t[0],n[0],r[0],l),o.depth=s(t[1],n[1],r[1],l),o.height=s(t[2],n[2],r[2],l)}function H(o,t){const r=k(t,g,[o.width,void 0,o.height]);o.width=s(t[0],o.width,1,r),o.height=s(t[2],o.height,1,r)}function k(o,t,r){for(let n=0;n<3;n++){const l=o[n];switch(l){case"symbol-value":{const e=r[n];return e!=null?e/t[n]:1}case"proportional":break;default:if(l&&t[n])return l/t[n]}}return 1}async function T(o){const{computeObjectLayerResourceSize:t}=await d(()=>import("./symbolLayerUtils-Bys_tSQ1.js"),__vite__mapDeps([0,1,2,3]),import.meta.url),r=await t(o,10),{width:n,height:l,depth:e}=o,a=[n,e,l];let u=1;for(let i=0;i<3;i++){const p=a[i];if(p!=null){u=p/r[i];break}}for(let i=0;i<3;i++)a[i]==null&&(a[i]=r[i]*u);return{resourceSize:r,symbolSize:a}}function s(o,t,r,n){switch(o){case"proportional":return r*n;case"symbol-value":return t??r;default:return o}}function V(o,t){const r=w(t);if(r!=null)switch(o.type){case"simple-marker":o.size=r;break;case"picture-marker":{const n=o.width/o.height;n>1?(o.width=r,o.height=r*n):(o.width=r*n,o.height=r);break}case"simple-line":o.width=r;break;case"text":o.font.size=r}}async function X(o,t){if(o&&t)return m(o)?F(o,t):void(h(o)&&V(o,t))}function Y(o,t,r){if(o&&t!=null)if(m(o)){const n=o.symbolLayers;n&&n.forEach((l=>{if(l&&l.type==="object")switch(r){case"tilt":l.tilt=t;break;case"roll":l.roll=t;break;default:l.heading=t}}))}else h(o)&&(o.type!=="simple-marker"&&o.type!=="picture-marker"&&o.type!=="text"||(o.angle=t))}async function Z(o,t){return await o.fetchSymbol(t)||o.fetchCIMSymbol(t)}export{Y as D,Z as N,X as R,Q as h,W as k};
