import{g as u,V as f,h as w,e as l,f as p,P as h,v as y,a as _,c as V}from"./uuid-De2V3pkO.js";import{m as v,u as C}from"./LayerView-DVe-QqFJ.js";import{i as c}from"./GraphicContainer-B0JHZwYr.js";import{r as g}from"./GraphicsView2D-D913Qe__.js";import"./index-OAJD89tD.js";import"./scaleUtils-ApfxRMLk.js";import"./Container-DX7KQTHt.js";import"./mat3f32-BPgNI_lm.js";import"./parser-CQvYRaWk.js";import"./mat4f32-BYh1DbDV.js";import"./mat4-DR7ljCfE.js";import"./definitions-DYuD04dF.js";import"./enums-BFYfP9qy.js";import"./Texture-BUpON3bN.js";import"./capabilities-BeSycj8J.js";import"./map-BEES39Ai.js";import"./Basemap-DVlQKLRn.js";import"./loadAll-Cim39wYP.js";import"./PortalItem-C8IOgJp9.js";import"./writeUtils-993Cp9iz.js";import"./layerUtils-D8dZn4eh.js";import"./compilerUtils-BndV9QTL.js";import"./CollectionFlattener-BEJgaFwb.js";import"./infoFor3D-CKoUGm1M.js";import"./basemapUtils-BPWzFCB8.js";import"./TablesMixin-BAh-Tdsn.js";import"./arcgisLayerUrl-DMpJLG2u.js";import"./Cyclical-bCBpTSsi.js";import"./workers-Dp_XhR59.js";import"./TileInfo-ybWiFFHA.js";import"./jsxFactory-CrT0-KGb.js";import"./UpdatingHandles-7vim6dHb.js";import"./signal-C4o35hpO.js";import"./GraphicsCollection-DbKTAY2Z.js";import"./ViewingMode-HRfKv6NR.js";import"./unitBezier-C3UyU2rI.js";import"./mat2df32-Y88URbH1.js";import"./vec2-C6Y96AwR.js";import"./TileStore-DTOce_SM.js";import"./quickselect-Dsa-MazW.js";import"./commonjsHelpers-DCkdB7M8.js";import"./QuantizationParameters-DrrRb5JH.js";import"./TileInfoView-CccucBWX.js";import"./vec2f64-BuJjW9A-.js";import"./normalizeUtils-CHaYFzrc.js";import"./normalizeUtilsCommon-vfKhPTnw.js";import"./mat3-Riwg5JNu.js";import"./vec2f32-DJy8k_UQ.js";import"./GoTo-BYKJE8LR.js";import"./color-cT1-Ge3_.js";import"./enums-lYQiQBYo.js";import"./VertexElementDescriptor-BLyltQyJ.js";import"./BaseGraphicContainer-DZjiSQFU.js";import"./FeatureContainer-BV5r4dtJ.js";import"./AttributeStoreView-DRtDspVQ.js";import"./TiledDisplayObject-BVLmQerJ.js";import"./diffUtils-B9GaWVUW.js";import"./labelingInfo-C5rI8Tdf.js";import"./LabelClass-5BgkMgGD.js";import"./labelUtils-Dph0uXsk.js";import"./defaultsJSON-CHAaurhX.js";import"./jsonUtils-CqYY9-3B.js";import"./WGLContainer-CCreaUuQ.js";import"./FramebufferObject-BKEPrhyG.js";import"./ProgramTemplate-CzjMKiq1.js";import"./GeometryUtils-CzofDDjY.js";import"./heatmapUtils-DncJMPvQ.js";import"./vec4f64-Jk3PXxMO.js";import"./StyleDefinition-C8U8LdH5.js";import"./config-BOD8--da.js";import"./earcut-BVL67bTw.js";import"./featureConversionUtils-BBvLZPS5.js";import"./OptimizedFeature-CuDeWVOV.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./visualVariablesUtils-CsTrhTSw.js";import"./ExpandedCIM-Dnfk4gBv.js";import"./BidiEngine-VcLDr8lR.js";import"./GeometryUtils-D08nBgDv.js";import"./utils-pl3RUk3K.js";import"./Rect-CUzevAry.js";import"./quantizationUtils-D3whBd2n.js";import"./floatRGBA-BJa16tCb.js";import"./clusterUtils-CBl3uOAm.js";import"./MD5-MtSiOt06.js";import"./SizeVariable-CEwBbtT1.js";import"./colorRamps-BC6MwlXc.js";import"./LegendOptions-FRTnoArL.js";import"./lengthUtils-C4EPlNSZ.js";import"./util-Co9CNf_x.js";import"./TileContainer-C6bCPGX3.js";import"./vec3f32-CYGJTZYG.js";import"./normalizeUtilsSync-BoYPclmC.js";import"./projectionSupport-DtScbnKU.js";import"./json-Wa8cmqdu.js";import"./Matcher-CavG8wnV.js";import"./tileUtils-B7X19rIS.js";import"./TurboLine-ADRWAXBV.js";import"./LRUCache-DMLtX-OB.js";import"./ComputedAttributeStorage-AKRlEkJh.js";import"./FieldsIndex-dTLkFgHd.js";import"./TimeOnly-LdAwpTO1.js";const d="sublayers",m="layerView";let n=class extends v(C){constructor(){super(...arguments),this._highlightIds=new Map}async fetchPopupFeatures(i){return Array.from(this.graphicsViews(),(t=>t.hitTest(i).filter((r=>!!r.popupTemplate)))).flat()}*graphicsViews(){this._graphicsViewsFeatureCollectionMap==null?this._graphicsViews==null?yield*[]:yield*this._graphicsViews:yield*this._graphicsViewsFeatureCollectionMap.keys()}async hitTest(i,t){return Array.from(this.graphicsViews(),(r=>{const e=r.hitTest(i);if(this._graphicsViewsFeatureCollectionMap!=null){const o=this._graphicsViewsFeatureCollectionMap.get(r);for(const s of e)!s.popupTemplate&&o.popupTemplate&&(s.popupTemplate=o.popupTemplate),s.sourceLayer=s.layer=this.layer}return e})).flat().map((r=>({type:"graphic",graphic:r,layer:this.layer,mapPoint:i})))}highlight(i){let t;typeof i=="number"?t=[i]:i instanceof u?t=[i.uid]:Array.isArray(i)&&i.length>0?t=typeof i[0]=="number"?i:i.map((e=>e&&e.uid)):f.isCollection(i)&&(t=i.map((e=>e&&e.uid)).toArray());const r=t?.filter(w);return r?.length?(this._addHighlight(r),l((()=>this._removeHighlight(r)))):l()}update(i){for(const t of this.graphicsViews())t.processUpdate(i)}attach(){const i=this.view,t=()=>this.requestUpdate(),r=this.layer.featureCollections;if(r!=null&&r.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const e of r){const o=new c(this.view.featuresTilingScheme),s=new g({view:i,graphics:e.source,renderer:e.renderer,requestUpdateCallback:t,container:o});this._graphicsViewsFeatureCollectionMap.set(s,e),this.container.addChild(s.container),this.addHandles([p((()=>e.visible),(a=>s.container.visible=a),h),p((()=>s.updating),(()=>this.notifyChange("updating")),h)],m)}this._updateHighlight()}else this.layer.sublayers!=null&&this.addHandles(y((()=>this.layer.sublayers),"change",(()=>this._createGraphicsViews()),{onListenerAdd:()=>this._createGraphicsViews(),onListenerRemove:()=>this._destroyGraphicsViews()}),d)}detach(){this._destroyGraphicsViews(),this.removeHandles(d)}moveStart(){}moveEnd(){}viewChange(){for(const i of this.graphicsViews())i.viewChange()}isUpdating(){for(const i of this.graphicsViews())if(i.updating)return!0;return!1}_destroyGraphicsViews(){this.container.removeAllChildren(),this.removeHandles(m);for(const i of this.graphicsViews())i.destroy();this._graphicsViews=null,this._graphicsViewsFeatureCollectionMap=null}_createGraphicsViews(){if(this._destroyGraphicsViews(),this.layer.sublayers==null)return;const i=[],t=this.view,r=()=>this.requestUpdate();for(const e of this.layer.sublayers){const o=new c(this.view.featuresTilingScheme);o.fadeTransitionEnabled=!0;const s=new g({view:t,graphics:e.graphics,requestUpdateCallback:r,container:o});this.addHandles([e.on("graphic-update",s.graphicUpdateHandler),p((()=>e.visible),(a=>s.container.visible=a),h),p((()=>s.updating),(()=>this.notifyChange("updating")),h)],m),this.container.addChild(s.container),i.push(s)}this._graphicsViews=i,this._updateHighlight()}_addHighlight(i){for(const t of i)if(this._highlightIds.has(t)){const r=this._highlightIds.get(t);this._highlightIds.set(t,r+1)}else this._highlightIds.set(t,1);this._updateHighlight()}_removeHighlight(i){for(const t of i)if(this._highlightIds.has(t)){const r=this._highlightIds.get(t)-1;r===0?this._highlightIds.delete(t):this._highlightIds.set(t,r)}this._updateHighlight()}_updateHighlight(){const i=Array.from(this._highlightIds.keys());for(const t of this.graphicsViews())t.setHighlight(i)}};n=_([V("esri.views.2d.layers.MapNotesLayerView2D")],n);const ft=n;export{ft as default};
