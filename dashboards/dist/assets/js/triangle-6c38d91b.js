import{bz as U,bJ as j,c8 as g,eQ as A,C as x,eR as N,ca as z,dX as q,bW as J}from"./uuid-854440a9.js";import{s as w}from"./Indices-eada83b8.js";import{s as L}from"./sphere-8ac68e6d.js";import{v as Q}from"./lineSegment-148c0b63.js";var O;(function(i){i[i.Layer=0]="Layer",i[i.Object=1]="Object",i[i.Mesh=2]="Mesh",i[i.Line=3]="Line",i[i.Point=4]="Point",i[i.Material=5]="Material",i[i.Texture=6]="Texture",i[i.COUNT=7]="COUNT"})(O||(O={}));class T{constructor(o,d,u){this.primitiveIndices=o,this._numIndexPerPrimitive=d,this.position=u,this._children=void 0,w(o.length>=1),w(u.size===3||u.size===4);const{data:e,size:l,indices:p}=u;w(p.length%this._numIndexPerPrimitive==0),w(p.length>=o.length*this._numIndexPerPrimitive);const I=o.length;let s=l*p[this._numIndexPerPrimitive*o[0]];f.clear(),f.push(s);const n=j(e[s],e[s+1],e[s+2]),t=g(n);for(let a=0;a<I;++a){const m=this._numIndexPerPrimitive*o[a];for(let c=0;c<this._numIndexPerPrimitive;++c){s=l*p[m+c],f.push(s);let h=e[s];n[0]=Math.min(h,n[0]),t[0]=Math.max(h,t[0]),h=e[s+1],n[1]=Math.min(h,n[1]),t[1]=Math.max(h,t[1]),h=e[s+2],n[2]=Math.min(h,n[2]),t[2]=Math.max(h,t[2])}}this.bbMin=n,this.bbMax=t;const r=A(x(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(t[0]-n[0],t[1]-n[1]),t[2]-n[2]);let P=this.radius*this.radius;for(let a=0;a<f.length;++a){s=f.at(a);const m=e[s]-r[0],c=e[s+1]-r[1],h=e[s+2]-r[2],b=m*m+c*c+h*h;if(b<=P)continue;const v=Math.sqrt(b),_=.5*(v-this.radius);this.radius=this.radius+_,P=this.radius*this.radius;const M=_/v;r[0]+=m*M,r[1]+=c*M,r[2]+=h*M}this.center=r,f.clear()}getChildren(){if(this._children||N(this.bbMin,this.bbMax)<=1)return this._children;const o=A(x(),this.bbMin,this.bbMax,.5),d=this.primitiveIndices.length,u=new Uint8Array(d),e=new Array(8);for(let t=0;t<8;++t)e[t]=0;const{data:l,size:p,indices:I}=this.position;for(let t=0;t<d;++t){let r=0;const P=this._numIndexPerPrimitive*this.primitiveIndices[t];let a=p*I[P],m=l[a],c=l[a+1],h=l[a+2];for(let b=1;b<this._numIndexPerPrimitive;++b){a=p*I[P+b];const v=l[a],_=l[a+1],M=l[a+2];v<m&&(m=v),_<c&&(c=_),M<h&&(h=M)}m<o[0]&&(r|=1),c<o[1]&&(r|=2),h<o[2]&&(r|=4),u[t]=r,++e[r]}let s=0;for(let t=0;t<8;++t)e[t]>0&&++s;if(s<2)return;const n=new Array(8);for(let t=0;t<8;++t)n[t]=e[t]>0?new Uint32Array(e[t]):void 0;for(let t=0;t<8;++t)e[t]=0;for(let t=0;t<d;++t){const r=u[t];n[r][e[r]++]=this.primitiveIndices[t]}this._children=new Array;for(let t=0;t<8;++t)n[t]!==void 0&&this._children.push(new T(n[t],this._numIndexPerPrimitive,this.position));return this._children}static prune(){f.prune()}}const f=new U({deallocator:null});function R(i){return i?{p0:g(i.p0),p1:g(i.p1),p2:g(i.p2)}:{p0:x(),p1:x(),p2:x()}}function k(i,o,d){return z(y,o,i),z(C,d,i),q(J(y,y,C))/2}new L(Q);new L(()=>R());const y=x(),C=x();export{O as e,T as o,k as w};
