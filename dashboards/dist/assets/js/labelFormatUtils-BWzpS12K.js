import{d6 as w,s as b,o as f,d7 as g,d8 as h,ao as v,bb as y,ba as x,ap as $,d9 as E}from"./uuid-De2V3pkO.js";import{x as F,_ as A}from"./labelUtils-Dph0uXsk.js";import"./index-OAJD89tD.js";const d=b.getLogger("esri.layers.support.labelFormatUtils"),p={type:"simple",evaluate:()=>null},L={getAttribute:(r,t)=>r.field(t)};async function H(r,t,c){if(!r||!r.symbol||!t)return p;const s=r.where,l=F(r);let a;if(l.type==="arcade"){const e=await g(l.expression,c,t);if(e==null)return p;a={type:"arcade",evaluate(u,n){try{const o="attributes"in u?e.repurposeFeature(u):u;o.contextTimeZone=n??null;const i=e.evaluate({$view:{timeZone:n},$feature:o},e.services);if(i!=null)return i.toString()}catch(o){d.error(new f("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:o,feature:u,expression:l}))}return null},needsHydrationToEvaluate:()=>A(l.expression)==null}}else a={type:"simple",evaluate:e=>l.expression.replaceAll(/{[^}]*}/g,(u=>{const n=u.slice(1,-1),o=t.get(n);if(!o)return u;let i=null;return"attributes"in e?e&&e.attributes&&(i=e.attributes[o.name]):i=e.field(o.name),i==null?"":T(i,o)}))};if(s){let e;try{e=await w(s,t)}catch(n){return d.error(new f("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:s,error:n})),p}const u=a.evaluate;a.evaluate=(n,o)=>{const i="attributes"in n?void 0:L;try{if(e.testFeature(n,i))return u(n,o)}catch(m){d.error(new f("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:s,feature:n,error:m}))}return null}}return a}function T(r,t){if(r==null)return"";const c=t.domain;if(c){if(c.type==="codedValue"||c.type==="coded-value"){const l=r;for(const a of c.codedValues)if(a.code===l)return a.name}else if(c.type==="range"){const{max:l,min:a}=h(t),e=+r;if(a!=null&&l!=null&&a<=e&&e<=l)return c.name}}let s=r;return v(t)?s=y(s,x("short-date")):$(t)&&(s=E(+s)),s||""}export{H as createLabelFunction,T as formatField};
