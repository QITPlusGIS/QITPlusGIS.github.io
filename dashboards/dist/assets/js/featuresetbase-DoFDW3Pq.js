import{m as Fe}from"./TimeOnly-LdAwpTO1.js";import{l as N,K as De,X as J,H as L,b as v,a as m,r as p,P,c as b,x as Te,y as fe,Q as ue,A as S,B as U,q as A,U as G,E as Ee,$ as M,J as be,v as Ne,p as O,D as Ae,S as xe,T as _,V as X,Y}from"./arcadeUtils-n9cXjWJA.js";import{e as de,j as Le,q as ce,f as Se,c as me,a as Ce,b as ve,d as Pe,g as q,k as Ze,F as $e,T as Re,B as k,h as ke,i as B,L as C,I as ee}from"./featureSetUtils-BtPKSOXU.js";import{l as Me}from"./portalUtils-B4YgCz6M.js";import{u as Ue,D as pe}from"./SpatialFilter-y465MIPM.js";import{Z as ye,db as Oe}from"./uuid-De2V3pkO.js";import{I as T}from"./WhereClause-BcQt-S-F.js";import{Z as te}from"./FeatureLayer-XPLTGHtu.js";import{y as W}from"./Field-CpwGNSHU.js";import"./index-OAJD89tD.js";import"./number-CZPYs-P5.js";import"./featureConversionUtils-BBvLZPS5.js";import"./OptimizedFeature-CuDeWVOV.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./FieldsIndex-dTLkFgHd.js";import"./MD5-MtSiOt06.js";import"./SubtypeGroupLayer-oO41KkqE.js";import"./loadAll-Cim39wYP.js";import"./MultiOriginJSONSupport-Df7Mn0iX.js";import"./arcgisLayerUrl-DMpJLG2u.js";import"./APIKeyMixin-CcEMCMh8.js";import"./ArcGISService-B9AkhE_C.js";import"./BlendLayer-4Nq3kFEk.js";import"./jsonUtils-Ds9cu0Qh.js";import"./parser-CQvYRaWk.js";import"./mat4f32-BYh1DbDV.js";import"./mat4-DR7ljCfE.js";import"./CustomParametersMixin-B-WvQlLz.js";import"./EditBusLayer-Z-bxRsy2.js";import"./FeatureLayerBase-Vxy7-5Ka.js";import"./commonProperties-7y88ic0r.js";import"./ElevationInfo-C7w4yfnq.js";import"./lengthUtils-C4EPlNSZ.js";import"./featureLayerUtils-JQb3hLRE.js";import"./Query-CEg5oX17.js";import"./FullTextSearch-C1te3nF2.js";import"./QuantizationParameters-DrrRb5JH.js";import"./layerUtils-D8dZn4eh.js";import"./jsonUtils-CshCi2EU.js";import"./UniqueValueRenderer-DdZymv08.js";import"./LegendOptions-FRTnoArL.js";import"./diffUtils-B9GaWVUW.js";import"./SizeVariable-CEwBbtT1.js";import"./colorRamps-BC6MwlXc.js";import"./compilerUtils-BndV9QTL.js";import"./ColorStop-B_V1vtMl.js";import"./jsonUtils-CqYY9-3B.js";import"./styleUtils-IlLdeGfy.js";import"./DictionaryLoader-Bl9OQ4Ss.js";import"./LRUCache-DMLtX-OB.js";import"./heatmapUtils-DncJMPvQ.js";import"./vec4f64-Jk3PXxMO.js";import"./AttachmentQuery-BX_2HFsg.js";import"./RelationshipQuery-CSVnFDD7.js";import"./fieldType-CQ9t6Wui.js";import"./LayerFloorInfo-DRZBdyCP.js";import"./serviceCapabilitiesUtils-BVYFxrwG.js";import"./OperationalLayer-Bx6pTHh7.js";import"./PortalLayer-DU1TFOEn.js";import"./PortalItem-C8IOgJp9.js";import"./portalItemUtils-2ng-Kvae.js";import"./RefreshableLayer-BEFOmf5k.js";import"./ScaleRangeLayer-cDV6S-UX.js";import"./TemporalLayer-B6MVRSR-.js";import"./fieldProperties-BBmuKf7F.js";import"./FeatureTemplate-CuIcCtQS.js";import"./LabelClass-5BgkMgGD.js";import"./labelUtils-Dph0uXsk.js";import"./defaultsJSON-CHAaurhX.js";import"./labelingInfo-C5rI8Tdf.js";import"./popupUtils-tKvJKde2.js";import"./versionUtils-go49xXEj.js";import"./interfaces-CL2NbQte.js";import"./infoFor3D-CKoUGm1M.js";import"./executeQueryJSON-BPmRxjW1.js";import"./query-Dc0QFYci.js";import"./normalizeUtils-CHaYFzrc.js";import"./normalizeUtilsCommon-vfKhPTnw.js";import"./pbfQueryUtils-CF_kx7yC.js";import"./pbf-Jel0b315.js";import"./queryZScale-BHsgP0Ac.js";import"./FeatureSet-B32diVNL.js";import"./executeQueryPBF-cAc13GFo.js";import"./AttachmentInfo-CH3MnwK5.js";import"./executeForIds-DVUzyPe5.js";import"./TopFeaturesQuery-BR6kql40.js";import"./FeatureType-okWbna3M.js";import"./geometryEngineAsync-BjWQzrry.js";import"./workers-Dp_XhR59.js";import"./FeatureEffectLayer-C-VkqhLI.js";import"./FeatureEffect-D6mxFSco.js";import"./FeatureReductionLayer-CMPQavUU.js";import"./clusterUtils-CBl3uOAm.js";import"./FeatureReductionSelection-BdTwQHJB.js";import"./OrderedLayer-CDjvvtKC.js";import"./styleUtils-CfnOzvk7.js";function ze(s,t,r,c){if(c.length===1){if(A(c[0]))return Y(s,c[0],-1);if(M(c[0]))return Y(s,c[0].toArray(),-1)}return Y(s,c,-1)}async function ne(s,t,r){const c=s.getVariables();if(c.length>0){const g=[];for(let n=0;n<c.length;n++){const a={name:c[n]};g.push(await t.evaluateIdentifier(r,a))}const e={};for(let n=0;n<c.length;n++)e[c[n]]=g[n];return s.parameters=e,s}return s}function d(s,t,r=null){for(const c in s)if(c.toLowerCase()===t.toLowerCase())return s[c];return r}function we(s){if(s===null)return null;const t={type:d(s,"type",""),name:d(s,"name","")};if(t.type==="range")t.range=d(s,"range",[]);else{t.codedValues=[];for(const r of d(s,"codedValues",[]))t.codedValues.push({name:d(r,"name",""),code:d(r,"code",null)})}return t}function ie(s){if(s===null)return null;const t={},r=d(s,"wkt",null);r!==null&&(t.wkt=r);const c=d(s,"wkid",null);return c!==null&&(t.wkid=c),t}function he(s){if(s===null)return null;const t={hasZ:d(s,"hasz",!1),hasM:d(s,"hasm",!1)},r=d(s,"spatialreference",null);r&&(t.spatialReference=ie(r));const c=d(s,"x",null);if(c!==null)return t.x=c,t.y=d(s,"y",null),t;const g=d(s,"rings",null);if(g!==null)return t.rings=g,t;const e=d(s,"paths",null);if(e!==null)return t.paths=e,t;const n=d(s,"points",null);if(n!==null)return t.points=n,t;for(const a of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){const u=d(s,a,null);u!==null&&(t[a]=u)}return t}function je(s,t){for(const r of t)if(r===s)return!0;return!1}function He(s){return!!s.layerDefinition&&!!s.featureSet&&je(s.layerDefinition.geometryType,["",null,"esriGeometryNull","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])!==!1&&A(s.layerDefinition.fields)!==!1&&A(s.featureSet.features)!==!1}function z(s){return s?.toLowerCase()==="utc"?"UTC":s?.toLowerCase()==="unknown"?"Unknown":s}function Pn(s){s.mode==="async"&&(s.functions.timezone=function(t,r){return s.standardFunctionAsync(t,r,(async(c,g,e)=>{if(N(e,1,2,t,r),De(e[0])||J(e[0]))return"Unknown";if(L(e[0])){if(await e[0].load(),e.length===1||e[1]===null)return e[0].datesInUnknownTimezone?z("unknown"):z(e[0].dateFieldsTimeZone);if(!(e[1]instanceof v)||e[1].hasField("type")===!1)throw new m(t,p.InvalidParameter,r);const u=e[1].field("type");if(P(u)===!1)throw new m(t,p.InvalidParameter,r);switch(b(u).toLowerCase()){case"preferredtimezone":return z(e[0].preferredTimeZone);case"editfieldsinfo":return z(e[0].editFieldsInfo?.timeZone??null);case"timeinfo":return z(e[0].timeInfo?.timeZone??null);case"field":if(e[1].hasField("fieldname")&&P(e[1].field("fieldname")))return z(e[0].fieldTimeZone(b(e[1].field("fieldname"))))}throw new m(t,p.InvalidParameter,r)}const n=Te(e[0],fe(t));if(n===null)return null;const a=n.timeZone;return a==="system"?Fe.systemTimeZoneCanonicalName:a.toLowerCase()==="utc"?"UTC":a.toLowerCase()==="unknown"?"Unknown":a}))},s.functions.sqltimestamp=function(t,r){return s.standardFunctionAsync(t,r,(async(c,g,e)=>{N(e,1,3,t,r);const n=e[0];if(ue(n)){if(e.length===1)return n.toSQLWithKeyword();if(e.length===2)return n.changeTimeZone(b(e[1])).toSQLWithKeyword();throw new m(t,p.InvalidParameter,r)}if(J(n))return n.toSQLWithKeyword();if(L(n)){if(e.length!==3)throw new m(t,p.InvalidParameter,r);await n.load();const a=b(e[1]);if(J(e[2]))return e[2].toSQLWithKeyword();if(ue(e[2])===!1)throw new m(t,p.InvalidParameter,r);const u=n.fieldTimeZone(a);return u===null?e[2].toSQLWithKeyword():e[2].changeTimeZone(u).toSQLWithKeyword()}throw new m(t,p.InvalidParameter,r)}))},s.signatures.push({name:"sqltimestamp",min:2,max:4}),s.functions.featuresetbyid=function(t,r){return s.standardFunctionAsync(t,r,((c,g,e)=>{if(N(e,2,4,t,r),e[0]instanceof de){const n=b(e[1]);let a=S(e[2],null);const u=U(S(e[3],!0));if(a===null&&(a=["*"]),A(a)===!1)throw new m(t,p.InvalidParameter,r);return e[0].featureSetById(n,u,a)}throw new m(t,p.InvalidParameter,r)}))},s.signatures.push({name:"featuresetbyid",min:2,max:4}),s.functions.getfeatureset=function(t,r){return s.standardFunctionAsync(t,r,((c,g,e)=>{if(N(e,1,2,t,r),G(e[0])){let n=S(e[1],"datasource");return n===null&&(n="datasource"),n=b(n).toLowerCase(),Le(e[0].fullSchema(),n,t.lrucache,t.interceptor,t.spatialReference)}throw new m(t,p.InvalidParameter,r)}))},s.signatures.push({name:"getfeatureset",min:1,max:2}),s.functions.featuresetbyportalitem=function(t,r){return s.standardFunctionAsync(t,r,((c,g,e)=>{if(N(e,2,5,t,r),e[0]===null)throw new m(t,p.PortalRequired,r);if(e[0]instanceof Ee){const o=b(e[1]),i=b(e[2]);let l=S(e[3],null);const f=U(S(e[4],!0));if(l===null&&(l=["*"]),A(l)===!1)throw new m(t,p.InvalidParameter,r);let I=null;return I=t.services?.portal?t.services.portal:ye.getDefault(),I=Me(e[0],I),ce(o,i,t.spatialReference,l,f,I,t.lrucache,t.interceptor)}if(P(e[0])===!1)throw new m(t,p.PortalRequired,r);const n=b(e[0]),a=b(e[1]);let u=S(e[2],null);const y=U(S(e[3],!0));if(u===null&&(u=["*"]),A(u)===!1)throw new m(t,p.InvalidParameter,r);return ce(n,a,t.spatialReference,u,y,t.services?.portal??ye.getDefault(),t.lrucache,t.interceptor)}))},s.signatures.push({name:"featuresetbyportalitem",min:2,max:5}),s.functions.featuresetbyname=function(t,r){return s.standardFunctionAsync(t,r,((c,g,e)=>{if(N(e,2,4,t,r),e[0]instanceof de){const n=b(e[1]);let a=S(e[2],null);const u=U(S(e[3],!0));if(a===null&&(a=["*"]),A(a)===!1)throw new m(t,p.InvalidParameter,r);return e[0].featureSetByName(n,u,a)}throw new m(t,p.InvalidParameter,r)}))},s.signatures.push({name:"featuresetbyname",min:2,max:4}),s.functions.featureset=function(t,r){return s.standardFunction(t,r,((c,g,e)=>{N(e,1,1,t,r);let n=e[0];const a={layerDefinition:{geometryType:"",objectIdField:"",hasM:!1,hasZ:!1,globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if(P(n))n=JSON.parse(n),n.layerDefinition!==void 0?(a.layerDefinition=n.layerDefinition,a.featureSet=n.featureSet,n.layerDefinition.spatialReference&&(a.layerDefinition.spatialReference=n.layerDefinition.spatialReference)):(a.featureSet.features=n.features,a.featureSet.geometryType=n.geometryType,a.layerDefinition.geometryType=a.featureSet.geometryType,a.layerDefinition.objectIdField=n.objectIdFieldName??"",a.layerDefinition.typeIdField=n.typeIdFieldName,a.layerDefinition.globalIdField=n.globalIdFieldName,a.layerDefinition.fields=n.fields,n.spatialReference&&(a.layerDefinition.spatialReference=n.spatialReference));else{if(!(e[0]instanceof v))throw new m(t,p.InvalidParameter,r);{n=JSON.parse(e[0].castToText(!0));const u=d(n,"layerdefinition");if(u!==null){a.layerDefinition.geometryType=d(u,"geometrytype",""),a.featureSet.geometryType=a.layerDefinition.geometryType,a.layerDefinition.globalIdField=d(u,"globalidfield",""),a.layerDefinition.objectIdField=d(u,"objectidfield",""),a.layerDefinition.typeIdField=d(u,"typeidfield",""),a.layerDefinition.hasZ=d(u,"hasz",!1)===!0,a.layerDefinition.hasM=d(u,"hasm",!1)===!0;const y=d(u,"spatialreference",null);y&&(a.layerDefinition.spatialReference=ie(y));for(const i of d(u,"fields",[])){const l={name:d(i,"name",""),alias:d(i,"alias",""),type:d(i,"type",""),nullable:d(i,"nullable",!0),editable:d(i,"editable",!0),length:d(i,"length",null),domain:we(d(i,"domain"))};a.layerDefinition.fields.push(l)}const o=d(n,"featureset",null);if(o){const i={};for(const l of a.layerDefinition.fields)i[l.name.toLowerCase()]=l.name;for(const l of d(o,"features",[])){const f={},I=d(l,"attributes",{});for(const D in I)f[i[D.toLowerCase()]]=I[D];a.featureSet.features.push({attributes:f,geometry:he(d(l,"geometry",null))})}}}else{a.layerDefinition.hasZ=d(n,"hasz",!1)===!0,a.layerDefinition.hasM=d(n,"hasm",!1)===!0,a.layerDefinition.geometryType=d(n,"geometrytype",""),a.featureSet.geometryType=a.layerDefinition.geometryType,a.layerDefinition.objectIdField=d(n,"objectidfieldname",""),a.layerDefinition.typeIdField=d(n,"typeidfieldname","");const y=d(n,"spatialreference",null);y&&(a.layerDefinition.spatialReference=ie(y));let o=d(n,"fields",null);if(A(o))for(const f of o){const I={name:d(f,"name",""),alias:d(f,"alias",""),type:d(f,"type",""),nullable:d(f,"nullable",!0),editable:d(f,"editable",!0),length:d(f,"length",null),domain:we(d(f,"domain"))};a.layerDefinition.fields.push(I)}else o=null,a.layerDefinition.fields=o;const i={};for(const f of a.layerDefinition.fields)i[f.name.toLowerCase()]=f.name;let l=d(n,"features",null);if(A(l))for(const f of l){const I={},D=d(f,"attributes",{});for(const F in D)I[i[F.toLowerCase()]]=D[F];a.featureSet.features.push({attributes:I,geometry:he(d(f,"geometry",null))})}else l=null,a.featureSet.features=l}}}if(He(a)===!1)throw new m(t,p.InvalidParameter,r);return a.layerDefinition.geometryType||(a.layerDefinition.geometryType="esriGeometryNull"),Se.create(a,t.spatialReference)}))},s.signatures.push({name:"featureset",min:1,max:1}),s.functions.filter=function(t,r){return s.standardFunctionAsync(t,r,(async(c,g,e)=>{if(N(e,2,2,t,r),A(e[0])||M(e[0])){const n=[];let a=e[0];a instanceof be&&(a=a.toArray());let u=null;if(!Ne(e[1]))throw new m(t,p.InvalidParameter,r);u=e[1].createFunction(t);for(const y of a){const o=u(y);Oe(o)?await o===!0&&n.push(y):o===!0&&n.push(y)}return n}if(L(e[0])){const n=await e[0].load(),a=T.create(e[1],n.getFieldsIndex(),n.dateFieldsTimeZoneDefaultUTC),u=a.getVariables();if(u.length>0){const y=[];for(let i=0;i<u.length;i++){const l={name:u[i]};y.push(await s.evaluateIdentifier(t,l))}const o={};for(let i=0;i<u.length;i++)o[u[i]]=y[i];return a.parameters=o,new me({parentfeatureset:e[0],whereclause:a})}return new me({parentfeatureset:e[0],whereclause:a})}throw new m(t,p.InvalidParameter,r)}))},s.signatures.push({name:"filter",min:2,max:2}),s.functions.orderby=function(t,r){return s.standardFunctionAsync(t,r,(async(c,g,e)=>{if(N(e,2,2,t,r),L(e[0])){const n=new Ce(e[1]);return new ve({parentfeatureset:e[0],orderbyclause:n})}throw new m(t,p.InvalidParameter,r)}))},s.signatures.push({name:"orderby",min:2,max:2}),s.functions.top=function(t,r){return s.standardFunctionAsync(t,r,(async(c,g,e)=>{if(N(e,2,2,t,r),L(e[0]))return new Pe({parentfeatureset:e[0],topnum:e[1]});if(A(e[0]))return O(e[1])>=e[0].length?e[0].slice(0):e[0].slice(0,O(e[1]));if(M(e[0]))return O(e[1])>=e[0].length()?e[0].slice(0):e[0].slice(0,O(e[1]));throw new m(t,p.InvalidParameter,r)}))},s.signatures.push({name:"top",min:2,max:2}),s.functions.first=function(t,r){return s.standardFunctionAsync(t,r,(async(c,g,e)=>{if(N(e,1,1,t,r),L(e[0])){const n=await e[0].first(c.abortSignal);if(n!==null){const a=Ae.createFromGraphicLikeObject(n.geometry,n.attributes,e[0],t.timeZone);return a._underlyingGraphic=n,a}return n}return A(e[0])?e[0].length===0?null:e[0][0]:M(e[0])?e[0].length()===0?null:e[0].get(0):null}))},s.signatures.push({name:"first",min:1,max:1}),s.functions.attachments=function(t,r){return s.standardFunctionAsync(t,r,(async(c,g,e)=>{N(e,1,2,t,r);const n={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(e.length>1){if(e[1]instanceof v){if(e[1].hasField("minsize")&&(n.minsize=O(e[1].field("minsize"))),e[1].hasField("metadata")&&(n.returnMetadata=U(e[1].field("metadata"))),e[1].hasField("maxsize")&&(n.maxsize=O(e[1].field("maxsize"))),e[1].hasField("types")){const a=xe(e[1].field("types"),!1);a.length>0&&(n.types=a)}}else if(e[1]!==null)throw new m(t,p.InvalidParameter,r)}if(G(e[0])){let a=e[0]._layer;return a instanceof te&&(a=q(a,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),a===null?[]:L(a)===!1?[]:(await a.load(),a.queryAttachments(e[0].field(a.objectIdField),n.minsize,n.maxsize,n.types,n.returnMetadata))}if(e[0]===null)return[];throw new m(t,p.InvalidParameter,r)}))},s.signatures.push({name:"attachments",min:1,max:2}),s.functions.featuresetbyrelationshipname=function(t,r){return s.standardFunctionAsync(t,r,(async(c,g,e)=>{N(e,2,4,t,r);const n=e[0],a=b(e[1]);let u=S(e[2],null);const y=U(S(e[3],!0));if(u===null&&(u=["*"]),A(u)===!1)throw new m(t,p.InvalidParameter,r);if(e[0]===null)return null;if(!G(e[0]))throw new m(t,p.InvalidParameter,r);let o=n._layer;if(o instanceof te&&(o=q(o,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),o===null||L(o)===!1)return null;o=await o.load();const i=o.relationshipMetaData().filter((F=>F.name===a));if(i.length===0)return null;if(i[0].relationshipTableId!==void 0&&i[0].relationshipTableId!==null&&i[0].relationshipTableId>-1)return Ze(o,i[0],n.field(o.objectIdField),o.spatialReference,u,y,t.lrucache,t.interceptor);let l=o.serviceUrl();if(!l)return null;l=l.charAt(l.length-1)==="/"?l+i[0].relatedTableId.toString():l+"/"+i[0].relatedTableId.toString();const f=await $e(l,o.spatialReference,u,y,t.lrucache,t.interceptor);await f.load();let I=f.relationshipMetaData();if(I=I.filter((F=>F.id===i[0].id)),n.hasField(i[0].keyField)===!1||n.field(i[0].keyField)===null){const F=await o.getFeatureByObjectId(n.field(o.objectIdField),[i[0].keyField]);if(F){const E=T.create(I[0].keyField+"= @id",f.getFieldsIndex(),f.dateFieldsTimeZoneDefaultUTC);return E.parameters={id:F.attributes[i[0].keyField]},f.filter(E)}return new Ue({parentfeatureset:f})}const D=T.create(I[0].keyField+"= @id",f.getFieldsIndex(),f.dateFieldsTimeZoneDefaultUTC);return D.parameters={id:n.field(i[0].keyField)},f.filter(D)}))},s.signatures.push({name:"featuresetbyrelationshipname",min:2,max:4}),s.functions.featuresetbyassociation=function(t,r){return s.standardFunctionAsync(t,r,(async(c,g,e)=>{N(e,2,3,t,r);const n=e[0],a=b(S(e[1],"")).toLowerCase(),u=P(e[2])?b(e[2]):null;if(e[0]===null)return null;if(!G(e[0]))throw new m(t,p.InvalidParameter,r);let y=n._layer;if(y instanceof te&&(y=q(y,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),y===null||L(y)===!1)return null;await y.load();const o=y.serviceUrl(),i=await Re(o,t.spatialReference);let l=null,f=null,I=!1;if(u!==null&&u!==""&&u!==void 0){for(const h of i.terminals)h.terminalName===u&&(f=h.terminalId);f===null&&(I=!0)}const D=i.associations.getFieldsIndex(),F=D.get("TOGLOBALID").name,E=D.get("FROMGLOBALID").name,K=D.get("TOTERMINALID").name,V=D.get("FROMTERMINALID").name,j=D.get("FROMNETWORKSOURCEID").name,H=D.get("TONETWORKSOURCEID").name,R=D.get("ASSOCIATIONTYPE").name,ge=D.get("ISCONTENTVISIBLE").name,Ie=D.get("OBJECTID").name;for(const h of y.fields)if(h.type==="global-id"){l=n.field(h.name);break}let Z=null,ae=new k(new W({name:"percentalong",alias:"percentalong",type:"double"}),T.create("0",i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC)),re=new k(new W({name:"side",alias:"side",type:"string"}),T.create("''",i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC));const x="globalid",se="globalId",le={};for(const h in i.lkp)le[h]=i.lkp[h].sourceId;const $=new ke(new W({name:"classname",alias:"classname",type:"string"}),null,le);let w="";switch(a){case"midspan":{w=`((${F}='${l}') OR ( ${E}='${l}')) AND (${R} IN (5))`,$.codefield=T.create(`CASE WHEN (${F}='${l}') THEN ${j} ELSE ${H} END`,i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC);const h=X(C.findField(i.associations.fields,E));h.name=x,h.alias=x,Z=new k(h,T.create(`CASE WHEN (${E}='${l}') THEN ${F} ELSE ${E} END`,i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC)),ae=i.unVersion>=4?new ee(C.findField(i.associations.fields,D.get("PERCENTALONG").name)):new k(new W({name:"percentalong",alias:"percentalong",type:"double"}),T.create("0",i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC));break}case"junctionedge":{w=`((${F}='${l}') OR ( ${E}='${l}')) AND (${R} IN (4,6))`,$.codefield=T.create(`CASE WHEN (${F}='${l}') THEN ${j} ELSE ${H} END`,i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC);const h=X(C.findField(i.associations.fields,E));h.name=x,h.alias=x,Z=new k(h,T.create(`CASE WHEN (${E}='${l}') THEN ${F} ELSE ${E} END`,i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC)),re=new k(new W({name:"side",alias:"side",type:"string"}),T.create(`CASE WHEN (${R}=4) THEN 'from' ELSE 'to' END`,i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC));break}case"connected":{let h=`${F}='@T'`,oe=`${E}='@T'`;f!==null&&(h+=` AND ${K}=@A`,oe+=` AND ${V}=@A`),w="(("+h+") OR ("+oe+"))",w=_(w,"@T",l??""),h=_(h,"@T",l??""),f!==null&&(h=_(h,"@A",f.toString()),w=_(w,"@A",f.toString())),$.codefield=T.create("CASE WHEN "+h+` THEN ${j} ELSE ${H} END`,i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC);const Q=X(C.findField(i.associations.fields,E));Q.name=x,Q.alias=x,Z=new k(Q,T.create("CASE WHEN "+h+` THEN ${E} ELSE ${F} END`,i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC));break}case"container":w=`${F}='${l}' AND ${R} = 2`,f!==null&&(w+=` AND ${K} = `+f.toString()),$.codefield=j,w="( "+w+" )",Z=new B(C.findField(i.associations.fields,E),x,x);break;case"content":w=`(${E}='${l}' AND ${R} = 2)`,f!==null&&(w+=` AND ${V} = `+f.toString()),$.codefield=H,w="( "+w+" )",Z=new B(C.findField(i.associations.fields,F),x,x);break;case"structure":w=`(${F}='${l}' AND ${R} = 3)`,f!==null&&(w+=` AND ${K} = `+f.toString()),$.codefield=j,w="( "+w+" )",Z=new B(C.findField(i.associations.fields,E),x,se);break;case"attached":w=`(${E}='${l}' AND ${R} = 3)`,f!==null&&(w+=` AND ${V} = `+f.toString()),$.codefield=H,w="( "+w+" )",Z=new B(C.findField(i.associations.fields,F),x,se);break;default:throw new m(t,p.InvalidParameter,r)}return I&&(w="1 <> 1"),new C({parentfeatureset:i.associations,adaptedFields:[new ee(C.findField(i.associations.fields,Ie)),new ee(C.findField(i.associations.fields,ge)),Z,re,$,ae],extraFilter:w?T.create(w,i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC):null})}))},s.signatures.push({name:"featuresetbyassociation",min:2,max:6}),s.functions.groupby=function(t,r){return s.standardFunctionAsync(t,r,(async(c,g,e)=>{if(N(e,3,3,t,r),!L(e[0]))throw new m(t,p.InvalidParameter,r);const n=await e[0].load(),a=[],u=[];let y=!1,o=[];if(P(e[1]))o.push(e[1]);else if(e[1]instanceof v)o.push(e[1]);else if(A(e[1]))o=e[1];else{if(!M(e[1]))throw new m(t,p.InvalidParameter,r);o=e[1].toArray()}for(const i of o)if(P(i)){const l=T.create(b(i),n.getFieldsIndex(),n.dateFieldsTimeZoneDefaultUTC),f=pe(l)===!0?b(i):"%%%%FIELDNAME";a.push({name:f,expression:l}),f==="%%%%FIELDNAME"&&(y=!0)}else{if(!(i instanceof v))throw new m(t,p.InvalidParameter,r);{const l=i.hasField("name")?i.field("name"):"%%%%FIELDNAME",f=i.hasField("expression")?i.field("expression"):"";if(l==="%%%%FIELDNAME"&&(y=!0),!l)throw new m(t,p.InvalidParameter,r);a.push({name:l,expression:T.create(f||l,n.getFieldsIndex(),n.dateFieldsTimeZoneDefaultUTC)})}}if(o=[],P(e[2]))o.push(e[2]);else if(A(e[2]))o=e[2];else if(M(e[2]))o=e[2].toArray();else{if(!(e[2]instanceof v))throw new m(t,p.InvalidParameter,r);o.push(e[2])}for(const i of o){if(!(i instanceof v))throw new m(t,p.InvalidParameter,r);{const l=i.hasField("name")?i.field("name"):"",f=i.hasField("statistic")?i.field("statistic"):"",I=i.hasField("expression")?i.field("expression"):"";if(!l||!f||!I)throw new m(t,p.InvalidParameter,r);u.push({name:l,statistic:f.toLowerCase(),expression:T.create(I,n.getFieldsIndex(),n.dateFieldsTimeZoneDefaultUTC)})}}if(y){const i={};for(const f of n.fields)i[f.name.toLowerCase()]=1;for(const f of a)f.name!=="%%%%FIELDNAME"&&(i[f.name.toLowerCase()]=1);for(const f of u)f.name!=="%%%%FIELDNAME"&&(i[f.name.toLowerCase()]=1);let l=0;for(const f of a)if(f.name==="%%%%FIELDNAME"){for(;i["field_"+l.toString()]===1;)l++;i["field_"+l.toString()]=1,f.name="FIELD_"+l.toString()}}for(const i of a)await ne(i.expression,s,t);for(const i of u)await ne(i.expression,s,t);return e[0].groupby(a,u)}))},s.signatures.push({name:"groupby",min:3,max:3}),s.functions.distinct=function(t,r){return s.standardFunctionAsync(t,r,(async(c,g,e)=>{if(L(e[0])){N(e,2,2,t,r);const n=await e[0].load(),a=[];let u=[];if(P(e[1]))u.push(e[1]);else if(e[1]instanceof v)u.push(e[1]);else if(A(e[1]))u=e[1];else{if(!M(e[1]))throw new m(t,p.InvalidParameter,r);u=e[1].toArray()}let y=!1;for(const o of u)if(P(o)){const i=T.create(b(o),n.getFieldsIndex(),n.dateFieldsTimeZoneDefaultUTC),l=pe(i)===!0?b(o):"%%%%FIELDNAME";a.push({name:l,expression:i}),l==="%%%%FIELDNAME"&&(y=!0)}else{if(!(o instanceof v))throw new m(t,p.InvalidParameter,r);{const i=o.hasField("name")?o.field("name"):"%%%%FIELDNAME",l=o.hasField("expression")?o.field("expression"):"";if(i==="%%%%FIELDNAME"&&(y=!0),!i)throw new m(t,p.InvalidParameter,r);a.push({name:i,expression:T.create(l||i,n.getFieldsIndex(),n.dateFieldsTimeZoneDefaultUTC)})}}if(y){const o={};for(const l of n.fields)o[l.name.toLowerCase()]=1;for(const l of a)l.name!=="%%%%FIELDNAME"&&(o[l.name.toLowerCase()]=1);let i=0;for(const l of a)if(l.name==="%%%%FIELDNAME"){for(;o["field_"+i.toString()]===1;)i++;o["field_"+i.toString()]=1,l.name="FIELD_"+i.toString()}}for(const o of a)await ne(o.expression,s,t);return e[0].groupby(a,[])}return ze("distinct",c,g,e)}))}),s.functions.getfeaturesetinfo=function(t,r){return s.standardFunctionAsync(t,r,(async(c,g,e)=>{if(N(e,1,1,t,r),!L(e[0]))return null;const n=await e[0].getFeatureSetInfo();return n?v.convertObjectToArcadeDictionary({layerId:n.layerId,layerName:n.layerName,itemId:n.itemId,serviceLayerUrl:n.serviceLayerUrl,webMapLayerId:n.webMapLayerId??null,webMapLayerTitle:n.webMapLayerTitle??null,className:null,objectClassId:null},fe(t),!1,!1):null}))},s.signatures.push({name:"getfeaturesetinfo",min:1,max:1})}export{Pn as registerFunctions};
