const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./geometryEngineJSON-sD9OYPGK.js","./geometryEngineBase-ecgHTWEI.js","./commonjsHelpers-DCkdB7M8.js","./json-Wa8cmqdu.js"])))=>i.map(i=>d[i]);
import{_ as E}from"./index-OAJD89tD.js";import{fB as j,a7 as C,R as D,fC as V,eh as Z,aU as B,bZ as _,aV as m,O as S,aD as J,d as z,fD as W,fE as K,fF as L,fG as Y,o as h,aZ as x,c0 as k}from"./uuid-De2V3pkO.js";import{D as H}from"./arcgisLayerUrl-DMpJLG2u.js";import{R as Q}from"./normalizeUtils-CHaYFzrc.js";import{x as v,j as F}from"./projectionSupport-DtScbnKU.js";import{U as X,H as ee,$ as te,P as w,b as re,h as G,d as ie,K as N}from"./featureConversionUtils-BBvLZPS5.js";import{a as p}from"./OptimizedFeature-CuDeWVOV.js";const b=new p,ne=new p,P=new p,g={esriGeometryPoint:w,esriGeometryPolyline:te,esriGeometryPolygon:ee,esriGeometryMultipoint:X};function Me(e,t,r,n=e.hasZ,s=e.hasM){if(t==null)return null;const i=e.hasZ&&n,l=e.hasM&&s;if(r){const a=G(P,t,e.hasZ,e.hasM,"esriGeometryPoint",r,n,s);return w(a,i,l)}return w(t,i,l)}function R(e,t,r,n,s,i,l=t,a=r){const u=t&&l,o=r&&a,f=n!=null?"coords"in n?n:n.geometry:null;if(f==null)return null;if(s){let c=ie(ne,f,t,r,e,s,l,a);return i&&(c=G(P,c,u,o,e,i)),g[e]?.(c,u,o)??null}if(i){const c=G(P,f,t,r,e,i,l,a);return g[e]?.(c,u,o)??null}return re(b,f,t,r,l,a),g[e]?.(b,u,o)??null}function Ee(e){return e&&A in e?JSON.parse(JSON.stringify(e,se)):e}const A="_geVersion",se=(e,t)=>e!==A?t:void 0,le=new D({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),M=Object.freeze({});async function Fe(e,t,r){const{outFields:n,orderByFields:s,groupByFieldsForStatistics:i,outStatistics:l}=e;if(n)for(let a=0;a<n.length;a++)n[a]=n[a].trim();if(s)for(let a=0;a<s.length;a++)s[a]=s[a].trim();if(i)for(let a=0;a<i.length;a++)i[a]=i[a].trim();if(l)for(let a=0;a<l.length;a++)l[a].onStatisticField&&(l[a].onStatisticField=l[a].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),ae(e,t,r)}async function ae(e,t,r){if(!e)return null;let{where:n}=e;if(e.where=n=n?.trim(),(!n||/^1 *= *1$/.test(n)||t&&t===n)&&(e.where=null),!e.geometry)return e;let s=await ue(e);if(e.distance=0,e.units=null,e.spatialRel==="esriSpatialRelEnvelopeIntersects"){const{spatialReference:i}=e.geometry;s=j(s),s.spatialReference=i}if(s){await v(s.spatialReference,r),s=oe(s,r);const i=(await Q(C(s)))[0];if(i==null)throw M;const l="quantizationParameters"in e&&e.quantizationParameters?.tolerance||"maxAllowableOffset"in e&&e.maxAllowableOffset||0,a=l&&U(s,r)?{densificationStep:8*l}:void 0,u=i.toJSON(),o=F(u,u.spatialReference,r,a);if(!o)throw M;o.spatialReference=r,e.geometry=o}return e}function U(e,t){if(!e)return!1;const r=e.spatialReference;return(m(e)||S(e)||J(e))&&!z(r,t)&&!H(r,t)}function oe(e,t){const r=e.spatialReference;return U(e,t)&&m(e)?{spatialReference:r,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}async function ue(e){const{distance:t,units:r}=e,n=e.geometry;if(t==null||"vertexAttributes"in n)return n;const s=n.spatialReference,i=r?le.fromJSON(r):V(s),l=s&&(Z(s)||B(s))?n:await v(s,_).then((()=>F(n,_)));return(await fe())(l.spatialReference,l,t,i)}async function fe(){return(await E(async()=>{const{geodesicBuffer:e}=await import("./geometryEngineJSON-sD9OYPGK.js").then(t=>t.g);return{geodesicBuffer:e}},__vite__mapDeps([0,1,2,3]),import.meta.url)).geodesicBuffer}function ce(e){return e==="mesh"?W:K(e)}function O(e,t){return e?t?4:3:t?3:2}function me(e,t,r,n){return T(e,t,r,n.coords[0],n.coords[1])}function pe(e,t,r,n,s,i){const l=O(s,i),{coords:a,lengths:u}=n;if(!u)return!1;for(let o=0,f=0;o<u.length;o++,f+=l)if(!T(e,t,r,a[f],a[f+1]))return!1;return!0}function T(e,t,r,n,s){if(!e)return!1;const i=O(t,r),{coords:l,lengths:a}=e;let u=!1,o=0;for(const f of a)u=ye(u,l,i,o,f,n,s),o+=f*i;return u}function ye(e,t,r,n,s,i,l){let a=e,u=n;for(let o=n,f=n+s*r;o<f;o+=r){u=o+r,u===f&&(u=n);const c=t[o],y=t[o+1],q=t[u],d=t[u+1];(y<l&&d>=l||d<l&&y>=l)&&c+(l-y)/(d-y)*(q-c)<i&&(a=!a)}return a}const $="unsupported-query",Re={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},I={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function Se(e){return e!=null&&I.spatialRelationship[e]===!0}function de(e){return e!=null&&I.queryGeometry[k(e)]===!0}function he(e){return e!=null&&I.layerGeometry[e]===!0}function ge(){return E(()=>import("./geometryEngineJSON-sD9OYPGK.js").then(e=>e.g),__vite__mapDeps([0,1,2,3]),import.meta.url)}function Ae(e,t,r,n,s){if(S(t)&&r==="esriGeometryPoint"&&(e==="esriSpatialRelIntersects"||e==="esriSpatialRelContains")){const i=N(new p,t,!1,!1);return Promise.resolve((l=>me(i,!1,!1,l)))}if(S(t)&&r==="esriGeometryMultipoint"){const i=N(new p,t,!1,!1);if(e==="esriSpatialRelContains")return Promise.resolve((l=>pe(i,!1,!1,l,n,s)))}if(m(t)&&r==="esriGeometryPoint"&&(e==="esriSpatialRelIntersects"||e==="esriSpatialRelContains"))return Promise.resolve((i=>L(t,R(r,n,s,i))));if(m(t)&&r==="esriGeometryMultipoint"&&e==="esriSpatialRelContains")return Promise.resolve((i=>Y(t,R(r,n,s,i))));if(m(t)&&e==="esriSpatialRelIntersects"){const i=ce(r);return Promise.resolve((l=>i(t,R(r,n,s,l))))}return ge().then((i=>{const l=i[Re[e]].bind(null,t.spatialReference,t);return a=>l(R(r,n,s,a))}))}async function Ue(e,t,r){const{spatialRel:n,geometry:s}=e;if(s){if(!Se(n))throw new h($,"Unsupported query spatial relationship",{query:e});if(x(s.spatialReference)&&x(r)){if(!de(s))throw new h($,"Unsupported query geometry type",{query:e});if(!he(t))throw new h($,"Unsupported layer geometry type",{query:e});if(e.outSR)return v(e.geometry?.spatialReference,e.outSR)}}}function Oe(e){if(m(e))return!0;if(S(e)){for(const t of e.rings)if(t.length!==5||t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1;return!0}return!1}async function Te(e,t){if(!e)return null;const r=t.featureAdapter,{startTimeField:n,endTimeField:s}=e;let i=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(n&&s)await t.forEach((a=>{const u=r.getAttribute(a,n),o=r.getAttribute(a,s);u==null||isNaN(u)||(i=Math.min(i,u)),o==null||isNaN(o)||(l=Math.max(l,o))}));else{const a=n||s;await t.forEach((u=>{const o=r.getAttribute(u,a);o==null||isNaN(o)||(i=Math.min(i,o),l=Math.max(l,o))}))}return{start:i,end:l}}function qe(e,t,r){if(!t||!e)return null;const{startTimeField:n,endTimeField:s}=e;if(!n&&!s)return null;const{start:i,end:l}=t;if(i===null&&l===null)return null;if(i===void 0&&l===void 0)return Ge();const a=r.getAttributeAsTimestamp?.bind(r)??r.getAttribute.bind(r);return n&&s?$e(a,n,s,i,l):we(a,n||s,i,l)}function $e(e,t,r,n,s){return n!=null&&s!=null?i=>{const l=e(i,t),a=e(i,r);return(l==null||l<=s)&&(a==null||a>=n)}:n!=null?i=>{const l=e(i,r);return l==null||l>=n}:s!=null?i=>{const l=e(i,t);return l==null||l<=s}:void 0}function we(e,t,r,n){return r!=null&&n!=null&&r===n?s=>e(s,t)===r:r!=null&&n!=null?s=>{const i=e(s,t);return i!=null&&i>=r&&i<=n}:r!=null?s=>{const i=e(s,t);return i!=null&&i>=r}:n!=null?s=>{const i=e(s,t);return i!=null&&i<=n}:void 0}function Ge(){return()=>!1}export{Oe as I,Ue as P,Fe as S,R as a,M as g,Ee as h,ae as j,Te as n,qe as t,Ae as v,Me as y};
