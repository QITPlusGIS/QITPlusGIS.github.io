import{cF as bt,Q as te,a as i,y as n,c as D,s as de,o as T,S as he,aO as xt,q as oe,b5 as ze,g5 as qe,bb as Mt,b6 as Z,N as ge,j as Me,aA as Ie,cw as $e,cv as Re,z as Te,g as fe,a5 as It,el as $t,l as ve,Z as Ce,dl as Rt,D as Tt,V as Ct,cK as Lt,cG as Et,cJ as Ft,dI as Nt,f as ie,hh as kt,P as _e,cD as le,cZ as At,w as ke,h as me,eO as jt,ee as Bt,k as We,v as Pt,u as Ot,de as Ae,hi as ye,by as Dt}from"./uuid-De2V3pkO.js";import{I as H,O as Ze,D as g,G as we,T as Gt,x as Kt,E as ae}from"./jsxFactory-CrT0-KGb.js";import{n as Ht,e as Vt}from"./vmEvent-D7WKamFP.js";import{i as zt}from"./FullTextSearch-C1te3nF2.js";import{f as qt}from"./scaleUtils-ApfxRMLk.js";import{t as Le}from"./commonProperties-DHiB1uzW.js";import{p as Wt,n as Zt}from"./project-DkWqofWk.js";import{t as Ut,e as S,a as je}from"./GoTo-BYKJE8LR.js";import"./index-OAJD89tD.js";const w="esri-search",_={base:w,widgetIcon:H.search,hasMultipleSources:`${w}--multiple-sources`,isLoading:`${w}--loading`,isSearching:`${w}--searching`,showSuggestions:`${w}--show-suggestions`,showSources:`${w}--sources`,showWarning:`${w}--warning`,container:`${w}__container`,input:`${w}__input`,inputContainer:`${w}__input-container`,form:`${w}__form`,submitButton:`${w}__submit-button`,sourcesButton:`${w}__sources-button`,sourcesButtonDown:`${w}__sources-button--down`,sourcesButtonUp:`${w}__sources-button--up`,clearButton:`${w}__clear-button`,sourceName:`${w}__source-name`,suggestionsMenu:`${w}__suggestions-menu`,suggestionList:`${w}__suggestions-list`,suggestionListCurrentLocation:`${w}__suggestions-list--current-location`,sourcesMenu:`${w}__sources-menu`,source:`${w}__source`,warningMenu:`${w}__warning-menu`,warningMenuBody:`${w}__warning-body`,warningMenuHeader:`${w}__warning-header`,warningMenuText:`${w}__warning-text`,noValueText:`${w}__no-value-text`},U="esri-search-result-renderer",W={base:U,showMoreResults:`${U}__more-results--show-more-results`,moreResults:`${U}__more-results`,moreResultsList:`${U}__more-results-list`,moreResultsItem:`${U}__more-results-item`,moreResultsListHeader:`${U}__more-results-list-header`};let M=class extends bt(te){constructor(t){super(t),this.autoNavigate=null,this.filter=null,this.getResults=null,this.getSuggestions=null,this.maxResults=null,this.maxSuggestions=null,this.minSuggestCharacters=null,this.outFields=null,this.placeholder="",this.popupEnabled=null,this.popupTemplate=null,this.prefix="",this.resultGraphicEnabled=null,this.resultSymbol=null,this.suggestionsEnabled=null,this.suffix="",this.withinViewEnabled=!1,this.zoomScale=null}};i([n()],M.prototype,"autoNavigate",void 0),i([n()],M.prototype,"filter",void 0),i([n()],M.prototype,"getResults",void 0),i([n()],M.prototype,"getSuggestions",void 0),i([n()],M.prototype,"maxResults",void 0),i([n()],M.prototype,"maxSuggestions",void 0),i([n()],M.prototype,"minSuggestCharacters",void 0),i([n()],M.prototype,"outFields",void 0),i([n()],M.prototype,"placeholder",void 0),i([n()],M.prototype,"popupEnabled",void 0),i([n()],M.prototype,"popupTemplate",void 0),i([n()],M.prototype,"prefix",void 0),i([n()],M.prototype,"resultGraphicEnabled",void 0),i([n()],M.prototype,"resultSymbol",void 0),i([n()],M.prototype,"suggestionsEnabled",void 0),i([n()],M.prototype,"suffix",void 0),i([n()],M.prototype,"withinViewEnabled",void 0),i([n()],M.prototype,"zoomScale",void 0),M=i([D("esri.widgets.Search.SearchSource")],M);const Ee=M,Be=de.getLogger("esri.widgets.Search.support.geometryUtils");function Jt(e,t){if(!t)return Be.error("missing-parameter: view is missing."),Promise.reject(new T("searchgeometryutils:missing-parameter","view is missing."));if(!e)return Be.error("missing-parameter: point is missing."),Promise.reject(new T("searchgeometryutils:missing-parameter","point is missing."));if(e.hasZ||t.type==="2d")return Promise.resolve(e);const s=t?.map?.ground;return s?.layers.length?s.queryElevation(e,{cache:t.basemapTerrain?.elevationQueryCache}).then((r=>r.geometry)):Promise.resolve(e)}function Pe(e){if(e==null)return null;switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":return e.getPoint(0);case"polyline":return e.getPoint(0,0)}return null}function Fe(e,t,s){return e==null?null:e.type==="extent"?e:e.type==="multipoint"||e.type==="polygon"||e.type==="polyline"?e.extent:e.type==="point"?Ue(e,t,s):void 0}function Se(e,t,s){return e==null||t==null?null:Ue(e.center,t,s)}function Ue(e,t,s){const r=e.hasZ?e.z:void 0;return t?.map?(s!=null?qt(t,s):t.extent).clone().centerAt(e).set({zmax:r,zmin:r}):new he({xmin:e.x-.25,ymin:e.y-.25,xmax:e.x+.25,ymax:e.y+.25,spatialReference:e.spatialReference,zmin:r,zmax:r})}const Qt=/https?:\/\/services.*\.arcgis\.com/i,Xt=/(?:\{([^}]+)\})/g,ee=de.getLogger("esri.widgets.Search.support.layerSearchUtils");function Yt(e,t){const{exactMatch:s=!1,location:r,maxResults:o,spatialReference:l,source:a,sourceIndex:u,suggestResult:d,view:c}=e,{layer:h,filter:f,zoomScale:b}=a,v=c?.scale,y=Je(a,c),I=t?.signal;return Xe(h).then((()=>{const $=h.popupTemplate;return $?$.getRequiredFields(h.fieldsIndex):null})).then(($=>{const{objectIdField:E,returnZ:j}=h,B=it(a);if(!Ne(h,B))throw ee.error("invalid-field: displayField is invalid."),new T("getResults():invalid-field","displayField is invalid.");const C=$&&$.length?$:[B],R=a.outFields||C,G=Qe(R);if(R.includes(E)||G||R.push(E),h.floorInfo?.floorField&&R.push(h.floorInfo.floorField),!(G||ce(h,R)))throw ee.error("invalid-field: outField is invalid."),new T("getResults():invalid-field","outField is invalid.");const x=h.createQuery(),{orderByFields:k}=a;if(k&&(x.orderByFields=k),l){x.outSpatialReference=l;const P=1/xt(l);P&&(x.maxAllowableOffset=P)}const ne=h.geometryType==="mesh"||h.geometryType==="multipatch",se=h.capabilities?.data?.supportsZ&&!ne;if(x.returnZ=se&&j!==!1,x.returnGeometry=!0,x.multipatchOption=ne?"xyFootprint":null,R&&(x.outFields=R),r)x.geometry=r;else if(d.key)x.objectIds=[d.key];else{const P=a.searchFields||[B];if(!ce(h,P))throw ee.error("invalid-field: search field is invalid."),new T("getResults():invalid-field","search field is invalid.");if(rt(h)&&(x.num=o),y&&(x.geometry=y),!d.text?.trim())return[];const pe=d.text,{prefix:vt="",suffix:_t=""}=a,wt=ot(`${vt}${pe}${_t}`);st(h)&&et(h,P)&&!s&&pe&&(x.fullText=tt({text:pe,searchFields:P}));const St=nt({searchTerm:wt,layer:h,searchFields:P,filter:f,exactMatch:s,query:x,type:"search"});if(x.where=St,!Ye(x))return[]}return h.queryFeatures(x,{signal:I}).then((P=>hs(P,c,a,u,B,v,b)))}))}function es(e,t){const{source:s,spatialReference:r,view:o,suggestTerm:l,maxSuggestions:a,sourceIndex:u,exactMatch:d}=e,{layer:c,filter:h}=s,f=t?.signal,b=Je(s,o);return Xe(c).then((()=>{if(!rt(c))return[];const v=it(s),y=s.searchFields||[v],I=[];s.suggestionTemplate?s.suggestionTemplate.replaceAll(Xt,((se,P)=>(I.push(P),se))):I.push(v);const $=Qe(I);I.includes(c.objectIdField)||$||I.push(c.objectIdField);const E=Ne(c,v),j=$||ce(c,I),B=ce(c,y);if(!E)throw ee.error("invalid-field: displayField is invalid."),new T("getSuggestions():invalid-field","displayField is invalid.");if(!j)throw ee.error("invalid-field: outField is invalid."),new T("getSuggestions():invalid-field","outField is invalid.");if(!B)throw ee.error("invalid-field: search field is invalid."),new T("getSuggestions():invalid-field","search field is invalid.");const C=c.createQuery(),{orderByFields:R}=s;if(R&&(C.orderByFields=R),C.outSpatialReference=r,C.returnGeometry=!1,C.num=a,C.outFields=I,b&&(C.geometry=b),!l.trim())return[];const{prefix:G="",suffix:x=""}=s,k=ot(`${G}${l}${x}`);st(c)&&et(c,y)&&!d&&l&&(C.fullText=tt({text:l,searchFields:y}));const ne=nt({searchTerm:k,layer:c,searchFields:y,filter:h,exactMatch:d,query:C,type:"suggest"});return C.where=ne,Ye(C)?c.queryFeatures(C,{signal:f}).then((se=>us(se,s,u,v))):[]}))}function Je(e,t){const{filter:s,withinViewEnabled:r}=e,o=t?.extent;return s?.geometry??(r&&o?o:void 0)}function Qe(e){return e&&e.includes("*")}async function Xe(e){e&&await e.load()}function Ye(e){return!(!e.fullText&&!e.where)}function et(e,t){const s=e?.indexes;return!s||!t?.length?!1:s.filter((r=>r.indexType==="FullText")).some((r=>{const o=r.fields?.split(",").map((l=>l.trim().toLowerCase()))||[];return t.every((l=>o.includes(l.toLowerCase())))}))}function tt({text:e,searchFields:t}){return e.trim().split(" ").filter((s=>!!s.trim())).map((s=>new zt({onFields:t,searchTerm:s,searchType:"prefix"})))}function st(e){return e?.capabilities?.query?.supportsFullTextSearch??!1}function rt(e){return e?.capabilities?.query?.supportsPagination??!1}function ts(e){return e?.fieldsIndex?.fields?.find((t=>t.type==="string"))?.name??""}function it(e){return e.displayField||e.layer.displayField||ts(e.layer)}function ce(e,t){return!(!e||!t?.length)&&t.every((s=>Ne(e,s)))}function Ne(e,t){return!!e.getField(t)}function ss(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}function rs(e,t,s){let r=null;const{codedValues:o}=e;return o&&o.some((l=>{const a=l.name,u=s?a:a.toLowerCase();return(s?t:t.toLowerCase())===u&&(r=l.code.toString(),!0)})),r}function ot(e){return e.replaceAll("'","''")}function re(e,t){const s=t?.where;return s?`(${e}) AND (${s})`:e}function is({currentTerm:e,field:t,filter:s,exactMatch:r,url:o,type:l}){const a=t?.type,u=t?.name;if(a==="string"||a==="date"||a==="global-id"){const d=Qt.test(o??""),c=d&&ss(e)?"N":"";return re(r&&l==="search"?`${u} = ${c}'${e}'`:d?`${u} LIKE ${c}${`'${e}%'`}`:`${`LOWER(${u})`} LIKE ${c}${`'${e.toLowerCase()}%'`}`,s)}if(a==="oid"||a==="small-integer"||a==="integer"||a==="single"||a==="double"){const d=Number(e);return isNaN(d)?null:re(`${u} = ${d}`,s)}return re(`${u} = ${e}`,s)}function os(e,t){return e?` OR (${t})`:`(${t})`}function nt({searchTerm:e,layer:t,searchFields:s,filter:r,exactMatch:o,query:l,type:a}){const{definitionExpression:u,url:d}=t;let c="";return!l.fullText&&e&&s&&s.forEach((h=>{const f=t.getField(h),b=typeof t.getFieldDomain=="function"&&t.getFieldDomain(h),v=(b&&b.type==="coded-value"?rs(b,e,o):null)||e||null;if(v!==null){const y=is({currentTerm:v,field:f,filter:r,exactMatch:o,url:d,type:a});y&&(c+=os(c,y))}})),u&&c?`(${u}) AND (${c})`:u||c}function ns(e,t){let s=null;const{codedValues:r}=e;return r&&r.length&&r.some((o=>o.code===t&&(s=o.name,!0))),s}function ls(e,t){return e[Object.keys(e).find((s=>s.toLowerCase()===t.toLowerCase()))]}function lt(e,t,s){const r=e.sourceLayer,{attributes:o}=e,l=typeof r.getFieldDomain=="function"&&r.getFieldDomain(s);if(t)return qe(t,o);if(s&&o){const a=r.getField(s),u=ls(o,s);return u==null?"":l&&l.type==="coded-value"?ns(l,u)??"":a?.type==="date"?Mt(new Date(u)):typeof u=="number"?u.toString():typeof u!="string"?"":u.trim()}return""}function as(e,t,s,r){const o=e.sourceLayer,{attributes:l}=e,{objectIdField:a}=o,u=a?l[a]:null;return{text:lt(e,t.suggestionTemplate,r),key:u,sourceIndex:s}}function us(e,t,s,r){return e.features.map((o=>as(o,t,s,r)))}function cs(e){return e!=null&&e.minScale!=null&&e.maxScale!=null}function ds(e,t,s,r,o,l,a){const u=e.clone(),d=e.sourceLayer,c=d?.objectIdField,h=c?e.attributes[c]:null,f=lt(e,s.searchTemplate,o);l!=null&&cs(d)&&(d.minScale&&d.minScale<l?l=d.minScale:d.maxScale&&d.maxScale>l&&(l=d.maxScale));const b=Fe(u.geometry,t,l),v=typeof a=="number"?Se(oe(b),t,a):b,y=e.clone();return v!=null&&(y.geometry=ze.fromExtent(v)),{extent:v,target:y,feature:u,key:h,name:f,sourceIndex:r}}function hs(e,t,s,r,o,l,a){return e.features.map((u=>ds(u,t,s,r,o,l,a)))}var be;let O=be=class extends Ee{constructor(e){super(e),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(t,s)=>Yt({source:this,...t},s),this.getSuggestions=(t,s)=>es({source:this,...t},s)}set layer(e){this._set("layer",e),e&&e.load().catch((()=>{}))}get name(){return this._getLayerTitle()??""}set name(e){this._overrideIfSome("name",e)}clone(){return new be({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?oe(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?oe(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){return this.layer.fieldsIndex?.fields.find((e=>e.type==="string"))?.name??""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){const{layer:e,searchFields:t}=this;return e.loaded?`: ${(t||[this._getDisplayField()]).map((s=>e.getField(s)?.alias||s)).join(", ")}`:""}_getLayerTitle(){const{layer:e}=this;if(!e)return;const{title:t}=e;return t?`${t}${this._getSearchFieldsString()}`:void 0}};i([n({json:{read:{source:"field.name"},write:{target:"field.name"}}})],O.prototype,"displayField",void 0),i([n({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],O.prototype,"exactMatch",void 0),i([n({value:null})],O.prototype,"layer",null),i([n()],O.prototype,"name",null),i([n({type:[String],json:{write:!0}})],O.prototype,"orderByFields",void 0),i([n()],O.prototype,"searchFields",void 0),i([n()],O.prototype,"searchTemplate",void 0),i([n()],O.prototype,"suggestionTemplate",void 0),O=be=i([D("esri.widgets.Search.LayerSearchSource")],O);const J=O;function gs(e){return!!e&&typeof e.x=="number"&&typeof e.y=="number"}function ps(e){return e&&typeof e.xmin=="number"&&typeof e.ymin=="number"&&typeof e.xmax=="number"&&typeof e.ymax=="number"}let z=class extends te{constructor(t){super(t),this.address=null,this.attributes=null,this.extent=null,this.location=null,this.score=null}};i([n({type:String,json:{write:!0}})],z.prototype,"address",void 0),i([n({type:Object,json:{write:!0}})],z.prototype,"attributes",void 0),i([n({type:he,json:{write:!0}})],z.prototype,"extent",void 0),i([n({type:Z,json:{write:!0}})],z.prototype,"location",void 0),i([n({type:Number,json:{write:!0}})],z.prototype,"score",void 0),z=i([D("esri.rest.support.AddressCandidate")],z);const at=z;let L=class extends te{constructor(t){super(t),this.address=null,this.apiKey=null,this.categories=null,this.countryCode=null,this.forStorage=null,this.location=null,this.locationType=null,this.magicKey=null,this.maxLocations=null,this.outFields=null,this.outSpatialReference=null,this.searchExtent=null}};i([n({type:Object,json:{write:!0}})],L.prototype,"address",void 0),i([n(Le)],L.prototype,"apiKey",void 0),i([n({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],L.prototype,"categories",void 0),i([n({type:String,json:{write:!0}})],L.prototype,"countryCode",void 0),i([n({type:Boolean,json:{write:!0}})],L.prototype,"forStorage",void 0),i([n({type:Z,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],L.prototype,"location",void 0),i([n({type:String,json:{write:!0}})],L.prototype,"locationType",void 0),i([n({type:String,json:{write:!0}})],L.prototype,"magicKey",void 0),i([n({type:Number,json:{write:!0}})],L.prototype,"maxLocations",void 0),i([n({type:[String],json:{write:{writer:(e,t)=>{t.outFields=e?e.join(","):null}}}})],L.prototype,"outFields",void 0),i([n({type:ge,json:{read:{source:"outSR"},write:{target:"outSR"}}})],L.prototype,"outSpatialReference",void 0),i([n({type:he,json:{write:{writer:(e,t)=>{const s=e?e.shiftCentralMeridian():null;t.searchExtent=s}}}})],L.prototype,"searchExtent",void 0),L=i([D("esri.rest.support.AddressToLocationsParameters")],L),L.from=Me(L);const ut=L;async function ms(e,t,s){t=ut.from(t);const r=Ie(e),{address:o,...l}=t.toJSON(),a={...o,...l,f:"json"},u=$e({...r.query,...a}),d=Re(u,s),c=`${r.path}/findAddressCandidates`;return Te(c,d).then(ys)}function ys({data:e}){if(!e)return[];const{candidates:t,spatialReference:s}=e;return t?t.map((r=>{if(!r)return;const{extent:o,location:l}=r,a=!o||ps(o);return gs(l)&&a?(o&&(o.spatialReference=s),l&&(l.spatialReference=s),at.fromJSON(r)):void 0})):[]}let V=class extends te{constructor(t){super(t),this.apiKey=null,this.location=null,this.locationType=null,this.outSpatialReference=null}};i([n(Le)],V.prototype,"apiKey",void 0),i([n({type:Z,json:{write:{writer:(e,t)=>{const s=e?e.clone().normalize():null,r=s!==void 0;t.location=r?s:null}}}})],V.prototype,"location",void 0),i([n({type:String,json:{write:!0}})],V.prototype,"locationType",void 0),i([n({type:ge,json:{read:{source:"outSR"},write:{target:"outSR"}}})],V.prototype,"outSpatialReference",void 0),V=i([D("esri.rest.support.LocationToAddressParameters")],V),V.from=Me(V);const ct=V;async function fs(e,t,s){t=ct.from(t);const r=Ie(e),o={...t.toJSON(),f:"json"},l=$e({...r.query,...o}),a=Re(l,s),u=`${r.path}/reverseGeocode`;return Te(u,a).then(vs)}function vs({data:e}){if(!e)return;const{address:t,location:s}=e,r=t?.Match_addr||"";return at.fromJSON({address:r,attributes:t||{},location:s,score:100})}let Q=class extends te{constructor(e){super(e),this.isCollection=null,this.magicKey=null,this.text=null}};i([n({type:Boolean,json:{write:!0}})],Q.prototype,"isCollection",void 0),i([n({type:String,json:{write:!0}})],Q.prototype,"magicKey",void 0),i([n({type:String,json:{write:!0}})],Q.prototype,"text",void 0),Q=i([D("esri.rest.support.SuggestionCandidate")],Q);const _s=Q;let A=class extends te{constructor(t){super(t),this.apiKey=null,this.categories=null,this.countryCode=null,this.location=null,this.maxSuggestions=null,this.outSpatialReference=null,this.searchExtent=null,this.text=null}};i([n(Le)],A.prototype,"apiKey",void 0),i([n({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],A.prototype,"categories",void 0),i([n({type:String,json:{write:!0}})],A.prototype,"countryCode",void 0),i([n({type:Z,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],A.prototype,"location",void 0),i([n({type:Number,json:{write:!0}})],A.prototype,"maxSuggestions",void 0),i([n({type:ge,json:{read:{source:"outSR"},write:{target:"outSR"}}})],A.prototype,"outSpatialReference",void 0),i([n({type:he,json:{write:{writer:(e,t)=>{const s=e?e.shiftCentralMeridian():null;t.searchExtent=JSON.stringify(s)}}}})],A.prototype,"searchExtent",void 0),i([n({type:String,json:{write:!0}})],A.prototype,"text",void 0),A=i([D("esri.rest.support.SuggestLocationsParameters")],A),A.from=Me(A);const dt=A;async function ws(e,t,s){const r=Ie(e),o={...(t=dt.from(t)).toJSON(),f:"json"},l=$e({...r.query,...o}),a=Re(l,s),u=`${r.path}/suggest`;return Te(u,a).then(Ss)}function Ss(e){const{data:t}=e;if(!t)return[];const{suggestions:s}=t;return s?s.map((r=>new _s(r))):[]}const bs="Single Line Input",xs=3e5;function Ms(e,t){return e.location?Cs(e,t):Ls(e,t)}function ht(e,t){if(t.localSearchDisabled)return null;const s=e?.scale;return typeof s=="number"&&s<=xs?e?.extent?.center:null}async function Is(e,t){const{source:s,spatialReference:r,view:o,suggestTerm:l,maxSuggestions:a,sourceIndex:u}=e,d=new dt,{apiKey:c,url:h}=s,f=gt(s,o),b=t?.signal;if(!h)return null;c&&(d.apiKey=c),s.categories&&(d.categories=s.categories),r&&(d.outSpatialReference=r);const v=ht(o,s);if(v&&(d.location=v),!l.trim())return null;const{prefix:y="",suffix:I=""}=s,$=`${y}${l}${I}`;return d.text=$,f&&(d.searchExtent=f),d.maxSuggestions=a,s.countryCode&&(d.countryCode=s.countryCode),ws(h,d,{signal:b}).then((E=>Fs(E,u)))}function $s(e){return!!e&&/(?:geocode\-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}function Rs(e){return!!e&&/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/i.test(e)}function Oe(e){return!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}const Ts="https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer";async function Cs(e,t){const{source:s,spatialReference:r,location:o,sourceIndex:l,view:a}=e,{apiKey:u,url:d,zoomScale:c,defaultZoomScale:h}=s;if(d==null)return[];const f=a?.scale,b=t?.signal,v=new ct;v.location=o,u&&(v.apiKey=u),r&&(v.outSpatialReference=r);try{return pt([await fs(d,v,{signal:b})],{sourceIndex:l,scale:f,view:a,zoomScale:c,defaultZoomScale:h})}catch{return[]}}function gt(e,t){const{filter:s,withinViewEnabled:r}=e,o=t?.scale,l=t?.extent,a=s?.geometry;return Fe(a,t,o)||(r&&l?l:void 0)}async function Ls(e,t){const{source:s,suggestResult:r,spatialReference:o,view:l,maxResults:a,sourceIndex:u}=e,d=s?.zoomScale,c=s?.defaultZoomScale;if(!r.text?.trim())return null;const f=!r.key&&s.prefix?s.prefix:"",b=!r.key&&s.suffix?s.suffix:"",v=`${f}${r.text}${b}`,y=new ut,{apiKey:I,url:$}=s,E=l?.scale,j=gt(s,l),B=t?.signal;if(I&&(y.apiKey=I),!$)return null;s.categories&&(y.categories=s.categories),s.locationType&&(y.locationType=s.locationType),o&&(y.outSpatialReference=o);const C=ht(l,s);C&&(y.location=C),y.maxLocations=a,j&&(y.searchExtent=j),s.countryCode&&(y.countryCode=s.countryCode);const{key:R}=r,G=`${R}`;return R&&(y.magicKey=G),y.address={},y.address[s.singleLineFieldName||bs]=v,s.outFields&&(y.outFields=s.outFields),ms($,y,{signal:B}).then((x=>pt(x,{key:G,scale:E,sourceIndex:u,view:l,zoomScale:d,defaultZoomScale:c})))}function Es(e,t){return{text:e.text,key:e.magicKey,sourceIndex:t}}function Fs(e,t){return e.map((s=>Es(s,t)))}function Ns(e,t){const{key:s,scale:r,sourceIndex:o,view:l,zoomScale:a,defaultZoomScale:u}=t,{attributes:d,extent:c,location:h,address:f}=e,b=new fe({geometry:h,attributes:d}),v=c||h,y=Fe(v,l,r),I=typeof a=="number"?Se(y,l,a):typeof u=="number"&&v?.type==="point"?Se(y,l,u):y,$=h?`${h.x},${h.y}`:"",E=f||$,j=b.clone();return I!=null&&(j.geometry=ze.fromExtent(I)),{extent:I,feature:b,target:j,key:s,name:E,sourceIndex:o}}function pt(e,t){return e.filter(Boolean).map((s=>Ns(s,t)))}var xe;const ks="esri.widgets.Search.LocatorSearchSource";let N=xe=class extends Ee{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.defaultZoomScale=null,this.localSearchDisabled=!1,this.locationType=null,this.name="",this.placeholder="",this.searchTemplate="",this.singleLineFieldName=null,this.suggestionsEnabled=null,this.url=null,this.zoomScale=null,this.getResults=(t,s)=>Ms({source:this,...t},s),this.getSuggestions=(t,s)=>Is({source:this,...t},s)}clone(){return new xe({apiKey:this.apiKey,autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?oe(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?oe(this.categories):null,countryCode:this.countryCode,locationType:this.locationType,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})}};i([n()],N.prototype,"apiKey",void 0),i([n()],N.prototype,"categories",void 0),i([n()],N.prototype,"countryCode",void 0),i([n({json:{write:!0}})],N.prototype,"defaultZoomScale",void 0),i([n()],N.prototype,"localSearchDisabled",void 0),i([n()],N.prototype,"locationType",void 0),i([n({json:{write:!0}})],N.prototype,"name",void 0),i([n({json:{write:!0}})],N.prototype,"placeholder",void 0),i([n()],N.prototype,"searchTemplate",void 0),i([n({json:{write:!0}})],N.prototype,"singleLineFieldName",void 0),i([n({json:{read:{source:"suggest"},write:{target:"suggest"}}})],N.prototype,"suggestionsEnabled",void 0),i([n({json:{write:!0}})],N.prototype,"url",void 0),i([n({json:{write:!0}})],N.prototype,"zoomScale",void 0),N=xe=i([D(ks)],N);const mt=N,yt=de.getLogger("esri.widgets.support.geolocationUtils"),As={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function js(){const e=It("esri-geolocation");return e||yt.warn("geolocation-unsupported","Geolocation unsupported."),e}function Bs(){const e=window.isSecureContext;return e||yt.warn("insecure-context","Geolocation requires a secure origin."),e}function De(){return js()&&Bs()}function Ps(e){return e||(e=As),new Promise(((s,r)=>{setTimeout((()=>r(new T("geolocation:timeout","getting the current geolocation position timed out"))),15e3),navigator.geolocation.getCurrentPosition(s,r,e??void 0)}))}function Os(e,t){const{position:s,view:r}=e,o=Ds(s),l=o?.coords;if(!l)throw new T("geometry-service:no-coords","Geolocation has no coordinates");return Ks(Gs(l),r,t)}function Ds(e){const t=e&&e.coords||{},s={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed};return e&&{coords:s,timestamp:e.timestamp}}function Gs({longitude:e,latitude:t,altitude:s}){return new Z({longitude:e,latitude:t,z:s||void 0,spatialReference:{wkid:4326}})}function Ks(e,t,s){if(!t)return Promise.resolve(e);const r=t.spatialReference;return r.isWGS84?Promise.resolve(e):r.isWebMercator?Promise.resolve($t(e)):Hs(s).then((o=>{if(!o)throw new T("geometry-service:missing-url","Geometry service URL is missing");const l=new Wt({geometries:[e],outSpatialReference:r});return Zt(o,l,s).then((a=>a[0]))}))}function Hs(e){if(ve.geometryServiceUrl)return Promise.resolve(ve.geometryServiceUrl);const t=Ce.getDefault();return t.load(e).catch((()=>{})).then((()=>t.helperServices?.geometry?.url))}function F(e,t){return e.hasOwnProperty(t)&&e[t]!=null&&e[t]!==""}const Vs=()=>Bt("esri/widgets/Search/t9n/Search"),ft="esri.widgets.Search.SearchViewModel",K=de.getLogger(ft),Ge="highlight",ue=Ct.ofType({key:e=>e.layer?"layer":"locator",base:Ee,typeMap:{layer:J,locator:mt}}),Ke=ge.WGS84,zs="esri/images/search/search-symbol-32.png",qs=/<[\s\S]*?>/g,X=-1;let p=class extends Ut(Rt.EventedMixin(Tt)){constructor(e){super(e),this._gotoController=null,this._searching=null,this._updatingPromise=null,this._createdFeatureLayers=[],this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new ue,this.defaultSymbols={point:new Ft({url:Nt(zs),size:24,width:24,height:24}),polyline:new Et({color:[130,130,130,1],width:2}),polygon:new Lt({color:[235,235,235,.4],outline:{color:[130,130,130,1],width:2}})},this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=3,this.popupEnabled=!0,this.popupTemplate=null,this.portal=Ce.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new ue,this.suggestionDelay=350,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){const e=async()=>{const t=await Vs();this.messages=t,this.defaultPopupTemplate=new We({title:t.searchResult,content:"{Match_addr}"})};e(),this.addHandles([ie((()=>[this.includeDefaultSources,this.view,this.portal]),(()=>this._update()),_e),kt(e)])}destroy(){this._destroyFeatureLayers(),this._abortGoTo(),this.clearGraphics()}get activeSource(){return this.allSources.at(this.activeSourceIndex)??null}get activeSourceIndex(){return this.allSources.length===1||!this.searchAllEnabled?0:X}set activeSourceIndex(e){this._overrideIfSome("activeSourceIndex",e)}get allPlaceholder(){return this.messages?.allPlaceholder}set allPlaceholder(e){this._overrideIfSome("allPlaceholder",e)}get allSources(){const{sources:e,defaultSources:t,includeDefaultSources:s}=this,r=typeof s=="function"?s.call(null,{sources:e,defaultSources:t}):s?t.concat(e):e,o=this._get("allSources")||new ue;return o.removeAll(),o.addMany(r.filter(Boolean)),o}get locationEnabled(){return this._get("locationEnabled")||De()}set locationEnabled(e){if(e===void 0)return void this._clearOverride("locationEnabled");const t=De();if(e&&!t){const s=new T("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});K.error(s)}this._override("locationEnabled",!!e&&t)}get placeholder(){const{allSources:e,activeSourceIndex:t,allPlaceholder:s}=this;return t===X?s??"":e.at(t)?.placeholder??""}set searchTerm(e){this._set("searchTerm",e||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==e&&this._set("selectedSuggestion",null),e===""&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":this.allSources.length===0?"disabled":"ready"}get updating(){return this._updatingPromise!=null}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup();const{view:e,resultGraphic:t}=this;e&&t&&e.graphics.remove(t),this._set("resultGraphic",null)}search(e,t){this.emit("search-start"),this.clearGraphics();const s=this._createSuggestionForSearch(e),r=(async()=>{try{await this.when();const o=await this._getResultsFromSources(s,t);if(t?.signal?.aborted)return null;const l={activeSourceIndex:this.activeSourceIndex,searchTerm:s.text??"",numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(l,o,s);const a=this._getFirstResult(l.results),u=s.location&&a?a.name:s.text,d=u?.replace(qs,"");return this._set("searchTerm",d),(s.key&&typeof s.sourceIndex=="number"||s.location)&&this._set("selectedSuggestion",s),this._set("results",l.results),this._set("resultCount",l.results.reduce(((c,h)=>c+(h.results?.length??0)),0)),this.emit("search-complete",l),await this._selectFirstResult(a),l}finally{this._clearSearching()}})();return this._searching=r,r}async searchNearby(e){if(!this.locationEnabled){const s=new T("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});throw K.error(s),s}const t=(async()=>{try{const s=await Ps(),r=await Os({position:s,view:this.view},e);return await this.search(r,e)}finally{this._clearSearching()}})();return this._searching=t,t}async select(e){if(this.clearGraphics(),!e){const k=new T("select:missing-parameter","Cannot select without a searchResult.",{searchResult:e});throw K.error(k),k}const{view:t}=this,s=F(e,"sourceIndex")?e.sourceIndex:this._getSourceIndexOfResult(e),r=s!=null?this.allSources.at(s):null;if(!r){const k=new T("select:missing-source","Cannot select without a source.",{source:r});throw K.error(k),k}const o=r instanceof J?this._getLayerSourcePopupTemplate(r):r.popupTemplate,l=r.resultSymbol||this._getDefaultSymbol(e),a=F(r,"resultGraphicEnabled")?r.resultGraphicEnabled:this.resultGraphicEnabled,u=F(r,"autoNavigate")?r.autoNavigate:this.autoNavigate,d=(F(r,"popupEnabled")?r.popupEnabled:this.popupEnabled)?o||this.popupTemplate||this.defaultPopupTemplate:null,{feature:c}=e;if(!c){const k=new T("select:missing-feature","Cannot select without a feature.",{feature:c});throw K.error(k),k}const{attributes:h,geometry:f,layer:b,sourceLayer:v}=c,y=Pe(f),I={layerViewQuery:this._getLayerView(c),elevationQuery:t&&y!=null?Jt(y,t).catch((()=>y)):Promise.resolve(y)},$=await le(I),E=$.layerViewQuery.value,j=$.elevationQuery.value;l instanceof At&&(l.text=e.name);const B=t&&u?e.target||e.extent:null;await(B!=null?this._goToSearchResult(B):Promise.resolve());const R=E?c:new fe({geometry:f,symbol:l,attributes:h,layer:b,sourceLayer:v,popupTemplate:d}),G=t?.popup,x=G&&R.getEffectivePopupTemplate(G.defaultPopupTemplateEnabled);return x&&await t.openPopup({features:[R],location:j}),E&&Ht(E)&&!x&&this._highlightFeature({graphic:R,layerView:E}),!E&&a&&t&&t.graphics.push(R),this._setResultFloor(e),this._set("selectedResult",e),this._set("resultGraphic",R),this.emit("select-result",{result:e,source:r,sourceIndex:s}),e}async suggest(e,t,s){const r=e||this.searchTerm;this.emit("suggest-start",{searchTerm:r}),await this._suggestTimer(t,s);const o=await this._suggestImmediate(r,s);return this._set("suggestions",o?.results),this._set("suggestionCount",o?.results.reduce(((l,a)=>l+(a.results?.length??0)),0)??null),this.emit("suggest-complete",o),o}async when(){await ke((()=>!this.updating))}async _update(){const{portal:e,view:t}=this;if(this.includeDefaultSources){const s=this._updatingPromise=le([e?.load(),t?.when()]);if(this.destroyed||(await s,s!==this._updatingPromise))return}await ke((()=>this.messages)),this.destroyed||this._updateDefaultSources(),this._updatingPromise=null}_clearSearching(){this._searching=null}_convertHelperServices(){const e=this.portal?.helperServices?.geocode;return e?e.map((t=>{if(t.placefinding===!1)return;const s=ve.apiKey&&Oe(t.url)?{url:Ts}:null,r=mt.fromJSON({...t,...s}),o=r.url;if(Oe(o)||Rs(o)||$s(o)){const l=r.outFields??["Addr_type","Match_addr","StAddr","City"],a=(r.placeholder||this.messages?.placeholder)??"",u=typeof r.defaultZoomScale=="number"?r.defaultZoomScale:2500;r.singleLineFieldName="SingleLine",r.outFields=l,r.placeholder=a,r.defaultZoomScale=u}return r.singleLineFieldName?r:void 0})).filter(me):[]}_destroyFeatureLayers(){this._createdFeatureLayers.forEach((e=>e?.destroy())),this._createdFeatureLayers=[]}_getLayerSources(e,t){const s=this.view?.map;return e.map((r=>{const o=s.findLayerById(r.id);if(!o)return;const l=this._getLayerJSON(r),a=J.fromJSON(l);return a.placeholder=t,this._getLayer(o,l).then((u=>{a.layer=u})),a})).filter(me).toArray()}_getTableSources(e,t){const s=this.view?.map;return e.map((r=>{if(!r.id)return;const o=s.findTableById(r.id);if(!o)return;const l=this._getLayerJSON(r),a=J.fromJSON(l);return a.placeholder=t,this._getLayer(o,l).then((u=>{a.layer=u})),a})).filter(me).toArray()}_convertApplicationProperties(){const e=this.view?.map,t=e?.applicationProperties?.viewing?.search;if(!t)return[];const{enabled:s,hintText:r,layers:o,tables:l}=t;return s?[...this._getLayerSources(o,r),...this._getTableSources(l,r)]:[]}async _getSubLayer(e,t){if(await e.load(),!e.allSublayers)throw new Error;const s=e.allSublayers.find((o=>o.id===t.subLayer));if(!s)throw new Error;const r=await s.createFeatureLayer?.();if(!r)throw new Error;return this._createdFeatureLayers.push(r),r}async _getBuildingSubLayer(e,t){await e.load();const s=e.allSublayers.find((r=>r.id===t.subLayer));if(s?.type!=="building-component")throw new Error;if(await s.load(),s.associatedLayer==null)throw new Error;return await s.associatedLayer.load(),s}async _getLayer(e,t){if(e.type==="feature"||e.type==="scene"||e.type==="csv"||e.type==="geojson"||e.type==="ogc-feature")return e;if(e.type==="map-image")try{return await this._getSubLayer(e,t)}catch{const r=new T("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:e});return K.error(r),null}return e.type==="building-scene"?this._getBuildingSubLayer(e,t):null}_getLayerJSON(e){return typeof e.toJSON=="function"?e.toJSON():e}_updateDefaultSources(){const{defaultSources:e,includeDefaultSources:t}=this;this._destroyFeatureLayers(),e.removeAll(),t&&e.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()])}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){const e=this.view?.popup,{resultGraphic:t}=this;if(!e||!t)return;const s="selectedFeature"in e,r=s?e.selectedFeature:null;s&&r&&r===t&&e.close()}_suggestTimer(e,t){const s=e??this.suggestionDelay;return jt(s,null,t?.signal)}_createLocationForSearch(e){return e instanceof fe?Pe(e.geometry):e instanceof Z?e:Array.isArray(e)&&e.length===2?new Z({longitude:e[0],latitude:e[1]}):null}_createSuggestionForSearch(e){if(e&&F(e,"key")&&F(e,"text")&&F(e,"sourceIndex"))return e;const t=this._createLocationForSearch(e),s=typeof e=="string"?e:this.searchTerm,{selectedSuggestion:r,selectedResult:o}=this,l=!e&&r&&o,a=l&&r.key===o.key&&r.sourceIndex===o.sourceIndex,u=l&&r.location;return a||u?r:{location:t,text:t?"":s,sourceIndex:null,key:null}}_getFirstResult(e){let t=null;return e&&e.some((s=>{const{results:r}=s,o=r?.[0],l=!!o;return l&&(t=o),l})),t}async _selectFirstResult(e){return this.autoSelect&&e?this.select(e):null}async _suggestImmediate(e,t){await this.when();const s=await this._getSuggestionsFromSources(e,t);if(t?.signal?.aborted)return null;const r={activeSourceIndex:this.activeSourceIndex,searchTerm:e??"",numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(r,s),r}_formatSourceResponse(e,t,s){const r=t?.value||[],o=t?.error,l=this.allSources.at(s);if(o){const a={sourceIndex:s,source:l,error:o};e.errors.push(a),K.error(o),e.numErrors++}else{const a={sourceIndex:s,source:l,results:r};e.results.push(a),e.numResults+=r.length}}_formatResponse(e,t,s){if(t)if(e.activeSourceIndex===X){const r=s&&F(s,"sourceIndex")&&s.sourceIndex!==-1?s.sourceIndex:void 0;t.forEach(((o,l)=>{const a=r!==void 0?r:l;this._formatSourceResponse(e,o,a)}))}else this._formatSourceResponse(e,t[0],e.activeSourceIndex)}async _getResultsFromSources(e,t){const{allSources:s}=this,r=!e.location&&F(e,"sourceIndex")?e.sourceIndex:this.activeSourceIndex,o=[];if(!s.length){const l=new T("search:no-sources-defined","At least one source is required.",{allSources:s});throw K.error(l),l}return r===X?s.forEach(((l,a)=>{o.push(this._getResultsFromSource(e,a,t))})):o.push(this._getResultsFromSource(e,r,t)),le(o)}async _getSuggestionsFromSources(e,t){const{allSources:s,activeSourceIndex:r}=this,o=[];if(!s.length){const l=new T("suggest:no-sources-defined","At least one source is required.",{allSources:s});throw K.error(l),l}return r===X?s.forEach(((l,a)=>{o.push(this._getSuggestionsFromSource(e,a,t))})):o.push(this._getSuggestionsFromSource(e,r,t)),le(o)}async _getResultsFromSource(e,t,s){const r=t!=null?this.allSources.at(t):null;if(!r)return null;const{location:o=null}=e,l=this.view?.spatialReference||Ke,a=F(r,"maxResults")?r.maxResults:this.maxResults,u=!!(r instanceof J&&F(r,"exactMatch"))&&r.exactMatch,{view:d}=this;return r.getResults?.({view:d,sourceIndex:t,location:o,suggestResult:e,spatialReference:l,exactMatch:u,maxResults:a},s)}async _getSuggestionsFromSource(e,t,s){const r=this.allSources.at(t);if(!r)return null;e??="";const o=F(r,"suggestionsEnabled")?r.suggestionsEnabled:this.suggestionsEnabled,l=e?.length,a=F(r,"minSuggestCharacters")?r.minSuggestCharacters:this.minSuggestCharacters;if(o&&e.trim()&&l>=a){const u=this.view?.spatialReference||Ke,d=F(r,"maxSuggestions")?r.maxSuggestions:this.maxSuggestions,{view:c}=this,h=!!(r instanceof J&&F(r,"exactMatch"))&&r.exactMatch;return r.getSuggestions?.({view:c,sourceIndex:t,suggestTerm:e,spatialReference:u,maxSuggestions:d,exactMatch:h},s)}return null}_getLayerSourcePopupTemplate(e){const{layer:t}=e;if(t)return F(e,"popupTemplate")?e.popupTemplate:t.popupTemplate}_getSourceIndexOfResult(e){const t=this.results;if(!t)return null;let s=null;return t.some((r=>r.results.some((o=>o===e&&(s=r.sourceIndex,!0))))),s}async _goToSearchResult(e){this._abortGoTo();const t=new AbortController;this._gotoController=t;const s={target:{target:e},options:{signal:t.signal}};e||(s.options.animate=!1),await this.callGoTo(s),this._gotoController=null}_getDefaultSymbol(e){const{defaultSymbols:t}=this,s=e.feature?.geometry;if(s==null)return null;switch(s.type){case"point":case"multipoint":return t.point;case"polyline":return t.polyline;case"extent":case"polygon":return t.polygon;default:return null}}_removeHighlight(){this.removeHandles(Ge)}async _getLayerView(e){const{view:t}=this;if(!e||!t||e.layer?.type==="building-component"||e.layer?.type==="subtype-sublayer")return null;const{layer:s}=e;return s?(await t.when(),t.whenLayerView(s)):null}_highlightFeature(e){const{graphic:t,layerView:s}=e,{attributes:r,layer:o}=t,{objectIdField:l}=o,a=(l&&r?.[l])??null,u=s.highlight(a??t);this.addHandles(u,Ge)}_setResultFloor(e){const{view:t}=this,s=e.feature?.attributes,r=e.feature?.sourceLayer;if(r&&"floorInfo"in r&&r?.floorInfo?.floorField&&s){const o=s[r.floorInfo.floorField];t?.emit("select-result-floor",o)}}};p.ALL_INDEX=X,i([n()],p.prototype,"_searching",void 0),i([n()],p.prototype,"_updatingPromise",void 0),i([n({readOnly:!0,value:null})],p.prototype,"activeSource",null),i([n()],p.prototype,"activeSourceIndex",null),i([n()],p.prototype,"allPlaceholder",null),i([n({readOnly:!0})],p.prototype,"allSources",null),i([n()],p.prototype,"autoNavigate",void 0),i([n()],p.prototype,"autoSelect",void 0),i([n()],p.prototype,"defaultPopupTemplate",void 0),i([n({readOnly:!0})],p.prototype,"defaultSources",void 0),i([n()],p.prototype,"defaultSymbols",void 0),i([n()],p.prototype,"includeDefaultSources",void 0),i([n()],p.prototype,"locationEnabled",null),i([n()],p.prototype,"maxInputLength",void 0),i([n()],p.prototype,"maxResults",void 0),i([n()],p.prototype,"maxSuggestions",void 0),i([n()],p.prototype,"messages",void 0),i([n()],p.prototype,"minSuggestCharacters",void 0),i([n({readOnly:!0})],p.prototype,"placeholder",null),i([n()],p.prototype,"popupEnabled",void 0),i([n({type:We})],p.prototype,"popupTemplate",void 0),i([n({type:Ce})],p.prototype,"portal",void 0),i([n()],p.prototype,"resultCount",void 0),i([n()],p.prototype,"resultGraphicEnabled",void 0),i([n({readOnly:!0})],p.prototype,"resultGraphic",void 0),i([n({readOnly:!0})],p.prototype,"results",void 0),i([n({readOnly:!0})],p.prototype,"selectedSuggestion",void 0),i([n()],p.prototype,"searchAllEnabled",void 0),i([n({readOnly:!0})],p.prototype,"selectedResult",void 0),i([n()],p.prototype,"searchTerm",null),i([n({type:ue})],p.prototype,"sources",void 0),i([n({readOnly:!0})],p.prototype,"state",null),i([n()],p.prototype,"suggestionDelay",void 0),i([n()],p.prototype,"suggestionCount",void 0),i([n({readOnly:!0})],p.prototype,"suggestions",void 0),i([n()],p.prototype,"suggestionsEnabled",void 0),i([n({readOnly:!0})],p.prototype,"updating",null),i([n()],p.prototype,"view",void 0),i([n()],p.prototype,"clear",null),p=i([D(ft)],p);const Y=p;let q=class extends Ze{constructor(e,t){super(e,t),this.messages=null,this.showMoreResultsOpen=!1,this.viewModel=null}destroy(){this.viewModel=null}render(){const e={[W.showMoreResults]:this.showMoreResultsOpen};return g("div",{class:this.classes(W.base,S.widget)},g("div",{class:this.classes(W.moreResults,e),key:"esri-search-renderer__container"},this._renderSearchResultName(),this._renderMoreResults()))}_renderMoreResults(){return g("div",{key:"esri-search-renderer__more-results"},this._renderMoreResultsButton(),this._renderMoreResultsLists())}_renderSearchResultName(){const e=this.viewModel?.selectedResult,t=e?.name||"";return g("div",{class:W.moreResultsItem,key:"esri-search-renderer__result-name"},t)}_renderMoreResultsLists(){const{viewModel:e}=this;if(!e)return[];const t=e.results;if((e.resultCount??0)<2)return null;const s=t?.map((r=>this._renderMoreResultsList(r)));return g("div",{class:W.moreResultsList,key:"esri-search-renderer__more-results-container"},s)}_renderMoreResultsButton(){const{messages:e,viewModel:t}=this;return t?(t.resultCount??0)<2?null:g("div",{class:W.moreResultsItem,key:"esri-search-renderer__more-results-button"},g("a",{bind:this,class:S.anchor,href:"#",onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?e.hideMoreResults:e.showMoreResults)):null}_renderMoreResultsHeader(e,t){return g("div",{class:W.moreResultsListHeader,key:`esri-search-result-renderer__header-${t}`},e)}_renderMoreResultsList(e){const{results:t}=e,s=t?.length??0,r=s>0,o=this.viewModel?.selectedResult,l=s===1&&t[0]===o,a=this._getSourceName(e.source,e.sourceIndex),u=(this.viewModel?.results?.length??0)>1&&!l?this._renderMoreResultsHeader(a,e.sourceIndex):null,d=r&&t.map(((h,f)=>this._renderMoreResultsListItem(h,f))),c=r&&!l?g("ul",{key:`esri-search-result-renderer__list-${e.sourceIndex}`},d):null;return r?g("div",{key:`esri-search-result-renderer__results-${e.sourceIndex}`},u,c):null}_renderMoreResultsListItem(e,t){const s=this.viewModel?.selectedResult;return e!==s?g("li",{key:`esri-search-result-renderer__list-item-${t}`},g("a",{bind:this,class:S.anchor,"data-result":e,href:"#",onclick:this._selectResultClick,onkeydown:this._selectResultClick,tabIndex:0},e.name)):null}_showMoreResultsClick(e){e.preventDefault(),this.showMoreResultsOpen=!this.showMoreResultsOpen;const t=this.viewModel?.view?.popup;t&&"reposition"in t&&t.reposition()}_selectResultClick(e){e.preventDefault();const t=e.currentTarget["data-result"];this.viewModel?.select(t)}_getSourceName(e,t){return t===Y.ALL_INDEX?this.messages.all:e.name}};i([n(),we("esri/widgets/Search/t9n/Search")],q.prototype,"messages",void 0),i([n()],q.prototype,"showMoreResultsOpen",void 0),i([n()],q.prototype,"viewModel",void 0),i([je()],q.prototype,"_showMoreResultsClick",null),i([je()],q.prototype,"_selectResultClick",null),q=i([D("esri.widgets.Search.SearchResultRenderer")],q);const Ws=q,Zs=/<[a-z/][\s\S]*>/i,Us=(e,t)=>{const s=Dt(t).split(/\s/),r=new RegExp(`(${s.join("|")})`,"gi");return e.replace(r,(o=>`<strong>${o}</strong>`))};let m=class extends Ze{constructor(e,t){super(e,t),this._activeMenuItemIndex=-1,this._inputNode=null,this._menuItemCount=0,this._sourceMenuButtonNode=null,this._sourceListNode=null,this._suggestionListNode=null,this._searchResultRenderer=new Ws,this._suggestController=null,this._searchController=null,this._locateFailed=!1,this._container=null,this.activeMenu="none",this.disabled=!1,this.iconClass=_.widgetIcon,this.icon=null,this.messages=null,this.messagesCommon=null,this.viewModel=new Y,this._clearActiveMenu=()=>{this.activeMenu="none"},this._removeActiveMenu=s=>{const r=s.relatedTarget;r&&this._container?.contains(r)||this._clearActiveMenu()},this.addHandles([ie((()=>this.searchTerm),(s=>{(s&&this.activeMenu==="warning"||!s&&!this.viewModel?.selectedSuggestion?.location)&&this._clearActiveMenu()})),Pt((()=>this.viewModel?.allSources),"change",(()=>this._watchSourceChanges())),ie((()=>this.activeMenu),(()=>this._resetActiveMenuItemIndex()),_e),ie((()=>this.viewModel?.defaultPopupTemplate),(s=>{s&&(s.content=this._renderSearchResultsContent.bind(this))}),_e)])}destroy(){this._cancelSuggest(),this._cancelSearch(),this._searchResultRenderer=Ot(this._searchResultRenderer)}get displayedSearchTerm(){return`${this.viewModel.searchTerm}`.trim()}get inputId(){return this._buildId("input")}get suggestionsMenuId(){return this._buildId("suggest-menu")}get sourceMenuId(){return this._buildId("source-menu")}get sourceMenuButtonId(){return this._buildId("source-menu-button")}get activeSource(){return this.viewModel?.activeSource}get activeSourceIndex(){return this.viewModel.activeSourceIndex}set activeSourceIndex(e){this.viewModel.activeSourceIndex=e}get allPlaceholder(){return this.viewModel.allPlaceholder}set allPlaceholder(e){this.viewModel.allPlaceholder=e}get allSources(){return this.viewModel.allSources}get autoNavigate(){return this.viewModel.autoNavigate}set autoNavigate(e){this.viewModel.autoNavigate=e}get autoSelect(){return this.viewModel.autoSelect}set autoSelect(e){this.viewModel.autoSelect=e}get defaultSources(){return this.viewModel.defaultSources}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get includeDefaultSources(){return this.viewModel.includeDefaultSources}set includeDefaultSources(e){this.viewModel.includeDefaultSources=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get locationEnabled(){return this.viewModel.locationEnabled}set locationEnabled(e){this.viewModel.locationEnabled=e}get maxResults(){return this.viewModel.maxResults}set maxResults(e){this.viewModel.maxResults=e}get maxSuggestions(){return this.viewModel.maxSuggestions}set maxSuggestions(e){this.viewModel.maxSuggestions=e}get minSuggestCharacters(){return this.viewModel.minSuggestCharacters}set minSuggestCharacters(e){this.viewModel.minSuggestCharacters=e}get popupEnabled(){return this.viewModel.popupEnabled}set popupEnabled(e){this.viewModel.popupEnabled=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get portal(){return this.viewModel?.portal}set portal(e){this.viewModel&&(this.viewModel.portal=e)}get resultGraphic(){return this.viewModel.resultGraphic}set resultGraphic(e){this.viewModel.resultGraphic=e}get resultGraphicEnabled(){return this.viewModel.resultGraphicEnabled}set resultGraphicEnabled(e){this.viewModel.resultGraphicEnabled=e}get results(){return this.viewModel.results}get searchAllEnabled(){return this.viewModel.searchAllEnabled}set searchAllEnabled(e){this.viewModel.searchAllEnabled=e}get searchTerm(){return this.viewModel.searchTerm}set searchTerm(e){this.viewModel.searchTerm=e}get selectedResult(){return this.viewModel.selectedResult}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get suggestions(){return this.viewModel.suggestions}get suggestionsEnabled(){return this.viewModel.suggestionsEnabled}set suggestionsEnabled(e){this.viewModel.suggestionsEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}clear(){this.viewModel.clear()}focus(){this._inputNode?.focus(),this.emit("search-focus")}blur(){this._inputNode?.blur(),this.emit("search-blur")}async search(e){this._clearActiveMenu(),this._cancelSuggest(),this._cancelSearch();const t=new AbortController,{signal:s}=t;this._searchController=t;try{const r=await this.viewModel.search(e,{signal:s});return this._searchController!==t?void 0:(this.activeMenu=r?.numResults?"none":"warning",this._searchController=null,r)}catch{return this._searchController!==t?void 0:(this._clearActiveMenu(),void(this._searchController=null))}}async suggest(e){this._cancelSuggest();const t=new AbortController,{signal:s}=t;this._suggestController=t;try{const r=await this.viewModel.suggest(e,null,{signal:s});return this._suggestController!==t?void 0:(this._suggestController=null,r?.numResults&&this._openSuggestionMenu(),this._scrollToTopSuggestion(),r)}catch{return this._suggestController!==t||(this._suggestController=null),null}}render(){const{state:e}=this.viewModel,t={[S.disabled]:e==="disabled",[S.widgetDisabled]:this.disabled};return g("div",{class:this.classes(_.base,S.widget,t)},e==="loading"?this._renderLoader():this._renderContainer())}_renderSubmitButton(){const{messages:e,disabled:t}=this;return g("button",{"aria-label":e.searchButtonTitle,bind:this,class:this.classes(_.submitButton,S.widgetButton),disabled:t,key:"esri-search__submit-button",onclick:this._handleSearchButtonClick,title:e.searchButtonTitle,type:"button"},g("span",{"aria-hidden":"true",class:H.search}))}_renderWarningMenu(){return g("div",{class:this.classes(S.menu,_.warningMenu),key:"esri-search__error-menu"},g("div",{class:_.warningMenuBody},this._renderWarning()))}_renderSourceMenuButton(){const{messages:e,activeMenu:t,sourceMenuId:s,sourceMenuButtonId:r,disabled:o}=this,{activeSourceIndex:l,allSources:a}=this.viewModel;return a.length>1?g("button",{afterCreate:ae,"aria-controls":s,"aria-expanded":(t==="source").toString(),"aria-haspopup":"true","aria-label":e.searchIn,bind:this,class:this.classes(_.sourcesButton,S.widgetButton),"data-node-ref":"_sourceMenuButtonNode",disabled:o,id:r,key:"esri-search__source-menu-button",onclick:this._handleSourcesMenuToggleClick,onfocus:this._handleSourcesMenuToggleFocus,title:e.searchIn,type:"button"},g("span",{"aria-hidden":"true",class:this.classes(H.downArrow,_.sourcesButtonDown)}),g("span",{"aria-hidden":"true",class:this.classes(H.upArrow,_.sourcesButtonUp)}),g("span",{class:_.sourceName},this._getSourceName(l))):null}_renderSourcesList(){const{allSources:e,searchAllEnabled:t}=this.viewModel,{_activeMenuItemIndex:s,activeMenu:r,sourceMenuId:o,sourceMenuButtonId:l}=this,a=r==="source"&&s>-1?this._buildId("source-item",s):null;return e.length>1?g("ul",{afterCreate:ae,"aria-activedescendant":a,"aria-labelledby":l,bind:this,class:S.menuList,"data-node-ref":"_sourceListNode",id:o,onkeydown:this._handleSourceMenuKeydown,onkeyup:this._handleSourceMenuKeyup,role:"menu",tabIndex:-1},t?this._renderSource(Y.ALL_INDEX):null,e.map(((u,d)=>this._renderSource(d))).toArray()):null}_renderSourcesMenu(){const{allSources:e}=this.viewModel;return e.length>1?g("div",{class:this.classes(S.menu,_.sourcesMenu),key:"esri-search__source-menu"},this._renderSourcesList()):null}_renderLoader(){const{messages:e,messagesCommon:t,disabled:s}=this;return g("div",{class:S.loader,key:"base-loader",tabIndex:s?-1:void 0},g("span",{"aria-hidden":"true",class:S.loaderAnimation}),g("span",{class:H.fontFallbackText},e.searchButtonTitle),g("span",{class:S.loaderText},t.loading))}_renderContainer(){const{allSources:e,state:t}=this.viewModel,{activeMenu:s}=this,r={[_.hasMultipleSources]:e.length>1,[_.isLoading]:t==="loading",[_.isSearching]:t==="searching",[_.showWarning]:s==="warning",[_.showSources]:s==="source",[_.showSuggestions]:s==="suggestion"};return g("div",{afterCreate:o=>{this._container=o,o.addEventListener("focusout",this._removeActiveMenu)},afterRemoved:o=>{o.removeEventListener("focusout",this._removeActiveMenu)},class:this.classes(r,_.container),key:"base-container",tabIndex:-1},this._renderSourceMenuButton(),this._renderSourcesMenu(),this._renderInputContainer(),this._renderSubmitButton(),this._renderWarningMenu())}_renderClearButton(){return this.searchTerm?g("button",{bind:this,class:this.classes(_.clearButton,S.widgetButton),disabled:this.disabled,key:"esri-search__clear-button",onclick:this._handleClearButtonClick,onfocus:this._clearActiveMenu,title:this.messages.clearButtonTitle,type:"button"},g("span",{"aria-hidden":"true",class:H.close})):null}_renderLocationGroup(){const{messages:e,locationEnabled:t,displayedSearchTerm:s}=this,r=t&&!s,o=this.activeMenu==="suggestion"&&this._activeMenuItemIndex===0;return r?g("ul",{class:this.classes(S.menuList,_.suggestionList,_.suggestionListCurrentLocation),key:"esri-search__suggestion-list-current-location",role:"group"},g("li",{"aria-selected":(this.activeMenu==="suggestion"&&this._activeMenuItemIndex===0).toString(),bind:this,class:this.classes(S.menuItem,o?S.menuItemFocus:null),"data-current-location-item":!0,id:this._buildId("suggestion-item",0),onclick:this._handleUseCurrentLocationClick,role:"option"},g("span",{"aria-hidden":"true",class:H.locateCircled})," ",e.useCurrentLocation)):null}_renderInput(){const{activeMenu:e,locationEnabled:t,displayedSearchTerm:s,messages:r,suggestionsMenuId:o,inputId:l,_activeMenuItemIndex:a,disabled:u}=this,{maxInputLength:d,placeholder:c,searchTerm:h,suggestionCount:f}=this.viewModel,b=!(!(t&&!s)&&!f),v=e==="suggestion"&&a>-1?this._buildId("suggestion-item",a):null;return g("input",{afterCreate:ae,"aria-activedescendant":v,"aria-autocomplete":"list","aria-controls":b?o:null,"aria-expanded":(b&&e==="suggestion").toString(),"aria-haspopup":"listbox","aria-label":r.searchButtonTitle,autocomplete:"off",bind:this,class:this.classes(S.input,_.input),"data-node-ref":"_inputNode",disabled:u,id:l,maxlength:d,onblur:this.blur,onclick:this._openSuggestionMenu,onfocus:this.focus,oninput:this._handleInputPaste,onkeyup:this._handleInputKeyup,onpaste:this._handleInputPaste,placeholder:c,role:"combobox",title:h?"":c,type:"text",value:h})}_renderForm(){return g("form",{bind:this,class:_.form,disabled:this.disabled,key:"esri-search__form",onsubmit:this._formSubmit,role:"search"},this._renderInput())}_renderSuggestList(e){const{sourceIndex:t}=e,{results:s}=e;return s?.length?g("ul",{class:this.classes(S.menuList,_.suggestionList),key:`esri-search__suggestion-list-${t}`,role:"group"},s?.map((o=>this._renderSuggestion(o,this._menuItemCount++)))):null}_renderSuggestionsGroup(){const{suggestions:e}=this.viewModel;return e?e.map((t=>[this._renderSuggestionHeader(t),this._renderSuggestList(t)])):[]}_renderSuggestionsMenu(){const{displayedSearchTerm:e,locationEnabled:t,suggestionsMenuId:s,inputId:r}=this,{suggestionCount:o}=this.viewModel,l=t&&!e||o;return this._menuItemCount=0,l?g("div",{afterCreate:ae,"aria-labelledby":r,bind:this,class:this.classes(S.menu,_.suggestionsMenu),"data-node-ref":"_suggestionListNode",id:s,key:"esri-search__suggestions-menu",role:"listbox"},this._renderLocationGroup(),this._renderSuggestionsGroup()):null}_renderInputContainer(){return g("div",{class:_.inputContainer,key:"esri-search__input-container"},this._renderForm(),this._renderSuggestionsMenu(),this._renderClearButton())}_renderSuggestionHeader(e){const{allSources:t,activeSourceIndex:s}=this.viewModel,{sourceIndex:r}=e,o=e.results?.length,l=t.length>1&&s===Y.ALL_INDEX;return o&&l?g("div",{class:S.menuHeader,key:`esri-search__suggestion-header-${r}`},this._getSourceName(r)):null}_renderSuggestion(e,t){const{_activeMenuItemIndex:s,viewModel:{searchTerm:r}}=this;if(!r)return;const o=this.activeMenu==="suggestion"&&s===t;return g("li",{"aria-selected":(this.activeMenu==="suggestion"&&this._activeMenuItemIndex===t).toString(),bind:this,class:this.classes(S.menuItem,o?S.menuItemFocus:null),"data-suggestion":e,id:this._buildId("suggestion-item",t),innerHTML:this._getSuggestResultHTML(e.text,r),key:`esri-search__suggestion_${t}`,onclick:this._handleSuggestionClick,role:"option"})}_renderSource(e){const{activeSourceIndex:t,searchAllEnabled:s}=this.viewModel,r={[S.menuItemActive]:e===t,[S.menuItemFocus]:this.activeMenu==="source"&&e===(s?this._activeMenuItemIndex-1:this._activeMenuItemIndex)},o=s?e+1:e;return g("li",{"aria-checked":(e===t).toString(),bind:this,class:this.classes(_.source,S.menuItem,r),"data-source-index":e,id:this._buildId("source-item",o),key:`esri-search__source-${e}`,onclick:this._handleSourceClick,role:"menuitemradio"},this._getSourceName(e))}_renderNoResultsWarning(e){const{messages:t}=this,s=e?qe(t.noResultsFoundForValue,{value:`"${e}"`}):t.noResultsFound;return g("div",{key:"esri-search__no_results"},g("div",{class:_.warningMenuHeader},t.noResults),g("div",{class:_.warningMenuText},s))}_renderEmptySearchWarning(){const{messages:e}=this;return g("div",{key:"esri-search__empty-search"},g("span",{"aria-hidden":"true",class:H.noticeTriangle}),g("span",{class:_.noValueText},e.emptyValue))}_renderLocateWarning(){const{messages:e}=this;return g("div",{key:"esri-search__locate-error"},g("span",{"aria-hidden":"true",class:H.noticeTriangle}),g("span",{class:_.noValueText},e.locateError))}_renderWarning(){const{displayedSearchTerm:e,_locateFailed:t}=this,{viewModel:s}=this;return t?this._renderLocateWarning():s.selectedSuggestion?.location||e?this._renderNoResultsWarning(e):this._renderEmptySearchWarning()}_resetActiveMenuItemIndex(){this._activeMenuItemIndex=-1}_buildId(e,t){return`${this.id}-${e}${t===void 0?"":`-${t}`}`}_watchSourceChanges(){const{viewModel:{allSources:e}}=this,t="sources";this.removeHandles(t),e.forEach((s=>this.addHandles(ie((()=>s.name),(()=>this.scheduleRender())),t)))}_handleSourcesMenuToggleFocus(){this.activeMenu!=="source"&&this._clearActiveMenu()}_handleSourcesMenuToggleClick(){const e=this.activeMenu==="source";this.activeMenu=e?"none":"source",this.renderNow(),this.activeMenu==="source"&&this._sourceListNode?.focus()}_handleClearButtonClick(){this.viewModel.clear(),this._focus()}_handleSearchButtonClick(){this.search()}_handleSuggestionClick(e){const t=He(e.currentTarget);t&&(this._focus(),this.search(t))}_handleUseCurrentLocationClick(){this._useCurrentLocation()}_useCurrentLocation(){this._focus("none"),this._cancelSuggest(),this._cancelSearch();const e=new AbortController,{signal:t}=e;this._searchController=e,(async()=>{try{const s=await this.viewModel.searchNearby({signal:t});this.activeMenu=s?.numResults?"none":"warning"}catch{this._locateFailed=!0,this.activeMenu="warning"}finally{this._searchController=null}})()}_handleSourceClick(e){this._setSourceFromMenuItem(e.currentTarget)}_setSourceFromMenuItem(e){if(!e)return;const t=Js(e);t!=null&&(this.viewModel.activeSourceIndex=t,this._clearActiveMenu(),this._sourceMenuButtonNode?.focus())}_cancelSuggest(){this._suggestController=Ae(this._suggestController)}_cancelSearch(){this._searchController=Ae(this._searchController),this._locateFailed=!1}_handleInputKeyup(e){const t=ye(e);if(e.ctrlKey||e.metaKey||t==="Copy"||t==="ArrowLeft"||t==="ArrowRight"||t==="Shift")return;if(t==="Tab"||t==="Escape"||e.shiftKey&&t==="Tab")return this._cancelSuggest(),void(t==="Escape"&&this._clearActiveMenu());const s=t==="Home"||t==="End"||t==="ArrowUp"||t==="ArrowDown";if(t==="Enter"&&this._activeMenuItemIndex<0)return void this._cancelSuggest();const r=this._suggestionListNode?.getElementsByTagName("li");if(r?.length){if(this.activeMenu!=="suggestion"&&this._openSuggestionMenu(),s)return e.preventDefault(),this._cancelSuggest(),void this._handleItemNavigation(t,r,this._suggestionListNode);const o=r[this._activeMenuItemIndex];if(t==="Enter"&&o){const l=He(o);return void(l?(this._focus(),this.search(l)):Qs(o)&&this._useCurrentLocation())}}this.viewModel.searchTerm&&this.suggest()}_handleItemNavigation(e,t,s){const r=this._activeMenuItemIndex;e==="Home"&&(this._activeMenuItemIndex=0),e==="End"&&(this._activeMenuItemIndex=t.length-1),e==="ArrowUp"&&(this._activeMenuItemIndex=this._activeMenuItemIndex<=0?t.length-1:this._activeMenuItemIndex-1),e==="ArrowDown"&&(this._activeMenuItemIndex=this._activeMenuItemIndex===t.length-1?0:this._activeMenuItemIndex+1),r!==this._activeMenuItemIndex&&s&&Gt(t[this._activeMenuItemIndex],s)}_scrollToTopSuggestion(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)}_openSuggestionMenu(){this.activeMenu="suggestion"}_handleInputPaste(e){const t=e.target;this.viewModel.searchTerm!==t.value&&(this.viewModel.searchTerm=t.value),this.viewModel.searchTerm&&this.suggest()}_handleSourceMenuKeydown(e){const t=ye(e);if(Kt(t)){e.preventDefault();const s=this._sourceListNode?.getElementsByTagName("li"),r=s?.[this._activeMenuItemIndex];this._setSourceFromMenuItem(r)}else t!=="ArrowUp"&&t!=="ArrowDown"&&t!=="End"&&t!=="Home"||e.preventDefault()}_handleSourceMenuKeyup(e){const t=ye(e),s=t==="ArrowUp"||t==="ArrowDown"||t==="End"||t==="Home";if(s&&e.preventDefault(),t==="Escape")return this._clearActiveMenu(),void this._sourceMenuButtonNode?.focus();const r=this._sourceListNode?.getElementsByTagName("li");return r&&r.length!==0&&s?(this.activeMenu!=="source"&&(this.activeMenu="source"),void this._handleItemNavigation(t,r,this._sourceListNode?.parentElement)):void 0}_focus(e){this.focus(),e&&(this.activeMenu=e)}_formSubmit(e){e.preventDefault(),this._activeMenuItemIndex===-1&&this.search()}_getSourceName(e){const{messages:t}=this,s=this.viewModel,{allSources:r}=s,o=r.at(e);return e===Y.ALL_INDEX?t.all:o&&o.name||t.untitledSource}_getSuggestResultHTML(e,t){return e?Zs.test(e)?e:Us(e,t):this.messages.untitledResult}_renderSearchResultsContent(){return this._searchResultRenderer.showMoreResultsOpen=!1,this._searchResultRenderer.viewModel=this.viewModel,this._searchResultRenderer}};function He(e){return e?.["data-suggestion"]}function Js(e){return e?.["data-source-index"]}function Qs(e){return!!e?.["data-current-location-item"]}i([n()],m.prototype,"_activeMenuItemIndex",void 0),i([n()],m.prototype,"displayedSearchTerm",null),i([n({readOnly:!0})],m.prototype,"inputId",null),i([n({readOnly:!0})],m.prototype,"suggestionsMenuId",null),i([n({readOnly:!0})],m.prototype,"sourceMenuId",null),i([n({readOnly:!0})],m.prototype,"sourceMenuButtonId",null),i([n()],m.prototype,"activeMenu",void 0),i([n({readOnly:!0})],m.prototype,"activeSource",null),i([n()],m.prototype,"activeSourceIndex",null),i([n()],m.prototype,"allPlaceholder",null),i([n({readOnly:!0})],m.prototype,"allSources",null),i([n()],m.prototype,"autoNavigate",null),i([n()],m.prototype,"autoSelect",null),i([n({readOnly:!0})],m.prototype,"defaultSources",null),i([n()],m.prototype,"disabled",void 0),i([n()],m.prototype,"goToOverride",null),i([n()],m.prototype,"iconClass",void 0),i([n()],m.prototype,"icon",void 0),i([n()],m.prototype,"includeDefaultSources",null),i([n()],m.prototype,"label",null),i([n()],m.prototype,"locationEnabled",null),i([n()],m.prototype,"maxResults",null),i([n()],m.prototype,"maxSuggestions",null),i([n(),we("esri/widgets/Search/t9n/Search")],m.prototype,"messages",void 0),i([n(),we("esri/t9n/common")],m.prototype,"messagesCommon",void 0),i([n()],m.prototype,"minSuggestCharacters",null),i([n()],m.prototype,"popupEnabled",null),i([n()],m.prototype,"popupTemplate",null),i([n()],m.prototype,"portal",null),i([n()],m.prototype,"resultGraphic",null),i([n()],m.prototype,"resultGraphicEnabled",null),i([n({readOnly:!0})],m.prototype,"results",null),i([n()],m.prototype,"searchAllEnabled",null),i([n()],m.prototype,"searchTerm",null),i([n({readOnly:!0})],m.prototype,"selectedResult",null),i([n()],m.prototype,"sources",null),i([n({readOnly:!0})],m.prototype,"suggestions",null),i([n()],m.prototype,"suggestionsEnabled",null),i([n()],m.prototype,"view",null),i([Vt(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),n({type:Y})],m.prototype,"viewModel",void 0),m=i([D("esri.widgets.Search")],m);const Xs=m,wr=e=>{e.layers.ab&&e.mapView.when().then(()=>e.layers.ab.when()).then(()=>{Ys(e),sr(e),tr(e)})},Ys=e=>{e.ui.searchPanel=document.createElement("div"),e.ui.searchPanel.id="searchPanel",e.ui.searchPanel.innerHTML=`
        <div id="searchContainer"></div>
        <div id="searchPanelContent"></div>
    `,e.ui.mapInterfaceContainer.appendChild(e.ui.searchPanel)},er=(e,t)=>{const s=document.createElement("button");return s.type="button",s.innerHTML=e.ui.icons.info,s.addEventListener("click",()=>{e.utils.showResultInfo(e,t.attributes),e.highlightSelect&&e.highlightSelect.remove(),e.highlightSelect=e.mainLayerView.highlight(t),e.mapView.goTo(t.geometry.extent.expand(2),{duration:1e3})}),s},Ve=(e,t)=>{const s=document.createElement("button");return s.type="button",s.innerHTML=e.ui.icons.dash,s.addEventListener("click",()=>{window.open(t,"_blank")}),s},tr=e=>{const t=e.layers.ab,s=e.showHasGuardian,r=t.createQuery();r.where="dash_url <> '' and dash_url is not null",r.outFields=["*"],r.orderByFields=["name"],t.queryFeatures(r).then(o=>{const l=document.createElement("ul");for(const a of o.features){const u=a.attributes.dash_url,d=a.attributes.name+", "+a.attributes.state,c=document.createElement("li");if(s){const h=er(e,a);c.appendChild(h);const f=Ve(e,u);c.appendChild(f),c.appendChild(document.createTextNode(d))}else{const h=Ve(e,u);c.appendChild(h);const f=document.createElement("a");f.href=u,f.target="_blank",f.rel="noopener",f.textContent=d,c.appendChild(f)}l.appendChild(c)}e.dashboardsList=l,e.ui.searchPanelContent=document.getElementById("searchPanelContent"),e.ui.searchPanelContent.innerHTML="",e.ui.searchPanelContent.appendChild(l)})},sr=e=>{e.widgets.search=rr(e),ir(e)},rr=e=>{const t=new Xs({view:e.mapView,locationEnabled:!1,searchAllEnabled:!1,includeDefaultSources:!1,container:"searchContainer"});return t.goToOverride=(s,r)=>{const o=r.target.target.attributes,l=e.showHasGuardian;return l&&e.utils.showResultInfo(e,o),e.highlightSelect&&e.highlightSelect.remove(),e.highlightSelect=e.mainLayerView.highlight(r.target.target),r.options.duration=1e3,s.goTo(r.target.target.geometry.extent.expand(2),r.options).then(()=>{if(!l){const a=o.dash_url;if(typeof a=="string")try{const u=new URL(a);(u.protocol==="http:"||u.protocol==="https:")&&window.open(u.href,"_blank","noopener")}catch{}}})},t.on("select-result",s=>{t.clear()}),t},ir=e=>{e.widgets.search.sources=[{layer:e.layers.ab,searchFields:["name"],suggestionTemplate:"{name}, {state}",exactMatch:!1,outFields:["name","state","dash_url","g_ims"],prefix:"%",postfix:"%",name:"LGA Name",placeholder:"LGA Name",maxSuggestions:6,minSuggestCharacters:1}],e.widgets.search.when(()=>{e.showHeader&&e.widgets.search.focus()})};export{wr as addSearchPanel};
