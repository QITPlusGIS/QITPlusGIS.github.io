import{a as t,bK as v,y as n,k as R,U as m,T as y,c as w,ai as $,q as p,ez as u,eU as A,Q as G,f as B,F as L}from"./uuid-De2V3pkO.js";import{a as f,c as k}from"./clusterUtils-CBl3uOAm.js";import{m as j,y as T,a as C}from"./commonProperties-7y88ic0r.js";import{t as c,p as I}from"./FeatureReductionSelection-BdTwQHJB.js";import"./UniqueValueRenderer-DdZymv08.js";import{m as F,o as b,p as D}from"./jsonUtils-CshCi2EU.js";import{D as z}from"./featureLayerUtils-JQb3hLRE.js";import{C as M}from"./LabelClass-5BgkMgGD.js";var h;const O="esri.layers.support.FeatureReductionBinning";let a=h=class extends c{constructor(i){super(i),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(i,o,r){const e=i.filter((l=>l.statisticType!=="avg_angle")).map((l=>l.toJSON()));$(r,e,o)}readRenderer(i,o,r){const e=o.drawingInfo?.renderer;return e?b(e,o,r)??void 0:z(o,r)}clone(){return new h({fields:p(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:p(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:p(this.popupTemplate),renderer:p(this.renderer)})}};t([v({binning:"binning"})],a.prototype,"type",void 0),t([v({geohash:"geohash"})],a.prototype,"binType",void 0),t([n({type:Number,range:{min:1,max:9},json:{write:!0}})],a.prototype,"fixedBinLevel",void 0),t([n({type:[M],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],a.prototype,"labelingInfo",void 0),t([n(j)],a.prototype,"labelsVisible",void 0),t([n({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],a.prototype,"maxScale",void 0),t([n(T)],a.prototype,"popupEnabled",void 0),t([n({type:R,json:{name:"popupInfo",write:!0}})],a.prototype,"popupTemplate",void 0),t([n({type:[f],json:{write:!0}})],a.prototype,"fields",void 0),t([m("fields")],a.prototype,"writeFields",null),t([n({types:F,json:{write:{target:"drawingInfo.renderer"}}})],a.prototype,"renderer",void 0),t([y("renderer",["drawingInfo.renderer"])],a.prototype,"readRenderer",null),a=h=t([w(O)],a);const N=a;var g;const J="esri.layers.support.FeatureReductionCluster";function x(i){return i.type==="simple"&&!i.visualVariables?.length}let s=g=class extends G{constructor(i){super(i),this.type="cluster",this.clusterRadius=u("80px"),this.clusterMinSize=u("12px"),this.clusterMaxSize=u("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(i,o,r){const e=o.drawingInfo?.renderer;return e?.authoringInfo?.isAutoGenerated?null:e?x(e)?null:b(e,o,r)??void 0:z(o,r)}readSymbol(i,o,r){const e=o.drawingInfo?.renderer;return e?.authoringInfo?.isAutoGenerated?null:e&&x(e)?b(e,o,r)?.symbol:null}writeSymbol(i,o,r,e){const l=this.renderer?.authoringInfo?.isAutoGenerated;if(!this.renderer||l){const d=new D({symbol:i});o.drawingInfo={renderer:d.write({},e)}}}writeFields(i,o,r){const e=i.filter((l=>l.statisticType!=="avg_angle")).map((l=>l.toJSON()));$(r,e,o)}readFields(i,o,r){return i.filter((e=>!e.isAutoGenerated)).map((e=>f.fromJSON(e)))}clone(){return new g({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:p(this.labelingInfo),labelsVisible:this.labelsVisible,fields:p(this.fields),maxScale:this.maxScale,renderer:p(this.renderer),symbol:p(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:p(this.popupTemplate)})}};t([n({type:["cluster"],readOnly:!0,json:{write:!0}})],s.prototype,"type",void 0),t([n({type:Number,cast:i=>i==="auto"?i:u(i),json:{write:!0}})],s.prototype,"clusterRadius",void 0),t([n({type:Number,cast:u,json:{write:!0}})],s.prototype,"clusterMinSize",void 0),t([n({type:Number,cast:u,json:{write:!0}})],s.prototype,"clusterMaxSize",void 0),t([n({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],s.prototype,"maxScale",void 0),t([n(T)],s.prototype,"popupEnabled",void 0),t([n({type:R,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],s.prototype,"popupTemplate",void 0),t([n({types:F,json:{write:{target:"drawingInfo.renderer"}}})],s.prototype,"renderer",void 0),t([y("renderer",["drawingInfo.renderer"])],s.prototype,"readRenderer",null),t([n({types:A})],s.prototype,"symbol",void 0),t([y("symbol",["drawingInfo.renderer"])],s.prototype,"readSymbol",null),t([m("symbol")],s.prototype,"writeSymbol",null),t([n({type:[M],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],s.prototype,"labelingInfo",void 0),t([n(j)],s.prototype,"labelsVisible",void 0),t([n({type:[f],json:{write:!0}})],s.prototype,"fields",void 0),t([m("fields")],s.prototype,"writeFields",null),t([y("fields")],s.prototype,"readFields",null),s=g=t([w(J)],s);const V=s,S={key:"type",base:c,typeMap:{cluster:V,binning:N}},U={types:{key:"type",base:c,typeMap:{selection:I,cluster:V,binning:N}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:S},"portal-item":{types:S},"web-scene":{types:{key:"type",base:c,typeMap:{selection:I}},name:"layerDefinition.featureReduction",write:{layerContainerTypes:C}}}}},Z=i=>{let o=class extends i{constructor(...r){super(...r),this.addHandles(B((()=>this.renderer),(()=>{if(this.featureReduction){const e=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",e)}}),L))}set featureReduction(r){const e=this._normalizeFeatureReduction(r);this._set("featureReduction",e)}set renderer(r){}_normalizeFeatureReduction(r){if(r?.type!=="cluster")return r;const e=r.clone(),l=[new f({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],d=(e.fields??[]).filter((_=>!_.isAutoGenerated));if(r.renderer&&!r.renderer.authoringInfo?.isAutoGenerated)return e.fields=[...l,...d],e;if(r.symbol)return e.fields=[...l,...d],e.renderer=null,e;if(!this.renderer)return r;const E=k(l,this.renderer,r,null,!1);return e.fields=[...l,...d],e.renderer=E,e}};return t([n(U)],o.prototype,"featureReduction",null),o=t([w("esri.layers.mixins.FeatureReductionLayer")],o),o};export{Z as c};
