const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./editingSupport-D5I07PLd.js","./uuid-De2V3pkO.js","./index-OAJD89tD.js","./normalizeUtils-CHaYFzrc.js","./normalizeUtilsCommon-vfKhPTnw.js","./EditBusLayer-Z-bxRsy2.js","./infoFor3D-CKoUGm1M.js","./layerUtils-D8dZn4eh.js"])))=>i.map(i=>d[i]);
import{_ as g}from"./index-OAJD89tD.js";import{R as F,dp as A,o as s,d6 as O,dq as P,dr as j,A as m}from"./uuid-De2V3pkO.js";import{b as f}from"./Query-CEg5oX17.js";import{L as R}from"./layerUtils-D8dZn4eh.js";import{p as E}from"./jsonUtils-CshCi2EU.js";import{A as x}from"./UniqueValueRenderer-DdZymv08.js";import{c as C}from"./AttachmentQuery-BX_2HFsg.js";import I from"./RelationshipQuery-CSVnFDD7.js";async function L(e,t,n){t=t.clone(),e.capabilities.query.supportsMaxRecordCountFactor&&(t.maxRecordCountFactor=q(e));const r=_(e),a=e.capabilities.query.supportsPagination;t.start=0,t.num=r;let o=null;for(;;){const u=await e.source.queryFeaturesJSON(t,n);if(o==null?o=u:o.features=o.features.concat(u.features),o.exceededTransferLimit=u.exceededTransferLimit,!a||!u.exceededTransferLimit)break;t.start+=r}return o}function _(e){return q(e)*M(e)}function M(e){return e.capabilities.query.maxRecordCount||2e3}function q(e){return e.capabilities.query.supportsMaxRecordCountFactor?f.MAX_MAX_RECORD_COUNT_FACTOR:1}const J=new F({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function k(e,t,n,r){const a=await d(e);if(await w(e,t,r),!a.addAttachment)throw new s(r,"Layer source does not support addAttachment capability");return a.addAttachment(t,n)}function w(e,t,n){const{attributes:r}=t,{objectIdField:a}=e;return e.capabilities?.data?.supportsAttachment?t?r?a&&r[a]?Promise.resolve():Promise.reject(new s(n,`feature is missing the identifying attribute ${a}`)):Promise.reject(new s(n,"'attributes' are required on a feature to query attachments")):Promise.reject(new s(n,"A feature is required to add/delete/update attachments")):Promise.reject(new s(n,"this layer doesn't support attachments"))}async function Z(e,t,n,r,a){const o=await d(e);if(await w(e,t,a),!o.updateAttachment)throw new s(a,"Layer source does not support updateAttachment capability");return o.updateAttachment(t,n,r)}async function H(e,t,n){const{applyEdits:r}=await g(()=>import("./editingSupport-D5I07PLd.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url),a=await e.load(),{source:o,globalIdField:u}=a;let p=n;return a.type==="feature"&&a.infoFor3D&&t.deleteFeatures!=null&&u!=null&&(p={...p,globalIdToObjectId:await S(e,t.deleteFeatures,u)}),r(a,o,t,n)}async function X(e,t,n){const{uploadAssets:r}=await g(()=>import("./editingSupport-D5I07PLd.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url),a=await e.load();return r(a,a.source,t,n)}async function z(e,t,n,r){const a=await d(e);if(await w(e,t,r),!a.deleteAttachments)throw new s(r,"Layer source does not support deleteAttachments capability");return a.deleteAttachments(t,n)}async function B(e,t,n){const r=(await e.load({signal:t?.signal})).source;if(!r.fetchRecomputedExtents)throw new s(n,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(t)}async function K(e,t,n,r){t=C.from(t),await e.load();const a=e.source,o=e.capabilities;if(!o?.data?.supportsAttachment)throw new s(r,"this layer doesn't support attachments");const{attachmentTypes:u,objectIds:p,globalIds:y,num:i,size:c,start:l,where:b}=t;if(!o?.operations?.supportsQueryAttachments&&(u?.length>0||y?.length>0||c?.length>0||i||l||b))throw new s(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",t);if(!(p?.length||y?.length||b))throw new s(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",t);if(!a.queryAttachments)throw new s(r,"Layer source does not support queryAttachments capability",t);return a.queryAttachments(t)}async function W(e,t,n,r){const a=await d(e);if(!a.queryObjectIds)throw new s(r,"Layer source does not support queryObjectIds capability");return a.queryObjectIds(f.from(t)??e.createQuery(),n)}async function Y(e,t,n,r){const a=await d(e);if(!a.queryFeatureCount)throw new s(r,"Layer source does not support queryFeatureCount capability");return a.queryFeatureCount(f.from(t)??e.createQuery(),n)}async function ee(e,t,n,r){const a=await d(e);if(!a.queryExtent)throw new s(r,"Layer source does not support queryExtent capability");return a.queryExtent(f.from(t)??e.createQuery(),n)}async function te(e,t,n,r){const a=await d(e);if(!a.queryRelatedFeatures)throw new s(r,"Layer source does not support queryRelatedFeatures capability");return a.queryRelatedFeatures(I.from(t),n)}async function re(e,t,n,r){const a=await d(e);if(!a.queryRelatedFeaturesCount)throw new s(r,"Layer source does not support queryRelatedFeaturesCount capability");return a.queryRelatedFeaturesCount(I.from(t),n)}async function ne(e){const t=e.source;if(t?.refresh)try{const{dataChanged:n,updates:r}=await t.refresh();if(r!=null&&(e.sourceJSON={...e.sourceJSON,...r},e.read(r,{origin:"service",url:e.parsedUrl})),n)return!0}catch{}if(e.definitionExpression)try{return(await O(e.definitionExpression,e.fieldsIndex)).hasDateFunctions}catch{}return!1}function ae(e){const t=new f,n=e.capabilities?.data,r=e.capabilities?.query;t.historicMoment=e.historicMoment,t.gdbVersion=e.gdbVersion,t.returnGeometry=!0,r&&(t.compactGeometryEnabled=r.supportsCompactGeometry,t.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),n&&(n.supportsZ&&e.returnZ!=null&&(t.returnZ=e.returnZ),n.supportsM&&e.returnM!=null&&(t.returnM=e.returnM)),t.outFields=["*"];const{timeOffset:a,timeExtent:o}=e;return t.timeExtent=a!=null&&o!=null?o.offset(-a.value,a.unit):o||null,t.multipatchOption=e.geometryType==="multipatch"?"xyFootprint":null,t}function oe(e){const{globalIdField:t,fields:n}=e;if(t)return t;if(n){for(const r of n)if(r.type==="esriFieldTypeGlobalID")return r.name}}function se(e){const{objectIdField:t,fields:n}=e;if(t)return t;if(n){for(const r of n)if(r.type==="esriFieldTypeOID")return r.name}}function ie(e){return e.currentVersion?e.currentVersion:e.hasOwnProperty("capabilities")||e.hasOwnProperty("drawingInfo")||e.hasOwnProperty("hasAttachments")||e.hasOwnProperty("htmlPopupType")||e.hasOwnProperty("relationships")||e.hasOwnProperty("timeInfo")||e.hasOwnProperty("typeIdField")||e.hasOwnProperty("types")?10:9.3}async function d(e){return(await e.load()).source}async function T(e,t){if(!m||m.findCredential(e))return;let n;try{const r=await R(e,t);r&&(n=await m.checkSignInStatus(`${r}/sharing`))}catch{}if(n)try{const r=t!=null?t.signal:null;await m.getCredential(e,{signal:r})}catch{}}async function ue(e,t,n){const r=e.parsedUrl?.path;r&&e.authenticationTriggerEvent===t&&await T(r,n)}function ce(e){return!e.sourceJSON?.isMultiServicesView&&(e.userHasUpdateItemPrivileges||e.editingEnabled)}const h=A({types:P});function le(e,t){if(e.defaultSymbol)return e.types?.length?new x({defaultSymbol:h(e.defaultSymbol,e,t),field:e.typeIdField,uniqueValueInfos:e.types.map((n=>({id:n.id,symbol:h(n.symbol,n,t)})))}):new E({symbol:h(e.defaultSymbol,e,t)})}function de(e){let t=e.sourceJSON?.cacheMaxAge;if(!t)return!1;const n=e.editingInfo?.lastEditDate?.getTime();return n==null||(t*=1e3,Date.now()-n<t)}async function S(e,t,n){if(t==null)return null;const r=[],{objectIdField:a}=e;if(t.forEach((i=>{let c=null;if("attributes"in i){const{attributes:l}=i;c={globalId:l[n],objectId:l[a]!=null&&l[a]!==-1?l[a]:null}}else c={globalId:i.globalId,objectId:i.objectId!=null&&i.objectId!==-1?i.objectId:null};c.globalId!=null&&(c.objectId!=null&&c.objectId!==-1||r.push(c.globalId))})),r.length===0)return null;const o=e.createQuery();o.where=r.map((i=>`${n}='${i}'`)).join(" OR "),o.returnGeometry=!1,o.outFields=[a,n],o.cacheHint=!1;const u=await j(L(e,o));if(!u.ok)return null;const p=new Map,y=u.value.features;for(const i of y){const c=i.attributes[n],l=i.attributes[a];c!=null&&l!=null&&l!==-1&&p.set(c,l)}return p}export{Y as A,ie as C,le as D,re as E,W as F,B as I,se as M,ee as O,te as P,ue as Q,oe as R,ne as S,ce as T,de as U,S as V,H as b,J as f,X as g,z as j,k as m,K as q,Z as w,ae as x};
