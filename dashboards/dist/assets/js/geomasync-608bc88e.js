import{z as fn,A as W,da as d,S as j,M as R,b4 as O,b5 as x,b6 as H,a7 as K,Z as B,df as ln,aO as on}from"./uuid-854440a9.js";import{Z as o,n as m,Q as V,K as Q,X,d as U,a as s,r as u,q as A,b as F,i as M,H as J,A as w,a9 as G,aa as k,ab as q,c as N,B as dn,ac as wn,ad as mn,E as Y,N as L,y as Z,ae as hn,af as C}from"./arcadeUtils-2ae88c16.js";import{c as P,r as D,a as y}from"./TimeOnly-c0fc7892.js";import{l as _}from"./portalUtils-2eb99449.js";import{A as yn,h as pn,S as gn,m as vn,x as Pn,p as In,O as An,g as Fn,R as Nn,D as bn,b as Rn,E as xn,k as Sn,y as On,w as jn,W as $,K as nn,F as T,M as E,d as Dn,C as rn,U as en,B as Mn,L as Jn,P as Ln,v as Zn,H as tn,N as an,J as Cn,j as Tn,T as zn,V as Un}from"./geometryEngineAsync-bec0ba39.js";import"./index-2eca610e.js";import"./Field-3600efd2.js";import"./fieldType-67bcc5fb.js";import"./number-3c59fea0.js";import"./featureConversionUtils-fdf2c775.js";import"./OptimizedFeature-ded94d90.js";import"./OptimizedFeatureSet-1d1ac4b9.js";import"./FieldsIndex-babfd5a5.js";import"./workers-bc069650.js";async function sn(t,r,e){var a,i;if(!((a=fn)==null?void 0:a.findCredential(t.restUrl)))return null;if(t.loadStatus==="loaded"&&r===""&&((i=t.user)!=null&&i.sourceJSON)&&e===!1)return t.user.sourceJSON;const l={responseType:"json",query:{f:"json"}};if(e&&(l.query.returnUserLicenseTypeExtensions=!0),r===""){const f=await W(t.restUrl+"/community/self",l);if(f.data){const h=f.data;if(h!=null&&h.username)return h}return null}const n=await W(t.restUrl+"/community/users/"+r,l);if(n.data){const f=n.data;return f.error?null:f}return null}function un(t){return ln.indexOf("4.")===0?x.fromExtent(t):new x({spatialReference:t.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]})}function I(t,r,e){if(m(t,2,2,r,e),!(t[0]instanceof d&&t[1]instanceof d)){if(!(t[0]instanceof d&&t[1]===null)){if(!(t[1]instanceof d&&t[0]===null)){if(t[0]!==null||t[1]!==null)throw new s(r,u.InvalidParameter,e)}}}}async function cn(t,r){if(t.type!=="polygon"&&t.type!=="polyline"&&t.type!=="extent")return 0;let e=1;(t.spatialReference.vcsWkid||t.spatialReference.latestVcsWkid)&&(e=hn(t.spatialReference)/on(t.spatialReference));let c=0;if(t.type==="polyline")for(const n of t.paths)for(let a=1;a<n.length;a++)c+=C(n[a],n[a-1],e);else if(t.type==="polygon")for(const n of t.rings){for(let a=1;a<n.length;a++)c+=C(n[a],n[a-1],e);(n[0][0]!==n[n.length-1][0]||n[0][1]!==n[n.length-1][1]||n[0][2]!==void 0&&n[0][2]!==n[n.length-1][2])&&(c+=C(n[0],n[n.length-1],e))}else t.type==="extent"&&(c+=2*C([t.xmin,t.ymin,0],[t.xmax,t.ymin,0],e),c+=2*C([t.xmin,t.ymin,0],[t.xmin,t.ymax,0],e),c*=2,c+=4*Math.abs(w(t.zmax,0)*e-w(t.zmin,0)*e));const l=new R({hasZ:!1,hasM:!1,spatialReference:t.spatialReference,paths:[[0,0],[0,c]]});return T(l,r)}function nr(t){t.mode==="async"&&(t.functions.disjoint=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>(I(n=o(n),r,e),n[0]===null||n[1]===null||yn(n[0],n[1])))},t.functions.intersects=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>(I(n=o(n),r,e),n[0]!==null&&n[1]!==null&&pn(n[0],n[1])))},t.functions.touches=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>(I(n=o(n),r,e),n[0]!==null&&n[1]!==null&&gn(n[0],n[1])))},t.functions.crosses=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>(I(n=o(n),r,e),n[0]!==null&&n[1]!==null&&vn(n[0],n[1])))},t.functions.within=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>(I(n=o(n),r,e),n[0]!==null&&n[1]!==null&&Pn(n[0],n[1])))},t.functions.contains=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>(I(n=o(n),r,e),n[0]!==null&&n[1]!==null&&In(n[0],n[1])))},t.functions.overlaps=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>(I(n=o(n),r,e),n[0]!==null&&n[1]!==null&&An(n[0],n[1])))},t.functions.equals=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>(m(n,2,2,r,e),n[0]===n[1]||(n[0]instanceof d&&n[1]instanceof d?Fn(n[0],n[1]):(V(n[0])&&V(n[1])||!!(Q(n[0])&&Q(n[1])||X(n[0])&&X(n[1])))&&n[0].equals(n[1]))))},t.functions.relate=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>{if(n=o(n),m(n,3,3,r,e),n[0]instanceof d&&n[1]instanceof d)return Nn(n[0],n[1],U(n[2]));if(n[0]instanceof d&&n[1]===null||n[1]instanceof d&&n[0]===null||n[0]===null&&n[1]===null)return!1;throw new s(r,u.InvalidParameter,e)})},t.functions.intersection=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>(I(n=o(n),r,e),n[0]===null||n[1]===null?null:bn(n[0],n[1])))},t.functions.union=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>{const a=[];if((n=o(n)).length===0)throw new s(r,u.WrongNumberOfParameters,e);if(n.length===1)if(A(n[0])){const i=o(n[0]);for(let f=0;f<i.length;f++)if(i[f]!==null){if(!(i[f]instanceof d))throw new s(r,u.InvalidParameter,e);a.push(i[f])}}else{if(!F(n[0])){if(n[0]instanceof d)return M(P(n[0]),r.spatialReference);if(n[0]===null)return null;throw new s(r,u.InvalidParameter,e)}{const i=o(n[0].toArray());for(let f=0;f<i.length;f++)if(i[f]!==null){if(!(i[f]instanceof d))throw new s(r,u.InvalidParameter,e);a.push(i[f])}}}else for(let i=0;i<n.length;i++)if(n[i]!==null){if(!(n[i]instanceof d))throw new s(r,u.InvalidParameter,e);a.push(n[i])}return a.length===0?null:Rn(a)})},t.functions.difference=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>(I(n=o(n),r,e),n[0]!==null&&n[1]===null?P(n[0]):n[0]===null?null:xn(n[0],n[1])))},t.functions.symmetricdifference=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>(I(n=o(n),r,e),n[0]===null&&n[1]===null?null:n[0]===null?P(n[1]):n[1]===null?P(n[0]):Sn(n[0],n[1])))},t.functions.clip=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>{if(n=o(n),m(n,2,2,r,e),!(n[1]instanceof j)&&n[1]!==null)throw new s(r,u.InvalidParameter,e);if(n[0]===null)return null;if(!(n[0]instanceof d))throw new s(r,u.InvalidParameter,e);return n[1]===null?null:On(n[0],n[1])})},t.functions.cut=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>{if(n=o(n),m(n,2,2,r,e),!(n[1]instanceof R)&&n[1]!==null)throw new s(r,u.InvalidParameter,e);if(n[0]===null)return[];if(!(n[0]instanceof d))throw new s(r,u.InvalidParameter,e);return n[1]===null?[P(n[0])]:jn(n[0],n[1])})},t.functions.area=function(r,e){return t.standardFunctionAsync(r,e,async(c,l,n)=>{if(m(n,1,2,r,e),(n=o(n))[0]===null)return 0;if(J(n[0])){const a=await n[0].sumArea(D(w(n[1],-1)),!1,r.abortSignal);if(r.abortSignal.aborted)throw new s(r,u.Cancelled,e);return a}if(A(n[0])||F(n[0])){const a=G(n[0],r.spatialReference);return a===null?0:$(a,D(w(n[1],-1)))}if(!(n[0]instanceof d))throw new s(r,u.InvalidParameter,e);return $(n[0],D(w(n[1],-1)))})},t.functions.areageodetic=function(r,e){return t.standardFunctionAsync(r,e,async(c,l,n)=>{if(m(n,1,2,r,e),(n=o(n))[0]===null)return 0;if(J(n[0])){const a=await n[0].sumArea(D(w(n[1],-1)),!0,r.abortSignal);if(r.abortSignal.aborted)throw new s(r,u.Cancelled,e);return a}if(A(n[0])||F(n[0])){const a=G(n[0],r.spatialReference);return a===null?0:nn(a,D(w(n[1],-1)))}if(!(n[0]instanceof d))throw new s(r,u.InvalidParameter,e);return nn(n[0],D(w(n[1],-1)))})},t.functions.length=function(r,e){return t.standardFunctionAsync(r,e,async(c,l,n)=>{if(m(n,1,2,r,e),(n=o(n))[0]===null)return 0;if(J(n[0])){const a=await n[0].sumLength(y(w(n[1],-1)),!1,r.abortSignal);if(r.abortSignal.aborted)throw new s(r,u.Cancelled,e);return a}if(A(n[0])||F(n[0])){const a=k(n[0],r.spatialReference);return a===null?0:T(a,y(w(n[1],-1)))}if(!(n[0]instanceof d))throw new s(r,u.InvalidParameter,e);return T(n[0],y(w(n[1],-1)))})},t.functions.length3d=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>{if(m(n,1,2,r,e),(n=o(n))[0]===null)return 0;if(A(n[0])||F(n[0])){const a=k(n[0],r.spatialReference);return a===null?0:a.hasZ===!0?cn(a,y(w(n[1],-1))):T(a,y(w(n[1],-1)))}if(!(n[0]instanceof d))throw new s(r,u.InvalidParameter,e);return n[0].hasZ===!0?cn(n[0],y(w(n[1],-1))):T(n[0],y(w(n[1],-1)))})},t.functions.lengthgeodetic=function(r,e){return t.standardFunctionAsync(r,e,async(c,l,n)=>{if(m(n,1,2,r,e),(n=o(n))[0]===null)return 0;if(J(n[0])){const a=await n[0].sumLength(y(w(n[1],-1)),!0,r.abortSignal);if(r.abortSignal.aborted)throw new s(r,u.Cancelled,e);return a}if(A(n[0])||F(n[0])){const a=k(n[0],r.spatialReference);return a===null?0:E(a,y(w(n[1],-1)))}if(!(n[0]instanceof d))throw new s(r,u.InvalidParameter,e);return E(n[0],y(w(n[1],-1)))})},t.functions.distance=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>{n=o(n),m(n,2,3,r,e);let a=n[0];(A(n[0])||F(n[0]))&&(a=q(n[0],r.spatialReference));let i=n[1];if((A(n[1])||F(n[1]))&&(i=q(n[1],r.spatialReference)),!(a instanceof d))throw new s(r,u.InvalidParameter,e);if(!(i instanceof d))throw new s(r,u.InvalidParameter,e);return Dn(a,i,y(w(n[2],-1)))})},t.functions.distancegeodetic=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>{n=o(n),m(n,2,3,r,e);const a=n[0],i=n[1];if(!(a instanceof O))throw new s(r,u.InvalidParameter,e);if(!(i instanceof O))throw new s(r,u.InvalidParameter,e);const f=new R({paths:[],spatialReference:a.spatialReference});return f.addPath([a,i]),E(f,y(w(n[2],-1)))})},t.functions.densify=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>{if(n=o(n),m(n,2,3,r,e),n[0]===null)return null;if(!(n[0]instanceof d))throw new s(r,u.InvalidParameter,e);const a=N(n[1]);if(isNaN(a))throw new s(r,u.InvalidParameter,e);if(a<=0)throw new s(r,u.InvalidParameter,e);return n[0]instanceof x||n[0]instanceof R?rn(n[0],a,y(w(n[2],-1))):n[0]instanceof j?rn(un(n[0]),a,y(w(n[2],-1))):n[0]})},t.functions.densifygeodetic=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>{if(n=o(n),m(n,2,3,r,e),n[0]===null)return null;if(!(n[0]instanceof d))throw new s(r,u.InvalidParameter,e);const a=N(n[1]);if(isNaN(a))throw new s(r,u.InvalidParameter,e);if(a<=0)throw new s(r,u.InvalidParameter,e);return n[0]instanceof x||n[0]instanceof R?en(n[0],a,y(w(n[2],-1))):n[0]instanceof j?en(un(n[0]),a,y(w(n[2],-1))):n[0]})},t.functions.generalize=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>{if(n=o(n),m(n,2,4,r,e),n[0]===null)return null;if(!(n[0]instanceof d))throw new s(r,u.InvalidParameter,e);const a=N(n[1]);if(isNaN(a))throw new s(r,u.InvalidParameter,e);return Mn(n[0],a,dn(w(n[2],!0)),y(w(n[3],-1)))})},t.functions.buffer=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>{if(n=o(n),m(n,2,3,r,e),n[0]===null)return null;if(!(n[0]instanceof d))throw new s(r,u.InvalidParameter,e);const a=N(n[1]);if(isNaN(a))throw new s(r,u.InvalidParameter,e);return a===0?P(n[0]):Jn(n[0],a,y(w(n[2],-1)))})},t.functions.buffergeodetic=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>{if(n=o(n),m(n,2,3,r,e),n[0]===null)return null;if(!(n[0]instanceof d))throw new s(r,u.InvalidParameter,e);const a=N(n[1]);if(isNaN(a))throw new s(r,u.InvalidParameter,e);return a===0?P(n[0]):Ln(n[0],a,y(w(n[2],-1)))})},t.functions.offset=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>{if(n=o(n),m(n,2,6,r,e),n[0]===null)return null;if(!(n[0]instanceof x||n[0]instanceof R))throw new s(r,u.InvalidParameter,e);const a=N(n[1]);if(isNaN(a))throw new s(r,u.InvalidParameter,e);const i=N(w(n[4],10));if(isNaN(i))throw new s(r,u.InvalidParameter,e);const f=N(w(n[5],0));if(isNaN(f))throw new s(r,u.InvalidParameter,e);return Zn(n[0],a,y(w(n[2],-1)),U(w(n[3],"round")).toLowerCase(),i,f)})},t.functions.rotate=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>{n=o(n),m(n,2,3,r,e);let a=n[0];if(a===null)return null;if(!(a instanceof d))throw new s(r,u.InvalidParameter,e);a instanceof j&&(a=x.fromExtent(a));const i=N(n[1]);if(isNaN(i))throw new s(r,u.InvalidParameter,e);const f=w(n[2],null);if(f===null)return tn(a,i);if(f instanceof O)return tn(a,i,f);throw new s(r,u.InvalidParameter,e)})},t.functions.centroid=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>{if(n=o(n),m(n,1,1,r,e),n[0]===null)return null;let a=n[0];if((A(n[0])||F(n[0]))&&(a=q(n[0],r.spatialReference)),a===null)return null;if(!(a instanceof d))throw new s(r,u.InvalidParameter,e);return a instanceof O?M(P(n[0]),r.spatialReference):a instanceof x?a.centroid:a instanceof R?wn(a):a instanceof H?mn(a):a instanceof j?a.center:null})},t.functions.multiparttosinglepart=function(r,e){return t.standardFunctionAsync(r,e,async(c,l,n)=>{n=o(n),m(n,1,1,r,e);const a=[];if(n[0]===null)return null;if(!(n[0]instanceof d))throw new s(r,u.InvalidParameter,e);if(n[0]instanceof O)return[M(P(n[0]),r.spatialReference)];if(n[0]instanceof j)return[M(P(n[0]),r.spatialReference)];const i=await an(n[0]);if(i instanceof x){const f=[],h=[];for(let p=0;p<i.rings.length;p++)if(i.isClockwise(i.rings[p])){const g=K({rings:[i.rings[p]],hasZ:i.hasZ===!0,hazM:i.hasM===!0,spatialReference:i.spatialReference.toJSON()});f.push(g)}else h.push({ring:i.rings[p],pt:i.getPoint(p,0)});for(let p=0;p<h.length;p++)for(let g=0;g<f.length;g++)if(f[g].contains(h[p].pt)){f[g].addRing(h[p].ring);break}return f}if(i instanceof R){const f=[];for(let h=0;h<i.paths.length;h++){const p=K({paths:[i.paths[h]],hasZ:i.hasZ===!0,hazM:i.hasM===!0,spatialReference:i.spatialReference.toJSON()});f.push(p)}return f}if(n[0]instanceof H){const f=M(P(n[0]),r.spatialReference);for(let h=0;h<f.points.length;h++)a.push(f.getPoint(h));return a}return null})},t.functions.issimple=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>{if(n=o(n),m(n,1,1,r,e),n[0]===null)return!0;if(!(n[0]instanceof d))throw new s(r,u.InvalidParameter,e);return Cn(n[0])})},t.functions.simplify=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>{if(n=o(n),m(n,1,1,r,e),n[0]===null)return null;if(!(n[0]instanceof d))throw new s(r,u.InvalidParameter,e);return an(n[0])})},t.functions.convexhull=function(r,e){return t.standardFunctionAsync(r,e,(c,l,n)=>{if(n=o(n),m(n,1,1,r,e),n[0]===null)return null;if(!(n[0]instanceof d))throw new s(r,u.InvalidParameter,e);return Tn(n[0])})},t.functions.getuser=function(r,e){return t.standardFunctionAsync(r,e,async(c,l,n)=>{var h,p;m(n,0,2,r,e);let a=w(n[1],""),i=a===!0;if(a=a===!0||a===!1?"":U(a),n.length===0||n[0]instanceof Y){let g=null;g=(h=r.services)!=null&&h.portal?r.services.portal:B.getDefault(),n.length>0&&(g=_(n[0],g));const S=await sn(g,a,i);if(S){const b=JSON.parse(JSON.stringify(S));for(const v of["lastLogin","created","modified"])b[v]!==void 0&&b[v]!==null&&(b[v]=new Date(b[v]));return L.convertObjectToArcadeDictionary(b,Z(r))}return null}let f=null;if(J(n[0])&&(f=n[0]),f){if(i=!1,a)return null;await f.load();const g=await f.getOwningSystemUrl();if(!g){if(!a){const v=await f.getIdentityUser();return v?L.convertObjectToArcadeDictionary({username:v},Z(r)):null}return null}let S=null;S=(p=r.services)!=null&&p.portal?r.services.portal:B.getDefault(),S=_(new Y(g),S);const b=await sn(S,a,i);if(b){const v=JSON.parse(JSON.stringify(b));for(const z of["lastLogin","created","modified"])v[z]!==void 0&&v[z]!==null&&(v[z]=new Date(v[z]));return L.convertObjectToArcadeDictionary(v,Z(r))}return null}throw new s(r,u.InvalidParameter,e)})}),t.functions.nearestcoordinate=function(r,e){return t.standardFunctionAsync(r,e,async(c,l,n)=>{if(n=o(n),m(n,2,2,r,e),!(n[0]instanceof d||n[0]===null))throw new s(r,u.InvalidParameter,e);if(!(n[1]instanceof O||n[1]===null))throw new s(r,u.InvalidParameter,e);if(n[0]===null||n[1]===null)return null;const a=await zn(n[0],n[1]);return a===null?null:L.convertObjectToArcadeDictionary({coordinate:a.coordinate,distance:a.distance},Z(r),!1,!0)})},t.functions.nearestvertex=function(r,e){return t.standardFunctionAsync(r,e,async(c,l,n)=>{if(n=o(n),m(n,2,2,r,e),!(n[0]instanceof d||n[0]===null))throw new s(r,u.InvalidParameter,e);if(!(n[1]instanceof O||n[1]===null))throw new s(r,u.InvalidParameter,e);if(n[0]===null||n[1]===null)return null;const a=await Un(n[0],n[1]);return a===null?null:L.convertObjectToArcadeDictionary({coordinate:a.coordinate,distance:a.distance},Z(r),!1,!0)})}}export{nr as registerFunctions};
