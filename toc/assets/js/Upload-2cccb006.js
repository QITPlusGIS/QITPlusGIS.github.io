import{v as h,w,x as y,y as p,z as _,_ as T,A as g,s as F,B as k,D as r,E as u,F as v,G as $,I as E,J as x,K as P,M as A,N as d,O as D}from"./index-285b86bc.js";let a=class extends h{constructor(){super({}),this._uploadTask=null}destroy(){this.cancel()}get state(){const e=this._uploadTask;return e?e.finished?e.error?w(e.error)?"canceled":"error":"success":"pending":"default"}get result(){var e;return((e=this._uploadTask)==null?void 0:e.value)??null}get error(){var e;return((e=this._uploadTask)==null?void 0:e.error)??null}uploadTo(e){this.cancel(),this._uploadTask=y(async t=>{const o=await O(e);if(p(t),o.length===0)throw _();const s=(await T(()=>import("./Mesh-b3fd109b.js"),["./Mesh-b3fd109b.js","./index-285b86bc.js","..\\index-add6cbc1.css","./MeshTransform-4c3e1230.js","./MeshComponent-7ecc5799.js","./imageUtils-c2d0d1ae.js","./MeshGeoreferencedRelativeVertexSpace-51a2ce4a.js","./MeshLocalVertexSpace-221fbd3a.js","./triangulationUtils-d04a78c7.js","./earcut-42d4ceed.js","./DoubleArray-002a0af8.js","./Indices-6bebb175.js","./deduplicate-e9648d89.js","./georeference-b6154556.js","./spatialReferenceEllipsoidUtils-24a4fa8c.js","./vec32-45b1afc1.js","./projection-ed091cb1.js","./BufferView-d2b0c642.js","./External-e3215da6.js"],import.meta.url)).default;p(t);const i=new g({x:0,y:0,z:0,spatialReference:e.spatialReference}),n=await s.createFromFiles(i,o,{layer:e,signal:t});if(p(t),!n)throw new F("editor:upload","could not upload or convert model");return n.load()})}cancel(){this._uploadTask=k(this._uploadTask)}};r([u()],a.prototype,"state",null),r([u()],a.prototype,"result",null),r([u()],a.prototype,"error",null),r([u()],a.prototype,"_uploadTask",void 0),a=r([v("esri.widgets.Editor.Upload")],a);let l=null;async function O(e){return"showOpenFilePicker"in window&&!l?R(e):j(e)}async function R(e){try{const t=await window.showOpenFilePicker({multiple:!0,excludeAcceptAllOption:!0,types:$(e.infoFor3D)});return Promise.all(t.map(o=>o.getFile()))}catch(t){return E(t),[]}}async function j(e){const t=x();let o;const s=document.createElement("input");s.type="file",s.multiple=!0,s.accept=P(e.infoFor3D).join(",");const i=A([d(s,"change",()=>f(n())),D(()=>clearTimeout(o)),d(document,["focus","focusin"],m),d(window,["focus","focusin"],m)]);function n(){return s.files?Array.from(s.files):[]}function f(c){i.remove(),t.resolve(c)}function m(){clearTimeout(o),o=setTimeout(()=>{if(!document.hasFocus())return;const c=n();c.length===0&&f(c)},z)}return l?l(s):s.click(),t.promise.finally(()=>i.remove())}function S(e){l=t=>{setTimeout(()=>{const o=new DataTransfer;e.forEach(s=>o.items.add(s)),t.files=o.files,t.dispatchEvent(new Event("change"))})}}function U(){l=null}const z=5e3;export{a as Upload,U as clearPromptForFilesStub,S as simulateSelectingFiles};
