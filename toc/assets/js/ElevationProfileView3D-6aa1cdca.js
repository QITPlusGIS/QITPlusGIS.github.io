import{B as E,gJ as _,x as R,y as D,gK as b,iE as H,iF as P,iG as L,a$ as p,iH as k,M as G,D as c,E as v,F as M,v as V,cH as y,iI as I,cU as d,bR as O,bM as S,aQ as T,dR as x,dP as f,bb as u,gL as w}from"./index-95bf5a29.js";import{p as z}from"./HoveredPoints-acc1ec65.js";import{j as $,P as C}from"./OutlineVisualElement-3fce7c6f.js";import"./analysisThemeUtils-ca1845e3.js";import"./colorUtils-eebbe84c.js";import"./vec4f32-0d1b2306.js";import"./Octree-951ba625.js";import"./line-579cbfc8.js";import"./DoubleArray-a1f802bb.js";import"./FloatArray-46ebcdae.js";import"./requestImageUtils-7af19df5.js";import"./basicInterfaces-bb952591.js";import"./enums-b14466b3.js";import"./Texture-bbec4966.js";import"./Indices-1b8b69f9.js";import"./triangle-2a16a8b5.js";import"./doublePrecisionUtils-e3c3d0d8.js";import"./BufferView-41ba25a0.js";import"./VertexElementDescriptor-2925c6af.js";import"./VertexArrayObject-b3a7c307.js";import"./OrderIndependentTransparency-b8ef1857.js";import"./hydratedFeatures-46e4e86d.js";import"./triangulationUtils-6d281c8e.js";import"./earcut-01cee920.js";import"./deduplicate-732e7549.js";import"./NestedMap-1b5db22e.js";import"./InterleavedLayout-e7643592.js";import"./types-1305598a.js";import"./floatRGBA-5b6289a8.js";import"./glUtil-0b7ee6ea.js";class A{constructor(e){this._params=e,this._highlightTask=null,this._highlightHandle=null,this._visualElementHandle=null}destroy(){this.remove()}remove(){this._highlightTask=E(this._highlightTask),this._highlightHandle=_(this._highlightHandle),this._visualElementHandle=_(this._visualElementHandle)}showHighlight(e){if(this.remove(),e==null||!g(e))return;const i=e.layer;this._highlightTask=R(async t=>{const o=await this._params.view.whenLayerView(i);D(t),b(o)&&(this._highlightHandle=o.highlight(e))})}showReshaping(e){if(this.remove(),e==null)return;const i=this._params.view,t=new $({view:i,geometry:g(e)?e.geometry:null,attached:!1,elevationInfo:H(e),renderOccluded:P.OccludeAndTransparentStencil}),o=new L({graphic:e}),s=[p(()=>o.isDraped,n=>{t.isDraped=n}),o.on("changed",()=>{t.geometry=g(e)?e.geometry:null}),i.trackGraphicState(o),i.maskOccludee(e),k(t)];C(i).visualElements.lineGraphics.outline.apply(t),t.attached=!0,this._visualElementHandle=G(s)}}function g(a){return a.geometry!=null&&a.geometry.type==="polyline"}const B=100;let m=class extends V{constructor(a){super(a),this._chartData=null,this._visualElements=[],this._handles=new y}initialize(){const a=I(e=>{this._update(e)},B);this._handles.add([p(()=>({spatialReference:this.view.spatialReference,chartData:this._chartData}),a,d),a])}destroy(){this._handles.destroy(),this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(a){this._chartData=a}_update(a){const{chartData:e}=a;if(e==null)return this.remove();if(!e.refined)return;const i=this._visualElements,t=e.lines.filter(r=>r.viewVisualizationEnabled),o=t.length;for(;i.length>o;)i.pop().destroy();const s=x().profileLinesStyle3D;for(;i.length<o;){const r=new $({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:s.width-s.outlineSize,width:s.width,falloff:s.falloff,color:s.outlineColor,renderOccluded:s.renderOccluded});i.push(r)}const n=a.spatialReference;for(let r=0;r<o;++r){const l=i[r],h=t[o-1-r];l.geometry=this._createLineGeometry(h,n),l.innerColor=O(S.toUnitRGBA(h.color))}}_createLineGeometry(a,e){const i=a.samples??[],t=i.length-1,o=[];let s=[];for(let n=0;n<=t;n++){const{x:r,y:l,z:h}=i[n];h!=null&&s.push([r,l,h]),n!==t&&h!=null||!s.length||(o.push(s),s=[])}return new T({paths:o,hasZ:!0,spatialReference:e})}_destroyVisualElements(){this._visualElements.forEach(a=>a.destroy()),this._visualElements.length=0}};c([v()],m.prototype,"view",void 0),c([v()],m.prototype,"_chartData",void 0),m=c([M("esri.widgets.ElevationProfile.support.ProfileLines3D")],m);class fe{constructor(e,i){this._handles=new y,this._inputRepresentation=new A({view:e}),this._hoveredPoints=new z({view:e}),this._profileLines=new m({view:e}),this._handles.add([p(()=>i.viewModel.hoveredPoints,t=>this._hoveredPoints.update(t),d),p(()=>{const{state:t,editable:o,highlightEnabled:s,viewModel:n}=i,r=n.input;return f(r,l=>{l.commitProperty("geometry"),l.commitProperty("layer")}),{input:r,state:t,editable:o,highlightEnabled:s}},t=>this._updateInputRepresentation(t),d),p(()=>i.viewModel.chartData,t=>this._profileLines.update(t),d),p(()=>f(i.viewModel.input,t=>t.geometry),()=>{this._profileLines.remove()},d)])}destroy(){this._handles=u(this._handles),this._inputRepresentation=u(this._inputRepresentation),this._hoveredPoints=u(this._hoveredPoints),this._profileLines=u(this._profileLines)}_updateInputRepresentation({input:e,state:i,editable:t,highlightEnabled:o}){const s=this._inputRepresentation;if(!o)return s.remove();i===w.Selected?s.showHighlight(e):i!==w.Created||t?s.remove():s.showReshaping(e)}}export{fe as ElevationProfileView3D};
