import{f3 as d,f0 as i,f1 as s,aS as S,aQ as x,A as b,aP as N,f4 as rn,aR as H,f5 as an,bN as V,aL as W,f6 as sn,f7 as cn,f8 as un,f9 as D}from"./index-a8f4225e.js";import{l,Q as h,B,c as Z,z as I,q as F,y as j,m as P,V as L,t as O,v as w,u as E,w as p,x as k,H as T,b as R,I as fn,K as U,A as C,P as M}from"./arcadeUtils-1b30c0cb.js";import{disjoint as on,intersects as ln,touches as dn,crosses as wn,within as hn,contains as mn,overlaps as yn,equals as pn,relate as gn,intersect as vn,union as Pn,difference as An,symmetricDifference as In,clip as Fn,cut as Rn,planarArea as K,geodesicArea as Q,planarLength as z,geodesicLength as q,distance as xn,densify as G,geodesicDensify as X,generalize as Nn,buffer as bn,geodesicBuffer as Sn,offset as On,rotate as Y,simplify as _,isSimple as Dn,convexHull as jn,nearestCoordinate as Ln,nearestVertex as Cn}from"./geometryEngineAsync-20b00823.js";import{t as $,s as nn}from"./portalUtils-9c2866ad.js";import"./number-67b764ec.js";import"./featureConversionUtils-92a6d504.js";import"./OptimizedFeature-4701473b.js";import"./OptimizedFeatureSet-1d1ac4b9.js";import"./OptimizedGeometry-196224d4.js";import"./arcadeTimeUtils-774613dd.js";function en(r){return sn.indexOf("4.")===0?N.fromExtent(r):new N({spatialReference:r.spatialReference,rings:[[[r.xmin,r.ymin],[r.xmin,r.ymax],[r.xmax,r.ymax],[r.xmax,r.ymin],[r.xmin,r.ymin]]]})}function A(r,e,t){if(h(r,2,2,e,t),!(r[0]instanceof d&&r[1]instanceof d)){if(!(r[0]instanceof d&&r[1]===null)){if(!(r[1]instanceof d&&r[0]===null)){if(r[0]!==null||r[1]!==null)throw new i(e,s.InvalidParameter,t)}}}}async function tn(r,e){if(r.type!=="polygon"&&r.type!=="polyline"&&r.type!=="extent")return 0;let t=1;(r.spatialReference.vcsWkid||r.spatialReference.latestVcsWkid)&&(t=cn(r.spatialReference)/un(r.spatialReference));let u=0;if(r.type==="polyline")for(const n of r.paths)for(let a=1;a<n.length;a++)u+=D(n[a],n[a-1],t);else if(r.type==="polygon")for(const n of r.rings){for(let a=1;a<n.length;a++)u+=D(n[a],n[a-1],t);(n[0][0]!==n[n.length-1][0]||n[0][1]!==n[n.length-1][1]||n[0][2]!==void 0&&n[0][2]!==n[n.length-1][2])&&(u+=D(n[0],n[n.length-1],t))}else r.type==="extent"&&(u+=2*D([r.xmin,r.ymin,0],[r.xmax,r.ymin,0],t),u+=2*D([r.xmin,r.ymin,0],[r.xmin,r.ymax,0],t),u*=2,u+=4*Math.abs(w(r.zmax,0)*t-w(r.zmin,0)*t));const o=new x({hasZ:!1,hasM:!1,spatialReference:r.spatialReference,paths:[[0,0],[0,u]]});return z(o,e)}function Bn(r){r.mode==="async"&&(r.functions.disjoint=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>(A(n=l(n),e,t),n[0]===null||n[1]===null||on(n[0],n[1])))},r.functions.intersects=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>(A(n=l(n),e,t),n[0]!==null&&n[1]!==null&&ln(n[0],n[1])))},r.functions.touches=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>(A(n=l(n),e,t),n[0]!==null&&n[1]!==null&&dn(n[0],n[1])))},r.functions.crosses=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>(A(n=l(n),e,t),n[0]!==null&&n[1]!==null&&wn(n[0],n[1])))},r.functions.within=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>(A(n=l(n),e,t),n[0]!==null&&n[1]!==null&&hn(n[0],n[1])))},r.functions.contains=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>(A(n=l(n),e,t),n[0]!==null&&n[1]!==null&&mn(n[0],n[1])))},r.functions.overlaps=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>(A(n=l(n),e,t),n[0]!==null&&n[1]!==null&&yn(n[0],n[1])))},r.functions.equals=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>(h(n,2,2,e,t),n[0]===n[1]||(n[0]instanceof d&&n[1]instanceof d?pn(n[0],n[1]):!(!B(n[0])||!B(n[1]))&&n[0].equals(n[1]))))},r.functions.relate=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>{if(n=l(n),h(n,3,3,e,t),n[0]instanceof d&&n[1]instanceof d)return gn(n[0],n[1],Z(n[2]));if(n[0]instanceof d&&n[1]===null||n[1]instanceof d&&n[0]===null||n[0]===null&&n[1]===null)return!1;throw new i(e,s.InvalidParameter,t)})},r.functions.intersection=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>(A(n=l(n),e,t),n[0]===null||n[1]===null?null:vn(n[0],n[1])))},r.functions.union=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>{const a=[];if((n=l(n)).length===0)throw new i(e,s.WrongNumberOfParameters,t);if(n.length===1)if(I(n[0])){const c=l(n[0]);for(let f=0;f<c.length;f++)if(c[f]!==null){if(!(c[f]instanceof d))throw new i(e,s.InvalidParameter,t);a.push(c[f])}}else{if(!F(n[0])){if(n[0]instanceof d)return j(P(n[0]),e.spatialReference);if(n[0]===null)return null;throw new i(e,s.InvalidParameter,t)}{const c=l(n[0].toArray());for(let f=0;f<c.length;f++)if(c[f]!==null){if(!(c[f]instanceof d))throw new i(e,s.InvalidParameter,t);a.push(c[f])}}}else for(let c=0;c<n.length;c++)if(n[c]!==null){if(!(n[c]instanceof d))throw new i(e,s.InvalidParameter,t);a.push(n[c])}return a.length===0?null:Pn(a)})},r.functions.difference=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>(A(n=l(n),e,t),n[0]!==null&&n[1]===null?P(n[0]):n[0]===null?null:An(n[0],n[1])))},r.functions.symmetricdifference=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>(A(n=l(n),e,t),n[0]===null&&n[1]===null?null:n[0]===null?P(n[1]):n[1]===null?P(n[0]):In(n[0],n[1])))},r.functions.clip=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>{if(n=l(n),h(n,2,2,e,t),!(n[1]instanceof S)&&n[1]!==null)throw new i(e,s.InvalidParameter,t);if(n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);return n[1]===null?null:Fn(n[0],n[1])})},r.functions.cut=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>{if(n=l(n),h(n,2,2,e,t),!(n[1]instanceof x)&&n[1]!==null)throw new i(e,s.InvalidParameter,t);if(n[0]===null)return[];if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);return n[1]===null?[P(n[0])]:Rn(n[0],n[1])})},r.functions.area=function(e,t){return r.standardFunctionAsync(e,t,async(u,o,n)=>{if(h(n,1,2,e,t),(n=l(n))[0]===null)return 0;if(L(n[0])){const a=await n[0].sumArea(O(w(n[1],-1)),!1,e.abortSignal);if(e.abortSignal.aborted)throw new i(e,s.Cancelled,t);return a}if(I(n[0])||F(n[0])){const a=E(n[0],e.spatialReference);return a===null?0:K(a,O(w(n[1],-1)))}if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);return K(n[0],O(w(n[1],-1)))})},r.functions.areageodetic=function(e,t){return r.standardFunctionAsync(e,t,async(u,o,n)=>{if(h(n,1,2,e,t),(n=l(n))[0]===null)return 0;if(L(n[0])){const a=await n[0].sumArea(O(w(n[1],-1)),!0,e.abortSignal);if(e.abortSignal.aborted)throw new i(e,s.Cancelled,t);return a}if(I(n[0])||F(n[0])){const a=E(n[0],e.spatialReference);return a===null?0:Q(a,O(w(n[1],-1)))}if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);return Q(n[0],O(w(n[1],-1)))})},r.functions.length=function(e,t){return r.standardFunctionAsync(e,t,async(u,o,n)=>{if(h(n,1,2,e,t),(n=l(n))[0]===null)return 0;if(L(n[0])){const a=await n[0].sumLength(p(w(n[1],-1)),!1,e.abortSignal);if(e.abortSignal.aborted)throw new i(e,s.Cancelled,t);return a}if(I(n[0])||F(n[0])){const a=k(n[0],e.spatialReference);return a===null?0:z(a,p(w(n[1],-1)))}if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);return z(n[0],p(w(n[1],-1)))})},r.functions.length3d=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>{if(h(n,1,2,e,t),(n=l(n))[0]===null)return 0;if(I(n[0])||F(n[0])){const a=k(n[0],e.spatialReference);return a===null?0:a.hasZ===!0?tn(a,p(w(n[1],-1))):z(a,p(w(n[1],-1)))}if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);return n[0].hasZ===!0?tn(n[0],p(w(n[1],-1))):z(n[0],p(w(n[1],-1)))})},r.functions.lengthgeodetic=function(e,t){return r.standardFunctionAsync(e,t,async(u,o,n)=>{if(h(n,1,2,e,t),(n=l(n))[0]===null)return 0;if(L(n[0])){const a=await n[0].sumLength(p(w(n[1],-1)),!0,e.abortSignal);if(e.abortSignal.aborted)throw new i(e,s.Cancelled,t);return a}if(I(n[0])||F(n[0])){const a=k(n[0],e.spatialReference);return a===null?0:q(a,p(w(n[1],-1)))}if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);return q(n[0],p(w(n[1],-1)))})},r.functions.distance=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>{n=l(n),h(n,2,3,e,t);let a=n[0];(I(n[0])||F(n[0]))&&(a=T(n[0],e.spatialReference));let c=n[1];if((I(n[1])||F(n[1]))&&(c=T(n[1],e.spatialReference)),!(a instanceof d))throw new i(e,s.InvalidParameter,t);if(!(c instanceof d))throw new i(e,s.InvalidParameter,t);return xn(a,c,p(w(n[2],-1)))})},r.functions.distancegeodetic=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>{n=l(n),h(n,2,3,e,t);const a=n[0],c=n[1];if(!(a instanceof b))throw new i(e,s.InvalidParameter,t);if(!(c instanceof b))throw new i(e,s.InvalidParameter,t);const f=new x({paths:[],spatialReference:a.spatialReference});return f.addPath([a,c]),q(f,p(w(n[2],-1)))})},r.functions.densify=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>{if(n=l(n),h(n,2,3,e,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);const a=R(n[1]);if(isNaN(a))throw new i(e,s.InvalidParameter,t);if(a<=0)throw new i(e,s.InvalidParameter,t);return n[0]instanceof N||n[0]instanceof x?G(n[0],a,p(w(n[2],-1))):n[0]instanceof S?G(en(n[0]),a,p(w(n[2],-1))):n[0]})},r.functions.densifygeodetic=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>{if(n=l(n),h(n,2,3,e,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);const a=R(n[1]);if(isNaN(a))throw new i(e,s.InvalidParameter,t);if(a<=0)throw new i(e,s.InvalidParameter,t);return n[0]instanceof N||n[0]instanceof x?X(n[0],a,p(w(n[2],-1))):n[0]instanceof S?X(en(n[0]),a,p(w(n[2],-1))):n[0]})},r.functions.generalize=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>{if(n=l(n),h(n,2,4,e,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);const a=R(n[1]);if(isNaN(a))throw new i(e,s.InvalidParameter,t);return Nn(n[0],a,fn(w(n[2],!0)),p(w(n[3],-1)))})},r.functions.buffer=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>{if(n=l(n),h(n,2,3,e,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);const a=R(n[1]);if(isNaN(a))throw new i(e,s.InvalidParameter,t);return a===0?P(n[0]):bn(n[0],a,p(w(n[2],-1)))})},r.functions.buffergeodetic=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>{if(n=l(n),h(n,2,3,e,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);const a=R(n[1]);if(isNaN(a))throw new i(e,s.InvalidParameter,t);return a===0?P(n[0]):Sn(n[0],a,p(w(n[2],-1)))})},r.functions.offset=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>{if(n=l(n),h(n,2,6,e,t),n[0]===null)return null;if(!(n[0]instanceof N||n[0]instanceof x))throw new i(e,s.InvalidParameter,t);const a=R(n[1]);if(isNaN(a))throw new i(e,s.InvalidParameter,t);const c=R(w(n[4],10));if(isNaN(c))throw new i(e,s.InvalidParameter,t);const f=R(w(n[5],0));if(isNaN(f))throw new i(e,s.InvalidParameter,t);return On(n[0],a,p(w(n[2],-1)),Z(w(n[3],"round")).toLowerCase(),c,f)})},r.functions.rotate=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>{n=l(n),h(n,2,3,e,t);let a=n[0];if(a===null)return null;if(!(a instanceof d))throw new i(e,s.InvalidParameter,t);a instanceof S&&(a=N.fromExtent(a));const c=R(n[1]);if(isNaN(c))throw new i(e,s.InvalidParameter,t);const f=w(n[2],null);if(f===null)return Y(a,c);if(f instanceof b)return Y(a,c,f);throw new i(e,s.InvalidParameter,t)})},r.functions.centroid=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>{if(n=l(n),h(n,1,1,e,t),n[0]===null)return null;let a=n[0];if((I(n[0])||F(n[0]))&&(a=T(n[0],e.spatialReference)),a===null)return null;if(!(a instanceof d))throw new i(e,s.InvalidParameter,t);return a instanceof b?j(P(n[0]),e.spatialReference):a instanceof N?a.centroid:a instanceof x?rn(a):a instanceof H?an(a):a instanceof S?a.center:null})},r.functions.multiparttosinglepart=function(e,t){return r.standardFunctionAsync(e,t,async(u,o,n)=>{n=l(n),h(n,1,1,e,t);const a=[];if(n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);if(n[0]instanceof b)return[j(P(n[0]),e.spatialReference)];if(n[0]instanceof S)return[j(P(n[0]),e.spatialReference)];const c=await _(n[0]);if(c instanceof N){const f=[],y=[];for(let m=0;m<c.rings.length;m++)if(c.isClockwise(c.rings[m])){const g=V({rings:[c.rings[m]],hasZ:c.hasZ===!0,hazM:c.hasM===!0,spatialReference:c.spatialReference.toJSON()});f.push(g)}else y.push({ring:c.rings[m],pt:c.getPoint(m,0)});for(let m=0;m<y.length;m++)for(let g=0;g<f.length;g++)if(f[g].contains(y[m].pt)){f[g].addRing(y[m].ring);break}return f}if(c instanceof x){const f=[];for(let y=0;y<c.paths.length;y++){const m=V({paths:[c.paths[y]],hasZ:c.hasZ===!0,hazM:c.hasM===!0,spatialReference:c.spatialReference.toJSON()});f.push(m)}return f}if(n[0]instanceof H){const f=j(P(n[0]),e.spatialReference);for(let y=0;y<f.points.length;y++)a.push(f.getPoint(y));return a}return null})},r.functions.issimple=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>{if(n=l(n),h(n,1,1,e,t),n[0]===null)return!0;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);return Dn(n[0])})},r.functions.simplify=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>{if(n=l(n),h(n,1,1,e,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);return _(n[0])})},r.functions.convexhull=function(e,t){return r.standardFunctionAsync(e,t,(u,o,n)=>{if(n=l(n),h(n,1,1,e,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);return jn(n[0])})},r.functions.getuser=function(e,t){return r.standardFunctionAsync(e,t,async(u,o,n)=>{h(n,0,2,e,t);let a=w(n[1],""),c=a===!0;if(a=a===!0||a===!1?"":Z(a),n.length===0||n[0]instanceof U){let y=null;y=e.services&&e.services.portal?e.services.portal:W.getDefault(),n.length>0&&(y=$(n[0],y));const m=await nn(y,a,c);if(m){const g=JSON.parse(JSON.stringify(m));for(const v of["lastLogin","created","modified"])g[v]!==void 0&&g[v]!==null&&(g[v]=new Date(g[v]));return C.convertObjectToArcadeDictionary(g,M(e))}return null}let f=null;if(L(n[0])&&(f=n[0]),f){if(c=!1,a)return null;await f.load();const y=await f.getOwningSystemUrl();if(!y){if(!a){const v=await f.getIdentityUser();return v?C.convertObjectToArcadeDictionary({username:v},M(e)):null}return null}let m=null;m=e.services&&e.services.portal?e.services.portal:W.getDefault(),m=$(new U(y),m);const g=await nn(m,a,c);if(g){const v=JSON.parse(JSON.stringify(g));for(const J of["lastLogin","created","modified"])v[J]!==void 0&&v[J]!==null&&(v[J]=new Date(v[J]));return C.convertObjectToArcadeDictionary(v,M(e))}return null}throw new i(e,s.InvalidParameter,t)})}),r.functions.nearestcoordinate=function(e,t){return r.standardFunctionAsync(e,t,async(u,o,n)=>{if(n=l(n),h(n,2,2,e,t),!(n[0]instanceof d||n[0]===null))throw new i(e,s.InvalidParameter,t);if(!(n[1]instanceof b||n[1]===null))throw new i(e,s.InvalidParameter,t);if(n[0]===null||n[1]===null)return null;const a=await Ln(n[0],n[1]);return a===null?null:C.convertObjectToArcadeDictionary({coordinate:a.coordinate,distance:a.distance},M(e),!1,!0)})},r.functions.nearestvertex=function(e,t){return r.standardFunctionAsync(e,t,async(u,o,n)=>{if(n=l(n),h(n,2,2,e,t),!(n[0]instanceof d||n[0]===null))throw new i(e,s.InvalidParameter,t);if(!(n[1]instanceof b||n[1]===null))throw new i(e,s.InvalidParameter,t);if(n[0]===null||n[1]===null)return null;const a=await Cn(n[0],n[1]);return a===null?null:C.convertObjectToArcadeDictionary({coordinate:a.coordinate,distance:a.distance},M(e),!1,!0)})}}export{Bn as registerFunctions};
