import{a as h,b as d,c as K,aS as Wi,cB as ne,b$ as Go,qe as Po,aw as Co,l as D,w as Lo,b9 as Pe,mR as zo,cR as No,hB as Es,jw as Vo,oG as jo,fp as Xe,kC as $i,lB as Ei,kj as Ho,lA as qt,d5 as nt,hD as Ve,qf as Ts,bj as b,bG as N,hv as R,d7 as Ri,fD as oe,bO as ve,cY as P,lN as ti,lO as vt,f$ as J,d3 as As,hb as $,qg as Di,cU as Vt,hm as st,aa as Ii,bv as Fo,mI as ii,lR as Uo,fo as X,lC as y,f_ as ln,fv as Ma,gR as Gi,fA as It,qh as Ha,bQ as fe,mE as cn,hw as me,qi as hn,qj as $s,lp as Rs,ht as Ds,d2 as Me,qk as ha,ql as ko,qm as Zo,cP as Gt,iE as k,iG as Xo,ar as Fa,mc as Bo,na as pn,mm as Is,bu as Yo,he as le,qn as qo,qo as Wo,cF as un,gN as Qo,ls as Jo,f6 as re,qp as dn,aI as yt,j as L,qq as ba,mb as gn,cW as Ko,hc as Qi,hf as ci,aC as Rt,qr as q,aj as We,mo as Sa,qs as er,hA as Pi,fS as tr,bK as _n,bM as mn,lG as Pt,qt as Ct,fP as Et,mk as ir,g2 as fn,qu as vn,hq as Gs,qv as ar,dJ as nr,qw as wa,qx as sr,qy as M,qz as or,fy as Le,qA as rr,qB as lr,qC as cr,fL as Lt,qD as xa,bR as hr,lH as Ps,hh as ie,c_ as je,fz as pr,hu as Z,qE as Cs,aX as ur,f as at,nf as dr,qF as gr,hC as _r,qG as Ls,lw as Oa,lo as zs,cZ as He,qH as mr,jk as Ci,aH as jt,qI as Ua,kH as Ns,qJ as Li,qK as fr,l4 as Ea,qL as Vs,z as js,aP as Hs,V as vr,dk as rt,qM as yr,qN as Fs,ln as Mr,mj as hi,jm as Us,qO as br,mK as Sr,eL as ka,qP as wr,ga as Qe,qQ as yn,fw as xr,dM as Or,qR as Mn,qS as Er,eH as Ta,b0 as Tr,aE as Ar,lm as ks,qT as $r,qU as Rr,eV as zi,ni as Dr,l5 as bn,cX as Jt,qV as Ir,fG as ai,ho as Sn,qW as wn,dn as Aa,bE as Gr,js as Pr,ep as xn,jp as On,jq as En,bF as Cr,qX as Lr,qY as Tn,lg as An,qZ as $n,k6 as gi,oL as zr,kB as Ut,fZ as _i,q_ as Nr}from"./index-4457faad.js";import{a as Vr,s as jr,i as ot,u as Zs}from"./analysisThemeUtils-f1446ce8.js";import{f as Hr,q as Fr,y as Ni,s as qe,h as Vi,m as ni,d as pi,t as Ji,R as Ur,p as kr,j as Zr,r as si,o as pa,k as Xr}from"./automaticLengthMeasurementUtils-8dfb30c1.js";import{t as Xs,a as Br,G as Ki,V as Yr,b as qr,e as bt,P as W,j as Mt,c as $a}from"./GraphicState-661b7831.js";import{r as Wr}from"./vec4f32-0d1b2306.js";import{B as zt,b as Bs,p as ze,n as Ra,s as ea,o as ui,t as Qr,a as ua,c as Ys,C as qs,V as Ws,u as Jr,w as Wt,$ as Kr,x as da,m as el,y as tl,z as il,D as ji,O as Qs,F as al,G as nl,H as Da,J as Js}from"./line-497a8ea9.js";import{o as sl,K as ol,a as rl,f as Te,X as Za}from"./NativeLineMaterial-e970214a.js";import{aw as Ks,av as Ia,f as ll,o as Hi,i as Xa,G as z,T as eo,P as to,C as io,y as Ba,e as Fi,z as cl,X as ao,b as hl,H as pl,p as U,K as no,j as Ya,k as qa,l as Wa,E as Ce,t as ul,a2 as dl,M as gl,s as _l,I as Rn,Y as ml,Z as fl,_ as vl,$ as yl,w as Ml}from"./FloatArray-73ba570e.js";import{r as bl,e as Ui,_ as ta,y as Dn,N as Sl,E as Be,o as wl,a as In}from"./SnappingContext-e7d6e9d1.js";import{a as so}from"./interfaces-1a80c8eb.js";import{t as Gn}from"./DoubleArray-28266794.js";import{n as Q}from"./basicInterfaces-bb952591.js";import{i as xl}from"./BufferView-eb3bc1bb.js";import{H as Ol}from"./InterleavedLayout-2de7b1c4.js";import{o as Fe,W as Qa,c as El,A as oo,h as ro,b as lo,E as co,_ as Ja,f as Tl,a as Al,l as $l,d as Rl,S as Dl,e as Il}from"./OrderIndependentTransparency-2a607a9a.js";import{I as Ti,R as Tt}from"./enums-b14466b3.js";import{E as Gl,I as Pl,H as Cl,o as Ll,r as zl,U as Ka,x as Nl,z as Vl,d as Ae,D as Kt,y as jl,q as Ht,P as At,l as ia,j as Hl,w as Fl,f as ki,C as Pn,O as Ul,M as Cn,a as kl,G as Zl,F as mi,S as Ln}from"./editPlaneUtils-ca90478a.js";import{d as Y,i as Xl,f as Bl}from"./colorUtils-7d6f3c40.js";import{x as zn,M as Yl,u as ql}from"./hydratedFeatures-1f5e8f4b.js";import{r as Wl}from"./VertexColor.glsl-93211d70.js";import{S as Ql}from"./GraphicManipulator-6e001305.js";import{r as oi,p as aa,a as en,l as Jl,c as Kl,n as ec}from"./TranslateTooltipInfos-3d780604.js";import{h as tc,x as ic,b as ac,N as Nn,l as nc,g as sc}from"./MeshTransform-36f32e46.js";import{g as kt}from"./persistable-c363ec8b.js";import"./Octree-30686065.js";import"./Indices-836a5a9a.js";import"./triangle-6e9991e3.js";import"./spatialReferenceEllipsoidUtils-db62ad95.js";import{i as oc,p as rc}from"./ExtentTooltipInfos-a381d85c.js";let lc=i=>({vnodeSelector:"",properties:void 0,children:void 0,text:i.toString(),domNode:null}),ho=(i,e,t)=>{for(let a=0,n=e.length;a<n;a++){let s=e[a];Array.isArray(s)?ho(i,s,t):s!=null&&s!==!1&&(typeof s=="string"&&(s=lc(s)),t.push(s))}};function cc(i,e,t){if(Array.isArray(e))t=e,e=void 0;else if(e&&(typeof e=="string"||e.hasOwnProperty("vnodeSelector"))||t&&(typeof t=="string"||t.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let a,n;return t&&t.length===1&&typeof t[0]=="string"?a=t[0]:t&&(n=[],ho(i,t,n),n.length===0&&(n=void 0)),{vnodeSelector:i,properties:e,children:n,text:a===""?void 0:a,domNode:null}}const Vn={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let ee=class extends Wi{get position(){return[this.x,this.y]}set position(e){this._set("x",e[0]),this._set("y",e[1])}get _textShadowColor(){return this.backgroundColor}get _textShadow(){const e=this._textShadowColor.toCss(!1);return`0 0 ${this._textShadowSize}px ${e}`}get _padding(){return .5*this.fontSize}get _borderRadius(){return this._padding}constructor(e){super(e),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.backgroundColor=new ne([0,0,0,.6]),this.textColor=new ne([255,255,255]),this._textShadowSize=1}render(){return cc("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this._padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(e){if(!this.visible)return;const t=e.font.replace(/^(.*?)px/,"");e.font=`${this.fontSize}px ${t}`;const a=this._padding,n=this._borderRadius,s=e.measureText(this.text).width,o=this.fontSize,r=hc[this.anchor];e.textAlign="center",e.textBaseline="middle";const l=s+2*a,c=o+2*a,p=this.x+r.x*l,g=this.y+r.y*c;this._roundedRect(e,p,g,l,c,n),e.fillStyle=this.backgroundColor.toCss(!0),e.fill();const u=this.x+(r.x+.5)*l,_=this.y+(r.y+.5)*c;this._renderTextShadow(e,this.text,u,_),e.fillStyle=this.textColor.toCss(!0),e.fillText(this.text,u,_)}_renderTextShadow(e,t,a,n){e.lineJoin="miter",e.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/Ga.length})`;const s=this._textShadowSize;for(const[o,r]of Ga)e.fillText(t,a+s*o,n+s*r)}_roundedRect(e,t,a,n,s,o){e.beginPath(),e.moveTo(t,a+o),e.arcTo(t,a,t+o,a,o),e.lineTo(t+n-o,a),e.arcTo(t+n,a,t+n,a+o,o),e.lineTo(t+n,a+s-o),e.arcTo(t+n,a+s,t+n-o,a+s,o),e.lineTo(t+o,a+s),e.arcTo(t,a+s,t,a+s-o,o),e.closePath()}_cssClasses(){const e={"esri-text-overlay-item":!0};let t;for(t in Vn)e[Vn[t]]=this.anchor===t;return e}};h([d()],ee.prototype,"x",void 0),h([d()],ee.prototype,"y",void 0),h([d()],ee.prototype,"position",null),h([d()],ee.prototype,"text",void 0),h([d()],ee.prototype,"fontSize",void 0),h([d()],ee.prototype,"anchor",void 0),h([d()],ee.prototype,"visible",void 0),h([d()],ee.prototype,"backgroundColor",void 0),h([d()],ee.prototype,"textColor",void 0),h([d()],ee.prototype,"_textShadowSize",void 0),h([d()],ee.prototype,"_textShadowColor",null),h([d()],ee.prototype,"_textShadow",null),h([d()],ee.prototype,"_padding",null),h([d()],ee.prototype,"_borderRadius",null),ee=h([K("esri.views.overlay.TextOverlayItem")],ee);const hc={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},Ga=[];for(let e=0;e<360;e+=360/16)Ga.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);const pc=ee,uc=3025,dc={default:15,far:25};let De=class extends Wi{constructor(e){super(e),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){const e=Go(async t=>{const a=await Po("esri/core/t9n/Units");Co(t),this._messagesUnits=a});this.addHandles([D(()=>[this.context!=null&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits],()=>this._update()),...["vertex-add","vertex-update","vertex-remove"].map(t=>Lo(()=>{var a;return(a=this.context)==null?void 0:a.editGeometryOperations},t,()=>this._update())),Pe(()=>e.abort())])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return this._messagesUnits==null}get test(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map(e=>e.label.text)}}get _edgeDistancePixels(){return dc[this.edgeDistance]}_update(){this._nextLabelIndex=0;const e=this.context;if(e==null)return void this._destroyUnusedLabels();const{components:t,geometry:a,coordinateHelper:n}=e.editGeometryOperations.data;if(!a)return void this._destroyUnusedLabels();const s=t.length;for(let o=0;o<s;++o){const r=[];if(t[o].iterateVertices(_=>{r.push(n.toXYZ(_.pos))}),o===0&&this.stagedVertex!=null&&r.push(n.toXYZ(this.stagedVertex)),r.length<2)continue;const l=r[0],c=r[r.length-1];a.type==="polygon"&&r.length>2&&!zo(l,c)&&r.push(l);const p=s===1&&!No(r,!1,!1);let g=gc,u=_c;this.toScreenPointArray(e,l,g);for(let _=1;_<r.length;++_){const m=r[_-1],f=r[_];this.toScreenPointArray(e,f,u),this._addLabel(e,m,g,f,u,p),[g,u]=[u,g]}}this._destroyUnusedLabels()}_addLabel(e,t,a,n,s,o){const{label:r}=this._getOrCreateLabel(e);if(!this.visible||Es(a,s)<uc)return void(r.visible=!1);const l=e.graphicState!=null?e.graphicState.isDraped?"on-the-ground":"absolute-height":Vo(e.editGeometryOperations.data.geometry,e.elevationInfo),{spatialReference:c}=e.editGeometryOperations.data,p=Hr(t,n,c,l),g=this._messagesUnits,u=jo(e.view);r.text=g!=null&&p!=null?Fr(g,p,u):"",r.visible=!0;const _=s[0]-a[0],m=s[1]-a[1];o?Xe(be,-m,_):Xe(be,m,-_),$i(be,be),Ei(be,be,this._edgeDistancePixels),Ho(Zt,a,s,.5),qt(Zt,Zt,be),r.position=[Zt[0],Zt[1]],Math.abs(be[0])>Math.abs(be[1])?r.anchor=be[0]>0?"left":"right":r.anchor=-be[1]<0?"top":"bottom"}_getOrCreateLabel(e){var n;if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];const t=new pc({anchor:"center",fontSize:10,textColor:Vr(),backgroundColor:jr(.6)});(n=e.view.overlay)==null||n.items.add(t);const a={label:t};return this._labelInfos.push(a),this._nextLabelIndex=this._labelInfos.length,a}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:e}){var t,a;(a=(t=this.context)==null?void 0:t.view.overlay)==null||a.items.remove(e),e.destroy()}};h([d()],De.prototype,"context",void 0),h([d()],De.prototype,"stagedVertex",void 0),h([d()],De.prototype,"visible",void 0),h([d()],De.prototype,"edgeDistance",void 0),h([d()],De.prototype,"updating",null),h([d()],De.prototype,"_messagesUnits",void 0),h([d()],De.prototype,"_edgeDistancePixels",null),De=h([K("esri.views.interactive")],De);const be=nt(),Zt=nt(),gc=Ve(),_c=Ve();let Zi=class extends De{getCameraOrExtent({view:e}){return e.state.camera}toScreenPointArray({view:e,elevationInfo:t,editGeometryOperations:a},n,s=Ve()){const{spatialReference:o}=a.data.coordinateHelper;return Ts(n,o,t,e,jn),e.state.camera.projectToScreen(jn,s),s}};Zi=h([K("esri.views.3d.interactive.SegmentLabels3D")],Zi);const jn=b();let mc=class extends Xs{constructor(e){super(e),this._location=b(),this._direction=N(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=Wr(1,0,1,1),this._renderOccluded=R.OccludeAndTransparent,this.applyProps(e)}createObject3DResourceFactory(e){return{view:e,createResources:t=>this._createObject3DResources(t),destroyResources:t=>this._destroyObject3DResources(t),recreateGeometry:(t,a)=>this._recreateObject3DGeometry(t,a),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:t=>this._destroyDrapedResources(t),recreateGeometry:t=>this._recreateDrapedGeometry(t)}}get location(){return this._location}set location(e){Ri(this._location,e)||(oe(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){Ri(this._direction,e)||(oe(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){ve(this._direction,P(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){ti(e,this._color)||(vt(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new zt(this.materialParameters),a=new Array;return this._createObject3DGeometry(t,e,a),{material:t,geometries:a,forEach:n=>{n(t),a.forEach(n)}}}_destroyObject3DResources(e){e.geometries.length=0,e.material.dispose()}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,a){const[n,s]=this._createGeometries(e);t.addGeometry(n),t.addGeometry(s),a.push(n),a.push(s),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new zt(this.materialParameters),t=D(()=>this.view.state.contentPixelRatio,()=>{this.drapedResources.recreateGeometry()});return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[],e.material.dispose()}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=this._createGeometries(e);return this._updateVerticesDraped(t),t.map(a=>new Bs(a))}_createGeometries(e){return[ze(e,[b(),b()]),ze(e,[b(),b()])]}_updateMaterial(){var t,a;const{materialParameters:e}=this;(t=this.object3dResources.resources)==null||t.material.setParameters(e),(a=this.drapedResources.resources)==null||a.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,vi),J($e,this.location,this.direction),t.projectToScreen($e,St),$i(St,As(St,St,vi)),this._updateVertexAttributesObject3D(t,e,0,vi,St,1),this._updateVertexAttributesObject3D(t,e,1,vi,St,-1)}_updateVertexAttributesObject3D(e,t,a,n,s,o){var g;const r=t.geometries[a],l=(g=r.getMutableAttribute($.POSITION))==null?void 0:g.data;if(!l)return;const{start:c,end:p}=this._computeStartEnd(s,n,o,this.offset,this.width,this.length);e.unprojectFromScreen(Di(c),$e),l[0]=$e[0],l[1]=$e[1],l[2]=$e[2],e.unprojectFromScreen(Di(p),$e),l[3]=$e[0],l[4]=$e[1],l[5]=$e[2],t.geometryVertexAttrsUpdated(r)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:a}}}=this,{location:n,width:s,length:o,offset:r}=this,l=fc;l.spatialReference=t.renderer.spatialReference,l.x=n[0],l.y=n[1];const c=t.overlayPixelSizeInMapUnits(l)*a,p=s*c,g=o*c,u=r*c;this._updateVertexAttributesDraped(e[0],p,g,u,-1),this._updateVertexAttributesDraped(e[1],p,g,u,1)}_updateVertexAttributesDraped(e,t,a,n,s){var g;const o=(g=e.getMutableAttribute($.POSITION))==null?void 0:g.data;if(!o)return;const{location:r,direction:l}=this,{start:c,end:p}=this._computeStartEnd(l,r,s,n,t,a);o[0]=c[0],o[1]=c[1],o[2]=Ra,o[3]=p[0],o[4]=p[1],o[5]=Ra,e.invalidateBoundingInfo()}_computeStartEnd(e,t,a,n,s,o){const r=Ei(Hn,Xe(Hn,e[1]*a,e[0]*-a),n+s/2),l=qt(fi,qt(fi,qt(fi,t,Ei(fi,e,o/2)),r),r);return{start:l,end:qt(Fn,l,Ei(Fn,e,-o))}}};const $e=b(),Hn=nt(),fi=nt(),Fn=nt(),vi=Ve(),St=Ve(),fc=Vt(0,0,void 0,null);let Pa=class{constructor(e){this.view=null,this._geometry=null,this._size=3,this._color=st(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=st(1,1,1,1),this._elevationInfo=null,this._resources=new Br({view:e.view,createResources:a=>this._createResources(a),destroyResources:a=>this._destroyResources(a),recreateGeometry:(a,n)=>{a.geometry=this._recreateGeometry(n,a.material)}});let t=!0;for(const a in e)a in this?a==="attached"?t=e[a]??!1:this[a]=e[a]:console.error("Cannot set unknown property",a);this.attached=t}destroy(){this._resources.destroy()}get visible(){return this._resources.visible}set visible(e){this._resources.visible=e}get attached(){return this._resources.attached}set attached(e){this._resources.attached=e}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._resources.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?this._resources!=null&&this._resources.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){ti(e,this._color)||(vt(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,this._resources!=null&&this._resources.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){ti(e,this._outlineColor)||(vt(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._resources&&this._resources.recreateGeometry()}_updateMaterial(){const e=this._resources.resources;e!=null&&e.material.setParameters(this._materialParameters(e.texture.id))}_updateSizeAttribute(){const e=this._resources.resources,t=this._resources.object;if(e==null||t==null)return;const a=e.geometry;if(a==null)return;const n=a.getMutableAttribute($.SIZE).data,s=this._geometrySize;n[0]=s,n[1]=s,t.geometryVertexAttrsUpdated(t.geometries[0])}_materialParameters(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:vc,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}get _geometrySize(){return this._size/Qt}_recreateGeometry(e,t){const a=this._createRenderGeometry(t);return a!=null&&e.addGeometry(a),a}_createResources(e){const t=sl(this._primitive,this._preferredTextureSize),a=new ol(this._materialParameters(t.id)),n=this._recreateGeometry(e,a);return{material:a,texture:t,geometry:n,forEach(s){s(t),s(a),this.geometry!=null&&s(this.geometry)}}}_destroyResources(e){e.geometry=null,e.material.dispose(),e.texture.dispose()}get _preferredTextureSize(){return Ii(Fo(2*this._geometrySize),16,128)}calculateMapBounds(e){if(this._resources.resources==null||this._resources.resources.geometry==null)return!1;const t=this._resources.resources.geometry.vertexAttributes.get($.POSITION);return ii(t.data,this.view.renderCoordsHelper.spatialReference,Un,this.view.spatialReference),Uo(e,Un),!0}_createRenderGeometry(e){const t=this.geometry;if(t==null)return null;const{renderCoordsHelper:a,elevationProvider:n}=this.view,s=ea(t,n,ui.fromElevationInfo(this.elevationInfo),a),o=X(y.get(),t.x,t.y,s),r=y.get();ii(o,t.spatialReference,r,a.spatialReference);const l=this._geometrySize;return Qr(e,null,r,null,[l,l],[0,0,0,1])}};const Qt=rl,vc=[Qt/2,Qt/2,1-Qt/2,1-Qt/2],Un=b();let yc=class extends Xs{constructor(e){super(e),this._maxSize=0,this._position=b(),this._up=b(),this._right=b(),this._renderOccluded=R.OccludeAndTransparent,this._color=st(1,0,0,1),this._outlineColor=st(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=R.Opaque,this.applyProps(e)}createObject3DResourceFactory(e){return{view:e,createResources:t=>this._createObject3DResources(t),destroyResources:t=>this._destroyObject3DResources(t),cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:t=>this._destroyDrapedResources(t)}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){vt(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){vt(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=this._outlineSize===0!=(e===0);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:a}){this._maxSize=Math.min(ln(t,e),ln(t,a))/3,ve(this._up,P(this._up,e,t)),ve(this._right,P(this._right,a,t)),oe(this._position,t),this.recreateGeometry()}_createObject3DResources(e){const t=new Te(this._quadMaterialParameters),a=this._outlineSize===0?void 0:new zt(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,a),{quadMaterial:t,outlineMaterial:a,forEach:n=>{n(t),a&&n(a)}}}_destroyObject3DResources(e){var t;e.quadMaterial.dispose(),(t=e.outlineMaterial)==null||t.dispose()}_createObject3DGeometries(e,t,a){if(Ri(this._up,Ma)&&Ri(this._right,Ma))return;const n=this._createGeometries(t,a);for(const s of n)e.addGeometry(s);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new Te(this._quadMaterialParameters),t=this._outlineSize===0?void 0:new zt(this._outlineMaterialParameters),a=this._createGeometries(e,t).map(n=>new Bs(n));return this._setTransformDraped(a),{quadMaterial:e,outlineMaterial:t,geometries:a,pixelRatioHandle:D(()=>this.view.state.contentPixelRatio,()=>{this.drapedResources.recreateGeometry()})}}_destroyDrapedResources(e){var t;e.pixelRatioHandle.remove(),e.geometries=[],(t=e.outlineMaterial)==null||t.dispose(),e.quadMaterial.dispose()}_createGeometries(e,t){const{up:a,right:n,corner:s}=this._getVertices(),o=this._quadGeometryData(a,n,s,e);return t?[o,ze(t,[a,s,n])]:[o]}_getVertices(){let e=this._up,t=this._right;const a=J(y.get(),e,t);return this.isDraped&&(e=oe(y.get(),e),t=oe(y.get(),t),e[2]=0,t[2]=0,a[2]=0),{up:e,right:t,corner:a}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(e=this.object3dResources.object){if(!e)return;const t=this.view.state.camera,a=this._size*t.computeScreenPixelSizeAt(this._position),n=Math.min(this._maxSize,a);Gi(Je,this._position),It(Je,Je,[n,n,n]),e.transformation=Je}_setTransformDraped(e){if(e.length===0)return;const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:a}}}=this,{_position:n,_size:s}=this,o=oe(y.get(),n);o[2]=Ra;const r=Mc;r.spatialReference=t.renderer.spatialReference,r.x=o[0],r.y=o[1];const l=s*(t.overlayPixelSizeInMapUnits(r)*a),c=Math.min(this._maxSize,l);Gi(Je,o),It(Je,Je,[c,c,1]);for(const p of e)p.updateTransformation(g=>{Ha(g,Je)})}_quadGeometryData(e,t,a,n){return new Ks(n,[[$.POSITION,new Ia([0,0,0,...t,...e,...a],3,!0)]],[[$.POSITION,[0,1,2,1,2,3]]])}get _quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){var e,t;(e=this.object3dResources.resources)==null||e.quadMaterial.setParameters(this._quadMaterialParameters),(t=this.drapedResources.resources)==null||t.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){var e,t,a,n;(t=(e=this.object3dResources.resources)==null?void 0:e.outlineMaterial)==null||t.setParameters(this._outlineMaterialParameters),(n=(a=this.drapedResources.resources)==null?void 0:a.outlineMaterial)==null||n.setParameters(this._outlineMaterialParameters)}};const Je=fe(),Mc=Vt(0,0,void 0,null);let ri=class extends bl{sortUniqueHints(e){return e.sort((t,a)=>(a instanceof cn?a.length:0)-(t instanceof cn?t.length:0))}visualizeIntersectionPoint(e,t){const{spatialReference:a,view:n}=t,s=Xt();return me(new Pa({view:n,primitive:"circle",geometry:hn(e.intersectionPoint,a),elevationInfo:e.isDraped?$s:Rs,size:20,outlineSize:2,color:s.intersectionPointColor,outlineColor:s.intersectionPointOutlineColor,pixelSnappingEnabled:!1}))}visualizePoint(e,t){const{view:a,spatialReference:n}=t,s=Xt(),o=Ke(e.point,e.domain,t);return me(new Pa({view:a,primitive:"circle",geometry:hn(o,n),elevationInfo:yi(e,t),size:20,outlineSize:2,color:s.pointColor,outlineColor:s.pointOutlineColor,pixelSnappingEnabled:!1}))}visualizeLine(e,t){const{view:a,spatialReference:n}=t,s=Xt(),o=Ke(e.lineStart,e.domain,t),r=Ke(e.lineEnd,e.domain,t);return me(this._createLineSegmentHint(e.type,o,r,n,yi(e,t),a,s,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:a,spatialReference:n}=t,s=Xt(),{isDraped:o}=e,r=yi(e,t),l=Ke(e.lineStart,e.domain,t),c=Ke(e.lineEnd,e.domain,t),p=ct(l,n,r,a,o),g=ct(c,n,r,a,o),u=Ds(g,p,g,.5),_=new mc({view:a,attached:!1,offset:Me.parallelLineHintOffset,length:Me.parallelLineHintLength,width:Me.parallelLineHintWidth,color:s.parallelSignColor,location:u,renderOccluded:o?R.OccludeAndTransparent:R.Opaque,isDraped:o,renderGroup:ua.SnappingHint});return _.setDirectionFromPoints(p,u),_.attached=!0,me(_)}visualizeRightAngleQuad(e,t){const{view:a,spatialReference:n}=t,s=Xt(),o=yi(e,t),{isDraped:r}=e,l=Ke(e.previousVertex,e.domain,t),c=Ke(e.centerVertex,e.domain,t),p=Ke(e.nextVertex,e.domain,t),g=ct(l,n,o,a,r),u=ct(c,n,o,a,r),_=ct(p,n,o,a,r);return me(new yc({view:a,attached:!0,color:r?s.rightAngleColorDraped:s.rightAngleColor,renderOccluded:r?R.OccludeAndTransparent:R.Transparent,outlineRenderOccluded:r?R.OccludeAndTransparent:R.Opaque,outlineColor:s.rightAngleOutlineColor,outlineSize:Me.rightAngleHintOutlineSize,size:Me.rightAngleHintSize,isDraped:r,geometry:{previous:g,center:u,next:_},renderGroup:ua.SnappingHint}))}_createLineSegmentHint(e,t,a,n,s,o,r,l=!1,c=!0,p=!0){const g=ct(t,n,s,o,l),u=ct(a,n,s,o,l),_=new Ki({view:o,extensionType:Yr.FADED,start:g,end:u,isDraped:l,color:r.lineColor,renderOccluded:l?R.OccludeAndTransparent:R.Opaque,renderGroup:ua.SnappingHint});switch(e){case ha.TARGET:_.width=Me.lineHintWidthTarget,_.fadedExtensions={start:0,end:Me.lineHintFadedExtensions};break;case ha.REFERENCE_EXTENSION:_.width=Me.lineHintWidthReference,_.fadedExtensions={start:0,end:0};break;case ha.REFERENCE:_.width=Me.lineHintWidthReference,_.fadedExtensions={start:c?Me.lineHintFadedExtensions:0,end:p?Me.lineHintFadedExtensions:0}}return _.attached=!0,_}};function Xt(i){const e=ne.toUnitRGBA(ot()),t=[0,0,0,0];return{intersectionPointColor:t,intersectionPointOutlineColor:e,pointColor:t,pointOutlineColor:e,lineColor:e,lineOutlineColor:void 0,parallelSignColor:e,rightAngleColor:e,rightAngleColorDraped:ne.toUnitRGBA(ot(.5)),rightAngleOutlineColor:e}}function Ke(i,e,t){const a=po(e,t);return a==null?i:ko(i[0],i[1],a)}function yi(i,e){return po(i.domain,e)!=null?e.selfSnappingZ.elevationInfo:i.isDraped?$s:Rs}function po(i,{selfSnappingZ:e}){return i===Zo.SELF&&e!=null?e.value:null}function ct(i,e,t,a,n,s=b()){if(n){const o=a.basemapTerrain.overlayManager.renderer.spatialReference;ii(i,e,s,o)}else Ts(i,e,t,a,s);return s}function tn(i){const{graphic:e}=i;return[D(()=>i.displaying,t=>{t?bc(e):kn(e)},{...Gt}),Pe(()=>kn(e))]}function bc(i){const{geometry:e}=i;uo(e)&&i.notifyMeshTransformChanged({action:so.EnableFastUpdates})}function kn(i){const{geometry:e}=i;uo(e)&&i.notifyMeshTransformChanged({action:so.DisableFastUpdates})}function uo(i){return(i==null?void 0:i.type)==="mesh"&&!i.vertexSpace.isGeoreferenced}let Sc=class extends qr{constructor(e){super(e.view),this._resources=null,this._transform=fe()}get object(){return this._resources!=null?this._resources.object:null}get transform(){return this._transform}set transform(e){Ha(this._transform,e),this._resources!=null&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(this._resources==null)return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),e.visible=this.visible,t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new Ys(e,{pickable:!1,updatePolicy:qs.SYNC}),a=new Ws({castShadow:!1});a.transformation=this._transform,this.createExternalResources(),this.createGeometries(a),e.addMany(a.geometries),this.forEachExternalMaterial(n=>e.add(n)),e.add(a),t.add(a),a.visible=this.visible,this._resources={layer:t,object:a}}destroyResources(){const e=this.view._stage;this._resources!=null&&e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this.forEachExternalMaterial(t=>{e.remove(t),t.dispose()}),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){this._resources!=null&&(this._resources.object.visible=e)}};function wc(i,e,t,a,n){const s=Gn(3*i.length),o=Gn(s.length);i.forEach((c,p)=>{s[3*p]=c[0],s[3*p+1]=c[1],s[3*p+2]=c.length>2?c[2]:0});const r=Jr(s,e,0,o,0,s,0,s.length/3,t,a,n),l=r!=null;return{numVertices:i.length,position:s,mapPositions:o,projectionSuccess:l,sampledElevation:r}}function xc(i,e){if(!e.screenSizeEnabled)return;const t=i.vertex;ll(t,e),t.uniforms.add(new Hi("perScreenPixelRatio",(a,n)=>n.camera.perScreenPixelRatio),new Hi("screenSizeScale",a=>a.screenSizeScale)),t.code.add(k`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));
return viewDirectionDistance * perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSizeScale * computeRenderPixelSizeAt(anchor) + anchor;
}`)}function Oc(i){const e=new Xa,t=i.hasMultipassTerrain&&(i.output===z.Color||i.output===z.Alpha);e.include(eo,i),e.include(xc,i),e.include(to,i);const{vertex:a,fragment:n}=e;return n.include(io),Ba(a,i),n.uniforms.add(new Fi("uColor",s=>s.color)),e.attributes.add($.POSITION,"vec3"),e.varyings.add("vWorldPosition","vec3"),t&&e.varyings.add("depth","float"),i.screenSizeEnabled&&e.attributes.add($.OFFSET,"vec3"),i.shadingEnabled&&(cl(a),e.attributes.add($.NORMAL,"vec3"),e.varyings.add("vViewNormal","vec3")),a.code.add(k`
    void main(void) {
      vWorldPosition = ${i.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),i.shadingEnabled&&a.code.add(k`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),a.code.add(k`
    ${t?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),t&&e.include(ao,i),n.code.add(k`
    void main() {
      discardBySlice(vWorldPosition);
      ${t?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),i.shadingEnabled?(n.uniforms.add(new hl("shadingDirection",s=>s.shadingDirection)),n.uniforms.add(new Fi("shadedColor",s=>Ec(s.shadingTint,s.color))),n.code.add(k`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(uColor, shadedColor, shadingFactor);`)):n.code.add(k`vec4 finalColor = uColor;`),n.code.add(k`
      ${i.output===z.ObjectAndLayerIdColor?k`finalColor.a = 1.0;`:""}
      if (finalColor.a < ${k.float(pl)}) {
        discard;
      }
      ${i.output===z.Alpha?k`fragColor = vec4(finalColor.a);`:""}

      ${i.output===z.Color?k`fragColor = highlightSlice(finalColor, vWorldPosition); ${i.transparencyPassType===Fe.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    }
    `),e}function Ec(i,e){const t=1-i[3],a=i[3]+e[3]*t;return a===0?(ht[3]=a,ht):(ht[0]=(i[0]*i[3]+e[0]*e[3]*t)/a,ht[1]=(i[1]*i[3]+e[1]*e[3]*t)/a,ht[2]=(i[2]*i[3]+e[2]*e[3]*t)/a,ht[3]=e[3],ht)}const ht=Xo(),Tc=Object.freeze(Object.defineProperty({__proto__:null,build:Oc},Symbol.toStringTag,{value:"Module"}));let go=class _o extends Ya{initializeProgram(e){return new qa(e.rctx,_o.shader.get().build(this.configuration),mo)}_setPipelineState(e){const t=this.configuration,a=e===Fe.NONE,n=e===Fe.FrontFace;return Qa({blending:t.output!==z.Color&&t.output!==z.Alpha||!t.transparent?null:a?El:oo(e),culling:ro(t.cullFace),depthTest:{func:n?Ti.LESS:t.shadingEnabled?Ti.LEQUAL:Ti.LESS},depthWrite:a?t.writeDepth?lo:null:co(e),colorWrite:Ja,polygonOffset:a||n?null:Tl})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};go.shader=new Wa(Tc,()=>Fa(()=>import("./ShadedColorMaterial.glsl-ec946cec.js"),["./ShadedColorMaterial.glsl-ec946cec.js","./index-4457faad.js","..\\index-add6cbc1.css","./FloatArray-73ba570e.js","./requestImageUtils-a82830fa.js","./basicInterfaces-bb952591.js","./enums-b14466b3.js","./Texture-53149a07.js","./Indices-836a5a9a.js","./triangle-6e9991e3.js","./doublePrecisionUtils-e3c3d0d8.js","./BufferView-eb3bc1bb.js","./VertexElementDescriptor-2925c6af.js","./VertexArrayObject-79e51137.js","./OrderIndependentTransparency-2a607a9a.js","./analysisThemeUtils-f1446ce8.js","./colorUtils-7d6f3c40.js","./automaticLengthMeasurementUtils-8dfb30c1.js","./spatialReferenceEllipsoidUtils-db62ad95.js","./geometryEngine-d03a7fa9.js","./geometryEngineBase-c813e811.js","./hydrated-263631bb.js","./GraphicState-661b7831.js","./vec4f32-0d1b2306.js","./Octree-30686065.js","./line-497a8ea9.js","./DoubleArray-28266794.js","./hydratedFeatures-1f5e8f4b.js","./triangulationUtils-2852bf6d.js","./earcut-938ec344.js","./deduplicate-34be5e74.js","./NestedMap-1b5db22e.js","./InterleavedLayout-2de7b1c4.js","./types-1305598a.js","./floatRGBA-45eb4edf.js","./glUtil-0b7ee6ea.js","./NativeLineMaterial-e970214a.js","./VertexColor.glsl-93211d70.js","./SnappingContext-e7d6e9d1.js","./PointSnappingHint-d54b5dad.js","./interfaces-1a80c8eb.js","./editPlaneUtils-ca90478a.js","./centroid-a42e4503.js","./GraphicManipulator-6e001305.js","./drapedUtils-b7424887.js","./TranslateTooltipInfos-3d780604.js","./MeshTransform-36f32e46.js","./persistable-c363ec8b.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-bc302e8d.js","./ExtentTooltipInfos-a381d85c.js"],import.meta.url));let Se=class extends no{constructor(){super(...arguments),this.output=z.Color,this.cullFace=Q.None,this.transparencyPassType=Fe.NONE,this.hasSlicePlane=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};h([U({count:z.COUNT})],Se.prototype,"output",void 0),h([U({count:Q.COUNT})],Se.prototype,"cullFace",void 0),h([U({count:Fe.COUNT})],Se.prototype,"transparencyPassType",void 0),h([U()],Se.prototype,"hasSlicePlane",void 0),h([U()],Se.prototype,"transparent",void 0),h([U()],Se.prototype,"writeDepth",void 0),h([U()],Se.prototype,"screenSizeEnabled",void 0),h([U()],Se.prototype,"shadingEnabled",void 0),h([U()],Se.prototype,"hasMultipassTerrain",void 0),h([U()],Se.prototype,"cullAboveGround",void 0);const mo=new Map([[$.POSITION,0],[$.NORMAL,1],[$.OFFSET,2]]);let Ca=class extends Bo{constructor(e){super(e,new $c),this.supportsEdges=!0,this._configuration=new Se,this._vertexAttributeLocations=mo}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,a,n,s,o){if(this.parameters.screenSizeEnabled){const r=e.vertexAttributes.get($.OFFSET);pn(e,a,n,s,{applyToVertex:(c,p,g,u)=>{const _=X(Zn,r.data[3*u],r.data[3*u+1],r.data[3*u+2]),m=X(Dc,c,p,g);return le(_,_,this.parameters.screenSizeScale*a.camera.computeRenderPixelSizeAt(_)),J(m,m,_),[m[0],m[1],m[2]]},applyToAabb:c=>{const p=qo(c,Zn);return Wo(c,this.parameters.screenSizeScale*a.camera.computeRenderPixelSizeAt(p))}},o)}else pn(e,a,n,s,void 0,o)}requiresSlot(e,t){if(t===z.Highlight)return e===Ce.OPAQUE_MATERIAL;if(t===z.Color||t===z.Alpha||t===z.ObjectAndLayerIdColor){let a=Ce.OPAQUE_MATERIAL;return this.parameters.transparent&&(a=this.parameters.writeDepth?Ce.TRANSPARENT_MATERIAL:Ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===a||e===Ce.DRAPED_MATERIAL}return!1}createGLMaterial(e){return new Ac(e)}createBufferWriter(){return new Rc(this.parameters.screenSizeEnabled)}},Ac=class extends ul{beginSlot(e){return this.ensureTechnique(go,e)}},$c=class extends Is{constructor(){super(...arguments),this.color=st(1,1,1,1),this.shadingTint=st(0,0,0,.25),this.shadingDirection=ve(b(),[.5,-.5,-.5]),this.screenSizeScale=14,this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=Q.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}},Rc=class{constructor(e){this.screenSizeEnabled=e;const t=Ol().vec3f($.POSITION).vec3f($.NORMAL);this.screenSizeEnabled&&t.vec3f($.OFFSET),this.vertexBufferLayout=t}elementCount(e){return e.indices.get($.POSITION).length}write(e,t,a,n,s){if(dl(a,this.vertexBufferLayout,e,t,n,s),this.screenSizeEnabled){if(!a.vertexAttributes.has($.OFFSET))throw new Error(`${$.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{const o=a.vertexAttributes.get($.OFFSET),r=a.indices.get($.OFFSET);Yo(o.size===3);const l=n.getField($.OFFSET,xl);if(!l)throw new Error("unable to acquire view for "+$.OFFSET);gl(r,o.data,t,l,s)}}}};const Zn=b(),Dc=b();let Xn=class extends Sc{constructor(e){super(e),this.view=null,this._renderOccluded=R.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=un([1,127/255,0,1]),this._size=11,this._outlineColor=un([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){ti(e,this._color)||(vt(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){ti(e,this._outlineColor)||(vt(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(e==null||e.length===0)return[];const t=.5,a=.5,n=wc(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,ui.fromElevationInfo(this.elevationInfo)),s=[],o=n.numVertices,r=n.position;for(let l=0;l<o;++l){const c=X(Ic,r[3*l],r[3*l+1],r[3*l+2]),p=Bn(this._vertexMaterial,t,c),g=Bn(this._vertexOutlineMaterial,a,c);s.push({vertexGeometry:p,vertexOutlineGeometry:g})}return s}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:a,vertexOutlineGeometry:n}of t)e.addGeometry(a),e.addGeometry(n)}createExternalResources(){this._vertexMaterial=new Ca({...this._vertexMaterialParameters,writeDepth:!0,cullFace:Q.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new Ca({...this._vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:Q.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}};const Ic=b();function Bn(i,e,t){return Wt(i,e,16,16,{offset:t})}let dt=class extends Gl{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:e,offset:t}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new Qo({mode:e,offset:t})}normalizeCtorArgs(e){if(!e.elevationInfo){const t=e.hasZ??!0;return{...e,elevationInfo:Jo(t)}}return e}initializeGraphic(e){const{view:t}=this,a=this._createGraphicState=new bt({graphic:e});return re([t.maskOccludee(e),t.trackGraphicState(a),D(()=>({element:this._outlineVisualElement,isDraped:a.isDraped}),({element:n,isDraped:s})=>{n&&(n.isDraped=s)},Gt),this._setupLoadingIndicator(a),...tn(a)])}makeDrawOperation(){const{geometryType:e}=this,t=e!=="circle"&&e!=="rectangle";return new Pl({view:this.view,manipulators:this.manipulators,geometryType:Cl(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new Ll(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new zl(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new ri,segmentLabels:t?new Zi:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:this._createGraphicState?this._createGraphicState.isDraped:dn(this.hasZ,this.elevationInfo)==="on-the-ground"})}onActiveVertexChanged(e){const{view:t}=this,a=W(t);if(this._activeVertexVisualElement)return this._activeVertexVisualElement.vertices=[e],this._updateVerticalLineVisualElement(e),null;const n=a.manipulators,s=n.vertex;this._activeVertexVisualElement=new Xn({view:t,spatialReference:t.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,color:Y(s.color),size:s.size,outlineColor:Y(s.outlineColor),outlineSize:s.outlineSize,renderOccluded:s.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=Y(n.selected.color),this._activeVertexVisualElement.attached=!0;const o=a.visualElements.zVerticalLine;return this._verticalLineVisualElement=new Ki({view:t,extensionType:o.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:R.OccludeAndTransparent}),o.apply(this._verticalLineVisualElement),Pe(()=>{this._activeVertexVisualElement=L(this._activeVertexVisualElement),this._verticalLineVisualElement=L(this._verticalLineVisualElement)})}_updateVerticalLineVisualElement(e){const t=this._verticalLineVisualElement;if(!t)return;const{renderCoordsHelper:a,elevationProvider:n}=this.view;X(wt,e[0],e[1],e[2]),Yn.setFromElevationInfo(this.elevationInfo),wt[2]=ea(wt,n,Yn,a),a.toRenderCoords(wt,this.view.spatialReference,wt)?(t.setStartEndFromWorldDownAtLocation(wt),t.attached=!0):t.attached=!1}onOutlineChanged(e){if(this._outlineVisualElement)return this._outlineVisualElement.geometry=e,null;const t=this.internalGraphicsLayer.elevationInfo,{view:a}=this,n=W(a);return this._outlineVisualElement=new Mt({view:a,geometry:e,elevationInfo:t,isDraped:this._createGraphicState?this._createGraphicState.isDraped:dn(this.hasZ,t)==="on-the-ground",attached:!1}),n.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),n.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,Pe(()=>{this._outlineVisualElement=L(this._outlineVisualElement)})}onRegularVerticesChanged(e){if(this._verticesVisualElement)return this._verticesVisualElement.vertices=e,null;const{view:t}=this,a=W(t).manipulators.vertex;return this._verticesVisualElement=new Xn({view:t,spatialReference:t.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,color:Y(a.color),size:a.size,outlineColor:Y(a.outlineColor),outlineSize:a.outlineSize,renderOccluded:a.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,Pe(()=>{this._verticesVisualElement=L(this._verticesVisualElement)})}_updateGraphicGeometry(e,t){if(this.geometryType==="mesh"&&(t==null?void 0:t.type)==="point"){const a=this.geometryToPlace;return a&&a.centerAt(t),void(a&&e.geometry===a?a.vertexSpace.isGeoreferenced?e.notifyGeometryChanged():e.notifyMeshTransformChanged():e.geometry=a)}super._updateGraphicGeometry(e,t)}_setupLoadingIndicator(e){const{drawOperation:t}=this;if(!this.geometryToPlace)return t.loading=!1,null;t.loading=!0;const a=Pe(()=>{t.loading=!1});let n;const s=()=>n&&cancelAnimationFrame(n);return re([yt(()=>e.displaying,()=>{s(),n=requestAnimationFrame(()=>a.remove())},{...Gt,once:!0}),Pe(s),a])}};h([d({constructOnly:!0})],dt.prototype,"elevationInfo",void 0),h([d({constructOnly:!0})],dt.prototype,"geometryType",void 0),h([d()],dt.prototype,"type",void 0),h([d({constructOnly:!0})],dt.prototype,"view",void 0),dt=h([K("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],dt);const Yn=new ui,wt=b();function Dt(i,e,t){return Gc(i,i.screenToRender(e,ba(y.get())),t)}function Gc(i,e,t){const a=ba(gn(y.get(),e));if(a[2]=0,!i.unprojectFromRenderScreen(a,t.origin))return null;const n=ba(gn(y.get(),e));n[2]=1;const s=i.unprojectFromRenderScreen(n,y.get());return s==null?null:(P(t.direction,s,t.origin),t)}class ce{constructor(e){var a;this.metadata=void 0,this._camera=new Kr,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=new Array,this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=fe(),this._worldFrame=null,this._renderLocation=b(),this._renderLocationDirty=!0,this._location=new Rt({x:0,y:0,z:0}),this._elevationAlignedLocation=new Rt,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=q.None,this._focused=!1,this.events=new We.EventEmitter,this._screenLocation={screenPointArray:Ve(),renderScreenPointArray:Sa(),pixelSize:0},this._screenLocationDirty=!0,this._engineResourcesAddedToStage=!1,this._attached=!1,this._location.spatialReference=e.view.spatialReference,Object.assign(this,e);const t=(a=this.view.state)==null?void 0:a.camera;t&&this._camera.copyFrom(t)}destroy(){this._applyObjectTransform=Nc,this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get _stage(){var e;return(e=this.view)==null?void 0:e._stage}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,this._noDisplayCount===1&&this._updateEngineObject(),{remove:er(()=>{this._noDisplayCount--,this._noDisplayCount===0&&this._updateEngineObject()})}}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){qn(e)&&(this._screenLocationDirty=!0),Ha(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=fe()),Pc(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){zn(e,this._location),this._notifyLocationChanged()}_notifyLocationChanged(){this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){zn(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){const e=this._elevation.override!=null?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y,this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=Yl(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:e===!0?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1;let e;if(qn(this._modelTransform)){const t=this._calculateModelTransformOffset(zc);e=J(t,t,this.renderLocation)}else e=this.renderLocation;this._camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(e,t){if(!this.available)return null;const a=Pi(e,Cc),n=this._getCollisionRadius(t),s=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(Es(this.screenLocation.screenPointArray,a)<n*n)return this.screenLocation.renderScreenPointArray[2]+s;break;case"line":{const o=this.collisionType.paths,r=this._getWorldToScreenObjectScale(),l=this._calculateObjectTransform(r,Mi),c=n*this.screenLocation.pixelSize,p=Dt(this._camera,a,ga);if(p==null)return null;for(const g of o){if(g.length===0)continue;const u=Et(ei,g[0],l);for(let _=1;_<g.length;_++){const m=Et(Jn,g[_],l),f=ar(fn(u,m,Wn),p);if(f!=null&&f<c*c){const v=J(y.get(),u,m);le(v,v,.5);const x=vn(y.get());return this._camera.projectToRenderScreen(v,x),x[2]+s}oe(u,m)}}break}case"disc":{const o=this.collisionType.direction,r=this.collisionType.offset??Ma,l=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(l,Mi),p=n*this.screenLocation.pixelSize,g=Dt(this._camera,a,ga);if(g==null)return null;const u=_n(Qn,c),_=mn(es,o,u),m=Et(ts,r,c);Pt(m,_,bi);const f=Kn;if(Ct(bi,g,f)&&Gs(f,m)<p*p)return this.screenLocation.renderScreenPointArray[2]+s;break}case"ribbon":{const{paths:o,direction:r}=this.collisionType,l=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(l,Mi),p=n*this._camera.computeScreenPixelSizeAt(this.renderLocation),g=Dt(this._camera,a,ga);if(g==null)return null;const u=_n(Qn,c),_=mn(es,r,u),m=this._calculateModelTransformPosition(ts);Pt(m,_,bi);const f=Kn;if(!Ct(bi,g,f))break;for(const v of o){if(v.length===0)continue;const x=Et(ei,v[0],c);for(let w=1;w<v.length;w++){const O=Et(Jn,v[w],c),V=ir(fn(x,O,Wn),f);if(V!=null&&V<p*p){const G=J(y.get(),x,O);le(G,G,.5);const he=vn(y.get());return this._camera.projectToRenderScreen(G,he),he[2]+s}oe(x,O)}}break}default:tr(this.collisionType)}return null}attach(e={manipulator3D:{}}){const t=this._stage;if(!t)return;const a=e.manipulator3D;a.engineLayerId==null?(this._engineLayer=new Ys(t,{pickable:!1,updatePolicy:qs.SYNC}),a.engineLayerId=this._engineLayer.id):t!=null&&t.getObject&&(this._engineLayer=t.getObject(a.engineLayerId)),a.engineLayerReferences=(a.engineLayerReferences||0)+1,this._materialIdReferences=a.materialIdReferences,this._materialIdReferences==null&&(this._materialIdReferences=new Map,a.materialIdReferences=this._materialIdReferences),this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),nr(this._location.spatialReference,this.view.spatialReference)||(this.location=new Rt({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const a=t.engineLayerReferences===0;this._removeResourcesFromStage(),a&&(t.engineLayerId=null,L(this._engineLayer)),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){wa(this.location,is,e.spatialReference)&&sr(e.extent,is)&&this._notifyLocationChanged()}_evaluateElevationAlignment(){if(this.elevationInfo==null)return;let e=null,t=0;const a=this.elevationInfo.offset??0;switch(this.elevationInfo.mode){case"on-the-ground":e=da(this.view.elevationProvider,this.location,"ground")??0;break;case"relative-to-ground":t=(da(this.view.elevationProvider,this.location,"ground")??0)+a;break;case"relative-to-scene":t=(da(this.view.elevationProvider,this.location,"scene")??0)+a;break;case"absolute-height":t=a}return t!==this._elevation.offset||e!==this._elevation.override?(this._elevation.offset=t,void(this._elevation.override=e)):void 0}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=Mi;if(this.autoScaleRenderObjects===!0){const o=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(o,t)}else this._calculateObjectTransform(e,t);const{objectsByState:a}=this._ensureEngineResources(),n=(this.focused?M.Focused:M.Unfocused)|(this.selected?M.Selected:M.Unselected),s=this._noDisplayCount>0;for(const{stateMask:o,objects:r}of a){if(s){for(const u of r)u.visible=!1;continue}const l=(o&M.All)!==M.None,c=(o&q.All)!==q.None,p=!l||(n&o)==(o&M.All),g=!c||(this.state&o)==(o&q.All);if(p&&g)for(const u of r)u.visible=!0,u.transformation=t;else for(const u of r)u.visible=!1}}_ensureEngineResources(){if(this._engineResources==null){const e=this._engineLayer,t=[],a=new Set;this.renderObjects.forEach(({geometry:{material:o}})=>{a.has(o)||(t.push(o),a.add(o))});const n=new Map;this._renderObjects.forEach(o=>{const r=new Ws({castShadow:!1,geometries:[o.geometry]}),l=n.get(o.stateMask)||[];l.push(r),n.set(o.stateMask,l)});const s=[];n.forEach((o,r)=>s.push({stateMask:r,objects:o})),this._engineResources={objectsByState:s,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){const e=this._stage;if(this._engineResourcesAddedToStage||this._engineResources==null||!e)return;const{objectsByState:t,layer:a,materials:n}=this._engineResources;n.forEach(s=>{const o=this._materialIdReferences,r=o.get(s.id)||0;r===0&&e.add(s),o.set(s.id,r+1)}),t.forEach(({objects:s})=>{a.addMany(s),e.addMany(s)}),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(){const e=this._stage;if(!this._engineResourcesAddedToStage||this._engineResources==null||!e)return;const{objectsByState:t,layer:a,materials:n}=this._engineResources;t.forEach(({objects:s})=>{a.removeMany(s),e.removeMany(s)}),n.forEach(s=>{const o=this._materialIdReferences,r=o.get(s.id);r===1?(e.remove(s),o.delete(s.id)):o.set(s.id,r-1)}),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*(e==="touch"?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),a=this._calculateObjectTransform(t,Lc);return X(e,a[12],a[13],a[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return P(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return or(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&Le(t,t,this._worldFrame),Le(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,this._applyObjectTransform!=null&&this._applyObjectTransform(t),t}get test(){let e=!1;if(this._engineResources!=null)for(const t in this._engineResources.objectsByState){const a=this._engineResources.objectsByState[t];for(const n of a.objects)if(n.visible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function qn(i){return i[12]!==0||i[13]!==0||i[14]!==0}function Pc(i,e,t){switch(i.viewingMode){case"local":return xa(t),!0;case"global":{const a=rr(i.renderCoordsHelper.spatialReference);return lr(e,0,ei,0,a.radius),cr(Lt(ei[0]),Lt(ei[1]),t),!0}}}const Cc=Ve(),Wn=Ko(),ga=Qi(),Qn=hr(),Lc=fe(),Mi=fe(),bi=ci(),ei=b(),Jn=b(),Kn=b(),es=b(),ts=b(),zc=b(),is=new Rt({x:0,y:0,z:0,spatialReference:null}),Nc=()=>{};let S=class{constructor(e,t=M.None){this.geometry=e,this.stateMask=t}};function Vc(i){const e=new Xa,{vertex:t,fragment:a}=e;return Ba(t,i),e.include(eo,i),e.attributes.add($.POSITION,"vec3"),e.attributes.add($.UV0,"vec2"),e.varyings.add("vpos","vec3"),i.hasMultipassTerrain&&e.varyings.add("depth","float"),t.code.add(k`
    void main(void) {
      vpos = position;
      ${i.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),e.include(to,i),e.include(ao,i),a.uniforms.add(new _l("tex",n=>n.texture),new Hi("opacity",n=>n.opacity)),e.varyings.add("vTexCoord","vec2"),i.output===z.Alpha?a.code.add(k`
    void main() {
      discardBySlice(vpos);
      ${i.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture(tex, vTexCoord).a * opacity;
      if (alpha  < ${k.float(Rn)}) {
        discard;
      }

      fragColor = vec4(alpha);
    }
    `):(a.include(io),a.code.add(k`
    void main() {
      discardBySlice(vpos);
      ${i.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
      fragColor = texture(tex, vTexCoord) * opacity;

      if (fragColor.a < ${k.float(Rn)}) {
        discard;
      }

      fragColor = highlightSlice(fragColor, vpos);
      ${i.transparencyPassType===Fe.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    }
    `)),e}const jc=Object.freeze(Object.defineProperty({__proto__:null,build:Vc},Symbol.toStringTag,{value:"Module"}));class na extends Ya{initializeProgram(e){return new qa(e.rctx,na.shader.get().build(this.configuration),Ps)}_setPipelineState(e,t){const a=this.configuration,n=e===Fe.NONE,s=e===Fe.FrontFace;return Qa({blending:a.output!==z.Color&&a.output!==z.Alpha||!a.transparent?null:n?Hc:oo(e),culling:ro(a.cullFace),depthTest:{func:$l(e)},depthWrite:n?a.writeDepth?lo:null:co(e),colorWrite:Ja,stencilWrite:a.hasOccludees?ml:null,stencilTest:a.hasOccludees?t?fl:vl:null,polygonOffset:n||s?null:Rl(a.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}na.shader=new Wa(jc,()=>Fa(()=>import("./ImageMaterial.glsl-0981e7d2.js"),["./ImageMaterial.glsl-0981e7d2.js","./FloatArray-73ba570e.js","./index-4457faad.js","..\\index-add6cbc1.css","./requestImageUtils-a82830fa.js","./basicInterfaces-bb952591.js","./enums-b14466b3.js","./Texture-53149a07.js","./Indices-836a5a9a.js","./triangle-6e9991e3.js","./doublePrecisionUtils-e3c3d0d8.js","./BufferView-eb3bc1bb.js","./VertexElementDescriptor-2925c6af.js","./VertexArrayObject-79e51137.js","./OrderIndependentTransparency-2a607a9a.js","./analysisThemeUtils-f1446ce8.js","./colorUtils-7d6f3c40.js","./automaticLengthMeasurementUtils-8dfb30c1.js","./spatialReferenceEllipsoidUtils-db62ad95.js","./geometryEngine-d03a7fa9.js","./geometryEngineBase-c813e811.js","./hydrated-263631bb.js","./GraphicState-661b7831.js","./vec4f32-0d1b2306.js","./Octree-30686065.js","./line-497a8ea9.js","./DoubleArray-28266794.js","./hydratedFeatures-1f5e8f4b.js","./triangulationUtils-2852bf6d.js","./earcut-938ec344.js","./deduplicate-34be5e74.js","./NestedMap-1b5db22e.js","./InterleavedLayout-2de7b1c4.js","./types-1305598a.js","./floatRGBA-45eb4edf.js","./glUtil-0b7ee6ea.js","./NativeLineMaterial-e970214a.js","./VertexColor.glsl-93211d70.js","./SnappingContext-e7d6e9d1.js","./PointSnappingHint-d54b5dad.js","./interfaces-1a80c8eb.js","./editPlaneUtils-ca90478a.js","./centroid-a42e4503.js","./GraphicManipulator-6e001305.js","./drapedUtils-b7424887.js","./TranslateTooltipInfos-3d780604.js","./MeshTransform-36f32e46.js","./persistable-c363ec8b.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-bc302e8d.js","./ExtentTooltipInfos-a381d85c.js"],import.meta.url));const Hc=Al(Tt.ONE,Tt.ONE_MINUS_SRC_ALPHA);let we=class extends no{constructor(){super(...arguments),this.output=z.Color,this.cullFace=Q.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=Fe.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};h([U({count:z.COUNT})],we.prototype,"output",void 0),h([U({count:Q.COUNT})],we.prototype,"cullFace",void 0),h([U()],we.prototype,"hasSlicePlane",void 0),h([U()],we.prototype,"transparent",void 0),h([U()],we.prototype,"enableOffset",void 0),h([U()],we.prototype,"writeDepth",void 0),h([U()],we.prototype,"hasOccludees",void 0),h([U({count:Fe.COUNT})],we.prototype,"transparencyPassType",void 0),h([U()],we.prototype,"hasMultipassTerrain",void 0),h([U()],we.prototype,"cullAboveGround",void 0);let Fc=class extends el{constructor(e){super(e,new kc),this.supportsEdges=!0,this._configuration=new we}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<Dl,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(e,t){return t===z.Color||t===z.Alpha||t===z.Highlight?e===Ce.DRAPED_MATERIAL?!0:t===z.Highlight?e===Ce.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?Ce.TRANSPARENT_MATERIAL:Ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ce.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new Uc(e)}createBufferWriter(){return new yl(tl)}},Uc=class extends Wl{constructor(e){super({...e,...e.material.parameters})}_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(na,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:e.hasOccludees}),this._updateParameters(e))}beginSlot(e){return this._output!==z.Color&&this._output!==z.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},kc=class extends Is{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=Q.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0}};function Ye(i,e=R.OccludeAndTransparent,t=!0){const a=st(i[0],i[1],i[2],i.length>3?i[3]:1),n=i[3]<1,s=!n;return t?new Ca({color:a,transparent:n,writeDepth:s,cullFace:Q.Back,renderOccluded:e}):new Te({color:a,transparent:n,writeDepth:s,cullFace:Q.Back,renderOccluded:e})}function Bt(i,e=R.OccludeAndTransparent){const t=st(i[0],i[1],i[2],i.length===4?i[3]:1);return new Te({color:t,transparent:!0,writeDepth:!0,cullFace:Q.Front,renderOccluded:e})}const Si=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1});function Zc(i,e){const t=new ce({view:i,autoScaleRenderObjects:!1,collisionPriority:1,metadata:e.metadata});return Xc(t,e),t}function Xc(i,e){var _;const t=e.material??new Fc({transparent:!0,writeDepth:!1,textureId:(_=e.texture)==null?void 0:_.id,renderOccluded:R.Opaque}),a=e.focusMultiplier??Si.focusMultiplier,n=e.calloutLength??Si.calloutLength,s=Si.discRadius*(e.discScale??1),o=s*a,r=(m,f)=>{const v=[0,1,2,2,3,0];return new Ks(f,[[$.POSITION,new Ia([n-m,-m,0,n+m,-m,0,n+m,m,0,n-m,m,0],3,!0)],[$.UV0,new Ia([0,0,1,0,1,1,0,1],2,!0)]],[[$.POSITION,v],[$.UV0,v]])},l=e.calloutWidth??Si.calloutWidth,c=new(l>1?zt:Za)({width:l,color:e.calloutColor,renderOccluded:R.OccludeAndTransparent}),p=ze(c,[[0,0,0],[n-s,0,0]]),g=ze(c,[[0,0,0],[n-o,0,0]]),u=e.customStateMask??q.None;i.collisionType={type:"disc",direction:[0,0,1],offset:[n,0,0]},i.focusMultiplier=a,i.metadata=e.metadata,i.radius=s,i.renderObjects=[new S(r(s,t),M.Unfocused|u),new S(p,M.Unfocused|u),new S(r(o,t),M.Focused|u),new S(g,M.Focused|u)]}const Bc=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});function fo(i,e,t,a){const n=P(y.get(),i,t),s=vo(n,je(y.get(),a,n),t,ie.get());pr(s,s);const o=Et(y.get(),e,s);return Math.atan2(o[1],o[0])}function vo(i,e,t,a){const n=ve(y.get(),i),s=ve(y.get(),e),o=je(y.get(),n,s);return a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=0,a[4]=s[0],a[5]=s[1],a[6]=s[2],a[7]=0,a[8]=o[0],a[9]=o[1],a[10]=o[2],a[11]=0,a[12]=t[0],a[13]=t[1],a[14]=t[2],a[15]=1,a}function Xi(i,e){const t=i.getViewForGraphic(e);return t!=null&&"computeAttachmentOrigin"in t?t.computeAttachmentOrigin(e,i.spatialReference):null}function yo(i,e,t){const a=Xi(i,t);a==null?Yc(e,t.geometry):e.elevationAlignedLocation=a}function Yc(i,e){if(e==null)return;const t=e.type==="mesh"?e.anchor:il(e);t!=null&&(i.location=ql(t))}function mt(i,e=Z(i)){return e.mode!=="on-the-ground"&&!(i.geometry==null||!i.geometry.hasZ)}var Ee;(function(i){i[i.NONE=0]="NONE",i[i.ANY=1]="ANY",i[i.Z=2]="Z",i[i.XY=4]="XY"})(Ee||(Ee={}));var I;(function(i){i[i.TRANSLATE_Z=0]="TRANSLATE_Z",i[i.TRANSLATE_XY=1]="TRANSLATE_XY",i[i.SCALE=2]="SCALE",i[i.ROTATE=3]="ROTATE",i[i.SCALE_ROTATE=4]="SCALE_ROTATE"})(I||(I={}));let Mo=class{constructor(){this.grabbingState=Ee.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=Ee.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((t,a)=>{if(a===I.TRANSLATE_Z&&(this.zManipulator=t),t instanceof ce&&(t.selected&&(this.numSelected===0&&(this.firstSelected=t),this.numSelected++),this.firstGrabbedXY==null&&t.grabbing&&a===I.TRANSLATE_XY&&(this.firstGrabbedXY=t)),t.grabbing)switch(this.grabbingState|=Ee.ANY,a){case I.TRANSLATE_Z:this.grabbingState|=Ee.Z;break;case I.TRANSLATE_XY:this.grabbingState|=Ee.XY}})}};function qc(i){const{view:e,graphic:t}=i,a=new bt({graphic:t}),n=Wc(i,a),s=[n,Qc(i,n.visualElement,a),e.maskOccludee(t),e.trackGraphicState(a)];return{visualElement:n.visualElement,remove:()=>re(s).remove()}}function Wc(i,e){const{view:t,graphic:a}=i,n=new Mt({view:t,geometry:La(a)?a.geometry:null,elevationInfo:Z(a),attached:!1}),s=W(t).visualElements.lineGraphics;s.shadowStyle.apply(n);const o=()=>{n.attached=e.displaying};s.outline.apply(n);const r=[D(()=>e.displaying,o),D(()=>e.isDraped,l=>{n.isDraped=l}),e.on("changed",()=>n.geometry=La(a)?a.geometry:null),me(n)];return o(),{visualElement:n,remove:()=>re(r).remove()}}function Qc(i,e,t){const{graphic:a,view:n}=i,s=[],o=Z(a),r=o.mode==="on-the-ground"||!o.offset&&o.mode!=="absolute-height",l=new Mo,c=W(n).visualElements,p=new Ki({view:n,extensionType:c.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:R.OccludeAndTransparent});c.pointGraphics.shadowStyle.apply(p);const g=Lt(c.heightPlaneAngleCutoff),u=new $a({view:n,attached:!1,angleCutoff:g});c.heightPlane.apply(u);let _=1,m=1;const f=()=>{if(l.update(i),!t.displaying||r&&(t.isDraped||!La(a)||!a.geometry.hasZ))return e.laserlineEnabled=!1,p.attached=!1,void(u.attached=!1);e.laserlineEnabled=!0;const w=l.grabbingState&Ee.XY?c.laserlineAlphaMultiplier:1;w!==_&&(_=w,c.lineGraphics.shadowStyle.apply(e,w),c.pointGraphics.shadowStyle.apply(p,w));const O=l.grabbingState&Ee.Z?c.laserlineAlphaMultiplier:1;O!==m&&(m=O,c.heightPlane.apply(u,O)),Jc(p,l),Kc(i,e,u,l)};c.zVerticalLine.apply(p),s.push(t.on("changed",f),D(()=>t.displaying,f),e.events.on("attachment-origin-changed",f),me(p),me(u));const v=[],x=()=>{re(v).remove(),v.length=0,i.forEachManipulator(w=>v.push(w.events.on("grab-changed",f))),i.forEachManipulator(w=>v.push(w.events.on("select-changed",f))),f()};return x(),s.push(i.onManipulatorsChanged(x),Cs(()=>re(v))),re(s)}function Jc(i,e){const t=e.numSelected===1?e.firstSelected:e.numSelected>1&&e.firstGrabbedXY!=null?e.firstGrabbedXY:null;t!=null?(i.setStartEndFromWorldDownAtLocation(t.renderLocation),i.attached=!0):i.attached=!1}function Kc(i,e,t,a){if(a.numSelected>0){X(pt,0,0,0);let n=0;i.forEachManipulator((s,o)=>{o===I.TRANSLATE_XY&&s.selected&&s instanceof ce&&(J(pt,pt,s.renderLocation),n++)}),n>0?(t.heightManifoldTarget=le(pt,pt,1/n),t.attached=!0):t.attached=!1}else{const n=e.attachmentOrigin;n!=null&&i.view.renderCoordsHelper.toRenderCoords(n,pt)?(t.heightManifoldTarget=pt,t.attached=!0):t.attached=!1}}function La(i){return i.geometry!=null&&(i.geometry.type==="polygon"||i.geometry.type==="polyline")}const pt=b();function eh(i){const{view:e,graphic:t}=i,a=new bt({graphic:t}),n=[],s=ih(i,a,n);return th(i,a,n,s),n.push(e.trackGraphicState(a)),{visualElement:s,remove(){re(n).remove()}}}function th(i,e,t,a){const{view:n,graphic:s}=i,o=W(n),r=new Ki({view:n,extensionType:o.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:R.OccludeAndTransparent});o.visualElements.zVerticalLine.apply(r);const l=new $a({view:n,intersectsLineInfinite:!0,attached:!1});o.visualElements.pointGraphics.shadowStyle.apply(l);const c=Lt(o.visualElements.heightPlaneAngleCutoff),p=new $a({view:n,attached:!1,angleCutoff:c});o.visualElements.heightPlane.apply(p);const g=Z(i.graphic),u=ui.fromElevationInfo(g),_=g.mode==="on-the-ground"||!g.offset&&g.mode!=="absolute-height",m=new Mo;let f=1,v=1;const x=()=>{m.update(i);const w=an(s),O=_&&(e.isDraped||w==null||!w.hasZ);let V=!0;if(O||w==null)V=!1;else{const ae=ea(w,n.elevationProvider,u,n.renderCoordsHelper);X(Oe,w.x,w.y,ae),ii(Oe,w.spatialReference,Oe,n.renderCoordsHelper.spatialReference),r.setStartEndFromWorldDownAtLocation(Oe),l.intersectsWorldUpAtLocation=Oe}const G=m.grabbingState&Ee.Z?o.visualElements.laserlineAlphaMultiplier:1;G!==f&&(f=G,o.visualElements.heightPlane.apply(p,G));const he=dr(oh);!O&&e.displaying&&a.calculateMapBounds(he)&&ii(gr(he,Oe),n.spatialReference,Oe,n.renderCoordsHelper.spatialReference)?(p.heightManifoldTarget=Oe,p.attached=!0):p.attached=!1;const ye=m.grabbingState&Ee.XY?o.visualElements.laserlineAlphaMultiplier:1;ye!==v&&(v=ye,o.visualElements.pointGraphics.shadowStyle.apply(l,ye));const T=V&&e.displaying&&!O;l.attached=T,r.attached=T};t.push(D(()=>[e.displaying,e.isDraped],x),e.on("changed",x)),i.forEachManipulator(w=>{t.push(w.events.on("grab-changed",x))}),t.push(me(l)),t.push(me(r)),t.push(me(p)),x()}function ih(i,e,t){const{view:a,graphic:n}=i,s=new Pa({view:a,geometry:an(n),elevationInfo:Z(n),attached:!1});return ah(i,s,e,t),t.push(me(s)),s}function an(i){const e=i.geometry;return e==null?null:e.type==="point"?e:e.type==="mesh"?e.anchor.clone():null}function ah(i,e,t,a){const n=()=>e.attached=t.displaying;nh(i,e,t,a),W(i.view).visualElements.pointGraphics.outline.apply(e),a.push(D(()=>t.displaying,n,at))}function nh(i,e,t,a){const{view:n,graphic:s}=i;let o=null;const r=c=>{o!=null&&(o.remove(),o=null),t.isDraped&&c!=null&&(o=sh(n,c,()=>{e.geometry=c}))},l=()=>{const c=an(s);r(c),e.geometry=c};a.push(t.on("changed",l),Cs(()=>o)),l()}function sh(i,e,t){const a=i.elevationProvider.spatialReference;_r(e,Oe,a);const n=Oe[0],s=Oe[1];return i.elevationProvider.on("elevation-change",o=>{Ls(o.extent,n,s)&&t()})}const Oe=b(),oh=ur();function sa(i){switch(i.graphic.geometry.type){case"point":case"mesh":return eh(i);case"polygon":case"polyline":return qc(i);default:return null}}const bo=128,Ne=70,rh=80,So=.02,lh=54,ch=100,wo=Math.ceil(Ne/3*2),gt=160,_a=.5,ma=24,xt=9,hh=gt+30,as=gt+53,ph=60,uh=23,dh=5*Math.PI/12,gh=1*Math.PI/3,ns=10,ss=.2,os=30,rs=53,ls=.2,cs=.3,_h=200,mh=3,fh=1e6;let di=class{constructor(){this._available=!0}set location(e){this._forEachManipulator3D(t=>t.location=e)}set elevationAlignedLocation(e){this._forEachManipulator3D(t=>t.elevationAlignedLocation=e)}set elevationInfo(e){this._forEachManipulator3D(t=>t.elevationInfo=e)}get renderLocation(){let e;return this._forEachManipulator3D(t=>{e||(e=t.renderLocation)}),e}get available(){return this._available}set available(e){this._available=e,this._forEachManipulator3D(t=>t.available=e)}get hovering(){return this.someManipulator(e=>e.hovering)}get grabbing(){return this.someManipulator(e=>e.grabbing)}get dragging(){return this.someManipulator(e=>e.dragging)}hasManipulator(e){return this.someManipulator(t=>t===e)}someManipulator(e){let t=!1;return this.forEachManipulator(a=>{!t&&e(a)&&(t=!0)}),t}_forEachManipulator3D(e){this.forEachManipulator((t,a)=>{t instanceof ce&&e(t,a)})}};function Bi(i,e){return xo(i,()=>e)}function vh(i){return xo(i,e=>e.plane)}function xo(i,e){const t=b(),a=b();let n=!1;return s=>{const o=e(s);if(s.action==="start"){const c=Pi(s.screenStart,Di(Oa.get())),p=Dt(i.state.camera,c,ps);p!=null&&(n=Ct(o,p,t))}if(!n)return null;const r=Pi(s.screenEnd,Di(Oa.get())),l=Dt(i.state.camera,r,ps);return l==null?null:Ct(o,l,a)?{...s,renderStart:t,renderEnd:a,plane:o,ray:l}:null}}function yh(i,e,t=0,a=null,n=null){let s=null;return o=>{if(o.action==="start"&&(s=i.sceneIntersectionHelper.intersectElevationFromScreen(Ve(o.screenStart.x,o.screenStart.y),e,t,n),s!=null&&a!=null&&!wa(s,s,a))||s==null)return null;const r=i.sceneIntersectionHelper.intersectElevationFromScreen(Ve(o.screenEnd.x,o.screenEnd.y),e,t,n);return r!=null&&(a==null||wa(r,r,a))?{...o,mapStart:s,mapEnd:r}:null}}function oa(i,e,t,a=null,n=null){return yh(i,t,zs(e,i,t),a,n)}function Oo(i,e,t,a=null,n=null){return oa(i,t,Z(e),a,n)}function Mh(i,e,t,a){const n=e.toMap(i.screenStart,{include:[t]});return n!=null?Oo(e,t,n,a):null}function bh(i,e){const t=wh,a=xh,n=ci();i.renderCoordsHelper.worldUpAtPosition(e,t);const s=je(n,t,P(a,e,i.state.camera.eye));return je(s,s,t),Pt(e,s,n)}function Eo(i,e,t){let a=null;const n=new Ka;return n.next(Bi(i,bh(i,e))).next(Sh(i,e)).next(To(i,t)).next(s=>{s.mapEnd.x=s.mapStart.x,s.mapEnd.y=s.mapStart.y,a=s}),s=>(a=null,n.execute(s),a)}function Sh(i,e){const t=b(),a=He(e);i.renderCoordsHelper.worldUpAtPosition(e,t);const n=b(),s=b(),o=r=>(P(r,r,e),mr(t,r,r),i.viewingMode==="global"&&He(r)*Math.sign(Ci(t,r))<.001-a&&P(r,le(r,t,.001),e),J(r,r,e),r);return r=>(r.renderStart=o(oe(n,r.renderStart)),r.renderEnd=o(oe(s,r.renderEnd)),r)}function To(i,e){const t=i.renderCoordsHelper;return a=>{const n=t.fromRenderCoords(a.renderStart,e),s=t.fromRenderCoords(a.renderEnd,e);return n!=null&&s!=null?{...a,mapStart:n,mapEnd:s}:null}}var hs;(function(i){i[i.GROUND=0]="GROUND",i[i.OTHER=1]="OTHER"})(hs||(hs={}));const wh=b(),xh=b(),ps=Qi();function ra(i,e,t,a){const n=i.graphic,s=(o,r)=>e({action:o,graphic:n,dxScreen:r.screenDeltaX,dyScreen:r.screenDeltaY});return t((o,r,l)=>(r.next(c=>(c.action==="start"&&s("start",c),c)).next(Nl(n,a)).next(c=>{switch(c.action){case"start":case"update":(c.translationX||c.translationY||c.translationZ)&&s("update",c);break;case"end":s("end",c)}return c}),{steps:r,cancel:l=l.next(Vl(n)).next(c=>(s("end",{screenDeltaX:0,screenDeltaY:0}),c))}))}function Ao(i){if(i==null||i.type!=="polyline"&&i.type!=="polygon")return 0;const e=(i.type==="polyline"?i.paths:i.rings)[0];if(!e||e.length<2)return 0;const t=e[0],a=e[1];return Math.atan2(a[1]-t[1],a[0]-t[0])}function Yi(i){if(i==null||i.axis==null)return 1;const{mapStart:e,mapEnd:t,axis:a}=i,n=[t.x-e.x,t.y-e.y];return n[0]*a[0]+n[1]*a[1]>0?1:-1}let Oh=class extends di{constructor(e){super(),this._handles=new jt,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),this._angle=0,this._scale=1,this._radius=Ne,this._updateAfterDrag=!1,this.events=new We,this._tool=e.tool,this._view=e.view,e.radius!=null&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator(t=>this._tool.manipulators.add(t))}set orthogonalAvailable(e){this._arrowManipulatorInfos.length>=3&&(this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e)}destroy(){this._handles=L(this._handles),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){for(const{manipulator:t}of this._arrowManipulatorInfos)e(t,I.TRANSLATE_XY)}createGraphicDragPipeline(e,t,a){const n=t.graphic,s=Z(n),o=n.geometry.spatialReference;return ra(t,a,r=>this.createDragPipeline((l,c,p,g,u)=>({steps:c,cancel:p}=e(l,c,p,g,u),r(l,c,p)),s,o,n),this._view.state.viewingMode)}createDragPipeline(e,t,a,n){return re(this._arrowManipulatorInfos.map(({manipulator:s},o)=>Ae(s,(r,l,c,p,g)=>{const u=l.next(_=>({..._,manipulatorType:I.TRANSLATE_XY})).next(Kt(this._view,r.elevationAlignedLocation)).next(oa(this._view,r.elevationAlignedLocation,t,a,n)).next(jl(r.location,this.angle+(o+1)*Math.PI*.5)).next(Ht());e(r,u,c,p,g)})))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:t},a){const n=this._radius/Ne,s=lh*n,o=s*Math.sqrt(3)/2,r=ji(this._opaqueMaterial,o,s/2,s/2,So);Qs(r,Gi(ie.get(),X(y.get(),0,-o/3,0))),e.renderObjects=[new S(r,M.Focused),new S(r.instantiate({material:this._transparentMaterial}),M.Unfocused)],e.radius=o/3*2*1.2;const l=Ua(ie.get(),a*Math.PI/2),c=Gi(ie.get(),X(y.get(),0,ch*n,0));Le(t,l,c)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=Ns(ie.get(),e,N(0,0,1));if(t==null)return;const a=Li(ie.get(),X(y.get(),this.displayScale,this.displayScale,this.displayScale)),n=Le(ie.get(),a,t);for(const s of this._arrowManipulatorInfos){const o=Le(ie.get(),n,s.transform);s.manipulator.modelTransform=o}}_createArrowManipulator(e){const t=new ce({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:N(0,0,1)}}),a={manipulator:t,transform:fe()};return this._updateArrowManipulator(a,e),this._handles.add(t.events.on("drag",n=>{this._updateAfterDrag&&n.action==="end"&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)})),a}_createMaterial(e=1){const t=W(this._view),a=ne.toUnitRGBA(t.colors.accent);return a[3]*=e,new Te({color:a,transparent:e!==1,cullFace:Q.Back,renderOccluded:R.Transparent})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map(({manipulator:e})=>e)}}},Eh=class{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&this._lastDragEvent!=null&&this._next!=null){const t=this._lastDragEvent.mapEnd,a=this._snap(this._lastDragEvent.screenEnd);if(a!=null){const n={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:e===!0?a:t,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this._next.execute(n)}}this._enabled=e}_snap(e){const t=this._view!=null?this._view.toMap(e,{exclude:[]}):null;return t!=null&&this._view!=null&&(t.z=zs(t,this._view,this._elevationInfo)),t}createDragEventPipelineStep(e,t){this._view=e,this._elevationInfo=t,this._lastDragEvent=null;const a=new Ka;return this._next=a,[n=>{if(this._lastDragEvent=n.action!=="end"?{...n}:null,this._enabled){const s=this._snap(n.screenEnd);return s!=null?{action:n.action,mapStart:n.mapStart,mapEnd:s,screenStart:n.screenStart,screenEnd:n.screenEnd}:null}return{action:n.action,mapStart:n.mapStart,mapEnd:n.mapEnd,screenStart:n.screenStart,screenEnd:n.screenEnd}},a]}},Th=class extends di{constructor(e){super(),this._snapToScene=new Eh,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=Ne,this._view=e.view,this._tool=e.tool,e.snapToScene!=null&&(this.snapToScene=e.snapToScene),e.radius!=null&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator(t=>this._tool.manipulators.add(t))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,I.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}createGraphicDragPipeline(e,t,a){const n=t.graphic,s=Z(n),o=n.geometry.spatialReference;return ra(t,a,r=>this.createDragPipeline((l,c,p,g,u)=>({steps:c,cancel:p}=e(l,c,p,g,u),r(l,c,p)),s,o,n),this._view.state.viewingMode)}createDragPipeline(e,t,a,n){const s=this._view;return Ae(this._manipulator,(o,r,l,c,p)=>{const g=r.next(Kt(s,o.elevationAlignedLocation)).next(oa(s,o.elevationAlignedLocation,t,a,n)).next(...this._snapToScene.createDragEventPipelineStep(s,t)).next(u=>({...u,manipulatorType:I.TRANSLATE_XY})).next(Ht());e(o,g,l,c,p)})}_updateManipulatorTransform(){const e=Li(ie.get(),X(y.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new ce({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:N(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=al(this._discMaterial,So,1,bo,N(0,0,1),N(0,0,0));e.transformation=Li(fe(),N(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new S(e,M.Focused),new S(e.instantiate({material:this._discMaterialTransparent}),M.Unfocused)],this._manipulator.radius=rh*(this._radius/Ne)}_createMaterial(e=1){const t=W(this._view),a=ne.toUnitRGBA(t.colors.accent);return a[3]*=e,new Te({color:a,transparent:e!==1,cullFace:Q.Back,renderOccluded:R.Transparent})}get test(){return{discManipulator:this._manipulator}}};class Ah extends di{constructor(e){super(),this._radius=Ne,this.events=new We,this._tool=e.tool,this._view=e.view,e.radius!=null&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator(t=>this._tool.manipulators.add(t))}destroy(){this._manipulator.applyObjectTransform=Rh,this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()})}forEachManipulator(e){e(this._manipulator,I.TRANSLATE_Z)}createGraphicDragPipeline(e,t,a){const n=t.graphic.geometry.spatialReference;return ra(t,a,s=>this.createDragPipeline((o,r,l,c,p)=>({steps:r,cancel:l}=e(o,r,l,c,p),s(o,r,l)),n),this._view.state.viewingMode)}createDragPipeline(e,t){const a=this._view;return Ae(this._manipulator,(n,s,o,r,l)=>{const c=s.next(p=>({...p,manipulatorType:I.TRANSLATE_Z})).next(Eo(a,n.renderLocation,t)).next(Ht());e(n,c,o,r,l)})}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}_updateManipulator(){const e=this._radius/Ne,t=W(this._view),a=t.zManipulator.height*e,n=t.zManipulator.coneHeight*e,s=t.zManipulator.coneWidth*e,o=t.zManipulator.width*e,r=[N(0,0,0),N(0,0,a)],l=[N(0,0,0),N(0,0,a+n)],c=w=>{const O=fe();if(Ea(O,O,[0,0,a]),Vs(O,O,Math.PI/2),w){const V=1+2*w/s;It(O,O,[V,V,V])}return O},p=c(0),g=(w,O)=>{const V=Xl(t.zManipulator.color,O);return V.a*=w,ne.toUnitRGBA(V)},u=Ye(g(1,.25),R.Occlude),_=Ye(g(1,0),R.Occlude),m=Ye(g(.7,0),t.zManipulator.renderOccluded),f=Ye(g(.85,0),t.zManipulator.renderOccluded),v=nl(u,r,o/2,16,!1),x=Da(u,n,s/2,16,!1);x.transformation=p,this._manipulator.renderObjects=[new S(x,M.Unfocused),new S(v,M.Unfocused),new S(x.instantiate({material:_}),M.Focused),new S(v.instantiate({material:_}),M.Focused),new S(x.instantiate({material:m}),M.Unfocused),new S(v.instantiate({material:m}),M.Unfocused),new S(x.instantiate({material:f}),M.Focused),new S(v.instantiate({material:f}),M.Focused)],this._manipulator.radius=o/2+2,this._manipulator.collisionType={type:"line",paths:[l]}}_createManipulator(){const e=this._view,t=W(e),a=new ce({view:e,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});a.applyObjectTransform=n=>{const s=e.state.camera,o=us;e.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,o);const r=fr(s.eye,o),l=s.computeRenderPixelSizeAtDist(r),c=P(Ot,o,s.eye);ve(c,c);const p=$h;e.renderCoordsHelper.worldUpAtPosition(us,p);const g=Math.abs(Ci(c,p)),u=je(Ot,c,p),_=je(Ot,u,p),m=Ii(g,.01,1),f=1-Math.sqrt(1-m*m)/m/s.fullWidth,v=this._radius/Ne,x=t.zManipulator.width*v;le(_,ve(_,_),(1/f-1)*r+l*x),n[12]-=Ot[0],n[13]-=Ot[1],n[14]-=Ot[2]},this._manipulator=a,this._updateManipulator()}get test(){return{manipulator:this._manipulator}}}const us=b(),Ot=b(),$h=b(),Rh=()=>{};let ft=class extends di{constructor(e){super(),this._handles=new jt,this._interactive=!0;const{tool:t,view:a,snapToScene:n,radius:s}=e;this._view=a,this.xyManipulation=new Th({tool:t,view:a,snapToScene:n,radius:s}),this.xyAxisManipulation=new Oh({tool:t,view:a,radius:s}),this.zManipulation=new Ah({tool:t,view:a,radius:s}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this._autoHideXYAxis(),this.forEachManipulator(o=>this._handles.add(o.events.on("grab-changed",()=>this._updateManipulatorInteractivity())))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(e,t,a){return re([this.xyManipulation.createGraphicDragPipeline((n,s,o,r,l)=>e(E.XY,n,s,o,r,l),t,a),this.xyAxisManipulation.createGraphicDragPipeline((n,s,o,r,l)=>e(E.XY_AXIS,n,s,o,r,l),t,a),this.zManipulation.createGraphicDragPipeline((n,s,o,r,l)=>e(E.Z,n,s,o,r,l),t,a)])}createDragPipeline(e,t,a,n){return re([this.xyManipulation.createDragPipeline((s,o,r,l,c)=>e(E.XY,s,o,r,l,c),t,a,n),this.xyAxisManipulation.createDragPipeline((s,o,r,l,c)=>e(E.XY_AXIS,s,o,r,l,c),t,a,n),this.zManipulation.createDragPipeline((s,o,r,l,c)=>e(E.Z,s,o,r,l,c),a)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this.xyAxisManipulation.angle=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator(t=>e(t,I.TRANSLATE_XY)),this.xyAxisManipulation.forEachManipulator(t=>e(t,I.TRANSLATE_XY)),this.zManipulation.forEachManipulator(t=>e(t,I.TRANSLATE_Z))}get _xyAxisVisible(){const e=this.xyManipulation.someManipulator(t=>t.focused)||this.xyAxisManipulation.someManipulator(t=>t.focused);return this._view.inputManager&&this._view.inputManager.latestPointerType==="touch"||e}_autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if(js("esri-mobile"))return;const a=[];t.forEachManipulator(s=>a.push(s)),e.forEachManipulator(s=>a.push(s));const n=()=>{const s=[];this._xyAxisVisible||e.forEachManipulator(o=>s.push(o.disableDisplay())),this._handles.remove(ds),this._handles.add(s,ds)};for(const s of a)this._handles.add(s.events.on("focus-changed",n));this._view.inputManager&&this._handles.add(yt(()=>{var s;return(s=this._view.inputManager)==null?void 0:s.latestPointerType},n)),n()}_updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator(t=>{t.interactive=!e&&this._interactive||t.grabbing})}static radiusForSymbol(e){const t=e!=null&&e.type==="point-3d"&&e.symbolLayers;return t&&t.length>0&&t.some(a=>a.type==="icon")?wo:Ne}};const ds="disable-xy-axis-display";var E;(function(i){i[i.XY=0]="XY",i[i.XY_AXIS=1]="XY_AXIS",i[i.Z=2]="Z"})(E||(E={}));let nn=class extends di{constructor(e){super(),this._view=e.view,this._tool=e.tool,this._graphicState=e.graphicState,this._createManipulator(),this.forEachManipulator(t=>this._tool.manipulators.add(t))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(e){e(this._manipulator,I.TRANSLATE_XY)}createGraphicDragPipeline(e){return ra(this._graphicState,e,t=>this.createDragPipeline(t),this._view.state.viewingMode)}createDragPipeline(e){const t=this._view,a=this._graphicState.graphic,n=a.geometry!=null?a.geometry.spatialReference:null;return Ae(this._manipulator,(s,o,r,l,c)=>{const p=o.next(Mh(c,t,a,n)).next(At()).next(Ht());e(s,p,r,l,c)})}_createManipulator(){const e=this._view,t=this._graphicState.graphic;this._manipulator=new Ql({graphic:t,view:e,selectable:!0,cursor:"move"})}},Dh=class{constructor(e){this.allGraphics=e,this.type="graphic-move-start"}};class Ih{constructor(e,t,a){this.dx=e,this.dy=t,this.allGraphics=a,this.type="graphic-move"}}class gs{constructor(e){this.allGraphics=e,this.type="graphic-move-stop"}}const Re="manipulators";let Ie=class extends Hs(We.EventedMixin(ia)){constructor(e){super(e),this._infos=new Map,this.graphics=new vr,this.enableZ=!0,this.tooltipOptions=new rt,this.type="move-3d",this._moveManipulation=null,this._tooltip=null}initialize(){const{view:e}=this;this.addHandles([this.graphics.on("change",a=>{a.removed.forEach(n=>this.removeHandles(n)),this._updateGraphicInfos(a),this._setupFastTransformUpdates(a.added),this._refreshManipulators()}),D(()=>this.tooltipOptions.enabled,a=>{this._tooltip=a?new pi({view:e}):L(this._tooltip)},Gt)]);const t=this.graphics.toArray();this._updateGraphicInfos({added:t,removed:[]}),this._setupFastTransformUpdates(t),this._refreshManipulators(),this.finishToolCreation()}destroy(){this._tooltip=L(this._tooltip),this._moveManipulation=L(this._moveManipulation),this.removeAllHandles(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_updateGraphicInfos({added:e,removed:t}){var a;for(const n of e){if(yr(n)!==Fs.SUPPORTED)continue;const s=new Gh(n),o=this.view.trackGraphicState(s.state);this._infos.set(s.graphic,{info:s,handle:o})}for(const n of t)(a=this._infos.get(n))==null||a.handle.remove(),this._infos.delete(n)}_setupFastTransformUpdates(e){for(const t of e){const{info:a}=this._infos.get(t);this.addHandles(tn(a.state),t)}}_refreshManipulators(){if(this.removeHandles(Re),this._moveManipulation=L(this._moveManipulation),this.manipulators.removeAll(),this._infos.size===0)return;const e=Array.from(this._infos.values(),({info:t})=>t);this._createManipulators(e),this._createVisualElements(e),this._updateMoveManipulation(e)}_createManipulators(e){for(const t of e){const a=t.state;t.manipulationXY=new nn({tool:this,view:this.view,graphicState:a}),t.manipulationXY.forEachManipulator(n=>this.addHandles([n.events.on("immediate-click",s=>{this.emit("immediate-click",{...s,graphic:a.graphic}),s.stopPropagation()}),n.events.on("grab-changed",({action:s})=>{const{tooltipOptions:o,_tooltip:r}=this;r!=null&&(s==="start"?r.info=new oi({tooltipOptions:o}):r.clear())})],Re)),this.addHandles(t.manipulationXY.createDragPipeline((n,s,o,r)=>this._buildDragEventPipeline(e,E.XY,n,s,o,r)),Re)}this._createMoveManipulation(e)}_createMoveManipulation(e){const t=new ft({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:e.length===1?ft.radiusForSymbol(e[0].graphic.symbol):Ne});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator(o=>{this.addHandles(o.events.on("immediate-click",r=>{t.zManipulation.hasManipulator(o)||this.graphics.length!==1||this.emit("immediate-click",{...r,graphic:this.graphics.at(0)}),r.stopPropagation()}),Re)});const a=o=>r=>{this.addHandles(r.events.on("focus-changed",({action:l})=>{const c=this._tooltip;c!=null&&(l==="focus"?this._updateMoveTooltip(e,o):c.clear())}),Re)};this._moveManipulation.xyManipulation.forEachManipulator(a(E.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(a(E.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(a(E.Z));const n=()=>this._updateMoveManipulation(e);for(const o of e)this.addHandles([o.state.on("changed",n),D(()=>o.state.displaying,n)],Re);const s=e[e.length-1];this.addHandles(s.state.on("changed",()=>this._updateMoveManipulationAngle(s)),Re),this.addHandles(t.createDragPipeline((o,r,l,c,p)=>this._buildDragEventPipeline(e,o,r,l,c,p),Z(s.graphic),s.graphic.geometry.spatialReference,s.graphic),Re),this._updateMoveManipulationAngle(s)}_createVisualElements(e){for(const t of e){const a=t.graphic,n=sa({view:this.view,graphic:a,forEachManipulator:s=>{var o,r;(o=t.manipulationXY)==null||o.forEachManipulator(s),(r=this._moveManipulation)==null||r.forEachManipulator(s)},onManipulatorsChanged:()=>Pe()});n!=null&&(t.geometryRepresentation=n.visualElement,t.geometryRepresentation instanceof Mt&&this.addHandles([t.geometryRepresentation.events.on("attachment-origin-changed",()=>{t.state.isDraped||this._updateMoveManipulation(e)}),D(()=>t.state.isDraped,()=>this._updateMoveManipulation(e))],Re),this.addHandles(n,Re))}}_updateMoveManipulationAngle(e){this._moveManipulation&&(this._moveManipulation.angle=Ao(e.graphic.geometry))}_updateMoveManipulation(e){const t=Vt(0,0,0,this.view.spatialReference);let a=0,n=!1;const s=this._moveManipulation;if(s){for(const o of e){if(!o.state.displaying)continue;const r=o.state.graphic;this.enableZ&&mt(r)&&(n=!0);const l=o.geometryRepresentation instanceof Mt&&!o.state.isDraped?o.geometryRepresentation.attachmentOrigin:Xi(this.view,r);if(l!=null){const{x:c,y:p,z:g}=l;t.x+=c,t.y+=p,g&&(t.z??(t.z=0),t.z+=g),a++}}a>0?(t.x/=a,t.y/=a,t.z??(t.z=0),t.z/=a,s.location=t,s.xyManipulation.available=!0,s.xyAxisManipulation.available=!0,s.zManipulation.available=n):s.available=!1}}_buildDragEventPipeline(e,t,a,n,s,o){const r=[],l=[];let c=null,p=null;const g=()=>{for(const u of r)u.dragging=!1;r.length=0,l.length=0,c=null,p=null,this._moveManipulation&&(this._moveManipulation.interactive=!0)};if(e.length===1&&t===E.XY){const u=e[0].graphic;({steps:n,cancel:s}=this._buildSnappingPipelineSteps(u,Z(u),n,s,o))}return s=s.next(u=>p==null?void 0:p(u)).next(()=>(this.emit("graphic-move-stop",new gs(l)),this.destroyed||g(),null)),{steps:n=n.next(u=>{var _,m;if(u.action==="start"){r.length=0,l.length=0;for(const f of e)f.dragging||!((_=f.manipulationXY)!=null&&_.hasManipulator(a))&&((m=f.manipulationXY)!=null&&m.grabbing)||(r.push(f),l.push(f.graphic),f.dragging=!0);if(l.length!==0&&(this._moveManipulation&&(this._moveManipulation.interactive=!1),c=Hl(l,this.view.state.viewingMode),p=Fl(l),this.emit("graphic-move-start",new Dh(l)),this.destroyed))return null}return l.length!==0?u:null}).next(u=>c==null?void 0:c(u)).next(u=>(this._updateMoveTooltip(e,t,u),u)).next(u=>{switch(u.action){case"start":case"update":if(u.translationX||u.translationY||u.translationZ){const _=this.view.toScreen(u.mapStart),m=this.view.toScreen(u.mapEnd),f=m.x-_.x,v=m.y-_.y;if(this.emit("graphic-move",new Ih(f,v,l)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new gs(l)),this.destroyed)return null;g()}return null}),cancel:s}}_updateMoveTooltip(e,t,a){const{tooltipOptions:n,_tooltip:s}=this;if(s==null)return;s.clear();const o=e.length===0?"absolute-height":e[0].state.isDraped?"on-the-ground":"absolute-height";switch(t){case E.XY:s.info=new oi({tooltipOptions:n}),this._updateMoveTooltipDistance(s.info,a,(r,l)=>qe(r,l,o));break;case E.XY_AXIS:s.info=new en({tooltipOptions:n}),this._updateMoveTooltipDistance(s.info,a,(r,l)=>{const c=qe(r,l,o);return Vi(c,Yi(a))});break;case E.Z:s.info=new aa({tooltipOptions:n}),this._updateMoveTooltipDistance(s.info,a,Ni)}}_updateMoveTooltipDistance(e,t,a){if(t!=null&&t.action!=="end"){const{mapStart:n,mapEnd:s}=t,o=a(n,s);e.distance=o??ni}}_buildSnappingPipelineSteps(e,t,a,n,s){const o=e.geometry;if(o==null||o.type!=="point"&&o.type!=="mesh")return{steps:a,cancel:n};const r=(o.type==="point"?o:o.anchor).clone(),l=new Ui({elevationInfo:t,pointer:s,editGeometryOperations:ta.fromGeometry(r,this.view.state.viewingMode),visualizer:new ri,excludeFeature:e}),c=this.snappingManager,{snappingStep:p,cancelSnapping:g}=ki({snappingContext:l,snappingManager:c,updatingHandles:this.updatingHandles});return n=n.next(g),{steps:a=a.next(u=>(r.z=Mr(this.view,r,Z(e),{mode:"absolute-height",offset:0}),{...u,snapOrigin:l.coordinateHelper.pointToVector(r)})).next(...p),cancel:n}}get test(){return{tooltip:this._tooltip}}};h([d({constructOnly:!0,nonNullable:!0})],Ie.prototype,"view",void 0),h([d()],Ie.prototype,"graphics",void 0),h([d({constructOnly:!0,nonNullable:!0})],Ie.prototype,"enableZ",void 0),h([d({constructOnly:!0,type:rt})],Ie.prototype,"tooltipOptions",void 0),h([d({constructOnly:!0})],Ie.prototype,"snappingManager",void 0),h([d()],Ie.prototype,"type",void 0),h([d()],Ie.prototype,"updating",null),Ie=h([K("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],Ie);class Gh{constructor(e){this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new bt({graphic:e})}get graphic(){return this.state.graphic}}function _s(i,e,t){const a=t.mode==="on-the-ground"?Dn.XY:Dn.XYZ;return new Sl(i,a,e,0)}function ms(i,e,t){const a=b();if(!i.renderCoordsHelper.toRenderCoords(e,a))return null;const n=fs(i,e,hi(t.plane)),s=fs(i,e,t.edgeDirection);if(n==null||s==null)return null;const o=je(b(),n,s);return Pt(a,o,ci())}function fs(i,e,t){const a=Vt(e.x+t[0],e.y+t[1],e.z+t[2],e.spatialReference),n=b(),s=b();return i.renderCoordsHelper.toRenderCoords(e,n)&&i.renderCoordsHelper.toRenderCoords(a,s)?Us(s,n,s):null}function Ph(i,e,t){const a=hi(i),n=Us(b(),e,t),s=je(b(),n,a),o=je(b(),n,s);return br(n[0],n[1],n[2],0,s[0],s[1],s[2],0,o[0],o[1],o[2],0,0,0,0,1)}function Ch(i,e,t){const a=t.projectToRenderScreen(i,Sa()),n=t.projectToRenderScreen(e,Sa());return a!=null&&n!=null?Sr(P(a,a,n)):0}let it=class extends Ji{constructor(e){super(e),this.type="reshape-edge-offset",this.distance=ni,this.area=null,this.totalLength=null}};h([d()],it.prototype,"type",void 0),h([d()],it.prototype,"distance",void 0),h([d()],it.prototype,"area",void 0),h([d()],it.prototype,"totalLength",void 0),it=h([K("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],it);let H=class extends We.EventedMixin(ka){constructor(i){super(i),this._selectedIndex=0,this._manipulatorHandles=new jt,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=C.NONE,this._recreatingManipulators=!1,this.outputGeometry=null,this._vertexLaserLineVisualElement=null;const e=W(i.tool.view).manipulators,t=e.vertex;this._vertexManipulatorMaterial=Ye(Y(t.color),t.renderOccluded),this._vertexManipulatorOutlineMaterial=Bt(Y(t.outlineColor),t.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=Bt(Y(t.hoverOutlineColor),t.renderOccluded);const a=e.edge;this._edgeManipulatorMaterial=Ye(Y(a.color),a.renderOccluded),this._edgeManipulatorOutlineMaterial=Bt(Y(a.outlineColor),a.renderOccluded);const n=e.edgeOffset;this._edgeOffsetManipulatorMaterial=Ye(Y(n.color),n.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=Ye(Y(n.hoverColor),n.renderOccluded,!1);const s=e.selected;this._selectedManipulatorMaterial=Ye(Y(s.color),s.renderOccluded),this._selectedManipulatorOutlineMaterial=Bt(Y(s.outlineColor),s.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=Bt(Y(s.hoverOutlineColor),s.renderOccluded)}initialize(){const{graphic:i,view:e}=this,t=this._graphicState=new bt({graphic:i});this._tooltip=new pi({view:e}),this.addHandles([D(()=>t.displaying,a=>{for(const n of this._manipulatorInfos)n.manipulator.available=a}),D(()=>({labels:this._segmentLabels,enabled:this._labelOptions.enabled,edgeOffsetEnabled:this.enableEdgeOffset}),({labels:a,enabled:n,edgeOffsetEnabled:s})=>{a!=null&&(a.visible=n,a.edgeDistance=s?"far":"default")},at),yt(()=>!this._tooltipOptions.enabled,()=>this._tooltip.clear(),at),this.view.trackGraphicState(t)])}destroy(){this._segmentLabels=L(this._segmentLabels),this._tooltip=L(this._tooltip),this._removeManipulators()}get inputGeometry(){return this._editGeometryOperations!=null?this._editGeometryOperations.data.geometry:null}set inputGeometry(i){this._recreateEditGeometryAndManipulators(i)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _labelOptions(){return this.tool.labelOptions}get _tooltipOptions(){return this.tool.tooltipOptions}removeSelectedVertices(){const i=this._manipulatorInfos.filter(e=>e.manipulator.selected&&e.type==="vertex");this._removeVertices(i)}onManipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=L(this._moveManipulation),this._graphicMoveManipulation=L(this._graphicMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(i){if(this._editGeometryOperations==null)return;const e=Z(this.graphic);for(const t of this._editGeometryOperations.data.components){const a=i==null?void 0:i.byComponentIndex.get(t.index);for(const n of t.vertices){const s=a==null?void 0:a.has(n.index);this._createVertexOrEdgeManipulator(n,e,s)}for(const n of t.edges)this._createVertexOrEdgeManipulator(n,e)}this._createGraphicMoveManipulation(),this._createMoveManipulation(e),this._createVisualElements()}get canRedo(){return this._editGeometryOperations!=null&&this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations!=null&&this._editGeometryOperations.canUndo}redo(){if(this._editGeometryOperations==null)return null;const i=this._editGeometryOperations.redo();return i!=null&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),i}undo(){if(this._editGeometryOperations==null)return null;this.emit("undo");const i=this._editGeometryOperations.undo();return i!=null&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),i}_recreateManipulators(){this._recreatingManipulators||(this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._createManipulators(),this._recreatingManipulators=!1)}_recreateEditGeometryAndManipulators(i){const e={byComponentIndex:new Map};if(i!=null&&this.inputGeometry!=null&&wr(i,this.inputGeometry)){for(const a of this._manipulatorInfos)if(a.type==="vertex"&&a.manipulator.selected){const{index:n,component:{index:s}}=a.handle,{byComponentIndex:o}=e,r=o.get(s)||new Set;r.add(n),o.set(s,r)}}if(this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._editGeometryOperations=L(this._editGeometryOperations),this._segmentLabels=L(this._segmentLabels),i==null)return void(this._recreatingManipulators=!1);const t=i.type==="mesh"?i.anchor:i;this._editGeometryOperations=ta.fromGeometry(t,this.view.state.viewingMode),this._createManipulators(e),this._segmentLabels=new Zi({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:Z(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled}),this._recreatingManipulators=!1}_perGraphicManipulatorDragAction(i,e){if(e.action==="end")return e;let t=0;const a=[],n=this._manipulatorInfos.some(o=>o.type==="vertex"&&o.manipulator.selected),s=i===$t.SELECTED_OR_ALL&&n;for(const o of this._manipulatorInfos)o.type==="vertex"&&(o.manipulator.grabbing||s&&!o.manipulator.selected||a.push(o),t++);if(a.length===0)return e;if(this._moveVertices(a,e),a.length===t){if(this._updateEventState(C.MOVING),this.destroyed)return e;this.emit("move",{type:"move",dx:e.screenDeltaX,dy:e.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(C.RESHAPING),this.destroyed)return e;this.emit("reshape",{type:"reshape",mover:this.graphic})}return e}_isMultiVertexSelection(){return this._manipulatorInfos.reduce((i,e)=>e.type==="vertex"&&e.manipulator.selected?i+1:i,0)>1}_perVertexManipulatorDragAction(i){if(this._updateEventState(C.RESHAPING),this.destroyed)return;const{mapDeltaX:e,mapDeltaY:t,mapDeltaZ:a}=i;if(!e&&!t&&!a)return;const n=[];for(const s of this._manipulatorInfos)s.type==="vertex"&&(s.manipulator.selected&&!s.manipulator.grabbing||s===i.info)&&n.push(s);this._moveVertices(n,i,Be.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(i){if(i===this._reshapeEventState)return!1;switch(i){case C.NONE:if(this._numGrabbing!==0||this._numDragging!==0)return!1;switch(this._reshapeEventState){case C.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case C.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case C.MOVING:switch(this._reshapeEventState){case C.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case C.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case C.RESHAPING:switch(this._reshapeEventState){case C.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case C.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const e=this._reshapeEventState!==i;return this._reshapeEventState=i,e}_createGraphicMoveManipulation(){const{tool:i,view:e}=this,t=this._graphicState;if(this._graphicMoveManipulation=new nn({tool:i,view:e,graphicState:t}),this.enableMoveGraphic){let a=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((n,s,o)=>{s.next(r=>this._trackNumDragging(r)).next(r=>(r.action==="start"&&(a=this._editGeometryOperations.createUndoGroup()),r)).next(r=>this._perGraphicManipulatorDragAction($t.ALL,r)).next(r=>(this._updateTranslateGraphicTooltip(E.XY,r),r)).next(r=>{r.action==="end"&&(this._tooltip.clear(),a=Qe(a))}),o.next(()=>this._onDragCancel(!0,()=>a=Qe(a)))})),this._graphicMoveManipulation.forEachManipulator(n=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(n,!1)))}else this._graphicMoveManipulation.forEachManipulator(a=>{a.grabbable=!1,a.cursor=null});this._graphicMoveManipulation.forEachManipulator(a=>this._manipulatorHandles.add(a.events.on("immediate-click",n=>{this._manipulatorInfos.some(s=>s.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...n,graphic:this.graphic}),n.stopPropagation()})))}_createMoveManipulation(i){const{graphic:e,handles:t,tool:a,view:n}=this,s=this._graphicState;this._moveManipulation=new ft({tool:a,view:n,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&mt(e),snapToScene:!1,radius:ft.radiusForSymbol(e.symbol)}),this._moveManipulation.forEachManipulator(l=>t.add([l.events.on("immediate-click",c=>{this._moveManipulation.zManipulation.hasManipulator(l)||this._manipulatorInfos.some(p=>p.manipulator.selected)||this.emit("immediate-click",{...c,graphic:e}),c.stopPropagation()}),this._watchAndUpdateGrabState(l,!1)]));const o=l=>c=>{t.add(c.events.on("focus-changed",({action:p})=>{p==="focus"&&this._tooltipOptions.enabled?this._updateTranslateTooltip(l):this._tooltip.clear()}))};this._moveManipulation.xyManipulation.forEachManipulator(o(E.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(o(E.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(o(E.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const r=e.geometry.spatialReference;t.add([this._moveManipulation.createDragPipeline((l,c,p,g,u)=>{const{snappingStep:_,cancelSnapping:m}=ki({predicate:f=>!!f.info,snappingManager:a.snappingManager,snappingContext:new Ui({editGeometryOperations:this._editGeometryOperations,elevationInfo:i,pointer:u,excludeFeature:e,visualizer:new ri}),updatingHandles:this.updatingHandles,useZ:!1});return g=g.next(f=>(this._onDragCancel(),f)).next(m),{steps:p=p.next(f=>this._trackNumDragging(f)).next(f=>{const v=this._manipulatorInfos.filter(x=>x.type==="vertex"&&x.manipulator.selected);return f.manipulatorType===I.TRANSLATE_XY&&v.length===1?{...f,info:v[0],snapOrigin:v[0].handle.pos}:f}).next(Pn(this.view,i,e)).next(..._).next(At()).next(f=>this._perGraphicManipulatorDragAction($t.SELECTED_OR_ALL,f)).next(f=>(this._updateTranslateTooltip(l,f),f)),cancel:g}},i,r,e),D(()=>s.displaying,()=>this._updateMoveManipulationPosition(),at),s.on("changed",()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()}),D(()=>s.isDraped,l=>{this._updateMoveManipulationPosition();const c="align-move-manipulation";l?t.add(this.view.elevationProvider.on("elevation-change",()=>this._updateMoveManipulationPosition()),c):t.remove(c)},at)])}_createVisualElements(){const{graphic:i,view:e}=this,t=sa({view:e,graphic:i,forEachManipulator:a=>{if(!this.destroyed&&!this._recreatingManipulators){this._graphicMoveManipulation.forEachManipulator(a),this._moveManipulation.forEachManipulator(a);for(const n of this._manipulatorInfos)a(n.manipulator,I.TRANSLATE_XY)}},onManipulatorsChanged:a=>this.on("manipulators-changed",a)});t!=null&&(this._outlineVisualElement=t.visualElement instanceof Mt?t.visualElement:null),this._outlineVisualElement!=null&&this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()})),this._manipulatorHandles.add(t)}_createEdgeOffsetManipulator(i,e=Z(this.graphic)){var _,m;const t=W(this.view).manipulators.edgeOffset,a=t.size/2,n=a+t.collisionPadding,s=a/n,o=s*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside==null&&(this._edgeOffsetManipulatorGeometryInside=ji(this._edgeOffsetManipulatorMaterial,o,s/2,s/2,t.height,t.offset)),this._edgeOffsetManipulatorGeometryOutside==null&&(this._edgeOffsetManipulatorGeometryOutside=ji(this._edgeOffsetManipulatorMaterial,-o,s/2,s/2,t.height,-t.offset));const r=[new S(this._edgeOffsetManipulatorGeometryInside.instantiate(),M.Unfocused),new S(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),M.Focused),new S(this._edgeOffsetManipulatorGeometryOutside.instantiate(),M.Unfocused),new S(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),M.Focused)],l=new ce({view:this.view,renderObjects:r,elevationInfo:e.mode!=="on-the-ground"||yn(this.graphic.symbol)?{mode:"absolute-height",offset:0}:e,worldOriented:!1,focusMultiplier:1,radius:n,available:!(!this.graphic.visible||!((_=this.graphic.layer)!=null&&_.visible)),collisionType:{type:"disc",direction:N(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),c=new ce({view:this.view,worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!((m=this.graphic.layer)!=null&&m.visible)),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",metadata:{deleting:!1}}),p={manipulator:l,handle:i,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:c,elevationInfo:e,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(p,t.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(p);const g=[];for(const f of[p.handle.leftVertex,p.handle.rightVertex]){const v=this._getManipulatorInfoFromHandle(f);v!=null&&g.push(v.manipulator.events.on("location-update",()=>this._updateEdgeOffsetManipulator(p)))}p.locationUpdateHandle=re(g),this._manipulatorHandles.add(p.locationUpdateHandle,l),this._manipulatorHandles.add([this._watchAndUpdateGrabState(l,!0),this._watchAndUpdateGrabState(c,!0)],l),this._manipulatorHandles.add(Ae(l,this._createEdgeOffsetPipeline(p,e)),l),this._manipulatorHandles.add(Ae(c,(f,v,x,w)=>{if(w==="touch")this._createEdgeOffsetPipeline(p,e)(f,v,x);else if(this.enableMoveGraphic){const O=this.graphic,V=O.geometry!=null?O.geometry.spatialReference:null;v.next(G=>this._trackNumDragging(G)).next(Kt(this.view,f.elevationAlignedLocation)).next(oa(this.view,f.elevationAlignedLocation,e,V,O)).next(Ht()).next(At()).next(G=>this._perGraphicManipulatorDragAction($t.ALL,G)).next(G=>(this._updateTranslateGraphicTooltip(E.XY,G),G)).next(G=>{G.action==="end"&&this._tooltip.clear()}),x.next(()=>this._onDragCancel(!f.metadata.deleting))}}),l);const u=f=>{this._manipulatorInfos.some(v=>v.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...f,graphic:this.graphic}),f.stopPropagation()};return this._manipulatorHandles.add([l.events.on("immediate-click",u),c.events.on("immediate-click",u),l.events.on("focus-changed",({action:f})=>{const v=this._tooltipOptions;if(f==="focus"&&v.enabled){const x=this._tooltip.info=new it({tooltipOptions:v});this._updateTooltipAreaOrTotalLength(x)}else this._tooltip.clear()})],l),this._manipulatorInfos.push(p),this.manipulators.add(l),this.manipulators.add(c),this.emit("manipulators-changed"),p}_autoHideEdgeOffsetManipulator(i,e){const t=i.manipulator,a=i.edgeManipulator,n=()=>{i.visibilityHandle=Qe(i.visibilityHandle);const s=this._getManipulatorInfoFromHandle(i.handle.leftVertex),o=this._getManipulatorInfoFromHandle(i.handle.rightVertex),r=s!=null&&o!=null&&Ch(s.manipulator.renderLocation,o.manipulator.renderLocation,this.view.state.camera)<e;(!t.focused&&!a.focused||r)&&(t.grabbable=!r,a.grabbable=!r,i.visibilityHandle=re([t.disableDisplay(),{remove:()=>{t.grabbable=!0,a.grabbable=this.enableMoveGraphic}}]))};this._manipulatorHandles.add([t.events.on("focus-changed",n),a.events.on("focus-changed",n),{remove:()=>{Qe(i.visibilityHandle),a.metadata.deleting=!0,this.manipulators.remove(a)}}],t),n()}_updateEdgeOffsetManipulator(i){this._updateManipulatorPosition(i);const{coordinateHelper:e}=this._editGeometryOperations.data,t=ms(this.view,i.manipulator.elevationAlignedLocation,_s(e,i.handle,i.manipulator.elevationInfo)),a=this._getManipulatorInfoFromHandle(i.handle.leftVertex),n=this._getManipulatorInfoFromHandle(i.handle.rightVertex);if(a==null||n==null)return;const s=a.manipulator.renderLocation,o=n.manipulator.renderLocation,r=t!=null?Ph(t,s,o):xr;i.manipulator.modelTransform=r,i.edgeManipulator.elevationAlignedLocation=i.manipulator.elevationAlignedLocation,i.edgeManipulator.modelTransform=r;const l=He(P(wi,s,o))/2;i.edgeManipulator.collisionType={type:"line",paths:[[[-l,0,0],[l,0,0]]]}}_createEdgeOffsetPipeline(i,e){return(t,a,n)=>{this._clearSelection();const{step:s,cleanup:o}=this._initializeEdgeOffset(i,e);a.next(r=>this._trackNumDragging(r)).next(Kt(this.view,t.elevationAlignedLocation)).next(s).next(vh(this.view)).next(To(this.view,this._editGeometryOperations.data.spatialReference)).next(At()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(i)).next(this._showEdgeOffsetTooltip()).next(r=>{r.action==="end"&&o()}),n.next(()=>{t.metadata.deleting||(o(),this._onDragCancel())})}}_initializeEdgeOffset(i,e){const{view:t}=this,a=this._editGeometryOperations,n=_s(a.data.coordinateHelper,i.handle,e),s=a.createUndoGroup(),o=ms(t,i.manipulator.elevationAlignedLocation,n);if(n.requiresSplitEdgeLeft){const _=this._getManipulatorInfoFromHandle(i.handle.leftVertex.leftEdge);_!=null&&this._splitEdgeManipulator(_,1)}if(n.requiresSplitEdgeRight){const _=this._getManipulatorInfoFromHandle(i.handle.rightVertex.rightEdge);_!=null&&this._splitEdgeManipulator(_,0)}const r=()=>new Ar({paths:[[i.handle.leftVertex.pos,i.handle.rightVertex.pos]],spatialReference:a.data.spatialReference}),l=W(t),c=new Mt({view:t,isDraped:this._graphicState.isDraped,geometry:r(),elevationInfo:i.elevationInfo,width:l.visualElements.lineGraphics.outline.width,color:Y(l.colors.accent),attached:!0});let p;const g=()=>{this._cleanEdgeOffsetCollapsedEdges(i),p=Qe(p)},u=this.on("undo",g);return p=re([me(c),D(()=>this._graphicState.isDraped,_=>c.isDraped=_),this._graphicState.on("changed",()=>c.geometry=r()),s,u]),{step:_=>n==null||o==null?(g(),null):{..._,operation:n,plane:o},cleanup:g}}_applyEdgeOffsetStep(i){return e=>{if(this.destroyed||e.operation==null)return e;this._updateEventState(C.RESHAPING);const{mapDeltaX:t,mapDeltaY:a,mapDeltaZ:n}=e;return(t||a||n)&&(this._offsetEdge(i,e),this.emit("reshape",{type:"reshape",mover:this.graphic})),e}}_applyComputeEdgeOffsetDistanceStep(){return i=>{const{operation:e,mapEnd:t}=i;return e==null||t==null?i:(i.action==="start"&&e.selectArrowFromStartPoint(t),{...i,signedDistance:e.signedDistanceToPoint(t)})}}_showEdgeOffsetTooltip(){return i=>{const{mapEnd:e,signedDistance:t,operation:a}=i,n=this._tooltip,s=this._tooltipOptions;if(!s.enabled||t==null)return n.clear(),i;let o=n.info;o!=null&&o.type==="reshape-edge-offset"||(o=n.info=new it({tooltipOptions:s}));const{coordinateHelper:r}=this._editGeometryOperations.data;return o.distance=i.action==="end"?ni:Lh(this._graphicState.isDraped,t*a.selectedArrow,e,a.plane,r),this._updateTooltipAreaOrTotalLength(o),i}}_cleanEdgeOffsetCollapsedEdges(i){var r,l;const e=(r=i.handle.leftVertex.leftEdge)==null?void 0:r.leftVertex,t=i.handle.leftVertex,a=(l=i.handle.rightVertex.rightEdge)==null?void 0:l.rightVertex,n=i.handle.rightVertex,s=this._editGeometryOperations.data.coordinateHelper,o=[];if(e&&s.distance(e.pos,t.pos)<fa){const c=this._getManipulatorInfoFromHandle(t);c!=null&&o.push(c)}if(s.distance(t.pos,n.pos)<fa||a&&s.distance(a.pos,n.pos)<fa){const c=this._getManipulatorInfoFromHandle(n);c!=null&&o.push(c)}o.length&&this._removeVertices(o)}_computeVertexManipulatorSizeAndOutline(i){const e=i.size/2,t=e+i.collisionPadding;return{size:e/t,outlineSize:(e+i.outlineSize)/t}}_createVertexOrEdgeManipulator(i,e=Z(this.graphic),t=!1){var g;const{view:a}=this,n=W(a);if(i.type==="edge"){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(i,e);if(!this.enableMidpoints)return null}if(this._vertexManipulatorGeometry==null||this._vertexManipulatorOutlineGeometry==null){const{size:u,outlineSize:_}=this._computeVertexManipulatorSizeAndOutline(n.manipulators.vertex);this._vertexManipulatorGeometry=Wt(this._vertexManipulatorMaterial,u,16,16),this._vertexManipulatorOutlineGeometry=Wt(this._vertexManipulatorOutlineMaterial,_,16,16)}if(this._edgeManipulatorGeometry==null||this._edgeManipulatorOutlineGeometry==null){const{size:u,outlineSize:_}=this._computeVertexManipulatorSizeAndOutline(n.manipulators.edge);this._edgeManipulatorGeometry=Wt(this._edgeManipulatorMaterial,u,16,16),this._edgeManipulatorOutlineGeometry=Wt(this._edgeManipulatorOutlineMaterial,_,16,16)}const{geometry:s}=this.graphic,o=s==null?void 0:s.type,r=o==="point"||o==="mesh"?[]:[new S(this._vertexManipulatorGeometry.instantiate(),xe.Vertex|M.Unselected),new S(this._vertexManipulatorOutlineGeometry.instantiate(),xe.Vertex|M.Unfocused|M.Unselected),new S(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),xe.Vertex|M.Focused|M.Unselected),new S(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),M.Selected),new S(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),M.Selected|M.Unfocused),new S(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),M.Selected|M.Focused)];this.enableMidpoints&&r.push(new S(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),xe.Edge|M.Focused|M.Unselected),new S(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),xe.Edge|M.Focused|M.Unselected),new S(this._edgeManipulatorGeometry.instantiate(),xe.Edge|M.Unfocused|M.Unselected),new S(this._edgeManipulatorOutlineGeometry.instantiate(),xe.Edge|M.Unfocused|M.Unselected));const l=new ce({view:a,renderObjects:r,elevationInfo:e,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!((g=this.graphic.layer)!=null&&g.visible)),metadata:{deleting:!1}});l.selected=t,this._setTypeSpecificManipulatorSettings(l,i,e);const c=i.type==="edge"?{manipulator:l,handle:i,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:l,handle:i,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(c),this.manipulators.add(l),this._updateManipulatorPosition(c),c.type==="edge"){const u=[];for(const _ of[c.handle.leftVertex,c.handle.rightVertex]){const m=this._getManipulatorInfoFromHandle(_);m!=null&&u.push(m.manipulator.events.on("location-update",()=>this._updateManipulatorPosition(c)))}c.locationUpdateHandle=re(u),this._manipulatorHandles.add(c.locationUpdateHandle,l)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(l,!0),l);const p=Ae(l,(u,_,m,f)=>{let v=null;const{snappingStep:x,cancelSnapping:w}=ki({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new Ui({editGeometryOperations:this._editGeometryOperations,elevationInfo:e,pointer:f,excludeFeature:this.graphic,visualizer:new ri}),updatingHandles:this.updatingHandles,useZ:!1});m=m.next(O=>(this._onDragCancel(!u.metadata.deleting,()=>v=Qe(v)),O)).next(w),_.next(O=>this._trackNumDragging(O)).next(O=>{if(O.action==="start"&&(v=this._editGeometryOperations.createUndoGroup()),c.type==="edge"){const V=this._splitEdgeManipulator(c);return{...O,info:V,snapOrigin:V.handle.pos}}return{...O,info:c,snapOrigin:c.handle.pos}}).next(Kt(this.view,u.elevationAlignedLocation)).next(Oo(this.view,this.graphic,u.elevationAlignedLocation,u.location.spatialReference,this.graphic)).next(Pn(this.view,e,this.graphic)).next(...x).next(At()).next(O=>{this._perVertexManipulatorDragAction(O),O.action==="end"&&(v=Qe(v)),this._updateTranslateVertexTooltip(u,E.XY,O)})});return this._manipulatorHandles.add([p,l.events.on("immediate-click",u=>this._manipulatorClickCallback(u,c)),l.events.on("select-changed",()=>{c.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()}),l.events.on("focus-changed",({action:u})=>{u==="focus"&&c.type!=="edge"?this._updateTranslateVertexTooltip(l,E.XY):this._tooltip.clear()})],l),this.emit("manipulators-changed"),c}_trackNumDragging(i){switch(i.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return i}_onDragCancel(i=!0,e){switch(this._numDragging--,i&&(this.undo(),this.outputGeometry=this._editGeometryOperations!=null?this._editGeometryOperations.data.geometry:null),this.tool.snappingManager!=null&&this.tool.snappingManager.doneSnapping(),this._tooltip.clear(),this._reshapeEventState){case C.NONE:break;case C.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case C.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}e&&e(),this.destroyed||this._updateEventState(C.NONE)}_setTypeSpecificManipulatorSettings(i,e,t){const{graphic:a,view:n}=this,s=W(n);switch(e.type){case"vertex":{i.state=xe.Vertex,i.selectable=!0,i.cursor="move",i.collisionPriority=2;const{size:o,collisionPadding:r}=s.manipulators.vertex;i.radius=o/2+r,i.elevationInfo=t;const{geometry:l}=a,c=l==null?void 0:l.type;i.interactive=c!=null&&c!=="point"&&c!=="mesh";break}case"edge":{i.state=xe.Edge,i.selectable=!1,i.cursor="copy",i.collisionPriority=-1;const{size:o,collisionPadding:r}=s.manipulators.edge;i.radius=o/2+r,i.elevationInfo=t.mode!=="on-the-ground"||yn(a.symbol)?{mode:"absolute-height",offset:0}:t;break}}}_watchAndUpdateGrabState(i,e){return i.events.on("grab-changed",t=>this._onGrabStateChanged(i,e,t.action,t.pointerType))}_onGrabStateChanged(i,e,t,a="mouse"){if(!this._recreatingManipulators){if(t==="start")e&&this._updateSelection(i),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(C.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,(a!=="touch"||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach(n=>{const{manipulator:s}=n,{geometry:o}=this.graphic,r=o==null?void 0:o.type;s.interactive=s.grabbing||!this._numGrabbing&&r!=null&&r!=="point"&&r!=="mesh","edgeManipulator"in n&&(n.edgeManipulator.interactive=n.edgeManipulator.grabbing||!this._numGrabbing)}),this._graphicMoveManipulation.forEachManipulator(n=>{n.interactive=n.grabbing||!this._numGrabbing}))}}_clearSelection(){for(const i of this._manipulatorInfos)i.manipulator.grabbing||(i.manipulator.selected=!1)}_updateSelection(i){i.grabbing&&!i.selected&&i.selectable&&(this._clearSelection(),i.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(i){i!=null&&(i.manipulator.metadata.deleting=!0,this.manipulators.remove(i.manipulator),this._manipulatorHandles.remove(i.manipulator),Or(this._manipulatorInfos,i),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(i){if(i){for(const e of this._manipulatorInfos)if(i===e.handle)return e}return null}_updateManipulatorPosition(i){if(i==null)return;const e=this._editGeometryOperations;if(i.type==="vertex")i.manipulator.location=e.data.coordinateHelper.vectorToDehydratedPoint(i.handle.pos,Yt),i.manipulator.grabbing&&this._vertexLaserLineVisualElement!=null&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=i.manipulator.renderLocation);else if(i.type==="edge"){const t=this._getManipulatorInfoFromHandle(i.handle.leftVertex),a=this._getManipulatorInfoFromHandle(i.handle.rightVertex);if(t==null||a==null)return;const n=t.manipulator,s=a.manipulator;if(i.manipulator.elevationInfo!=null&&i.manipulator.elevationInfo.mode==="on-the-ground"){const o=n.location,r=s.location,l=.5,c=o.x+l*(r.x-o.x),p=o.y+l*(r.y-o.y),g=o.hasZ&&r.hasZ?0:void 0;i.manipulator.location=Vt(c,p,g,e.data.spatialReference)}else Ds(wi,n.renderLocation,s.renderLocation,.5),i.manipulator.renderLocation=wi}}_splitEdgeManipulator(i,e=.5){const t=this._editGeometryOperations,a=t.splitEdge(i.handle,e).createdVertex;i.locationUpdateHandle=Qe(i.locationUpdateHandle);const n=Z(this.graphic);let s;this.enableEdgeOffset?(this._removeManipulator(i),s=this._createVertexOrEdgeManipulator(a)):(s=i,s.handle=a,s.type="vertex",this._setTypeSpecificManipulatorSettings(i.manipulator,i.handle,n)),a.leftEdge&&this._createVertexOrEdgeManipulator(a.leftEdge),a.rightEdge&&this._createVertexOrEdgeManipulator(a.rightEdge),this.outputGeometry=t.data.geometry,this._updateManipulatorPosition(s),this.enableEdgeOffset||this._updateTranslateVertexTooltip(s.manipulator,E.XY),this._updateSelection(i.manipulator);const o=this._updateEventState(C.RESHAPING),r=t.data.coordinateHelper.vectorToArray(s.handle.pos),l=t.data.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:r,componentIndex:l,vertexIndex:a.index}],added:r}),o&&this._updateEventState(C.NONE),s}_updateMoveManipulationPosition(){const i=X(wi,0,0,0);let e=0,t=!1,a=null,n=null;for(const s of this._manipulatorInfos)s.type==="vertex"&&(s.manipulator.selected?(e++,J(i,i,s.manipulator.renderLocation),a==null||s.selectedIndex>a.selectedIndex?(n=a,a=s):(n==null||s.selectedIndex>n.selectedIndex)&&(n=s)):t=!0);if(e===0){const s=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=s,this._moveManipulation.xyAxisManipulation.available=s,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=s,this._moveManipulation.zManipulation.available=s&&this.enableZShape&&mt(this.graphic),this._moveManipulation.angle=Ao(this.graphic.geometry),this._moveManipulation.radius=ft.radiusForSymbol(this.graphic.symbol)}else{const s=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=s,this._moveManipulation.xyAxisManipulation.available=s,this._moveManipulation.zManipulation.available=s&&this.enableZVertex&&mt(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=s&&e!==1;let o=0;if(a!=null){const r=a.handle.pos,l=n!=null?n.handle.pos:a.handle.leftEdge&&a.handle.leftEdge.leftVertex?a.handle.leftEdge.leftVertex.pos:null,c=n==null&&a.handle.rightEdge&&a.handle.rightEdge.rightVertex?a.handle.rightEdge.rightVertex.pos:null;l&&c?this._moveManipulation.xyAxisManipulation.available=!1:l?o=vs(l,r):c&&(o=vs(r,c))}this._moveManipulation.angle=o,this._moveManipulation.radius=wo}e!==0&&t?(le(i,i,1/e),Yt.spatialReference=this._editGeometryOperations.data.spatialReference,Yt.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(i,Yt),this._moveManipulation.elevationAlignedLocation=Yt):this._outlineVisualElement==null||this._graphicState.isDraped||this._outlineVisualElement.attachmentOrigin==null?yo(this.view,this._moveManipulation,this.graphic):this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin}_removeVertices(i){var a;const e=new Array,t=this._editGeometryOperations;for(const n of i)if(n.type==="vertex"&&t.canRemoveVertex()){e.push(n.handle),this._removeManipulator(n),this._removeManipulator(this._getManipulatorInfoFromHandle(n.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(n.handle.rightEdge));const s=t.removeVertices([n.handle]),o=(a=s.removedVertices)==null?void 0:a[0].createdEdge;o&&this._createVertexOrEdgeManipulator(o)}if(e.length>0){const n=e.map(o=>{const r=t.data.components.indexOf(o.component);return{coordinates:t.data.coordinateHelper.vectorToArray(o.pos),componentIndex:r,vertexIndex:o.index}});this.outputGeometry=t.data.geometry;const s=this._updateEventState(C.RESHAPING);if(this.destroyed||(this.emit("vertex-remove",{type:"vertex-remove",removed:n.map(o=>o.coordinates),vertices:n}),this.destroyed)||s&&(this._updateEventState(C.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(i,e,t=e.action==="start"?Be.NEW_STEP:Be.ACCUMULATE_STEPS){const a=this._editGeometryOperations;a.moveVertices(i.map(n=>n.handle),e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,t),this.outputGeometry=a.data.geometry;for(const n of i)this._updateManipulatorPosition(n)}_offsetEdge(i,e){if(e.operation==null||e.signedDistance==null)return;const t=this._editGeometryOperations,a=e.operation.clone();a.distance=e.signedDistance,t.updateVertices([i.handle.leftVertex,i.handle.rightVertex],a),this.outputGeometry=t.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(i.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(i.handle.rightVertex))}_manipulatorClickCallback(i,e){i.shiftKey||this._clearSelection(),e.type==="vertex"&&(e.manipulator.selected=!e.manipulator.selected,i.button===Mn.Right&&this._removeVertices([e])),e.type==="edge"&&i.button===Mn.Left&&this._splitEdgeManipulator(e),i.stopPropagation()}_updateTranslateTooltip(i,e){const t=this._manipulatorInfos.filter(a=>a.type==="vertex"&&a.manipulator.selected);t.length===1?this._updateTranslateVertexTooltip(t[0].manipulator,i,e):this._updateTranslateGraphicTooltip(i,e)}_updateTranslateGraphicTooltip(i,e){const t=this._tooltipOptions;if(!t.enabled)return;const a=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(i){case E.XY:this._tooltip.info=new oi({tooltipOptions:t}),this._updateTranslateTooltipDistance(this._tooltip.info,e,(n,s)=>qe(n,s,a));break;case E.XY_AXIS:this._tooltip.info=new en({tooltipOptions:t}),this._updateTranslateTooltipDistance(this._tooltip.info,e,(n,s)=>{const o=qe(n,s,a);return Vi(o,Yi(e))});break;case E.Z:this._tooltip.info=new aa({tooltipOptions:t}),this._updateTranslateTooltipDistance(this._tooltip.info,e,Ni)}}_updateTranslateVertexTooltip(i,e,t){const a=this._tooltipOptions;if(!a.enabled)return;let n;const s=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(e){case E.XY:n=new ec({tooltipOptions:a}),this._updateTranslateTooltipDistance(n,t,(r,l)=>qe(r,l,s)),this._updateTooltipAreaOrTotalLength(n);break;case E.XY_AXIS:n=new Kl({tooltipOptions:a}),this._updateTranslateTooltipDistance(n,t,(r,l)=>{const c=qe(r,l,s);return Vi(c,Yi(t))}),this._updateTooltipAreaOrTotalLength(n);break;case E.Z:n=new Jl({tooltipOptions:a}),this._updateTranslateTooltipDistance(n,t,Ni)}const o=Ur(i.elevationAlignedLocation);o!=null&&(n.elevation={mode:"absolute-height",...o}),this._tooltip.info=n}_updateTranslateTooltipDistance(i,e,t){if(e!=null&&e.action!=="end"){const{mapStart:a,mapEnd:n}=e,s=t(a,n);i.distance=s??ni}}_updateTooltipAreaOrTotalLength(i){const{geometry:e}=this.graphic;if(e==null)return;const t=this._graphicState.isDraped?"on-the-ground":"absolute-height";i.area=e.type==="polygon"?wl(e,t):null,i.totalLength=e.type==="polyline"?kr(e,t):null}get test(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}};function vs(i,e){return Math.atan2(e[1]-i[1],e[0]-i[0])+Math.PI/2}function Lh(i,e,t,a,n){if(i){const s=n.toXYZ(n.pointToVector(t)),o=Er(a,s,y.get()),r=Zr(o,s,n.spatialReference);if(r!=null)return si(r.value*Math.sign(e),r.unit)}return si(e*Ta(t.spatialReference),"meters")}h([d()],H.prototype,"_editGeometryOperations",void 0),h([d()],H.prototype,"_segmentLabels",void 0),h([d({constructOnly:!0})],H.prototype,"tool",void 0),h([d()],H.prototype,"_tooltip",void 0),h([d()],H.prototype,"inputGeometry",null),h([d()],H.prototype,"outputGeometry",void 0),h([d({readOnly:!0})],H.prototype,"updating",null),h([d()],H.prototype,"manipulators",null),h([d()],H.prototype,"view",null),h([d()],H.prototype,"graphic",null),h([d()],H.prototype,"enableZShape",null),h([d()],H.prototype,"enableZVertex",null),h([d()],H.prototype,"enableMoveGraphic",null),h([d()],H.prototype,"enableMidpoints",null),h([d()],H.prototype,"enableEdgeOffset",null),h([d()],H.prototype,"_labelOptions",null),h([d()],H.prototype,"_tooltipOptions",null),H=h([K("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],H);const Yt=Vt(0,0,void 0,Tr.WGS84),wi=b(),fa=1e-6;var xe,C,$t;(function(i){i.Vertex=q.Custom1,i.Edge=q.Custom2})(xe||(xe={})),function(i){i[i.NONE=0]="NONE",i[i.MOVING=1]="MOVING",i[i.RESHAPING=2]="RESHAPING"}(C||(C={})),function(i){i[i.ALL=0]="ALL",i[i.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}($t||($t={}));let te=class extends We.EventedMixin(ia){constructor(e){super(e),this._handles=new jt,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.labelOptions=new ks,this.tooltipOptions=new rt,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const e=this._reshapeOperation=new H({tool:this});this.addHandles([e.on("reshape",t=>{t.type==="reshape"&&this._onReshapeGeometryChanged(),this.emit("reshape",t)}),e.on("move",t=>{t.type==="move"&&this._onReshapeGeometryChanged(),this.emit("move",t)}),e.on("vertex-add",t=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",t)}),e.on("vertex-remove",t=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",t)}),e.on("immediate-click",t=>this.emit("immediate-click",t)),this.view.on("pointer-down",["Shift"],t=>t.stopPropagation()),D(()=>this.graphic,()=>this._updateGraphic(),Gt)]),this.finishToolCreation()}destroy(){this._handles=L(this._handles),this._reshapeOperation=L(this._reshapeOperation)}get updating(){var e;return((e=this._reshapeOperation)==null?void 0:e.updating)??!1}_updateGeometry(){const e=$r(this.graphic);this._reshapeOperation.inputGeometry=e!=null?e.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),Rr(this.graphic)!==Fs.SUPPORTED)return;const e=D(()=>{var t;return(t=this.graphic)==null?void 0:t.geometry},()=>{this._internalGeometryUpdate===!1&&this._updateGeometry()},zi);this._handles.add(e,"onGraphicGeometryChange")}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}_updateGeometryInternally(e){this._internalGeometryUpdate=!0;const{graphic:t}=this,{geometry:a}=t;(a==null?void 0:a.type)==="mesh"&&e.type==="point"?(t.geometry=a.centerAt(e),t.notifyGeometryChanged()):t.geometry=e,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){const{outputGeometry:e}=this._reshapeOperation;this.graphic!=null&&e&&this._updateGeometryInternally(e.clone())}get canUndo(){return this._reshapeOperation.canUndo??!1}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping();const e=this._reshapeOperation.undo(),{outputGeometry:t}=this._reshapeOperation;e&&t&&this._updateGeometryInternally(t.clone())}get canRedo(){return this._reshapeOperation.canRedo??!1}redo(){this.snappingManager!=null&&this.snappingManager.doneSnapping();const e=this._reshapeOperation.redo(),{outputGeometry:t}=this._reshapeOperation;e&&t&&this._updateGeometryInternally(t.clone())}onInputEvent(e){e.type!=="key-down"||e.key!=="Delete"&&e.key!=="Backspace"||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}};h([d()],te.prototype,"_reshapeOperation",void 0),h([d({constructOnly:!0,nonNullable:!0})],te.prototype,"view",void 0),h([d({constructOnly:!0})],te.prototype,"graphic",void 0),h([d({constructOnly:!0,nonNullable:!0})],te.prototype,"enableZShape",void 0),h([d({constructOnly:!0,nonNullable:!0})],te.prototype,"enableZVertex",void 0),h([d({constructOnly:!0,nonNullable:!0})],te.prototype,"enableMoveGraphic",void 0),h([d({constructOnly:!0,nonNullable:!0})],te.prototype,"enableMidpoints",void 0),h([d({constructOnly:!0,nonNullable:!0})],te.prototype,"enableEdgeOffset",void 0),h([d()],te.prototype,"type",void 0),h([d({constructOnly:!0,type:ks})],te.prototype,"labelOptions",void 0),h([d({constructOnly:!0,type:rt})],te.prototype,"tooltipOptions",void 0),h([d({constructOnly:!0})],te.prototype,"snappingManager",void 0),h([d()],te.prototype,"updating",null),h([d()],te.prototype,"automaticManipulatorSelection",void 0),te=h([K("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],te);let Ue=class extends Ji{constructor(e){super(e),this.type="transform-rotate",this.rotation=null,this.rotationPrecision=null,this.orientation=null,this.orientationPrecision=null,this.rotationType="geographic"}};h([d()],Ue.prototype,"type",void 0),h([d()],Ue.prototype,"rotation",void 0),h([d()],Ue.prototype,"rotationPrecision",void 0),h([d()],Ue.prototype,"orientation",void 0),h([d()],Ue.prototype,"orientationPrecision",void 0),h([d()],Ue.prototype,"rotationType",void 0),Ue=h([K("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],Ue);let tt=class extends Ji{constructor(e){super(e),this.type="transform-scale",this.size=null,this.sizeUnit=null,this.sizePrecision=null}};h([d()],tt.prototype,"type",void 0),h([d()],tt.prototype,"scale",void 0),h([d()],tt.prototype,"size",void 0),h([d()],tt.prototype,"sizeUnit",void 0),h([d()],tt.prototype,"sizePrecision",void 0),tt=h([K("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],tt);let Ge=class extends Ji{constructor(e){super(e),this.type="transform-absolute",this.orientation=null,this.orientationPrecision=null,this.rotationType="geographic",this.size=null,this.sizePrecision=null,this.sizeUnit=null}};h([d()],Ge.prototype,"type",void 0),h([d()],Ge.prototype,"orientation",void 0),h([d()],Ge.prototype,"orientationPrecision",void 0),h([d()],Ge.prototype,"rotationType",void 0),h([d()],Ge.prototype,"size",void 0),h([d()],Ge.prototype,"sizePrecision",void 0),h([d()],Ge.prototype,"sizeUnit",void 0),Ge=h([K("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],Ge);var A,Nt;(function(i){i.ScaleIn=q.Custom2,i.ScaleOut=q.Custom3,i.RotateLeft=q.Custom4,i.RotateRight=q.Custom5,i.Unlocked=q.Custom7,i.DelayedFocused=q.Custom8,i.TouchInput=q.Custom12})(A||(A={}));class zh{get angle(){return this._adapter.angle}get scale(){return this._adapter.scale}set location(e){this._ringManipulator.location=e}set elevationAlignedLocation(e){this._ringManipulator.elevationAlignedLocation=e}get grabbing(){return this._ringManipulator.grabbing}set interactive(e){this._ringManipulator.interactive=e}constructor({adapter:e,tooltipOptions:t,mode:a,tool:n}){this._mode=null,this._handles=new jt,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=_h,this.events=new We,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>{var s;return((s=this._scaleRotateDragData)==null?void 0:s.mode)==="scale"?this._adapter.scale:1},this.tool=n,this._mode=a,this._adapter=e,this._tooltipOptions=t,this._tooltip=new pi({view:n.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this._handles.add(yt(()=>!this._tooltipOptions.enabled,()=>this._tooltip.clear(),at))}destroy(){var e;(e=this._activeAnimation)==null||e.frameTask.remove(),this._activeAnimation=null,this._handles=L(this._handles),this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=L(this._tooltip)}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=Dr({update:({deltaTime:a})=>{e.update(a)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){var e;(e=this._activeAnimation)==null||e.frameTask.remove(),this._activeAnimation=L(this._activeAnimation)}forEachManipulator(e){e(this._ringManipulator,I.SCALE_ROTATE)}_createManipulator(){const e=this._createRingManipulator();this._ringManipulator=e,this.tool.manipulators.add(e);const t=this.tool.graphicState.graphic,a=Ae(e,(n,s,o)=>{this._scaleRotateDragData=null;const r=this._adapter.startInteraction(),l={mode:"none",origin:Jt(n.renderLocation),initialAngle:this._adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=l,this._updateDragState();const c=y.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(n.renderLocation,c),s.next(Bi(this.tool.view,Pt(n.renderLocation,c,ci()))).next(p=>{const g=hi(p.plane),u=fo(p.renderStart,p.renderEnd,l.origin,g),_=Ir.shortestSignedDiff(l.angle,u);l.angleDir=Ii(l.angleDir+_,-cs,cs),l.angle=u;const m=Nh(l,p),f=m-this._adapter.scale;if(l.scaleDir=Ii(l.scaleDir+f,-ls,ls),this._onScaleChanged(),l.mode==="none"){const v=this._mode||Vh(p,p.plane,l.origin,this.tool.view.state.camera);if(v!=null){switch(v){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:t,angle:0}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:t,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()})}l.mode=v}}switch(l.mode){case"rotate":r.state.angle=l.initialAngle+u;break;case"scale":r.state.scale=m,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),p.action){case"start":case"update":switch(l.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:t,angle:ai(l.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:t,xScale:m,yScale:m})}break;case"end":switch(l.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:ai(l.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:m,yScale:m})}}return p.action==="end"&&(this.startAnimation(ys(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState(),r.done()),p}).next(this._updateTooltipPipelineStep(l)),o.next(()=>{if(r.cancel(),this._scaleRotateDragData!=null){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:1,yScale:1})}this.startAnimation(ys(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()})});this._handles.add([a,e.events.on("focus-changed",n=>{n.action==="focus"?this.startAnimation(jh(this,()=>this._updateDelayedFocusedState(),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()}),e.events.on("immediate-click",n=>{n.stopPropagation()}),D(()=>{var n;return(n=this.tool.graphicState)==null?void 0:n.displaying},n=>this._ringManipulator.available=n,at)])}_updateTooltipPipelineStep(e){return t=>{const a=this._tooltipOptions;if(!a.enabled)return t;if(t.action==="end")return this._updateFocusTooltip(),t;const n=this._tooltip,s=this._tooltipOptions.visualVariables;switch(e.mode){case"scale":{const{size:o,scale:r}=this._adapter,l=s==null?void 0:s.size;n.info=new tt({tooltipOptions:a,scale:{value:r},size:o!=null?si(o,"meters"):void 0,sizePrecision:Oi(l==null?void 0:l.valueType),sizeUnit:l==null?void 0:l.unit});break}case"rotate":{const{orientationClockwise:o,relativeAngleClockwise:r}=this._adapter,l=s==null?void 0:s.rotation,c=Oi(l==null?void 0:l.valueType);n.info=new Ue({tooltipOptions:a,rotation:r!=null?pa(r,"radians","geographic"):void 0,rotationPrecision:c,rotationType:(l==null?void 0:l.rotationType)??"geographic",orientation:o!=null?pa(o,"radians","geographic"):void 0,orientationPrecision:c})}}return t}}_updateFocusTooltip(){if(this._tooltipOptions.enabled)if(this.getFocused()){const e=this._tooltipOptions.visualVariables,t=e==null?void 0:e.rotation,a=e==null?void 0:e.size,n=this._mode,{size:s,orientationClockwise:o}=this._adapter,r=o!=null&&(n==null||n==="rotate"),l=s!=null&&(n==null||n==="scale");this._tooltip.info=new Ge({tooltipOptions:this._tooltipOptions,orientation:r?pa(o,"radians","geographic"):void 0,orientationPrecision:Oi(t==null?void 0:t.valueType),rotationType:(t==null?void 0:t.rotationType)??"geographic",size:l?si(s,"meters"):void 0,sizeUnit:a==null?void 0:a.unit,sizePrecision:Oi(a==null?void 0:a.valueType)})}else this._tooltip.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(A.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){var e;if(this._ringManipulator.updateStateEnabled(A.Unlocked,!(this._scaleRotateDragData!=null&&((e=this._scaleRotateDragData)==null?void 0:e.mode)!=="none")),this._scaleRotateDragData!=null)switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(A.ScaleIn|A.ScaleOut,!1),this._ringManipulator.updateStateEnabled(A.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(A.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(A.RotateLeft|A.RotateRight,!1),this._ringManipulator.updateStateEnabled(A.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(A.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(A.ScaleIn|A.ScaleOut|A.RotateLeft|A.RotateRight,!1)}_updateManipulatorTransform(){const e=Ns(ie.get(),this._adapter.angle,N(0,0,1));if(e==null)return;const t=this.getScale(),a=Li(ie.get(),X(y.get(),t,t,t));this._ringManipulator.modelTransform=Le(ie.get(),a,e)}_createRingManipulator(){const e=(T,ae,B)=>{const pe=[],se=Math.ceil(bo*(ae-T)/(2*Math.PI));for(let j=0;j<se+1;j++){const Ft=T+j*(ae-T)/se;pe.push(N(B*Math.cos(Ft),B*Math.sin(Ft),0))}return pe},t=T=>e(0,2*Math.PI,T),a=T=>[[-T/2,0],[T/2,0],[T/2,_a/2],[-T/2,_a/2]],n=this._createMaterial(1),s=(T,ae,B=n)=>Js(B,a(ae),T,[],[],!1),o=t(gt),r=s(o,ma),l={left:new Array,right:new Array},c=[];for(let T=0;T<2;T++){const ae=T*Math.PI-Math.PI/4,B=Math.PI/2-dh,pe=ae+B,se=ae+Math.PI/2-B,j=e(pe,se,hh),Ft=s(j,xt);c.push(j),c.push(e(pe,se,as-ma/2)),l.left.push(Ft),l.right.push(Ft.instantiate());for(let ca=0;ca<2;ca++){const on=ca===0,ge=fe();if(on){It(ge,ge,[1,-1,1]),bn(ge,ge,-pe,[0,0,1]);const lt=Math.round(ss*(j.length-1));ge[12]=j[lt][0],ge[13]=j[lt][1],ge[14]=j[lt][2]}else{bn(ge,ge,se,[0,0,1]);const lt=Math.round((1-ss)*(j.length-1));ge[12]=j[lt][0],ge[13]=j[lt][1],ge[14]=j[lt][2]}const rn=ji(n,ph,0,uh,_a);Qs(rn,ge),(on?l.left:l.right).push(rn)}}const p=[];for(let T=0;T<2;T++){const ae=T*Math.PI-Math.PI/4,B=Math.PI/2-gh,pe=ae+B,se=ae+Math.PI/2-B,j=e(pe,se,as);p.push(s(j,xt))}const g=this._createMaterial(.66),u=this._createMaterial(.5),_=this._createMaterial(.33),m=t(gt+os),f=t(gt+rs),v=s(m,xt,g),x=s(f,xt,_),w=t(gt-os),O=t(gt-rs),V=s(w,xt,g),G=s(O,xt,_);let he=[new S(r,A.DelayedFocused),new S(r.instantiate({material:u}),M.None)];this._mode&&this._mode!=="scale"||(he=he.concat([...p.map(T=>new S(T,A.DelayedFocused|A.Unlocked)),new S(v,A.DelayedFocused|A.ScaleIn),new S(x,A.DelayedFocused|A.ScaleIn),new S(V,A.DelayedFocused|A.ScaleOut),new S(G,A.DelayedFocused|A.ScaleOut)])),this._mode&&this._mode!=="rotate"||(he=he.concat([...l.right.map(T=>new S(T.instantiate(),A.DelayedFocused|A.Unlocked)),...l.left.map(T=>new S(T,A.DelayedFocused|A.RotateLeft)),...l.right.map(T=>new S(T,A.DelayedFocused|A.RotateRight))]));const ye=[o,...c];return new ce({view:this.tool.view,renderObjects:he,autoScaleRenderObjects:!1,worldOriented:!0,radius:ma,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:Z(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:ye,direction:N(0,0,1)}})}_createMaterial(e){const t=W(this.tool.view).colors.accent.clone();return t.a=e,new Te({color:Y(t),transparent:e!==1,cullFace:Q.Back,renderOccluded:R.Transparent})}get test(){return{ringManipulator:this._ringManipulator,setRingIndicatorDelayMs:e=>this._ringIndicatorDelayMs=e,tooltip:this._tooltip}}}function Nh(i,e){const t=P(y.get(),e.renderStart,i.origin),a=P(y.get(),e.renderEnd,i.origin),n=He(t),s=He(a);return n===0?0:s/n}function Vh(i,e,t,a){const{renderStart:n,renderEnd:s}=i,o=xi(n,a,y.get()),r=xi(s,a,y.get());if(Gs(o,r)<ns*ns)return null;const l=P(y.get(),n,t),c=je(y.get(),l,hi(e)),p=n,g=J(y.get(),p,c),u=xi(t,a,y.get()),_=o,m=xi(g,a,y.get()),f=P(y.get(),m,_),v=P(y.get(),o,u),x=Sn(_,f),w=Sn(u,v);return wn(x,r)<wn(w,r)?"rotate":"scale"}function xi(i,e,t){return e.projectToScreen(i,va),X(t,va[0],va[1],0)}function ys(i,e){let t=null,a=1;const n=()=>a;return{start:()=>{a=i.getScale(),t=i.getScale,i.getScale=n,e()},update:s=>(a+=((a+1)/2-a)*Math.min(s*mh,1),e(),Math.abs(a-1)<.01?Nt.STOP:Nt.CONTINUE),destroy:()=>{t&&(i.getScale=t),e()}}}function jh(i,e,t){let a=0,n=null;const s=()=>!1;return{start:()=>{n=i.getFocused,i.getFocused=s,a=0,e()},update:o=>(a+=o,!(n!=null&&n())||a>=t.delayMs?Nt.STOP:Nt.CONTINUE),destroy:()=>{n&&(i.getFocused=n),e()}}}function Oi(i){switch(i){case"integer":case"long":return 0;default:return null}}(function(i){i[i.CONTINUE=0]="CONTINUE",i[i.STOP=1]="STOP"})(Nt||(Nt={}));const va=Ve();function $o(i){return i.geometry!=null&&i.geometry.type==="mesh"?Hh(i.geometry):Fh(i)}function Hh(i){return i.vertexSpace.isRelative?Uh(i,i.transform,i.vertexSpace):kh(i)}function Fh(i){let e=i.geometry,t=null;return{undo(a){t=a.geometry,a.geometry=e},redo(a){e=a.geometry,a.geometry=t}}}function Uh(i,e,t){let a=e==null?void 0:e.clone(),n=Jt(t.origin),s=null,o=null;return{undo:r=>{var l;s=(l=i.transform)==null?void 0:l.clone(),o=Jt(t.origin),i.transform=a,i.vertexSpace.origin=n,r.notifyMeshTransformChanged()},redo:r=>{var l;a=(l=i.transform)==null?void 0:l.clone(),n=Jt(t.origin),i.transform=s,i.vertexSpace.origin=o,r.notifyMeshTransformChanged()}}}function kh(i){let e,t=i.vertexAttributes.clonePositional();return{undo:a=>{e=i.vertexAttributes.clonePositional(),i.vertexAttributes=t,a.notifyGeometryChanged()},redo:a=>{t=i.vertexAttributes.clonePositional(),i.vertexAttributes=e,a.notifyGeometryChanged()}}}let _e=class extends ka{constructor(i){super(i),this._interactionState=null}initialize(){this.addHandles([yt(()=>{const i=this._interactionState;return i&&i.angle!==i.previousAngle?{interactionState:i,angle:i.state.angle}:null},({interactionState:i})=>{this._updateMeshRotation(i)},zi),yt(()=>{const i=this._interactionState;return i&&i.scale!==i.previousScale?{interactionState:i,scale:i.state.scale}:null},({interactionState:i})=>{this._updateMeshSize(i)},zi)])}get initialAngle(){var i;return((i=this._interactionState)==null?void 0:i.initialAngle)??0}get angle(){var t;const i=this.geometry.transform;if(i==null)return((t=this._interactionState)==null?void 0:t.angle)??0;const e=ic(i.rotation)[2];return Math.abs(e)>.999999?Lt(ac(i.rotation))*Math.sign(e):0}get angleClockwise(){return-this.angle}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){var i;return((i=this._interactionState)==null?void 0:i.scale)??1}startInteraction(){const i=new ke({angle:this.angle});this._interactionState=i;const e=()=>{this._interactionState=null};return{state:i,done:e,cancel:()=>{i.cancel(),e()}}}createUndoRecord(){return $o(this.graphic)}_updateMeshRotation(i){const{angle:e,previousAngle:t}=i;i.previousAngle=e;const{geometry:a}=this,{vertexSpace:n}=a,s=ai(e-t);if(n.isGeoreferenced){const o=!n.isRelative&&this.viewingMode===Aa.Global,r=this.geometry.anchor;this.geometry.rotate(0,0,s,{origin:r,geographic:o}),this.graphic.notifyGeometryChanged()}else{a.transform??(a.transform=new Nn);const{transform:o}=a,r=nc(0,0,s,Zh);o.rotation=sc(o.rotation,r,o.rotation),this.graphic.notifyMeshTransformChanged()}}_updateMeshSize(i){const{scale:e,previousScale:t}=i;i.previousScale=e;const{geometry:a}=this,{vertexSpace:n}=a,s=e/t;if(n.isGeoreferenced){const o=!n.isRelative&&this.viewingMode===Aa.Global,r=this.geometry.anchor;this.geometry.scale(s,{origin:r,geographic:o}),this.graphic.notifyGeometryChanged()}else{a.transform??(a.transform=new Nn);const{transform:o}=a;o.scale=le(o.scale,o.scale,s),this.graphic.notifyMeshTransformChanged()}}};h([d({constructOnly:!0})],_e.prototype,"graphic",void 0),h([d({constructOnly:!0})],_e.prototype,"geometry",void 0),h([d({constructOnly:!0})],_e.prototype,"viewingMode",void 0),h([d()],_e.prototype,"initialAngle",null),h([d()],_e.prototype,"angle",null),h([d()],_e.prototype,"angleClockwise",null),h([d()],_e.prototype,"relativeAngle",null),h([d()],_e.prototype,"relativeAngleClockwise",null),h([d()],_e.prototype,"scale",null),h([d()],_e.prototype,"_interactionState",void 0),_e=h([K("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],_e);let ke=class extends Wi{get state(){const{angle:e,scale:t}=this;return{angle:e,scale:t}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=e.angle,this.previousAngle=e.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};h([d()],ke.prototype,"angle",void 0),h([d()],ke.prototype,"initialAngle",void 0),h([d()],ke.prototype,"previousAngle",void 0),h([d()],ke.prototype,"previousScale",void 0),h([d()],ke.prototype,"scale",void 0),h([d()],ke.prototype,"state",null),ke=h([K("InteractionState")],ke);const Zh=tc();let F=class extends ka{constructor(e){super(e),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles(yt(()=>this._interactionState!=null?this._interactionState.state:null,e=>{this._updateSymbol(e)},zi))}get initialAngle(){var e;return((e=this._interactionState)==null?void 0:e.initialAngle)??0}get angle(){return this._interactionState!=null?this._interactionState.angle:this._orientationReferenceSymbolLayer!=null?Xh(this._orientationReferenceSymbolLayer.heading??0):0}get angleClockwise(){return-this.angle}get orientation(){return this.angle}get orientationClockwise(){return this.angleClockwise}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){var e;return((e=this._interactionState)==null?void 0:e.scale)??1}get size(){const e=this._sizeReferenceSymbolLayer;if(e==null)return null;const t=this.findLayerView(),a=this._graphicSymbol;if(t==null||a==null||a.type!=="point-3d")return null;const n=t.getSymbolLayerSize(a,e);if("size"in n&&n.size!=null)return n.size;const s=this.sizeAxis;return!("width"in n)||n.width==null||s!=null&&s!=="width"&&s!=="all"&&s!=="width-and-depth"?!("depth"in n)||e.depth==null||s!=null&&s!=="depth"&&s!=="all"&&s!=="width-and-depth"?!("height"in n)||e.height==null||s!=null&&s!=="height"&&s!=="all"?null:n.height:n.depth:n.width}get _sizeReferenceSymbolLayer(){const e=this._graphicSymbol;return e==null||e.symbolLayers.length===0?null:e.symbolLayers.find(t=>t.type==="object")}get _orientationReferenceSymbolLayer(){const e=this._graphicSymbol;return e==null||e.symbolLayers.length===0?null:e.symbolLayers.find(t=>t.type==="object"&&t.heading!=null)}get _graphicSymbol(){return this.graphic!=null&&this.graphic.symbol!=null&&this.graphic.symbol.type==="point-3d"?this.graphic.symbol:null}set _graphicSymbol(e){this.graphic.symbol=e}startInteraction(){const e=this._graphicSymbol,t=this.findLayerView();if(this._interactionState!=null||e==null||t==null)return Bh;const a=e.symbolLayers.map(l=>l.type==="object"?t.getSymbolLayerSize(e,l):null).toArray(),n=e.clone(),s=this.angle,o=new Ze({originalSymbol:n,angle:s,initialSizes:a});this._interactionState=o;const r=()=>{this._interactionState=null};return{state:o,done:r,cancel:()=>{this._graphicSymbol=n,r()}}}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:a=>{t=a.symbol,a.symbol=e},redo:a=>{e=a.symbol,a.symbol=t}}}_updateSymbol({scale:e,angle:t,originalSymbol:a,initialSizes:n}){const s=this._graphicSymbol;if(s==null||s.type!=="point-3d")return;const o=s.clone(),r=-ai(t-this.initialAngle);let l=!1;this._forEachObjectSymbolLayerPair(a,o,(c,p,g)=>{const u=(c.heading??0)+r;p.heading!==u&&(p.heading=u,l=!0);const _=n[g];if(_!=null&&"width"in _){_.width=this.sizeFilter(_.width),_.height=this.sizeFilter(_.height),_.depth=this.sizeFilter(_.depth);const m=_.width*e;p.width!==m&&(p.width=m,l=!0);const f=_.depth*e;p.depth!==f&&(p.depth=f,l=!0);const v=_.height*e;p.height!==v&&(p.height=v,l=!0)}}),l&&(this._graphicSymbol=o)}_forEachObjectSymbolLayerPair(e,t,a){e.symbolLayers.forEach((n,s)=>{const o=t.symbolLayers.at(s);n.type==="object"&&o.type==="object"&&a(n,o,s)})}};function Xh(i){return-Lt(i)}h([d()],F.prototype,"initialAngle",null),h([d()],F.prototype,"angle",null),h([d()],F.prototype,"angleClockwise",null),h([d()],F.prototype,"orientation",null),h([d()],F.prototype,"orientationClockwise",null),h([d()],F.prototype,"relativeAngle",null),h([d()],F.prototype,"relativeAngleClockwise",null),h([d()],F.prototype,"scale",null),h([d()],F.prototype,"size",null),h([d()],F.prototype,"sizeAxis",void 0),h([d({constructOnly:!0})],F.prototype,"graphic",void 0),h([d()],F.prototype,"_interactionState",void 0),h([d({constructOnly:!0})],F.prototype,"findLayerView",void 0),h([d({constructOnly:!0})],F.prototype,"sizeFilter",void 0),h([d()],F.prototype,"_sizeReferenceSymbolLayer",null),h([d()],F.prototype,"_orientationReferenceSymbolLayer",null),h([d()],F.prototype,"_graphicSymbol",null),F=h([K("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],F);const Bh={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let Ze=class extends Wi{get state(){const{originalSymbol:i,angle:e,initialAngle:t,scale:a,initialSizes:n}=this;return{originalSymbol:i,angle:e,initialAngle:t,scale:a,initialSizes:n}}constructor(i){super(i),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=i.angle}};h([d()],Ze.prototype,"originalSymbol",void 0),h([d()],Ze.prototype,"angle",void 0),h([d()],Ze.prototype,"initialAngle",void 0),h([d()],Ze.prototype,"initialSizes",void 0),h([d()],Ze.prototype,"scale",void 0),h([d()],Ze.prototype,"state",null),Ze=h([K("InteractionState")],Ze);let ue=class extends Hs(We.EventedMixin(ia)){constructor(i){super(i),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new rt,this.type="transform-3d",this._scaleRotate=null,this._tooltip=null}initialize(){const{graphic:i,view:e}=this;this.graphicState=new bt({graphic:i}),this.addHandles(D(()=>this.tooltipOptions.enabled,s=>{this._tooltip=s?new pi({view:e}):L(this._tooltip)},Gt)),this._moveManipulation=new ft({tool:this,view:e,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&mt(i),radius:ft.radiusForSymbol(i.symbol)}),this._moveManipulation.forEachManipulator(s=>this.handles.add(s.events.on("immediate-click",o=>{this.emit("immediate-click",{...o,graphic:i}),o.stopPropagation()})));const t=s=>o=>{this.handles.add(o.events.on("focus-changed",({action:r})=>{const l=this._tooltip;l!=null&&(r==="focus"?this._updateMoveTooltip(s):l.clear())}))};this._moveManipulation.xyManipulation.forEachManipulator(t(E.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(t(E.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(t(E.Z));const a=Z(i);this._moveManipulation.elevationInfo=a,this.addHandles(tn(this.graphicState));const{geometry:n}=i;if(this._moveManipulation.createGraphicDragPipeline((s,o,r,l,c)=>{if(n!=null&&s===E.XY){const{snappingStep:p,cancelSnapping:g}=ki({snappingContext:new Ui({elevationInfo:a,pointer:c,editGeometryOperations:ta.fromGeometry(new Rt({spatialReference:n.spatialReference}),e.state.viewingMode),visualizer:new ri,excludeFeature:i}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,useZ:!1});l=l.next(g),r=r.next(Ul(this.view,a)).next(...p)}return{steps:r=r.next(p=>(this._updateMoveTooltip(s,p),p)),cancel:l}},this.graphicState,s=>{const{action:o,graphic:r,dxScreen:l,dyScreen:c}=s,p={graphic:r,dxScreen:l,dyScreen:c};switch(o){case"start":this.emit("graphic-translate-start",p),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",p);break;case"end":this.emit("graphic-translate-stop",p)}}),this._moveManipulation.angle=this._scaleRotate!=null?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.handles.add(D(()=>this._scaleRotateAdapter.angle,()=>this._updateMoveAngle())),this.enableScaling||this.enableRotation){const s=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new zh({tool:this,mode:s,adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.handles.add(this._scaleRotate.events.on("scale-changed",()=>this._onScaleChanged()))}this.handles.add([sa({view:this.view,graphic:this.graphic,forEachManipulator:s=>this._forEachManipulator(s),onManipulatorsChanged:()=>Pe()}),this.graphicState.on("changed",()=>this._onGeometryChanged()),this._hideManipulatorsForGraphicState(),D(()=>e.scale,()=>this._updateMoveAngle())]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator(s=>{s instanceof ce&&this.handles.add(s.events.on("grab-changed",()=>this._updateManipulatorsInteractive()))}),this.finishToolCreation()}destroy(){this._tooltip=L(this._tooltip),this._moveManipulation.destroy(),this._scaleRotate=L(this._scaleRotate),this._scaleRotateAdapter=L(this._scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}_updateManipulatorsInteractive(){this._scaleRotate!=null&&(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){var i,e,t;return this.graphic.geometry!=null&&this.graphic.geometry.type==="mesh"?new _e({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new F({graphic:this.graphic,sizeFilter:a=>this._enforceNonZeroSize(a),findLayerView:()=>this.view.allLayerViews.find(a=>a.layer===this.graphic.layer),sizeAxis:((t=(e=(i=this.tooltipOptions)==null?void 0:i.visualVariables)==null?void 0:e.size)==null?void 0:t.axis)??null})}_forEachManipulator(i){var e,t;(e=this._moveManipulation)==null||e.forEachManipulator(i),(t=this._scaleRotate)==null||t.forEachManipulator(i)}_hideManipulatorsForGraphicState(){return D(()=>this.graphicState.displaying,i=>{this._forEachManipulator(e=>e.available=i),this._moveManipulation.zManipulation.available=i&&this.enableZ&&mt(this.graphic)})}_createGeometryUndoRecord(){return $o(this.graphic)}set snapToScene(i){this._moveManipulation&&(this._moveManipulation.snapToScene=i),this._set("snapToScene",i)}get updating(){return this.updatingHandles.updating}set location(i){this._moveManipulation.location=i,this._scaleRotate&&(this._scaleRotate.location=i)}set elevationAlignedLocation(i){this._moveManipulation.elevationAlignedLocation=i,this._scaleRotate&&(this._scaleRotate.elevationAlignedLocation=i)}reset(){}onHide(){var i;(i=this._scaleRotate)==null||i.cancelActiveAnimation()}_onScaleChanged(){this._scaleRotate!=null&&(this._moveManipulation.displayScale=this._scaleRotate.getScale())}_updateMoveAngle(){this.view.state.viewingMode===Aa.Local||this.view.scale<fh?this._moveManipulation.angle=this._scaleRotateAdapter.angle:this._moveManipulation.angle=0}_onGeometryChanged(){yo(this.view,this,this.graphic)}_enforceNonZeroSize(i){return i||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}_updateMoveTooltip(i,e){const{tooltipOptions:t,_tooltip:a}=this;if(a==null)return;a.clear();const n=this.graphicState.isDraped?"on-the-ground":"absolute-height";switch(i){case E.XY:a.info=new oi({tooltipOptions:t}),this._updateMoveTooltipDistance(a.info,e,(s,o)=>qe(s,o,n));break;case E.XY_AXIS:a.info=new en({tooltipOptions:t}),this._updateMoveTooltipDistance(a.info,e,(s,o)=>{const r=qe(s,o,n);return Vi(r,Yi(e))});break;case E.Z:a.info=new aa({tooltipOptions:t}),this._updateMoveTooltipDistance(a.info,e,Ni)}}_updateMoveTooltipDistance(i,e,t){if(e!=null&&e.action!=="end"){const{mapStart:a,mapEnd:n}=e,s=t(a,n);i.distance=s??ni}}get test(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:this._scaleRotate!=null?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,setRingIndicatorDelayMs:i=>this._scaleRotate!=null?this._scaleRotate.test.setRingIndicatorDelayMs(i):null,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}};h([d({constructOnly:!0,nonNullable:!0})],ue.prototype,"view",void 0),h([d({constructOnly:!0,nonNullable:!0})],ue.prototype,"graphic",void 0),h([d({constructOnly:!0,nonNullable:!0})],ue.prototype,"enableZ",void 0),h([d()],ue.prototype,"enableRotation",void 0),h([d()],ue.prototype,"enableScaling",void 0),h([d({constructOnly:!0,type:rt})],ue.prototype,"tooltipOptions",void 0),h([d()],ue.prototype,"graphicState",void 0),h([d({value:!1})],ue.prototype,"snapToScene",null),h([d({constructOnly:!0})],ue.prototype,"snappingManager",void 0),h([d({readOnly:!0})],ue.prototype,"type",void 0),h([d({readOnly:!0})],ue.prototype,"updating",null),ue=h([K("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],ue);let et=class extends Gr(Cr){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&Pr(this.position,e.position)&&this.width===e.width&&this.height===e.height}};h([d({readOnly:!0,json:{read:!1,write:!0}})],et.prototype,"type",void 0),h([d({type:Rt}),kt()],et.prototype,"position",void 0),h([d({type:Number,nonNullable:!0,range:{min:0,max:360}}),kt(),xn(i=>On.normalize(En(i),0,!0))],et.prototype,"heading",void 0),h([d({type:Number,nonNullable:!0,range:{min:0,max:360}}),kt(),xn(i=>On.normalize(En(i),0,!0))],et.prototype,"tilt",void 0),h([d({type:Number,nonNullable:!0}),kt()],et.prototype,"width",void 0),h([d({type:Number,nonNullable:!0}),kt()],et.prototype,"height",void 0),et=h([K("esri.analysis.SlicePlane")],et);let Yh=class{constructor(){this.color=ot()}},qh=class{constructor(){this.color=new ne([0,0,0,.04]),this.gridColor=ot(.5),this.outlineColor=ot(.7)}};class Wh{constructor(){this.color=ot()}}let Qh=class{constructor(){this.color=ot(.5),this.contrastColor=Zs()}},Jh=class{constructor(){this.color=Zs(),this.outlineColor=ot()}},Kh=class{constructor(){this.callouts=new Yh,this.plane=new qh,this.resizeManipulators=new Wh,this.rotateManipulators=new Qh,this.shiftManipulator=new Jh}};new Kh;js("mac");const ep=2,tp=1.15,ip=1.15,ap=3,Ro=11,za=22.5,ya=40,Ms=48,np=2.25,sp=4,bs=1,op=.3,rp=6,lp=4;function cp(i){const e=new Xa,{vertex:t,fragment:a,attributes:n,varyings:s}=e;return Ba(t,i),n.add($.POSITION,"vec3"),n.add($.UV0,"vec2"),s.add("vUV","vec2"),t.code.add(k`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),a.uniforms.add(new Fi("backgroundColor",o=>o.backgroundColor),new Fi("gridColor",o=>o.gridColor),new Hi("gridWidth",o=>o.gridWidth)),a.code.add(k`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),e}const hp=Object.freeze(Object.defineProperty({__proto__:null,build:cp},Symbol.toStringTag,{value:"Module"}));class sn extends Ya{initializeProgram(e){return new qa(e.rctx,sn.shader.get().build(this.configuration),Ps)}initializePipeline(){return Qa({blending:Il(Tt.ONE,Tt.ONE,Tt.ONE_MINUS_SRC_ALPHA,Tt.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ti.LESS},colorWrite:Ja})}}sn.shader=new Wa(hp,()=>Fa(()=>import("./SlicePlaneMaterial.glsl-8930ae2b.js"),["./SlicePlaneMaterial.glsl-8930ae2b.js","./index-4457faad.js","..\\index-add6cbc1.css","./FloatArray-73ba570e.js","./requestImageUtils-a82830fa.js","./basicInterfaces-bb952591.js","./enums-b14466b3.js","./Texture-53149a07.js","./Indices-836a5a9a.js","./triangle-6e9991e3.js","./doublePrecisionUtils-e3c3d0d8.js","./BufferView-eb3bc1bb.js","./VertexElementDescriptor-2925c6af.js","./VertexArrayObject-79e51137.js","./OrderIndependentTransparency-2a607a9a.js","./analysisThemeUtils-f1446ce8.js","./colorUtils-7d6f3c40.js","./automaticLengthMeasurementUtils-8dfb30c1.js","./spatialReferenceEllipsoidUtils-db62ad95.js","./geometryEngine-d03a7fa9.js","./geometryEngineBase-c813e811.js","./hydrated-263631bb.js","./GraphicState-661b7831.js","./vec4f32-0d1b2306.js","./Octree-30686065.js","./line-497a8ea9.js","./DoubleArray-28266794.js","./hydratedFeatures-1f5e8f4b.js","./triangulationUtils-2852bf6d.js","./earcut-938ec344.js","./deduplicate-34be5e74.js","./NestedMap-1b5db22e.js","./InterleavedLayout-2de7b1c4.js","./types-1305598a.js","./floatRGBA-45eb4edf.js","./glUtil-0b7ee6ea.js","./NativeLineMaterial-e970214a.js","./VertexColor.glsl-93211d70.js","./SnappingContext-e7d6e9d1.js","./PointSnappingHint-d54b5dad.js","./interfaces-1a80c8eb.js","./editPlaneUtils-ca90478a.js","./centroid-a42e4503.js","./GraphicManipulator-6e001305.js","./drapedUtils-b7424887.js","./TranslateTooltipInfos-3d780604.js","./MeshTransform-36f32e46.js","./persistable-c363ec8b.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-bc302e8d.js","./ExtentTooltipInfos-a381d85c.js"],import.meta.url));function pp(i,e){return vo(i.basis1,i.basis2,i.origin,e)}function up(i,e,t,a){const n=e.worldUpAtPosition(i.origin,y.get()),s=y.get();switch(t){case li.HEADING:oe(s,n);break;case li.TILT:oe(s,i.basis1)}return Pt(i.origin,s,a)}function dp(i,e,t,a){const n=He(a.basis1),s=He(a.basis2),o=Do(a),r=Na(a),l=X(y.get(),0,0,0);J(l,le(y.get(),a.basis1,e.direction[0]),le(y.get(),a.basis2,e.direction[1])),J(l,a.origin,l);let c=0,p=1;if(la(e))e.direction[0]===1&&e.direction[1]===-1?c=ja:e.direction[0]===1&&e.direction[1]===1?c=Math.PI:e.direction[0]===-1&&e.direction[1]===1&&(c=3*Math.PI/2),p=r;else{const u=e.direction[0]!==0?1:2;c=u===1?ja:0,p=(u===1?s:n)-o}const g=Ua(ie.get(),c);It(g,g,X(y.get(),p,p,p)),Le(g,t,g),g[12]=0,g[13]=0,g[14]=0,i.modelTransform=g,i.renderLocation=l}function gp(i,e,t,a){const n=a.worldUpAtPosition(t.origin,y.get()),s=_p(t,_t.POSITIVE_X),o=Ua(ie.get(),s.edge*Math.PI/2);Vs(o,o,-bp(t,n)),Le(o,e,o),o[12]=0,o[13]=0,o[14]=0,i.modelTransform=o,i.renderLocation=s.position}var _t;function _p(i,e){switch(e){case _t.POSITIVE_X:return{basis:i.basis1,direction:1,position:J(y.get(),i.origin,i.basis1),edge:e};case _t.POSITIVE_Y:return{basis:i.basis2,direction:1,position:J(y.get(),i.origin,i.basis2),edge:e};case _t.NEGATIVE_X:return{basis:i.basis1,direction:-1,position:P(y.get(),i.origin,i.basis1),edge:e};case _t.NEGATIVE_Y:return{basis:i.basis2,direction:-1,position:P(y.get(),i.origin,i.basis2),edge:e}}}function Do(i){const e=He(i.basis1),t=He(i.basis2);return op*Math.min(e,t)}function Na(i){return Do(i)}function la(i){return i.direction[0]!==0&&i.direction[1]!==0}function mp(i,e){const t=e.offsetMode===qi.CENTER_ON_CALLOUT?ya:0,a=[N(t,0,-Ms/2),N(t,0,Ms/2)],n=Mp(a,!0),s=(g,u)=>vp(a,g,u,e),o=s(0,!1),r=s(np,!0),l=new Za({color:ne.toUnitRGBA(e.calloutColor),renderOccluded:R.OccludeAndTransparent}),c=ze(l,[[t,0,0],[t-ya,0,0]]),p=ze(l,[[t,0,0],[t-ya,0,0]]);return new ce({view:i,renderObjects:[...o.normal.map(g=>new S(g,M.Unfocused|ut)),...r.normal.map(g=>new S(g,M.Unfocused|ut)),new S(c,M.Unfocused|ut|Va),...o.focused.map(g=>new S(g,M.Focused|ut)),...r.focused.map(g=>new S(g,M.Focused|ut)),new S(p,M.Focused|ut|Va)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[n]},collisionPriority:1,radius:Ro,state:ut})}function fp(i,e,t){const a=la(e),n=a?[N(1,0,0),N(0,0,0),N(0,1,0)]:[N(1,0,0),N(-1,0,0)],s=ne.toUnitRGBA(t.color),o=m=>new zt({color:s,width:m,renderOccluded:R.OccludeAndTransparent}),r=()=>new Za({color:s,renderOccluded:R.OccludeAndTransparent}),l=a?sp:bs,c=l*ep,p=bs,g=m=>m>1?o(m):r(),u=[new S(ze(g(l),n),M.Unfocused|Ai),new S(ze(g(c),n),M.Focused|Ai),new S(ze(g(p),n),Io)],_=new ce({view:i,renderObjects:u,collisionType:{type:"line",paths:[n]},radius:a?rp:lp,...Bc});return _.state=Ai,_}function vp(i,e,t,a){const n=ne.blendColors(a.color,a.outlineColor,.4),s=ne.blendColors(a.color,a.outlineColor,.14),o=new Te({color:ne.toUnitRGBA(a.color),cullFace:Q.Back,renderOccluded:R.Opaque}),r=new Te({color:ne.toUnitRGBA(n),cullFace:Q.Back,renderOccluded:R.Opaque}),l=new Te({color:ne.toUnitRGBA(s),cullFace:Q.Back,renderOccluded:R.Opaque}),c=new Te({color:ne.toUnitRGBA(a.outlineColor),transparent:!0,writeDepth:!1,cullFace:Q.Front,renderOccluded:R.Transparent}),p=g=>{const u=i.slice(0),_=P(y.get(),u[0],u[1]);ve(_,_);const m=P(y.get(),u[u.length-1],u[u.length-2]);if(ve(m,m),e>0){const pe=le(b(),m,-e);u[u.length-1]=J(pe,pe,u[u.length-1]);const se=le(b(),_,-e);u[0]=J(se,se,u[0])}const f=g?ip:1,v=za*f,x=Ro*f,w=xa(ie.get());if(e>0){const pe=v/4,se=X(y.get(),0,pe,0),j=1+e/pe;Ea(w,w,se),It(w,w,X(y.get(),j,j,j)),Ea(w,w,le(se,se,-1/j))}const O=xa(fe()),V=N(0,1,0),G=Tn(fe(),An($n.get(),V,m));G[12]=u[u.length-1][0],G[13]=u[u.length-1][1],G[14]=u[u.length-1][2],Le(G,G,w);const he=yp(ap*(g?tp:1)+e,u,t?c:l);he.transformation=O;const ye=[he],T=Da(t?c:o,v,x,24,!1,!1,!0);T.transformation=G,ye.push(T);const ae=Da(t?c:r,v,x,24,!1,!0,!1);ae.transformation=G,ye.push(ae);const B=Tn(fe(),An($n.get(),V,_));return B[12]=u[0][0],B[13]=u[0][1],B[14]=u[0][2],Le(B,B,w),ye.push(T.instantiate({transformation:B})),ye.push(ae.instantiate({transformation:B})),ye};return{normal:p(!1),focused:p(!0)}}function yp(i,e,t){const a=[];for(let s=0;s<12;s++){const o=s/12*2*Math.PI;a.push([Math.cos(o)*i,Math.sin(o)*i])}return Js(t,a,e,[],[],!1)}function Mp(i,e){const t=P(b(),i[i.length-1],i[i.length-2]);if(ve(t,t),le(t,t,za),J(t,t,i[i.length-1]),e){const a=P(b(),i[0],i[1]);return ve(a,a),le(a,a,za),J(a,a,i[0]),[a,...i,t]}return[...i,t]}function bp(i,e){return Lr(e,i.basis2,i.basis1)+ja}(function(i){i[i.POSITIVE_X=0]="POSITIVE_X",i[i.POSITIVE_Y=1]="POSITIVE_Y",i[i.NEGATIVE_X=2]="NEGATIVE_X",i[i.NEGATIVE_Y=3]="NEGATIVE_Y"})(_t||(_t={}));const ut=q.Custom1;var li,Ss;(function(i){i[i.HEADING=1]="HEADING",i[i.TILT=2]="TILT"})(li||(li={})),function(i){i[i.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",i[i.HORIZONTAL=1]="HORIZONTAL",i[i.VERTICAL=2]="VERTICAL",i[i.TILTED=3]="TILTED"}(Ss||(Ss={}));const Va=q.Custom2;Qi();const ja=Math.PI/2,Ai=q.Custom1,Io=q.Custom2;var qi;(function(i){i[i.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",i[i.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"})(qi||(qi={}));const Sp="theme-style";function wp(i,e){return Tp(Ep(xp(Op(i),e)),e.size)}function xp(i,{accentColor:e,contrastColor:t}){const a=e.toHex(),n=e.a,s=t.toHex(),o=t.a,r=i.getElementsByTagNameNS("http://www.w3.org/2000/svg","style").namedItem(Sp);return r&&(r.innerHTML=`
      .contrast-fill { fill: ${s}; fill-opacity: ${o}; }
      .contrast-stroke { stroke: ${s}; stroke-opacity: ${o};  }
      .accent-fill { fill: ${a}; fill-opacity: ${n}; }
      .accent-stroke { stroke: ${a}; stroke-opacity:  ${n}; }`),i}function Op(i){const e=i.split(",")[1],t=atob(e);return new DOMParser().parseFromString(t,"image/svg+xml")}function Ep(i){const e=new XMLSerializer().serializeToString(i);return`data:image/svg+xml;base64,${btoa(e)}`}function Tp(i,e){const t=new Image(e,e);return t.src=i,t}const Ap="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxwYXRoIGQ9Ik0yOCAwYTI4IDI4IDAgMSAxIDAgNTYgMjggMjggMCAwIDEgMC01NnoiIGNsYXNzPSJhY2NlbnQtZmlsbCIvPjxwYXRoIHN0cm9rZS13aWR0aD0iNC45OSIgZD0iTTIwLjA1IDQwLjg2YTE1LjA1IDE1LjA1IDAgMCAwIDE3LjE0LTEuNSAxNS4wNSAxNS4wNSAwIDAgMCA0LjQ3LTE2LjY1IDE1LjA1IDE1LjA1IDAgMCAwLTIyLjcyLTcuMTUgMTUuMDUgMTUuMDUgMCAwIDAtNS41IDcuMTUiIGNsYXNzPSJjb250cmFzdC1zdHJva2UiLz48cGF0aCBkPSJtMTAuOTcgMzUuNTcgNS4zOCAxMi4wNyA3Ljc5LTEzLjQ3LTEzLjE3IDEuNHoiIGNsYXNzPSJjb250cmFzdC1maWxsIi8+PC9zdmc+",ws=64;function $p(i,e){const{accentColor:t,contrastColor:a,preMultiplyAlpha:n}=e;return i.fromData(`heading-rotate:[accent:${t},contrast:${a},size:${ws}]`,()=>new Ml(wp(Ap,{accentColor:t,contrastColor:a,size:ws}),{mipmap:!0,preMultiplyAlpha:n}))}class Rp{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&this._lastDragEvent!=null&&this._next!=null){const t={...this._lastDragEvent,action:"update"};e&&this._adjustScaleFactors(t),this._next.execute(t)}this._enabled=e}createDragEventPipelineStep(){this._lastDragEvent=null;const e=new Ka;return this._next=e,[t=>(this._lastDragEvent=t.action!=="end"?{...t}:null,this._enabled&&this._adjustScaleFactors(t),t),e]}_adjustScaleFactors(e){const t=la(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):e.handle.direction[0]===0?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}get test(){return{_adjustScaleFactors:e=>this._adjustScaleFactors(e)}}}let de=class extends We.EventedMixin(ia){constructor(i){super(i),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new rt,this._preserveAspectRatio=new Rp,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this._handles=new jt,this._attachmentOrigin=null,this._outlineVisualElement=null,this._mapBounds=gi(),this._mapBoundsStart=gi(),this._zmax=0,this._sizeStart=null,this._displayBounds=gi(),this._displayBoundsStart=gi(),this._displayBoundsMarginStart=0,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._rotateTooltipInfo=null,this._scaleTooltipInfo=null,this._startAngle=0,this._endAngle=0,this._startScale=nt(),this._endScale=nt()}initialize(){var u;const{view:i,graphic:e,manipulators:t,_handles:a}=this,n=W(i).colors,s=this._graphicState=new bt({graphic:e}),o=e.geometry;this._editGeometryOperations=ta.fromGeometry(o,i.state.viewingMode),this._graphicMoveManipulation=new nn({tool:this,view:i,graphicState:s}),this._moveZManipulator=mp(i,{offsetMode:qi.CENTER_ON_CALLOUT,calloutColor:n.accent,color:n.contrast,outlineColor:n.accent}),this._moveZManipulator.state|=Va,a.add([this._createMoveXYGraphicDragPipeline(),D(()=>this.enableZ,()=>this._updateManipulatorAvailability(this._moveZManipulator,I.TRANSLATE_Z)),this._createMoveZDragPipeline()]),t.add(this._moveZManipulator),this._resizeManipulators=this._resizeHandles.map(_=>{const m=fp(i,_,{color:n.accent});return a.add([D(()=>this.enableScaling,()=>this._updateManipulatorAvailability(m,I.SCALE)),m.events.on("grab-changed",f=>this._onResizeGrab(f)),this._createResizeDragPipeline(m,_)]),m}),t.addMany(this._resizeManipulators);const r=!((u=this.view._stage)!=null&&u.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result);this._rotateManipulatorTexture=$p(i.toolViewManager.textures,{accentColor:Bl(n.accent,.5),contrastColor:n.contrast,preMultiplyAlpha:r}),this._rotateManipulator=Zc(i,{calloutColor:Y(n.accent),texture:this._rotateManipulatorTexture.texture}),a.add([D(()=>this.enableRotation,()=>this._updateManipulatorAvailability(this._rotateManipulator,I.ROTATE)),this._rotateManipulator.events.on("grab-changed",_=>{this._onRotateGrab(_)}),this._createRotateDragPipeline(this._rotateManipulator)]),t.add(this._rotateManipulator),this._calculateMapBounds(),this._updateDisplayBounds();const l=sa({view:i,graphic:e,forEachManipulator:_=>this._forEachManipulator(_),onManipulatorsChanged:()=>Pe()});l!=null&&(this._outlineVisualElement=l.visualElement instanceof Mt?l.visualElement:null),this._outlineVisualElement!=null&&a.add(this._outlineVisualElement.events.on("attachment-origin-changed",()=>this._updateDisplayBounds())),a.add(l),a.add([s.on("changed",()=>this._onGeometryChanged()),D(()=>s.displaying,()=>this._updateAllManipulatorAvailability()),D(()=>s.isDraped,()=>this._graphicDrapedChanged(),at),i.trackGraphicState(s)]);const c=i.pointsOfInterest;a.add(D(()=>c==null?void 0:c.centerOnSurfaceFrequent.location,()=>this._updateDisplayBounds()));const p=_=>{a.add(_.events.on("grab-changed",()=>{this.grabbing=_.grabbing,this._updateAllManipulatorAvailability()}))};this._forEachManipulator(p);const g=(_,m)=>{a.add(_.events.on("immediate-click",f=>{m===I.TRANSLATE_XY&&this.emit("immediate-click",{...f,graphic:e}),f.stopPropagation()}))};this._forEachManipulator(g),this._onGeometryChanged(),this._updateAllManipulatorAvailability(),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._mapBounds=null,this._displayBounds=null,this._rotateManipulatorTexture.release(),this._handles.destroy(),this._graphicMoveManipulation.destroy(),this._editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null)}_initializeTooltip(){const{_handles:i,view:e}=this,t=this._tooltip=new pi({view:e}),a=()=>{t.info=this._getUpdatedTooltipInfo()};i.add([this.on("graphic-translate-start",a),this.on("graphic-translate",a),this.on("graphic-translate-stop",()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._tooltip.clear()}),this.on("graphic-rotate-start",n=>{this._startAngle=n.angle,a()}),this.on("graphic-rotate",n=>{this._endAngle=n.angle,a()}),this.on("graphic-rotate-stop",()=>{this._startAngle=0,this._endAngle=0,a()}),this.on("graphic-scale-start",n=>{Xe(this._startScale,n.xScale,n.yScale),Xe(this._endScale,n.xScale,n.yScale),a()}),this.on("graphic-scale",n=>{Xe(this._endScale,n.xScale,n.yScale),a()}),this.on("graphic-scale-stop",()=>{Xe(this._startScale,0,0),Xe(this._endScale,0,0),a()})]),this._forEachManipulator(n=>{i.add([n.events.on("focus-changed",a),n.events.on("grab-changed",a),n.events.on("drag",s=>{s.action==="cancel"?this._tooltip.clear():a()})])})}_getUpdatedTooltipInfo(){return this.tooltipOptions.enabled?this._graphicMoveManipulation.grabbing||this._graphicMoveManipulation.dragging?this._computeMoveXYTooltipInfo():this._moveZManipulator.focused?this._computeMoveZTooltipInfo():this._rotateManipulator.focused?this._computeRotateTooltipInfo():this._resizeManipulators.some(i=>i.focused)?this._computeScaleTooltipInfo():null:null}_computeMoveXYTooltipInfo(){return this._moveXYTooltipInfo??(this._moveXYTooltipInfo=new oi({tooltipOptions:this.tooltipOptions}))}_computeMoveZTooltipInfo(){const i=this._moveZTooltipInfo??(this._moveZTooltipInfo=new aa({tooltipOptions:this.tooltipOptions})),e=this._moveUnit;if(this._moveZManipulator.dragging){const t=this._mapBoundsStart.origin,a=this._mapBounds.origin,n=Xr(t,a,this.view.spatialReference);if(n==null)return null;i.distance=n}else i.distance=si(0,e);return i}_computeRotateTooltipInfo(){const i=this._rotateTooltipInfo??(this._rotateTooltipInfo=new oc({tooltipOptions:this.tooltipOptions}));return i.angle=this._startAngle-this._endAngle,i}_computeScaleTooltipInfo(){const i=this.graphic.geometry;if(i==null)return null;const e=this._scaleTooltipInfo??(this._scaleTooltipInfo=new rc({tooltipOptions:this.tooltipOptions})),t=Cn(this._mapBounds,this._zmax,i.spatialReference,this._graphicState.isDraped);return t==null?null:(e.xSize=t[0],e.ySize=t[1],this._sizeStart!=null&&this._resizeManipulators.some(a=>a.dragging)?(e.xScale=t[0].value/this._sizeStart[0].value,e.yScale=t[1].value/this._sizeStart[1].value):(e.xScale=1,e.yScale=1),e)}_graphicDrapedChanged(){this._handles.remove(xs),this._updateDisplayBounds(),this._graphicState.isDraped&&this._handles.add(this.view.elevationProvider.on("elevation-change",i=>{this._attachmentOrigin!=null&&Ls(i.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._updateDisplayBounds()}),xs)}_updateAllManipulatorAvailability(){this._forEachManipulator((i,e)=>this._updateManipulatorAvailability(i,e))}_updateManipulatorAvailability(i,e){const t=this.grabbing&&!i.grabbing;if(i.interactive=!t,i instanceof ce){const a=this._graphicState.displaying,n=this.enableZ&&mt(this.graphic);switch(e){case I.ROTATE:i.available=a&&this.enableRotation;break;case I.SCALE:i.available=a&&(this.enableScaling||this.enableRotation||n),i.interactive=!t&&this.enableScaling,i.state=this.enableScaling?Ai:Io;break;case I.TRANSLATE_Z:i.available=a&&n;break;default:i.available=a}}}_forEachManipulator(i){this._graphicMoveManipulation.forEachManipulator(i),this._resizeManipulators.forEach(e=>i(e,I.SCALE)),i(this._rotateManipulator,I.ROTATE),i(this._moveZManipulator,I.TRANSLATE_Z)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(i){this._preserveAspectRatio.enabled=i,this._set("preserveAspectRatio",i)}get _moveUnit(){return zr(this.view.spatialReference)??"meters"}reset(){}_onGeometryChanged(){this._updateDisplayBounds()}_calculateMapBounds(){var l;const i=this.graphic.geometry,e=this._editGeometryOperations.data,t=e.components[0].edges[0],a=As(Oa.get(),t.leftVertex.pos,t.rightVertex.pos);$i(a,a);const n=Xi(this.view,this.graphic)??((l=i.extent)==null?void 0:l.center);let s=n?Ip*this.view.pixelSizeAt(n):0;const o=this.view.spatialReference,r=i.spatialReference;o.equals(r)||(s*=Ta(o)/Ta(r)),kl(a,e,s,this._mapBounds),this._updateZMax()}_updateZMax(){const i=this._editGeometryOperations.data;if(!i.geometry.hasZ)return void(this._zmax=0);const e=i.coordinateHelper;let t=Number.NEGATIVE_INFINITY;for(const a of i.components)for(const n of a.vertices){const s=e.getZ(n.pos)??0;t=Math.max(s,t)}this._zmax=t}_updateDisplayBounds(){const{geometry:i}=this.graphic;if(i==null)return;const{extent:e}=i;if(!e)return;const t=this._outlineVisualElement==null||this._graphicState.isDraped||this._outlineVisualElement.attachmentOrigin==null?Xi(this.view,this.graphic):this._outlineVisualElement.attachmentOrigin;this._attachmentOrigin=t??e.center;const a=t!=null?t.z:ea(this._mapBounds.origin,this.view.elevationProvider,ui.fromElevationInfo(Z(this.graphic)),this.view.renderCoordsHelper),n=Ut(this._mapBounds);n.origin[2]=a??0,Zl(n,this.view.renderCoordsHelper,i.spatialReference,this._displayBoundsMargin,this._displayBounds),this._updateManipulators()}get _displayBoundsMargin(){var t;const i=this.view.pointsOfInterest,e=i?i.centerOnSurfaceFrequent.location:(t=this._editGeometryOperations.data.geometry.extent)==null?void 0:t.center;return e?Dp*this.view.pixelSizeAt(e):0}_createMoveXYGraphicDragPipeline(){return this._graphicMoveManipulation.createDragPipeline((i,e,t)=>this._applyGraphicMoveSteps(e,t,E.XY))}_createMoveZDragPipeline(){const i=this.view,e=this._editGeometryOperations.data.spatialReference;return Ae(this._moveZManipulator,(t,a,n)=>{const s=Jt(t.renderLocation),o=a.next(Eo(i,s,e)).next(Ht());this._applyGraphicMoveSteps(o,n,E.Z)})}_applyGraphicMoveSteps(i,e,t){const a=i.next(n=>(n.action==="start"&&(this.inputState={type:"move"},this._updateOperationStartProperties(),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:n.screenDeltaX,dyScreen:n.screenDeltaY})),n)).next(At()).next(this._moveDragUpdateGeometry()).next(n=>{const s={graphic:this.graphic,dxScreen:n.screenDeltaX,dyScreen:n.screenDeltaY};switch(n.action){case"start":case"update":(n.mapEnd.x-n.mapStart.x||n.mapEnd.y-n.mapStart.y||(n.mapEnd.z??0)-(n.mapStart.z??0))&&this.emit("graphic-translate",s);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",s)}return n}).next(n=>this._updateMoveTooltip(n,t));return e.next(()=>{this.inputState!=null&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this._cancel()}),a}_updateOperationStartProperties(){Ut(this._displayBounds,this._displayBoundsStart),Ut(this._mapBounds,this._mapBoundsStart),this.graphic.geometry!=null?this._sizeStart=Cn(this._mapBoundsStart,this._zmax,this.graphic.geometry.spatialReference,this._graphicState.isDraped):this._sizeStart=null}_moveDragUpdateGeometry(){return i=>{if(this.inputState==null||this.inputState.type!=="move")return i;const e=[];for(const n of this._editGeometryOperations.data.components)e.push(...n.vertices);const t=i.action==="start"?Be.NEW_STEP:Be.ACCUMULATE_STEPS,a=this._editGeometryOperations.moveVertices(e,i.mapDeltaX,i.mapDeltaY,i.mapDeltaZ,t);return mi(a,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,i}}_updateMoveTooltip(i,e){if(e===E.XY||e===E.XY_AXIS){const t=qe(i.mapStart,i.mapEnd,this._graphicState.isDraped?"on-the-ground":"absolute-height");t!=null&&this._moveXYTooltipInfo!=null&&(this._moveXYTooltipInfo.distance=t)}return i}_onResizeGrab({action:i,screenPoint:e}){if(i!=="start"||!e)return;const t=this._calculatePickRay(e);Ct(this._displayBounds.plane,t,y.get())&&(this._updateOperationStartProperties(),this._displayBoundsMarginStart=this._displayBoundsMargin,this.inputState={type:"resize"})}_createResizeDragPipeline(i,e){return Ae(i,(t,a,n)=>{this.inputState!=null&&(a.next(s=>(s.action==="start"&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),s)).next(Bi(this.view,this._displayBoundsStart.plane)).next(s=>({...s,handle:e})).next(this._resizeDragRenderPlaneToFactors()).next(...this._preserveAspectRatio.createDragEventPipelineStep()).next(this._resizeDragUpdateGeometry()).next(s=>{const o={graphic:this.graphic,xScale:s.factor1,yScale:s.factor2};switch(s.action){case"start":case"update":this.emit("graphic-scale",o);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",o)}return s}),n.next(()=>{this.inputState!=null&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this._cancel()}))})}_resizeDragRenderPlaneToFactors(){return i=>{const e=this._displayBoundsStart,t=i.handle.direction,a=this._displayBoundsMargin,n=this._displayBoundsMarginStart,s=oe(y.get(),e.origin);_i(s,s,e.basis1,-t[0]),_i(s,s,e.basis2,-t[1]);const o=P(y.get(),i.renderEnd,s),r=P(y.get(),i.renderStart,s),l=la(i.handle),c=Na(e),p=Na(this._displayBounds)/c,g=(u,_)=>{if(u===0)return 1;let m=He(_),f=.5*u*Ci(_,o)/m;const v=f<0?-1:1;l&&(f+=(m-.5*u*Ci(_,r)/m)*v*p);const x=m<1.5*n?1:Os;return m=Math.max(m-n,Os),v>0&&(f-=a),v*Math.max(v*(f/m),x)};return{...i,factor1:g(t[0],e.basis1),factor2:g(t[1],e.basis2)}}}_resizeDragUpdateGeometry(){return i=>{const e=oe(b(),this._mapBoundsStart.origin);_i(e,e,this._mapBoundsStart.basis1,-i.handle.direction[0]),_i(e,e,this._mapBoundsStart.basis2,-i.handle.direction[1]);const t=Xe(nt(),this._mapBoundsStart.basis1[0],this._mapBoundsStart.basis1[1]);$i(t,t);const a=[];for(const o of this._editGeometryOperations.data.components)a.push(...o.vertices);const n=i.action==="start"?Be.NEW_STEP:Be.ACCUMULATE_STEPS,s=this._editGeometryOperations.scaleVertices(a,e,t,i.factor1,i.factor2,n,In.REPLACE);return Ut(this._mapBoundsStart,this._mapBounds),mi(s,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,i}}_onRotateGrab({action:i,screenPoint:e}){if(i!=="start"||!e)return;const t=up(this._displayBounds,this.view.renderCoordsHelper,li.HEADING,ci()),a=this._calculatePickRay(e);Ct(t,a,y.get())&&(this._updateOperationStartProperties(),this.inputState={type:"rotate",rotatePlane:t})}_createRotateDragPipeline(i){return Ae(i,(e,t,a)=>{const n=this.inputState;n!=null&&(t.next(s=>(s.action==="start"&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),s)).next(Bi(this.view,n.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(n)).next(this._rotateDragUpdateGeometry()).next(s=>{const o={graphic:this.graphic,angle:ai(s.rotateAngle)};switch(s.action){case"start":case"update":this.emit("graphic-rotate",o);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",o)}return s}),a.next(()=>{this.inputState!=null&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this._cancel()}))})}_rotateDragRenderPlaneToRotate(i){return e=>{const t=hi(i.rotatePlane),a=fo(e.renderStart,e.renderEnd,this._displayBounds.origin,t);return{...e,rotateAxis:t,rotateAngle:a}}}_rotateDragUpdateGeometry(){return i=>{const e=oe(b(),this._mapBoundsStart.origin),t=[];for(const s of this._editGeometryOperations.data.components)t.push(...s.vertices);const a=i.action==="start"?Be.NEW_STEP:Be.ACCUMULATE_STEPS,n=this._editGeometryOperations.rotateVertices(t,e,i.rotateAngle,a,In.REPLACE);return Ut(this._mapBoundsStart,this._mapBounds),mi(n,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,i}}_calculatePickRay(i){const e=Qi(),t=Pi(i);return Dt(this.view.state.camera,t,e),ve(e.direction,e.direction),e}_updateManipulators(){if(!this.visible)return;const i=pp(this._displayBounds,ie.get());gp(this._rotateManipulator,i,this._displayBounds,this.view.renderCoordsHelper),this._updateZMoveHandle(this._moveZManipulator,i),this._resizeManipulators.forEach((e,t)=>{dp(e,this._resizeHandles[t],i,this._displayBounds)})}_updateZMoveHandle(i,e){const t=this._displayBounds,a={basis:t.basis1,direction:-1,position:P(y.get(),t.origin,t.basis1),edge:2},n=ie.get();Nr(n,e,a.edge*Math.PI/2),n[12]=0,n[13]=0,n[14]=0,i.modelTransform=n,i.renderLocation=a.position}_cancel(){const i=this._editGeometryOperations.lastOperation;i!=null&&(this._editGeometryOperations.undo(),this.graphic.geometry=this._editGeometryOperations.data.geometry,Ln(i,this._mapBounds),this._updateDisplayBounds(),this.inputState=null)}get canUndo(){return this._editGeometryOperations.canUndo}undo(){if(this.inputState!=null)this.view.activeTool=null;else if(this.canUndo){const i=this._editGeometryOperations.undo();this.graphic.geometry=this._editGeometryOperations.data.geometry,Ln(i,this._mapBounds),this._updateDisplayBounds()}}get canRedo(){return this._editGeometryOperations.canRedo}redo(){if(this.canRedo){const i=this._editGeometryOperations.redo();this.graphic.geometry=this._editGeometryOperations.data.geometry,mi(i,this._mapBounds),this._updateDisplayBounds()}}get test(){return{resizeManipulators:this._resizeManipulators,rotateManipulator:this._rotateManipulator,moveZManipulator:this._moveZManipulator,tooltip:this._tooltip}}};h([d({constructOnly:!0,nonNullable:!0})],de.prototype,"view",void 0),h([d({constructOnly:!0,nonNullable:!0})],de.prototype,"graphic",void 0),h([d({constructOnly:!0,nonNullable:!0})],de.prototype,"enableZ",void 0),h([d()],de.prototype,"enableRotation",void 0),h([d()],de.prototype,"enableScaling",void 0),h([d({constructOnly:!0,type:rt})],de.prototype,"tooltipOptions",void 0),h([d()],de.prototype,"preserveAspectRatio",null),h([d()],de.prototype,"grabbing",void 0),h([d()],de.prototype,"inputState",void 0),h([d({readOnly:!0})],de.prototype,"type",void 0),h([d()],de.prototype,"_moveUnit",null),de=h([K("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],de);const xs="draped-elevation-changes",Dp=10,Ip=80,Os=1e-6,Wu=Object.freeze(Object.defineProperty({__proto__:null,get DrawGraphicTool3D(){return dt},get ExtentTransformTool(){return de},get GraphicMoveTool(){return Ie},get GraphicReshapeTool(){return te},get GraphicTransformTool(){return ue}},Symbol.toStringTag,{value:"Module"}));export{Wu as e,Oc as p,cp as t,Vc as v};
